/*!Amalia.js ========== V1.3.7, Â© INA 2021 */
/**
 * Copyright (c) 2015 Institut National de l'Audiovisuel, INA
 * This file is part of amalia.js

 * amalia.js is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or (at your option) any later version.

 * Redistributions of source code, javascript and css minified versions
 * must retain the above copyright notice, this list of conditions and the following disclaimer.

 * Neither the name of the copyright holder nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.

 * You should have received a copy of the GNU General Public License
 * along with amalia.js. If not, see <http://www.gnu.org/licenses/>

 *
 * amalia.js is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 */


function X2JS(P,T,_){function C(e){var t=e.localName;return t=null==(t=null==t?e.baseName:t)||""==t?e.nodeName:t}function n(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):e}function r(e,t,a,i){var n="<"+(null!=e&&null!=e.__prefix?e.__prefix+":":"")+t;if(null!=a)for(var r=0;r<a.length;r++){var s=a[r],o=e[s];n+=" "+s.substr(1)+"='"+o+"'"}return n+(i?"/>":">")}function s(e,t){return"</"+(null!=e.__prefix?e.__prefix+":":"")+t+">"}function o(e,t){return a=t.toString(),i="_asArray",-1!==a.indexOf(i,a.length-i.length)||0==t.toString().indexOf("_")||e[t]instanceof Function;var a,i}function l(e){var t=0;if(e instanceof Object)for(var a in e)o(e,a)||t++;return t}function d(e){var t=[];if(e instanceof Object)for(var a in e)-1==a.toString().indexOf("__")&&0==a.toString().indexOf("_")&&t.push(a);return t}function u(e){var t,a,i="";return e instanceof Object?i+=(a="",null!=(t=e).__cdata&&(a+="<![CDATA["+t.__cdata+"]]>"),null!=t.__text&&(a+=S?n(t.__text):t.__text),a):null!=e&&(i+=S?n(e):e),i}function c(e){var t,a,i="";if(0<l(e))for(var n in e)o(e,n)||(a=d(t=e[n]),null==t||null==t?i+=r(t,n,a,!0):t instanceof Object?t instanceof Array?i+=function(e,t,a){var i="";if(0==e.length)i+=r(e,t,a,!0);else for(var n=0;n<e.length;n++)i+=r(e[n],t,d(e[n]),!1),i+=c(e[n]),i+=s(e[n],t);return i}(t,n,a):0<l(t)||null!=t.__text||null!=t.__cdata?(i+=r(t,n,a,!1),i+=c(t),i+=s(t,n)):i+=r(t,n,a,!0):(i+=r(t,n,a,!1),i+=u(t),i+=s(t,n)));return i+u(e)}null==T&&(T="_"),null==_&&(_=!1);var S=!1,A={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(e){var t;return window.DOMParser?t=(new window.DOMParser).parseFromString(e,"text/xml"):(0==e.indexOf("<?")&&(e=e.substr(e.indexOf("?>")+2)),(t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e)),t},this.xml2json=function(e){return function e(t){if(t.nodeType==A.DOCUMENT_NODE){for(var a=t.firstChild,i=0,n=t.childNodes.length;i<n;i+=1)if(t.childNodes[i].nodeType!==A.COMMENT_NODE){a=t.childNodes[i];break}return _?r=e(a):(r={})[u=C(a)]=e(a),r}if(t.nodeType!=A.ELEMENT_NODE)return t.nodeType==A.TEXT_NODE||t.nodeType==A.CDATA_SECTION_NODE?t.nodeValue:t.nodeType==A.COMMENT_NODE?null:void 0;var r;(r=new Object).__cnt=0;for(var s=[],o=t.childNodes,l=0;l<o.length;l++){var d,u=C(a=o.item(l));if(r.__cnt++,null==r[u]){var c=e(a);"#text"==u&&!/[^\s]/.test(c)||((f={})[u]=c,s.push(f)),r[u]=c,r[u+"_asArray"]=new Array(1),r[u+"_asArray"][0]=r[u]}else{null==r[u]||r[u]instanceof Array||(d=r[u],r[u]=new Array,r[u][0]=d,r[u+"_asArray"]=r[u]);for(var h=0;null!=r[u][h];)h++;var f,c=e(a);"#text"==u&&!/[^\s]/.test(c)||((f={})[u]=c,s.push(f)),r[u][h]=c}}r.__children=s;for(var p=0;p<t.attributes.length;p++){var g=t.attributes.item(p);r.__cnt++;for(var m=g.value,y=0,E=P.length;y<E;y++){var v=P[y];v.test.call(this,g)&&(m=v.converter.call(this,g.value))}r[T+g.name]=m}var M=t.prefix;return null!=M&&""!=M&&(r.__cnt++,r.__prefix=M),null!=(r=1==r.__cnt&&null!=r["#text"]?r["#text"]:r)["#text"]&&(r.__text=r["#text"],S&&(r.__text=r.__text.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")),delete r["#text"],delete r["#text_asArray"]),null!=r["#cdata-section"]&&(r.__cdata=r["#cdata-section"],delete r["#cdata-section"],delete r["#cdata-section_asArray"]),null==r.__text&&null==r.__cdata||(r.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),r}(e)},this.xml_str2json=function(e){e=this.parseXmlString(e);return this.xml2json(e)},this.json2xml_str=c,this.json2xml=function(e){e=this.json2xml_str(e);return this.parseXmlString(e)},this.getVersion=function(){return"1.0.11"},this.escapeMode=function(e){S=e}}function ObjectIron(l){var d=[];for(i=0,len=l.length;i<len;i+=1)l[i].isRoot?d.push("root"):d.push(l[i].name);function u(e,t,a){var i,n,r,s,o;if(null!==e&&0!==e.length)for(i=0,n=e.length;i<n;i+=1)r=e[i],t.hasOwnProperty(r.name)&&(a.hasOwnProperty(r.name)?r.merge&&(s=t[r.name],o=a[r.name],"object"==typeof s&&"object"==typeof o?function(e,t){if(null!==e&&null!==t)for(var a in e)e.hasOwnProperty(a)&&(t.hasOwnProperty(a)||(t[a]=e[a]))}(s,o):null!=r.mergeFunction?a[r.name]=r.mergeFunction(s,o):a[r.name]=s+o):a[r.name]=t[r.name])}var c=function(e,t){var a,i,n,r,s,o,l,d=e;if(null!==d.children&&0!==d.children.length)for(a=0,i=d.children.length;a<i;a+=1)if(o=d.children[a],t.hasOwnProperty(o.name))if(o.isArray)for(n=0,r=(s=t[o.name+"_asArray"]).length;n<r;n+=1)l=s[n],u(d.properties,t,l),c(o,l);else l=t[o.name],u(d.properties,t,l),c(o,l)},h=function(e){var t,a,i,n,r,s,o;if(null===e)return e;if("object"!=typeof e)return e;for(t=0,a=d.length;t<a;t+=1)"root"===d[t]&&(r=l[t],c(r,s=e));for(n in e)if(e.hasOwnProperty(n)&&"__children"!=n){if(-1!==(i=d.indexOf(n)))if((r=l[i]).isArray)for(t=0,a=(o=e[n+"_asArray"]).length;t<a;t+=1)s=o[t],c(r,s);else s=e[n],c(r,s);h(e[n])}return e};return{run:h}}var utils;!function(u){function c(e,t,a){return e[t]||a&&(e[t]={})}function h(e){return(e=typeof e)&&("function"==e||"object"==e)}function s(e,t,a){var i,n,r,s=e?e.split(f):[],o=s.length,l=u.isArray(t)?t:[t||window],d=0;if(0==o)return l[0];for(;i=l[d++];){for(r=0;r<o-1&&h(i);r++)i=c(i,s[r],a);if(h(i)&&void 0!==(n=c(i,s[r],a)))return!1===a&&delete i[s[r]],n}}var n=/_|-/,t=/::/,a=/([A-Z]+)([A-Z][a-z])/g,r=/([a-z\d])([A-Z])/g,o=/([a-z\d])([A-Z])/g,l=/\{([^\}]+)\}/g,f=/\./,d=u.String=u.extend(u.String||{},{getObject:s,capitalize:function(e,t){return e.charAt(0).toUpperCase()+e.substr(1)},camelize:function(e){return(e=d.classize(e)).charAt(0).toLowerCase()+e.substr(1)},classize:function(e,t){for(var a=e.split(n),i=0;i<a.length;i++)a[i]=d.capitalize(a[i]);return a.join(t||"")},niceName:function(e){d.classize(parts[i]," ")},underscore:function(e){return e.replace(t,"/").replace(a,"$1_$2").replace(r,"$1_$2").replace(o,"_").toLowerCase()},sub:function(e,i,n){var r=[];return r.push(e.replace(l,function(e,t){var a=s(t,i,"boolean"==typeof n?!n:n),t=typeof a;return"object"!=t&&"function"!=t||null===t?""+a:(r.push(a),"")})),r.length<=1?r[0]:r}})}(jQuery),function(e){function d(e,t){return e.concat(a(t))}function u(e,n,t){for(var a in t=t||e,e)t[a]=i(e[a])&&i(n[a])&&r.test(e[a])?function(a,i){return function(){var e,t=this._super;return this._super=n[a],e=i.apply(this,arguments),this._super=t,e}}(a,e[a]):e[a]}var c=!1,a=e.makeArray,i=e.isFunction,l=e.isArray,h=e.extend,r=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,f=e.Class=function(){arguments.length&&f.extend.apply(f,arguments)};h(f,{callback:function(r){var s,o=a(arguments);return r=o.shift(),l(r)||(r=[r]),s=this,function(){for(var e,t,a=d(o,arguments),i=r.length,n=0;n<i;n++)(t=r[n])&&((e="string"==typeof t)&&s._set_called&&(s.called=t),a=(e?s[t]:t).apply(s,a||[]),n<i-1&&(a=!l(a)||a._use_call?[a]:a));return a}},getObject:e.String.getObject,newInstance:function(){var e,t=this.rawInstance();return t.setup&&(e=t.setup.apply(t,arguments)),t.init&&t.init.apply(t,l(e)?e:arguments),t},setup:function(e,t){return this.defaults=h(!0,{},e.defaults,this.defaults),arguments},rawInstance:function(){c=!0;var e=new this;return c=!1,e},extend:function(e,t,a){"string"!=typeof e&&(a=t,t=e,e=null),a||(a=t,t=null),a=a||{};var i,n,r,s=this.prototype;function o(){if(!c)return this.constructor!==o&&arguments.length?arguments.callee.extend.apply(arguments.callee,arguments):this.Class.newInstance.apply(this.Class,arguments)}for(i in c=!0,n=new this,c=!1,u(a,s,n),this)this.hasOwnProperty(i)&&(o[i]=this[i]);u(t,this,o),e&&(l=(r=e.split(/\./)).pop(),(r=f.getObject(r.join("."),window,!0))[l]=o),h(o,{prototype:n,namespace:r,shortName:l,constructor:o,fullName:e});var l=(o.prototype.Class=o.prototype.constructor=o).setup.apply(o,d([this],arguments));return o.init&&o.init.apply(o,l||[]),o}}),f.prototype.callback=f.callback}(jQuery),function(e){"object"==typeof exports?module.exports=e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(d){"use strict";var a={},u=Math.max,c=Math.min;a.c={},a.c.d=d(document),a.c.t=function(e){return e.originalEvent.touches.length-1},a.o=function(){var i=this;this.o=null,this.$=null,this.i=null,this.g=null,this.v=null,this.cv=null,this.x=0,this.y=0,this.w=0,this.h=0,this.$c=null,this.c=null,this.t=0,this.isInit=!1,this.fgColor=null,this.pColor=null,this.dH=null,this.cH=null,this.eH=null,this.rH=null,this.scale=1,this.relative=!1,this.relativeWidth=!1,this.relativeHeight=!1,this.$div=null,this.run=function(){function e(e,t){for(var a in t)i.o[a]=t[a];i._carve().init(),i._configure()._draw()}if(!this.$.data("kontroled")){if(this.$.data("kontroled",!0),this.extend(),this.o=d.extend({min:void 0!==this.$.data("min")?this.$.data("min"):0,max:void 0!==this.$.data("max")?this.$.data("max"):100,stopper:!0,readOnly:this.$.data("readonly")||"readonly"===this.$.attr("readonly"),cursor:(!0===this.$.data("cursor")?30:this.$.data("cursor"))||0,thickness:this.$.data("thickness")&&Math.max(Math.min(this.$.data("thickness"),1),.01)||.35,lineCap:this.$.data("linecap")||"butt",width:this.$.data("width")||200,height:this.$.data("height")||200,displayInput:null==this.$.data("displayinput")||this.$.data("displayinput"),displayPrevious:this.$.data("displayprevious"),fgColor:this.$.data("fgcolor")||"#87CEEB",inputColor:this.$.data("inputcolor"),font:this.$.data("font")||"Arial",fontWeight:this.$.data("font-weight")||"bold",inline:!1,step:this.$.data("step")||1,rotation:this.$.data("rotation"),draw:null,change:null,cancel:null,release:null,format:function(e){return e},parse:function(e){return parseFloat(e)}},this.o),this.o.flip="anticlockwise"===this.o.rotation||"acw"===this.o.rotation,this.o.inputColor||(this.o.inputColor=this.o.fgColor),this.$.is("fieldset")?(this.v={},this.i=this.$.find("input"),this.i.each(function(t){var a=d(this);i.i[t]=a,i.v[t]=i.o.parse(a.val()),a.bind("change blur",function(){var e={};e[t]=a.val(),i.val(i._validate(e))})}),this.$.find("legend").remove()):(this.i=this.$,this.v=this.o.parse(this.$.val()),""===this.v&&(this.v=this.o.min),this.$.bind("change blur",function(){i.val(i._validate(i.o.parse(i.$.val())))})),this.o.displayInput||this.$.hide(),this.$c=d(document.createElement("canvas")).attr({width:this.o.width,height:this.o.height}),this.$div=d('<div style="'+(this.o.inline?"display:inline;":"")+"width:"+this.o.width+"px;height:"+this.o.height+'px;"></div>'),this.$.wrap(this.$div).before(this.$c),this.$div=this.$.parent(),"undefined"!=typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement(this.$c[0]),this.c=this.$c[0].getContext?this.$c[0].getContext("2d"):null,!this.c)throw{name:"CanvasNotSupportedException",message:"Canvas not supported. Please use excanvas on IE8.0.",toString:function(){return this.name+": "+this.message}};return this.scale=(window.devicePixelRatio||1)/(this.c.webkitBackingStorePixelRatio||this.c.mozBackingStorePixelRatio||this.c.msBackingStorePixelRatio||this.c.oBackingStorePixelRatio||this.c.backingStorePixelRatio||1),this.relativeWidth=this.o.width%1!=0&&this.o.width.indexOf("%"),this.relativeHeight=this.o.height%1!=0&&this.o.height.indexOf("%"),this.relative=this.relativeWidth||this.relativeHeight,this._carve(),this.v instanceof Object?(this.cv={},this.copy(this.v,this.cv)):this.cv=this.v,this.$.bind("configure",e).parent().bind("configure",e),this._listen()._configure()._xy().init(),this.isInit=!0,this.$.val(this.o.format(this.v)),this._draw(),this}},this._carve=function(){var e,t;return this.relative?(e=this.relativeWidth?this.$div.parent().width()*parseInt(this.o.width)/100:this.$div.parent().width(),t=this.relativeHeight?this.$div.parent().height()*parseInt(this.o.height)/100:this.$div.parent().height(),this.w=this.h=Math.min(e,t)):(this.w=this.o.width,this.h=this.o.height),this.$div.css({width:this.w+"px",height:this.h+"px"}),this.$c.attr({width:this.w,height:this.h}),1!==this.scale&&(this.$c[0].width=this.$c[0].width*this.scale,this.$c[0].height=this.$c[0].height*this.scale,this.$c.width(this.w),this.$c.height(this.h)),this},this._draw=function(){var e=!0;i.g=i.c,i.clear(),!1!==(e=i.dH?i.dH():e)&&i.draw()},this._touch=function(e){function t(e){(e=i.xy2val(e.originalEvent.touches[i.t].pageX,e.originalEvent.touches[i.t].pageY))!=i.cv&&(i.cH&&!1===i.cH(e)||(i.change(i._validate(e)),i._draw()))}return this.t=a.c.t(e),t(e),a.c.d.bind("touchmove.k",t).bind("touchend.k",function(){a.c.d.unbind("touchmove.k touchend.k"),i.val(i.cv)}),this},this._mouse=function(e){function t(e){(e=i.xy2val(e.pageX,e.pageY))!=i.cv&&(i.cH&&!1===i.cH(e)||(i.change(i._validate(e)),i._draw()))}return t(e),a.c.d.bind("mousemove.k",t).bind("keyup.k",function(e){27===e.keyCode&&(a.c.d.unbind("mouseup.k mousemove.k keyup.k"),i.eH&&!1===i.eH()||i.cancel())}).bind("mouseup.k",function(e){a.c.d.unbind("mousemove.k mouseup.k keyup.k"),i.val(i.cv)}),this},this._xy=function(){var e=this.$c.offset();return this.x=e.left,this.y=e.top,this},this._listen=function(){return this.o.readOnly?this.$.attr("readonly","readonly"):(this.$c.bind("mousedown",function(e){e.preventDefault(),i._xy()._mouse(e)}).bind("touchstart",function(e){e.preventDefault(),i._xy()._touch(e)}),this.listen()),this.relative&&d(window).resize(function(){i._carve().init(),i._draw()}),this},this._configure=function(){return this.o.draw&&(this.dH=this.o.draw),this.o.change&&(this.cH=this.o.change),this.o.cancel&&(this.eH=this.o.cancel),this.o.release&&(this.rH=this.o.release),this.o.displayPrevious?(this.pColor=this.h2rgba(this.o.fgColor,"0.4"),this.fgColor=this.h2rgba(this.o.fgColor,"0.6")):this.fgColor=this.o.fgColor,this},this._clear=function(){this.$c[0].width=this.$c[0].width},this._validate=function(e){e=~~((e<0?-.5:.5)+e/this.o.step)*this.o.step;return Math.round(100*e)/100},this.listen=function(){},this.extend=function(){},this.init=function(){},this.change=function(e){},this.val=function(e){},this.xy2val=function(e,t){},this.draw=function(){},this.clear=function(){this._clear()},this.h2rgba=function(e,t){return e=e.substring(1,7),"rgba("+(e=[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)])[0]+","+e[1]+","+e[2]+","+t+")"},this.copy=function(e,t){for(var a in e)t[a]=e[a]}},a.Dial=function(){a.o.call(this),this.startAngle=null,this.xy=null,this.radius=null,this.lineWidth=null,this.cursorExt=null,this.w2=null,this.PI2=2*Math.PI,this.extend=function(){this.o=d.extend({bgColor:this.$.data("bgcolor")||"#EEEEEE",angleOffset:this.$.data("angleoffset")||0,angleArc:this.$.data("anglearc")||360,inline:!0},this.o)},this.val=function(e,t){if(null==e)return this.v;e=this.o.parse(e),!1!==t&&e!=this.v&&this.rH&&!1===this.rH(e)||(this.cv=this.o.stopper?u(c(e,this.o.max),this.o.min):e,this.v=this.cv,this.$.val(this.o.format(this.v)),this._draw())},this.xy2val=function(e,t){var t=Math.atan2(e-(this.x+this.w2),-(t-this.y-this.w2))-this.angleOffset;return this.o.flip&&(t=this.angleArc-t-this.PI2),this.angleArc!=this.PI2&&t<0&&-.5<t?t=0:t<0&&(t+=this.PI2),t=t*(this.o.max-this.o.min)/this.angleArc+this.o.min,t=this.o.stopper?u(c(t,this.o.max),this.o.min):t},this.listen=function(){function e(e){e.preventDefault();var e=(t=e.originalEvent).detail||t.wheelDeltaX,t=t.detail||t.wheelDeltaY,a=s._validate(s.o.parse(s.$.val()))+(0<e||0<t?s.o.step:e<0||t<0?-s.o.step:0),a=u(c(a,s.o.max),s.o.min);s.val(a,!1),s.rH&&(clearTimeout(i),i=setTimeout(function(){s.rH(a),i=null},100),n=n||setTimeout(function(){i&&s.rH(a),n=null},200))}var i,n,a,r,s=this,o=1,l={37:-s.o.step,38:s.o.step,39:s.o.step,40:-s.o.step};this.$.bind("keydown",function(e){var t=e.keyCode;96<=t&&t<=105&&(t=e.keyCode=t-48),a=parseInt(String.fromCharCode(t)),isNaN(a)&&(13===t||8===t||9===t||189===t||190===t&&!s.$.val().match(/\./)||e.preventDefault(),-1<d.inArray(t,[37,38,39,40])&&(e.preventDefault(),t=s.o.parse(s.$.val())+l[t]*o,s.o.stopper&&(t=u(c(t,s.o.max),s.o.min)),s.change(s._validate(t)),s._draw(),r=window.setTimeout(function(){o*=2},30)))}).bind("keyup",function(e){isNaN(a)?r&&(window.clearTimeout(r),r=null,o=1,s.val(s.$.val())):s.$.val()>s.o.max&&s.$.val(s.o.max)||s.$.val()<s.o.min&&s.$.val(s.o.min)}),this.$c.bind("mousewheel DOMMouseScroll",e),this.$.bind("mousewheel DOMMouseScroll",e)},this.init=function(){(this.v<this.o.min||this.v>this.o.max)&&(this.v=this.o.min),this.$.val(this.v),this.w2=this.w/2,this.cursorExt=this.o.cursor/100,this.xy=this.w2*this.scale,this.lineWidth=this.xy*this.o.thickness,this.lineCap=this.o.lineCap,this.radius=this.xy-this.lineWidth/2,this.o.angleOffset&&(this.o.angleOffset=isNaN(this.o.angleOffset)?0:this.o.angleOffset),this.o.angleArc&&(this.o.angleArc=isNaN(this.o.angleArc)?this.PI2:this.o.angleArc),this.angleOffset=this.o.angleOffset*Math.PI/180,this.angleArc=this.o.angleArc*Math.PI/180,this.startAngle=1.5*Math.PI+this.angleOffset,this.endAngle=1.5*Math.PI+this.angleOffset+this.angleArc;var e=u(String(Math.abs(this.o.max)).length,String(Math.abs(this.o.min)).length,2)+2;this.o.displayInput&&this.i.css({width:(this.w/2+4>>0)+"px",height:(this.w/3>>0)+"px",position:"absolute","vertical-align":"middle","margin-top":(this.w/3>>0)+"px","margin-left":"-"+(3*this.w/4+2>>0)+"px",border:0,background:"none",font:this.o.fontWeight+" "+(this.w/e>>0)+"px "+this.o.font,"text-align":"center",color:this.o.inputColor||this.o.fgColor,padding:"0px","-webkit-appearance":"none"})||this.i.css({width:"0px",visibility:"hidden"})},this.change=function(e){this.cv=e,this.$.val(this.o.format(e))},this.angle=function(e){return(e-this.o.min)*this.angleArc/(this.o.max-this.o.min)},this.arc=function(e){var t;return e=this.angle(e),e=this.o.flip?(t=this.endAngle+1e-5)-e-1e-5:(t=this.startAngle-1e-5)+e+1e-5,this.o.cursor&&(t=e-this.cursorExt)&&(e+=this.cursorExt),{s:t,e:e,d:this.o.flip&&!this.o.cursor}},this.draw=function(){var e,t=this.g,a=this.arc(this.cv),i=1;t.lineWidth=this.lineWidth,t.lineCap=this.lineCap,"none"!==this.o.bgColor&&(t.beginPath(),t.strokeStyle=this.o.bgColor,t.arc(this.xy,this.xy,this.radius,this.endAngle-1e-5,this.startAngle+1e-5,!0),t.stroke()),this.o.displayPrevious&&(e=this.arc(this.v),t.beginPath(),t.strokeStyle=this.pColor,t.arc(this.xy,this.xy,this.radius,e.s,e.e,e.d),t.stroke(),i=this.cv==this.v),t.beginPath(),t.strokeStyle=(i?this.o:this).fgColor,t.arc(this.xy,this.xy,this.radius,a.s,a.e,a.d),t.stroke()},this.cancel=function(){this.val(this.v)}},d.fn.dial=d.fn.knob=function(t){return this.each(function(){var e=new a.Dial;e.o=t,e.$=d(this),e.run()}).parent()}}),function(t){var e,a,i,n;function r(e,t){var a,i;1<e.originalEvent.touches.length||(e.preventDefault(),a=e.originalEvent.changedTouches[0],(i=document.createEvent("MouseEvents")).initMouseEvent(t,!0,!0,window,1,a.screenX,a.screenY,a.clientX,a.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(i))}t.support.touch="ontouchend"in document,t.support.touch&&(e=t.ui.mouse.prototype,a=e._mouseInit,i=e._mouseDestroy,e._touchStart=function(e){!n&&this._mouseCapture(e.originalEvent.changedTouches[0])&&(n=!0,this._touchMoved=!1,r(e,"mouseover"),r(e,"mousemove"),r(e,"mousedown"))},e._touchMove=function(e){n&&(this._touchMoved=!0,r(e,"mousemove"))},e._touchEnd=function(e){n&&(r(e,"mouseup"),r(e,"mouseout"),this._touchMoved||r(e,"click"),n=!1)},e._mouseInit=function(){var e=this;e.element.bind({touchstart:t.proxy(e,"_touchStart"),touchmove:t.proxy(e,"_touchMove"),touchend:t.proxy(e,"_touchEnd")}),a.call(e)},e._mouseDestroy=function(){var e=this;e.element.unbind({touchstart:t.proxy(e,"_touchStart"),touchmove:t.proxy(e,"_touchMove"),touchend:t.proxy(e,"_touchEnd")}),i.call(e)})}(jQuery),function(e){"use strict";var t={VERSION:"0.5.3",System:function(){this._mappings={},this._outlets={},this._handlers={},this.strictInjections=!0,this.autoMapOutlets=!1,this.postInjectionHook="setup"}};t.System.prototype={_createAndSetupInstance:function(e,t){t=new t;return this.injectInto(t,e),t},_retrieveFromCacheOrCreate:function(e,t){if(void 0===t&&(t=!1),!this._mappings.hasOwnProperty(e))throw new Error(1e3);var a=this._mappings[e];return!t&&a.isSingleton?(null==a.object&&(a.object=this._createAndSetupInstance(e,a.clazz)),a.object):a.clazz?this._createAndSetupInstance(e,a.clazz):a.object},mapOutlet:function(e,t,a){if(void 0===e)throw new Error(1010);return a=a||e,this._outlets.hasOwnProperty(t=t||"global")||(this._outlets[t]={}),this._outlets[t][a]=e,this},getObject:function(e){if(void 0===e)throw new Error(1020);return this._retrieveFromCacheOrCreate(e)},mapValue:function(e,t){if(void 0===e)throw new Error(1030);return this._mappings[e]={clazz:null,object:t,isSingleton:!0},this.autoMapOutlets&&this.mapOutlet(e),this.hasMapping(e)&&this.injectInto(t,e),this},hasMapping:function(e){if(void 0===e)throw new Error(1040);return this._mappings.hasOwnProperty(e)},mapClass:function(e,t){if(void 0===e)throw new Error(1050);if(void 0===t)throw new Error(1051);return this._mappings[e]={clazz:t,object:null,isSingleton:!1},this.autoMapOutlets&&this.mapOutlet(e),this},mapSingleton:function(e,t){if(void 0===e)throw new Error(1060);if(void 0===t)throw new Error(1061);return this._mappings[e]={clazz:t,object:null,isSingleton:!0},this.autoMapOutlets&&this.mapOutlet(e),this},instantiate:function(e){if(void 0===e)throw new Error(1070);return this._retrieveFromCacheOrCreate(e,!0)},injectInto:function(e,t){if(void 0===e)throw new Error(1080);if("object"==typeof e){var a,i=[];for(a in this._outlets.hasOwnProperty("global")&&i.push(this._outlets.global),void 0!==t&&this._outlets.hasOwnProperty(t)&&i.push(this._outlets[t]),i){var n,r=i[a];for(n in r){var s=r[n];(!this.strictInjections||n in e)&&(e[n]=this.getObject(s))}}"setup"in e&&e.setup.call(e)}return this},unmap:function(e){if(void 0===e)throw new Error(1090);return delete this._mappings[e],this},unmapOutlet:function(e,t){if(void 0===e)throw new Error(1100);if(void 0===t)throw new Error(1101);return delete this._outlets[e][t],this},mapHandler:function(e,t,a,i,n){if(void 0===e)throw new Error(1110);return t=t||"global",a=a||e,void 0===i&&(i=!1),void 0===n&&(n=!1),this._handlers.hasOwnProperty(e)||(this._handlers[e]={}),this._handlers[e].hasOwnProperty(t)||(this._handlers[e][t]=[]),this._handlers[e][t].push({handler:a,oneShot:i,passEvent:n}),this},unmapHandler:function(e,t,a){if(void 0===e)throw new Error(1120);if(t=t||"global",a=a||e,this._handlers.hasOwnProperty(e)&&this._handlers[e].hasOwnProperty(t)){var i,n=this._handlers[e][t];for(i in n)if(n[i].handler===a){n.splice(i,1);break}}return this},notify:function(e){if(void 0===e)throw new Error(1130);var t=Array.prototype.slice.call(arguments),a=t.slice(1);if(this._handlers.hasOwnProperty(e)){var i,n=this._handlers[e];for(i in n){var r,s=n[i];"global"!==i&&(r=this.getObject(i));for(var o=[],l=0,d=s.length;l<d;l++){var u=s[l],c=r&&"string"==typeof u.handler?r[u.handler]:u.handler;u.oneShot&&o.unshift(l),u.passEvent?c.apply(r,t):c.apply(r,a)}for(l=0,d=o.length;l<d;l++)s.splice(o[l],1)}}return this}},e.dijon=t}(this),void 0===utils&&(utils={}),void 0===utils.Math&&(utils.Math={}),utils.Math.to64BitNumber=function(e,t){t=new goog.math.Long(0,t),e=new goog.math.Long(e,0);return t.add(e).toNumber()},goog={math:{}},goog.math.Long=function(e,t){this.low_=0|e,this.high_=0|t},goog.math.Long.IntCache_={},goog.math.Long.fromInt=function(e){if(-128<=e&&e<128){var t=goog.math.Long.IntCache_[e];if(t)return t}t=new goog.math.Long(0|e,e<0?-1:0);return-128<=e&&e<128&&(goog.math.Long.IntCache_[e]=t),t},goog.math.Long.fromNumber=function(e){return isNaN(e)||!isFinite(e)?goog.math.Long.ZERO:e<=-goog.math.Long.TWO_PWR_63_DBL_?goog.math.Long.MIN_VALUE:e+1>=goog.math.Long.TWO_PWR_63_DBL_?goog.math.Long.MAX_VALUE:e<0?goog.math.Long.fromNumber(-e).negate():new goog.math.Long(e%goog.math.Long.TWO_PWR_32_DBL_|0,e/goog.math.Long.TWO_PWR_32_DBL_|0)},goog.math.Long.fromBits=function(e,t){return new goog.math.Long(e,t)},goog.math.Long.fromString=function(e,t){if(0==e.length)throw Error("number format error: empty string");var a=t||10;if(a<2||36<a)throw Error("radix out of range: "+a);if("-"==e.charAt(0))return goog.math.Long.fromString(e.substring(1),a).negate();if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character: '+e);for(var i=goog.math.Long.fromNumber(Math.pow(a,8)),n=goog.math.Long.ZERO,r=0;r<e.length;r+=8){var s=Math.min(8,e.length-r),o=parseInt(e.substring(r,r+s),a);n=s<8?(s=goog.math.Long.fromNumber(Math.pow(a,s)),n.multiply(s).add(goog.math.Long.fromNumber(o))):(n=n.multiply(i)).add(goog.math.Long.fromNumber(o))}return n},goog.math.Long.TWO_PWR_16_DBL_=65536,goog.math.Long.TWO_PWR_24_DBL_=1<<24,goog.math.Long.TWO_PWR_32_DBL_=goog.math.Long.TWO_PWR_16_DBL_*goog.math.Long.TWO_PWR_16_DBL_,goog.math.Long.TWO_PWR_31_DBL_=goog.math.Long.TWO_PWR_32_DBL_/2,goog.math.Long.TWO_PWR_48_DBL_=goog.math.Long.TWO_PWR_32_DBL_*goog.math.Long.TWO_PWR_16_DBL_,goog.math.Long.TWO_PWR_64_DBL_=goog.math.Long.TWO_PWR_32_DBL_*goog.math.Long.TWO_PWR_32_DBL_,goog.math.Long.TWO_PWR_63_DBL_=goog.math.Long.TWO_PWR_64_DBL_/2,goog.math.Long.ZERO=goog.math.Long.fromInt(0),goog.math.Long.ONE=goog.math.Long.fromInt(1),goog.math.Long.NEG_ONE=goog.math.Long.fromInt(-1),goog.math.Long.MAX_VALUE=goog.math.Long.fromBits(-1,2147483647),goog.math.Long.MIN_VALUE=goog.math.Long.fromBits(0,-2147483648),goog.math.Long.TWO_PWR_24_=goog.math.Long.fromInt(1<<24),goog.math.Long.prototype.toInt=function(){return this.low_},goog.math.Long.prototype.toNumber=function(){return this.high_*goog.math.Long.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},goog.math.Long.prototype.toString=function(e){var t=e||10;if(t<2||36<t)throw Error("radix out of range: "+t);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(goog.math.Long.MIN_VALUE)){var a=goog.math.Long.fromNumber(t),e=this.div(a),i=e.multiply(a).subtract(this);return e.toString(t)+i.toInt().toString(t)}return"-"+this.negate().toString(t)}for(var n=goog.math.Long.fromNumber(Math.pow(t,6)),i=this,r="";;){var s=i.div(n),o=i.subtract(s.multiply(n)).toInt().toString(t);if((i=s).isZero())return o+r;for(;o.length<6;)o="0"+o;r=""+o+r}},goog.math.Long.prototype.getHighBits=function(){return this.high_},goog.math.Long.prototype.getLowBits=function(){return this.low_},goog.math.Long.prototype.getLowBitsUnsigned=function(){return 0<=this.low_?this.low_:goog.math.Long.TWO_PWR_32_DBL_+this.low_},goog.math.Long.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(goog.math.Long.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var e=0!=this.high_?this.high_:this.low_,t=31;0<t&&0==(e&1<<t);t--);return 0!=this.high_?t+33:t+1},goog.math.Long.prototype.isZero=function(){return 0==this.high_&&0==this.low_},goog.math.Long.prototype.isNegative=function(){return this.high_<0},goog.math.Long.prototype.isOdd=function(){return 1==(1&this.low_)},goog.math.Long.prototype.equals=function(e){return this.high_==e.high_&&this.low_==e.low_},goog.math.Long.prototype.notEquals=function(e){return this.high_!=e.high_||this.low_!=e.low_},goog.math.Long.prototype.lessThan=function(e){return this.compare(e)<0},goog.math.Long.prototype.lessThanOrEqual=function(e){return this.compare(e)<=0},goog.math.Long.prototype.greaterThan=function(e){return 0<this.compare(e)},goog.math.Long.prototype.greaterThanOrEqual=function(e){return 0<=this.compare(e)},goog.math.Long.prototype.compare=function(e){if(this.equals(e))return 0;var t=this.isNegative(),a=e.isNegative();return t&&!a||(t||!a)&&this.subtract(e).isNegative()?-1:1},goog.math.Long.prototype.negate=function(){return this.equals(goog.math.Long.MIN_VALUE)?goog.math.Long.MIN_VALUE:this.not().add(goog.math.Long.ONE)},goog.math.Long.prototype.add=function(e){var t=this.high_>>>16,a=65535&this.high_,i=this.low_>>>16,n=65535&this.low_,r=e.high_>>>16,s=65535&e.high_,o=e.low_>>>16,l=0,d=0,u=0,c=0;return u+=(c+=n+(65535&e.low_))>>>16,c&=65535,d+=(u+=i+o)>>>16,u&=65535,l+=(d+=a+s)>>>16,d&=65535,l+=t+r,l&=65535,goog.math.Long.fromBits(u<<16|c,l<<16|d)},goog.math.Long.prototype.subtract=function(e){return this.add(e.negate())},goog.math.Long.prototype.multiply=function(e){if(this.isZero())return goog.math.Long.ZERO;if(e.isZero())return goog.math.Long.ZERO;if(this.equals(goog.math.Long.MIN_VALUE))return e.isOdd()?goog.math.Long.MIN_VALUE:goog.math.Long.ZERO;if(e.equals(goog.math.Long.MIN_VALUE))return this.isOdd()?goog.math.Long.MIN_VALUE:goog.math.Long.ZERO;if(this.isNegative())return e.isNegative()?this.negate().multiply(e.negate()):this.negate().multiply(e).negate();if(e.isNegative())return this.multiply(e.negate()).negate();if(this.lessThan(goog.math.Long.TWO_PWR_24_)&&e.lessThan(goog.math.Long.TWO_PWR_24_))return goog.math.Long.fromNumber(this.toNumber()*e.toNumber());var t=this.high_>>>16,a=65535&this.high_,i=this.low_>>>16,n=65535&this.low_,r=e.high_>>>16,s=65535&e.high_,o=e.low_>>>16,l=65535&e.low_,d=0,u=0,c=0,e=0;return c+=(e+=n*l)>>>16,e&=65535,u+=(c+=i*l)>>>16,c&=65535,u+=(c+=n*o)>>>16,c&=65535,d+=(u+=a*l)>>>16,u&=65535,d+=(u+=i*o)>>>16,u&=65535,d+=(u+=n*s)>>>16,u&=65535,d+=t*l+a*o+i*s+n*r,d&=65535,goog.math.Long.fromBits(c<<16|e,d<<16|u)},goog.math.Long.prototype.div=function(e){if(e.isZero())throw Error("division by zero");if(this.isZero())return goog.math.Long.ZERO;if(this.equals(goog.math.Long.MIN_VALUE)){if(e.equals(goog.math.Long.ONE)||e.equals(goog.math.Long.NEG_ONE))return goog.math.Long.MIN_VALUE;if(e.equals(goog.math.Long.MIN_VALUE))return goog.math.Long.ONE;if((i=this.shiftRight(1).div(e).shiftLeft(1)).equals(goog.math.Long.ZERO))return e.isNegative()?goog.math.Long.ONE:goog.math.Long.NEG_ONE;var t=this.subtract(e.multiply(i));return i.add(t.div(e))}if(e.equals(goog.math.Long.MIN_VALUE))return goog.math.Long.ZERO;if(this.isNegative())return e.isNegative()?this.negate().div(e.negate()):this.negate().div(e).negate();if(e.isNegative())return this.div(e.negate()).negate();for(var a=goog.math.Long.ZERO,t=this;t.greaterThanOrEqual(e);){for(var i=Math.max(1,Math.floor(t.toNumber()/e.toNumber())),n=Math.ceil(Math.log(i)/Math.LN2),r=n<=48?1:Math.pow(2,n-48),s=goog.math.Long.fromNumber(i),o=s.multiply(e);o.isNegative()||o.greaterThan(t);)i-=r,o=(s=goog.math.Long.fromNumber(i)).multiply(e);s.isZero()&&(s=goog.math.Long.ONE),a=a.add(s),t=t.subtract(o)}return a},goog.math.Long.prototype.modulo=function(e){return this.subtract(this.div(e).multiply(e))},goog.math.Long.prototype.not=function(){return goog.math.Long.fromBits(~this.low_,~this.high_)},goog.math.Long.prototype.and=function(e){return goog.math.Long.fromBits(this.low_&e.low_,this.high_&e.high_)},goog.math.Long.prototype.or=function(e){return goog.math.Long.fromBits(this.low_|e.low_,this.high_|e.high_)},goog.math.Long.prototype.xor=function(e){return goog.math.Long.fromBits(this.low_^e.low_,this.high_^e.high_)},goog.math.Long.prototype.shiftLeft=function(e){if(0==(e&=63))return this;var t=this.low_;if(e<32){var a=this.high_;return goog.math.Long.fromBits(t<<e,a<<e|t>>>32-e)}return goog.math.Long.fromBits(0,t<<e-32)},goog.math.Long.prototype.shiftRight=function(e){if(0==(e&=63))return this;var t=this.high_;if(e<32){var a=this.low_;return goog.math.Long.fromBits(a>>>e|t<<32-e,t>>e)}return goog.math.Long.fromBits(t>>e-32,0<=t?0:-1)},goog.math.Long.prototype.shiftRightUnsigned=function(e){if(0==(e&=63))return this;var t=this.high_;if(e<32){var a=this.low_;return goog.math.Long.fromBits(a>>>e|t<<32-e,t>>>e)}return 32==e?goog.math.Long.fromBits(t,0):goog.math.Long.fromBits(t>>>e-32,0)};var UTF8={encode:function(e){for(var t=[],a=0;a<e.length;++a){var i=e.charCodeAt(a);i<128?t.push(i):(i<2048?t.push(192|i>>6):(i<65536?t.push(224|i>>12):(t.push(240|i>>18),t.push(128|63&i>>12)),t.push(128|63&i>>6)),t.push(128|63&i))}return t},decode:function(e){for(var t=[],a=0;a<e.length;){var i=e[a++];i<128||(i<224?i=(31&i)<<6:(i<240?i=(15&i)<<12:(i=(7&i)<<18,i|=(63&e[a++])<<12),i|=(63&e[a++])<<6),i|=63&e[a++]),t.push(String.fromCharCode(i))}return t.join("")}},BASE64={},btoa,atob;(function(r){function t(e){for(var t=0,a=[],i=0|e.length/3;0<i--;){var n=(e[t]<<16)+(e[t+1]<<8)+e[t+2];t+=3,a.push(r.charAt(63&n>>18)),a.push(r.charAt(63&n>>12)),a.push(r.charAt(63&n>>6)),a.push(r.charAt(63&n))}return 2==e.length-t?(n=(e[t]<<16)+(e[t+1]<<8),a.push(r.charAt(63&n>>18)),a.push(r.charAt(63&n>>12)),a.push(r.charAt(63&n>>6)),a.push("=")):1==e.length-t&&(n=e[t]<<16,a.push(r.charAt(63&n>>18)),a.push(r.charAt(63&n>>12)),a.push("==")),a.join("")}function i(e){for(var t=0,a=[],i=0|e.length/4;0<i--;){var n=(o[e.charCodeAt(t)]<<18)+(o[e.charCodeAt(t+1)]<<12)+(o[e.charCodeAt(t+2)]<<6)+o[e.charCodeAt(t+3)];a.push(255&n>>16),a.push(255&n>>8),a.push(255&n),t+=4}return a&&("="==e.charAt(t-2)?(a.pop(),a.pop()):"="==e.charAt(t-1)&&a.pop()),a}var o=function(){for(var e=[],t=0;t<r.length;++t)e[r.charCodeAt(t)]=t;return e["=".charCodeAt(0)]=0,e}(),n={encode:function(e){for(var t=[],a=0;a<e.length;++a)t.push(e.charCodeAt(a));return t},decode:function(e){for(var t=0;t<s.length;++t)a[t]=String.fromCharCode(a[t]);return a.join("")}};BASE64.decodeArray=function(e){e=i(e);return new Uint8Array(e)},BASE64.encodeASCII=function(e){e=n.encode(e);return t(e)},BASE64.decodeASCII=function(e){e=i(e);return n.decode(e)},BASE64.encode=function(e){e=UTF8.encode(e);return t(e)},BASE64.decode=function(e){e=i(e);return UTF8.decode(e)}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),void 0===btoa&&(btoa=BASE64.encode),void 0===atob&&(atob=BASE64.decode);var ISOBoxer=ISOBoxer||{};ISOBoxer.Cursor=function(e){this.offset=void 0===e?0:e};var ISOBox=function(){this._cursor=new ISOBoxer.Cursor};ISOBox.parse=function(e){var t=new ISOBox;return t._offset=e._cursor.offset,t._root=e._root||e,t._raw=e._raw,t._parent=e,t._parseBox(),e._cursor.offset=t._raw.byteOffset+t._raw.byteLength,t},ISOBox.prototype._readInt=function(e){var t=null;switch(e){case 8:t=this._raw.getInt8(this._cursor.offset-this._raw.byteOffset);break;case 16:t=this._raw.getInt16(this._cursor.offset-this._raw.byteOffset);break;case 32:t=this._raw.getInt32(this._cursor.offset-this._raw.byteOffset)}return this._cursor.offset+=e>>3,t},ISOBox.prototype._readUint=function(e){var t=null;switch(e){case 8:t=this._raw.getUint8(this._cursor.offset-this._raw.byteOffset);break;case 16:t=this._raw.getUint16(this._cursor.offset-this._raw.byteOffset);break;case 24:t=((a=this._raw.getUint16(this._cursor.offset-this._raw.byteOffset))<<8)+(i=this._raw.getUint8(this._cursor.offset-this._raw.byteOffset+2));break;case 32:t=this._raw.getUint32(this._cursor.offset-this._raw.byteOffset);break;case 64:var a=this._raw.getUint32(this._cursor.offset-this._raw.byteOffset),i=this._raw.getUint32(this._cursor.offset-this._raw.byteOffset+4);t=a*Math.pow(2,32)+i}return this._cursor.offset+=e>>3,t},ISOBox.prototype._readString=function(e){for(var t="",a=0;a<e;a++){var i=this._readUint(8);t+=String.fromCharCode(i)}return t},ISOBox.prototype._readTerminatedString=function(){for(var e="";;){var t=this._readUint(8);if(0==t)break;e+=String.fromCharCode(t)}return e},ISOBox.prototype._readTemplate=function(e){return this._readUint(e/2)+this._readUint(e/2)/Math.pow(2,e/2)},ISOBox.prototype._parseBox=function(){if(this._cursor.offset=this._offset,this._offset+8>this._raw.buffer.byteLength)this._root._incomplete=!0;else{switch(this.size=this._readUint(32),this.type=this._readString(4),1==this.size&&(this.largesize=this._readUint(64)),"uuid"==this.type&&(this.usertype=this._readString(16)),this.size){case 0:this._raw=new DataView(this._raw.buffer,this._offset,this._raw.byteLength-this._cursor.offset);break;case 1:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.largesize);break;default:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.size)}!this._incomplete&&this._boxParsers[this.type]&&this._boxParsers[this.type].call(this)}},ISOBox.prototype._parseFullBox=function(){this.version=this._readUint(8),this.flags=this._readUint(24)},ISOBox.prototype._boxParsers={},["moov","trak","tref","mdia","minf","stbl","edts","dinf","mvex","moof","traf","mfra","udta","meco","strk"].forEach(function(e){ISOBox.prototype._boxParsers[e]=function(){for(this.boxes=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.boxes.push(ISOBox.parse(this))}}),ISOBox.prototype._boxParsers.emsg=function(){this._parseFullBox(),this.scheme_id_uri=this._readTerminatedString(),this.value=this._readTerminatedString(),this.timescale=this._readUint(32),this.presentation_time_delta=this._readUint(32),this.event_duration=this._readUint(32),this.id=this._readUint(32),this.message_data=new DataView(this._raw.buffer,this._cursor.offset,this._raw.byteLength-(this._cursor.offset-this._offset))},ISOBox.prototype._boxParsers.free=ISOBox.prototype._boxParsers.skip=function(){this.data=new DataView(this._raw.buffer,this._cursor.offset,this._raw.byteLength-(this._cursor.offset-this._offset))},ISOBox.prototype._boxParsers.ftyp=ISOBox.prototype._boxParsers.styp=function(){for(this.major_brand=this._readString(4),this.minor_versions=this._readUint(32),this.compatible_brands=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.compatible_brands.push(this._readString(4))},ISOBox.prototype._boxParsers.mdat=function(){this.data=new DataView(this._raw.buffer,this._cursor.offset,this._raw.byteLength-(this._cursor.offset-this._offset))},ISOBox.prototype._boxParsers.mdhd=function(){this._parseFullBox(),1==this.version?(this.creation_time=this._readUint(64),this.modification_time=this._readUint(64),this.timescale=this._readUint(32),this.duration=this._readUint(64)):(this.creation_time=this._readUint(32),this.modification_time=this._readUint(32),this.timescale=this._readUint(32),this.duration=this._readUint(32));var e=this._readUint(16);this.pad=e>>15,this.language=String.fromCharCode(96+(e>>10&31),96+(e>>5&31),96+(31&e)),this.pre_defined=this._readUint(16)},ISOBox.prototype._boxParsers.mfhd=function(){this._parseFullBox(),this.sequence_number=this._readUint(32)},ISOBox.prototype._boxParsers.mvhd=function(){this._parseFullBox(),1==this.version?(this.creation_time=this._readUint(64),this.modification_time=this._readUint(64),this.timescale=this._readUint(32),this.duration=this._readUint(64)):(this.creation_time=this._readUint(32),this.modification_time=this._readUint(32),this.timescale=this._readUint(32),this.duration=this._readUint(32)),this.rate=this._readTemplate(32),this.volume=this._readTemplate(16),this.reserved1=this._readUint(16),this.reserved2=[this._readUint(32),this._readUint(32)],this.matrix=[];for(var e=0;e<9;e++)this.matrix.push(this._readTemplate(32));this.pre_defined=[];for(e=0;e<6;e++)this.pre_defined.push(this._readUint(32));this.next_track_ID=this._readUint(32)},ISOBox.prototype._boxParsers.sidx=function(){this._parseFullBox(),this.reference_ID=this._readUint(32),this.timescale=this._readUint(32),0==this.version?(this.earliest_presentation_time=this._readUint(32),this.first_offset=this._readUint(32)):(this.earliest_presentation_time=this._readUint(64),this.first_offset=this._readUint(64)),this.reserved=this._readUint(16),this.reference_count=this._readUint(16),this.references=[];for(var e=0;e<this.reference_count;e++){var t={},a=this._readUint(32);t.reference_type=a>>31&1,t.referenced_size=2147483647&a,t.subsegment_duration=this._readUint(32);a=this._readUint(32);t.starts_with_SAP=a>>31&1,t.SAP_type=a>>28&7,t.SAP_delta_time=268435455&a,this.references.push(t)}},ISOBox.prototype._boxParsers.ssix=function(){this._parseFullBox(),this.subsegment_count=this._readUint(32),this.subsegments=[];for(var e=0;e<this.subsegment_count;e++){var t={};t.ranges_count=this._readUint(32),t.ranges=[];for(var a=0;a<t.ranges_count;a++){var i={};i.level=this._readUint(8),i.range_size=this._readUint(24),t.ranges.push(i)}this.subsegments.push(t)}},ISOBox.prototype._boxParsers.tkhd=function(){this._parseFullBox(),1==this.version?(this.creation_time=this._readUint(64),this.modification_time=this._readUint(64),this.track_ID=this._readUint(32),this.reserved1=this._readUint(32),this.duration=this._readUint(64)):(this.creation_time=this._readUint(32),this.modification_time=this._readUint(32),this.track_ID=this._readUint(32),this.reserved1=this._readUint(32),this.duration=this._readUint(32)),this.reserved2=[this._readUint(32),this._readUint(32)],this.layer=this._readUint(16),this.alternate_group=this._readUint(16),this.volume=this._readTemplate(16),this.reserved3=this._readUint(16),this.matrix=[];for(var e=0;e<9;e++)this.matrix.push(this._readTemplate(32));this.width=this._readUint(32),this.height=this._readUint(32)},ISOBox.prototype._boxParsers.tfdt=function(){this._parseFullBox(),this.baseMediaDecodeTime=this._readUint(1==this.version?64:32)},ISOBox.prototype._boxParsers.tfhd=function(){this._parseFullBox(),this.track_ID=this._readUint(32),1&this.flags&&(this.base_data_offset=this._readUint(64)),2&this.flags&&(this.sample_description_offset=this._readUint(32)),8&this.flags&&(this.default_sample_duration=this._readUint(32)),16&this.flags&&(this.default_sample_size=this._readUint(32)),32&this.flags&&(this.default_sample_flags=this._readUint(32))},ISOBox.prototype._boxParsers.trun=function(){this._parseFullBox(),this.sample_count=this._readUint(32),1&this.flags&&(this.data_offset=this._readInt(32)),4&this.flags&&(this.first_sample_flags=this._readUint(32)),this.samples=[];for(var e=0;e<this.sample_count;e++){var t={};256&this.flags&&(t.sample_duration=this._readUint(32)),512&this.flags&&(t.sample_size=this._readUint(32)),1024&this.flags&&(t.sample_flags=this._readUint(32)),2048&this.flags&&(t.sample_composition_time_offset=0==this.version?this._readUint(32):this._readInt(32)),this.samples.push(t)}};var ISOBoxer=ISOBoxer||{};ISOBoxer.parseBuffer=function(e){return new ISOFile(e).parse()},ISOBoxer.Utils={},ISOBoxer.Utils.dataViewToString=function(e,t){if("undefined"!=typeof TextDecoder)return new TextDecoder(t||"utf-8").decode(e);for(var a="",i=0;i<e.byteLength;i++)a+=String.fromCharCode(e.getUint8(i));return a},"undefined"!=typeof exports&&(exports.parseBuffer=ISOBoxer.parseBuffer,exports.Utils=ISOBoxer.Utils);var ISOFile=function(e){this._raw=new DataView(e),this._cursor=new ISOBoxer.Cursor,this.boxes=[]};ISOFile.prototype.fetch=function(e){e=this.fetchAll(e,!0);return e.length?e[0]:null},ISOFile.prototype.fetchAll=function(e,t){var a=[];return ISOFile._sweep.call(this,e,a,t),a},ISOFile.prototype.parse=function(){for(this._cursor.offset=0,this.boxes=[];this._cursor.offset<this._raw.byteLength;){var e=ISOBox.parse(this);if(void 0===e.type)break;this.boxes.push(e)}return this},ISOFile._sweep=function(e,t,a){for(var i in this.type&&this.type==e&&t.push(this),this.boxes){if(t.length&&a)return;ISOFile._sweep.call(this.boxes[i],e,t,a)}},MediaPlayer=function(e){"use strict";function a(){return!!c&&!!h&&!S}function t(){if(!C)throw"MediaPlayer not initialized!";if(this.capabilities.supportsMediaSource()){if(!c||!h)throw"Missing view or source.";A=!0,this.debug.log("Playback initiated!"),f=l.getObject("streamController"),g.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,f),g.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_TIME_UPDATED,f),g.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_CAN_PLAY,f),g.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ERROR,f),g.setLiveDelayAttributes(I,O),l.mapValue("liveDelayFragmentCount",I),l.mapOutlet("liveDelayFragmentCount","trackController"),f.initialize(b,T,_),M.checkInitialBitrate(),"string"==typeof h?f.load(h):f.loadWithManifest(h),f.setUTCTimingSources(D,N),l.mapValue("scheduleWhilePaused",L),l.mapOutlet("scheduleWhilePaused","stream"),l.mapOutlet("scheduleWhilePaused","scheduleController"),l.mapValue("numOfParallelRequestAllowed",P),l.mapOutlet("numOfParallelRequestAllowed","scheduleController"),l.mapValue("bufferMax",R),l.mapOutlet("bufferMax","bufferController"),p.initialize()}else this.errHandler.capabilityError("mediasource")}function i(){a()&&t.call(this)}function n(){var e=y.getReadOnlyMetricsFor("video")||y.getReadOnlyMetricsFor("audio");return m.getCurrentDVRInfo(e)}function r(e){var t=n.call(this);return null===t?0:e+(t.manifestInfo.availableFrom.getTime()/1e3+t.range.start)}function s(e,t,a){t&&null!=e&&(a?p.setRules(e,t):p.addRules(e,t))}function o(){var e,t;this.adapter.reset(),A&&f?S||(S=!0,g.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,f),g.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_TIME_UPDATED,f),g.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_CAN_PLAY,f),g.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ERROR,f),t=this,(e={})[MediaPlayer.dependencies.StreamController.eventList.ENAME_TEARDOWN_COMPLETE]=function(){d.reset(),p.reset(),g.reset(),u.reset(),f=null,S=A=!1,a.call(t)&&i.call(t)},f.subscribe(MediaPlayer.dependencies.StreamController.eventList.ENAME_TEARDOWN_COMPLETE,e,void 0,!0),f.reset()):a.call(this)&&i.call(this)}var l,d,u,c,h,f,p,g,m,y,E,v,M,P=0,T=null,_=null,C=!1,S=!1,A=!1,b=!0,L=!1,R=MediaPlayer.dependencies.BufferController.BUFFER_SIZE_REQUIRED,N=!0,D=[],I=4,O=!1,x=dijon.System.prototype.getObject;dijon.System.prototype.getObject=function(e){var t=x.call(this,e);return"object"!=typeof t||t.getName||(t.getName=function(){return e},t.setMediaType=function(e){t.mediaType=e},t.getMediaType=function(){return t.mediaType}),t},(l=new dijon.System).mapValue("system",l),l.mapOutlet("system"),l.mapValue("eventBus",new MediaPlayer.utils.EventBus),l.mapOutlet("eventBus");var w=new MediaPlayer.utils.Debug;return l.mapValue("debug",w),l.mapOutlet("debug"),l.injectInto(w),w.setup(),l.injectInto(e),{notifier:void 0,debug:void 0,eventBus:void 0,capabilities:void 0,adapter:void 0,errHandler:void 0,uriQueryFragModel:void 0,videoElementExt:void 0,setup:function(){m=l.getObject("metricsExt"),d=l.getObject("abrController"),p=l.getObject("rulesController"),y=l.getObject("metricsModel"),M=l.getObject("DOMStorage"),g=l.getObject("playbackController"),u=l.getObject("mediaController"),this.restoreDefaultUTCTimingSources()},addEventListener:function(e,t,a){e=e.toLowerCase(),this.eventBus.addEventListener(e,t,a)},removeEventListener:function(e,t,a){e=e.toLowerCase(),this.eventBus.removeEventListener(e,t,a)},getVersion:function(){return"1.5.0"},getObjectByContextName:function(e){return l.getObject(e)},startup:function(){C||(l.injectInto(this),C=!0)},getDebug:function(){return this.debug},getVideoModel:function(){return E},setLiveDelayFragmentCount:function(e){I=e},useSuggestedPresentationDelay:function(e){O=e},enableLastBitrateCaching:function(e,t){M.enableLastBitrateCaching(e,t)},enableLastMediaSettingsCaching:function(e,t){M.enableLastMediaSettingsCaching(e,t)},setNumOfParallelRequestAllowed:function(e){P=e},setMaxAllowedBitrateFor:function(e,t){d.setMaxAllowedBitrateFor(e,t)},getMaxAllowedBitrateFor:function(e){return d.getMaxAllowedBitrateFor(e)},setAutoPlay:function(e){b=e},getAutoPlay:function(){return b},setScheduleWhilePaused:function(e){L=e},getScheduleWhilePaused:function(){return L},setBufferMax:function(e){R=e},getBufferMax:function(){return R},getMetricsExt:function(){return m},getMetricsFor:function(e){return y.getReadOnlyMetricsFor(e)},getQualityFor:function(e){return d.getQualityFor(e,f.getActiveStreamInfo())},setQualityFor:function(e,t){d.setPlaybackQuality(e,f.getActiveStreamInfo(),t)},setTextTrack:function(e){void 0===v&&(v=l.getObject("textSourceBuffer"));for(var t=c.textTracks,a=t.length,i=0;i<a;i++){var n=t[i],r=e===i?"showing":"hidden";n.mode!==r&&(n.mode=r)}v.isFragmented&&v.setTextTrack()},getBitrateInfoListFor:function(e){var t=function(){var e=f.getActiveStreamInfo();return e?f.getStreamById(e.id):null}.call(this);return t?t.getBitrateListFor(e):[]},setInitialBitrateFor:function(e,t){d.setInitialBitrateFor(e,t)},getInitialBitrateFor:function(e){return d.getInitialBitrateFor(e)},getStreamsFromManifest:function(e){return this.adapter.getStreamsInfo(e)},getTracksFor:function(e){var t=f?f.getActiveStreamInfo():null;return t?u.getTracksFor(e,t):[]},getTracksForTypeFromManifest:function(e,t,a){return(a=a||this.adapter.getStreamsInfo(t)[0])?this.adapter.getAllMediaInfoForType(t,a,e):[]},getCurrentTrackFor:function(e){var t=f?f.getActiveStreamInfo():null;return t?u.getCurrentTrackFor(e,t):null},setInitialMediaSettingsFor:function(e,t){u.setInitialSettings(e,t)},getInitialMediaSettingsFor:function(e){return u.getInitialSettings(e)},setCurrentTrack:function(e){u.setTrack(e)},getTrackSwitchModeFor:function(e){return u.getSwitchMode(e)},setTrackSwitchModeFor:function(e,t){u.setSwitchMode(e,t)},setSelectionModeForInitialTrack:function(e){u.setSelectionModeForInitialTrack(e)},getSelectionModeForInitialTrack:function(){return u.getSelectionModeForInitialTrack()},getAutoSwitchQuality:function(){return d.getAutoSwitchBitrate()},setAutoSwitchQuality:function(e){d.setAutoSwitchBitrate(e)},setSchedulingRules:function(e){s.call(this,p.SCHEDULING_RULE,e,!0)},addSchedulingRules:function(e){s.call(this,p.SCHEDULING_RULE,e,!1)},setABRRules:function(e){s.call(this,p.ABR_RULE,e,!0)},addABRRules:function(e){s.call(this,p.ABR_RULE,e,!1)},createProtection:function(){return l.getObject("protectionController")},retrieveManifest:function(e,t){var a,i,n;a=e,i=l.getObject("manifestLoader"),n=l.getObject("uriQueryFragModel"),(e={})[MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED]=function(e){e.error?t(null,e.error):t(e.data.manifest),i.unsubscribe(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,this)},i.subscribe(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,e),i.load(n.parseURI(a))},addUTCTimingSource:function(e,t){this.removeUTCTimingSource(e,t);var a=new Dash.vo.UTCTiming;a.schemeIdUri=e,a.value=t,D.push(a)},removeUTCTimingSource:function(a,i){D.forEach(function(e,t){e.schemeIdUri===a&&e.value===i&&D.splice(t,1)})},clearDefaultUTCTimingSources:function(){D=[]},restoreDefaultUTCTimingSources:function(){this.addUTCTimingSource("urn:mpeg:dash:utc:http-xsdate:2014","http://time.akamai.com/?iso")},enableManifestDateHeaderTimeSource:function(e){N=e},attachView:function(e){if(!C)throw"MediaPlayer not initialized!";E=null,(c=e)&&(E=l.getObject("videoModel")).setElement(c),o.call(this)},attachTTMLRenderingDiv:function(e){if(!E)throw"Must call attachView with video element before you attach TTML Rendering Div";E.setTTMLRenderingDiv(e)},attachSource:function(e,t,a){if(!C)throw"MediaPlayer not initialized!";h="string"==typeof e?(this.uriQueryFragModel.reset(),this.uriQueryFragModel.parseURI(e)):e,T=t,_=a,o.call(this)},reset:function(){this.attachSource(null),this.attachView(null),_=T=null},play:t,isReady:a,seek:function(e){e=g.getIsDynamic()?this.getDVRSeekOffset(e):e;this.getVideoModel().setCurrentTime(e)},time:function(){var e,t=E.getCurrentTime();return t=g.getIsDynamic()?null===(e=n.call(this))?0:this.duration()-(e.range.end-e.time):t},duration:function(){var e=E.getElement().duration;if(g.getIsDynamic()){var t,a=n.call(this);if(null===a)return 0;e=(t=a.range.end-a.range.start)<a.manifestInfo.DVRWindowSize?t:a.manifestInfo.DVRWindowSize}return e},timeAsUTC:function(){return r.call(this,this.time())},durationAsUTC:function(){return r.call(this,this.duration())},getDVRWindowSize:function(){return n.call(this).manifestInfo.DVRWindowSize},getDVRSeekOffset:function(e){var t=n.call(this),e=t.range.start+e;return e=e>t.range.end?t.range.end:e},formatUTC:function(e,t,a){var i=new Date(1e3*e),e=i.toLocaleDateString(t);return i.toLocaleTimeString(t,{hour12:a})+" "+e},convertToTimeCode:function(e){e=Math.max(e,0);var t=Math.floor(e/3600),a=Math.floor(e%3600/60),e=Math.floor(e%3600%60);return(0===t?"":t<10?"0"+t.toString()+":":t.toString()+":")+(a<10?"0"+a.toString():a.toString())+":"+(e<10?"0"+e.toString():e.toString())}}},MediaPlayer.prototype={constructor:MediaPlayer},MediaPlayer.dependencies={},MediaPlayer.dependencies.protection={},MediaPlayer.dependencies.protection.servers={},MediaPlayer.utils={},MediaPlayer.models={},MediaPlayer.vo={},MediaPlayer.vo.metrics={},MediaPlayer.vo.protection={},MediaPlayer.rules={},MediaPlayer.di={},MediaPlayer.events={RESET_COMPLETE:"resetComplete",METRICS_CHANGED:"metricschanged",METRIC_CHANGED:"metricchanged",METRIC_UPDATED:"metricupdated",METRIC_ADDED:"metricadded",MANIFEST_LOADED:"manifestloaded",PROTECTION_CREATED:"protectioncreated",PROTECTION_DESTROYED:"protectiondestroyed",STREAM_SWITCH_STARTED:"streamswitchstarted",STREAM_SWITCH_COMPLETED:"streamswitchcompleted",STREAM_INITIALIZED:"streaminitialized",TEXT_TRACK_ADDED:"texttrackadded",TEXT_TRACKS_ADDED:"alltexttracksadded",BUFFER_LOADED:"bufferloaded",BUFFER_EMPTY:"bufferstalled",ERROR:"error",LOG:"log"},MediaPlayer.di.Context=function(){"use strict";return{system:void 0,setup:function(){this.system.autoMapOutlets=!0,this.system.mapClass("eventBusCl",MediaPlayer.utils.EventBus),this.system.mapSingleton("capabilities",MediaPlayer.utils.Capabilities),this.system.mapSingleton("DOMStorage",MediaPlayer.utils.DOMStorage),this.system.mapClass("customTimeRanges",MediaPlayer.utils.CustomTimeRanges),this.system.mapSingleton("virtualBuffer",MediaPlayer.utils.VirtualBuffer),this.system.mapClass("isoFile",MediaPlayer.utils.IsoFile),this.system.mapSingleton("textTrackExtensions",MediaPlayer.utils.TextTrackExtensions),this.system.mapSingleton("vttParser",MediaPlayer.utils.VTTParser),this.system.mapSingleton("ttmlParser",MediaPlayer.utils.TTMLParser),this.system.mapSingleton("boxParser",MediaPlayer.utils.BoxParser),this.system.mapSingleton("videoModel",MediaPlayer.models.VideoModel),this.system.mapSingleton("manifestModel",MediaPlayer.models.ManifestModel),this.system.mapSingleton("metricsModel",MediaPlayer.models.MetricsModel),this.system.mapSingleton("uriQueryFragModel",MediaPlayer.models.URIQueryAndFragmentModel),this.system.mapSingleton("ksPlayReady",MediaPlayer.dependencies.protection.KeySystem_PlayReady),this.system.mapSingleton("ksWidevine",MediaPlayer.dependencies.protection.KeySystem_Widevine),this.system.mapSingleton("ksClearKey",MediaPlayer.dependencies.protection.KeySystem_ClearKey),this.system.mapSingleton("serverPlayReady",MediaPlayer.dependencies.protection.servers.PlayReady),this.system.mapSingleton("serverWidevine",MediaPlayer.dependencies.protection.servers.Widevine),this.system.mapSingleton("serverClearKey",MediaPlayer.dependencies.protection.servers.ClearKey),this.system.mapSingleton("serverDRMToday",MediaPlayer.dependencies.protection.servers.DRMToday),this.system.mapSingleton("requestModifierExt",MediaPlayer.dependencies.RequestModifierExtensions),this.system.mapSingleton("textSourceBuffer",MediaPlayer.dependencies.TextSourceBuffer),this.system.mapSingleton("mediaSourceExt",MediaPlayer.dependencies.MediaSourceExtensions),this.system.mapSingleton("sourceBufferExt",MediaPlayer.dependencies.SourceBufferExtensions),this.system.mapSingleton("abrController",MediaPlayer.dependencies.AbrController),this.system.mapSingleton("errHandler",MediaPlayer.dependencies.ErrorHandler),this.system.mapSingleton("videoExt",MediaPlayer.dependencies.VideoModelExtensions),this.system.mapSingleton("protectionExt",MediaPlayer.dependencies.ProtectionExtensions),this.system.mapClass("protectionController",MediaPlayer.dependencies.ProtectionController),this.system.mapSingleton("playbackController",MediaPlayer.dependencies.PlaybackController),function(){var e=document.createElement("video");MediaPlayer.models.ProtectionModel_21Jan2015.detect(e)?this.system.mapClass("protectionModel",MediaPlayer.models.ProtectionModel_21Jan2015):MediaPlayer.models.ProtectionModel_3Feb2014.detect(e)?this.system.mapClass("protectionModel",MediaPlayer.models.ProtectionModel_3Feb2014):MediaPlayer.models.ProtectionModel_01b.detect(e)?this.system.mapClass("protectionModel",MediaPlayer.models.ProtectionModel_01b):(this.debug.log("No supported version of EME detected on this user agent!"),this.debug.log("Attempts to play encrypted content will fail!"))}.call(this),this.system.mapSingleton("liveEdgeFinder",MediaPlayer.dependencies.LiveEdgeFinder),this.system.mapClass("metrics",MediaPlayer.models.MetricsList),this.system.mapClass("insufficientBufferRule",MediaPlayer.rules.InsufficientBufferRule),this.system.mapClass("bufferOccupancyRule",MediaPlayer.rules.BufferOccupancyRule),this.system.mapClass("throughputRule",MediaPlayer.rules.ThroughputRule),this.system.mapSingleton("abrRulesCollection",MediaPlayer.rules.ABRRulesCollection),this.system.mapSingleton("rulesController",MediaPlayer.rules.RulesController),this.system.mapClass("bufferLevelRule",MediaPlayer.rules.BufferLevelRule),this.system.mapClass("pendingRequestsRule",MediaPlayer.rules.PendingRequestsRule),this.system.mapClass("playbackTimeRule",MediaPlayer.rules.PlaybackTimeRule),this.system.mapClass("sameTimeRequestRule",MediaPlayer.rules.SameTimeRequestRule),this.system.mapClass("abandonRequestRule",MediaPlayer.rules.AbandonRequestsRule),this.system.mapSingleton("scheduleRulesCollection",MediaPlayer.rules.ScheduleRulesCollection),this.system.mapClass("liveEdgeBinarySearchRule",MediaPlayer.rules.LiveEdgeBinarySearchRule),this.system.mapClass("liveEdgeWithTimeSynchronizationRule",MediaPlayer.rules.LiveEdgeWithTimeSynchronizationRule),this.system.mapSingleton("synchronizationRulesCollection",MediaPlayer.rules.SynchronizationRulesCollection),this.system.mapClass("xlinkController",MediaPlayer.dependencies.XlinkController),this.system.mapClass("xlinkLoader",MediaPlayer.dependencies.XlinkLoader),this.system.mapClass("streamProcessor",MediaPlayer.dependencies.StreamProcessor),this.system.mapClass("eventController",MediaPlayer.dependencies.EventController),this.system.mapClass("textController",MediaPlayer.dependencies.TextController),this.system.mapClass("bufferController",MediaPlayer.dependencies.BufferController),this.system.mapClass("manifestLoader",MediaPlayer.dependencies.ManifestLoader),this.system.mapSingleton("manifestUpdater",MediaPlayer.dependencies.ManifestUpdater),this.system.mapClass("fragmentController",MediaPlayer.dependencies.FragmentController),this.system.mapClass("fragmentLoader",MediaPlayer.dependencies.FragmentLoader),this.system.mapClass("fragmentModel",MediaPlayer.dependencies.FragmentModel),this.system.mapSingleton("streamController",MediaPlayer.dependencies.StreamController),this.system.mapSingleton("mediaController",MediaPlayer.dependencies.MediaController),this.system.mapClass("stream",MediaPlayer.dependencies.Stream),this.system.mapClass("scheduleController",MediaPlayer.dependencies.ScheduleController),this.system.mapSingleton("timeSyncController",MediaPlayer.dependencies.TimeSyncController),this.system.mapSingleton("notifier",MediaPlayer.dependencies.Notifier)}}},Dash={modules:{},dependencies:{},vo:{},di:{}},Dash.di.DashContext=function(){"use strict";return{system:void 0,debug:void 0,setup:function(){Dash.di.DashContext.prototype.setup.call(this),this.system.mapClass("parser",Dash.dependencies.DashParser),this.system.mapClass("indexHandler",Dash.dependencies.DashHandler),this.system.mapSingleton("baseURLExt",Dash.dependencies.BaseURLExtensions),this.system.mapClass("fragmentExt",Dash.dependencies.FragmentExtensions),this.system.mapClass("representationController",Dash.dependencies.RepresentationController),this.system.mapSingleton("manifestExt",Dash.dependencies.DashManifestExtensions),this.system.mapSingleton("metricsExt",Dash.dependencies.DashMetricsExtensions),this.system.mapSingleton("timelineConverter",Dash.dependencies.TimelineConverter),this.system.mapSingleton("adapter",Dash.dependencies.DashAdapter)}}},Dash.di.DashContext.prototype=new MediaPlayer.di.Context,Dash.di.DashContext.prototype.constructor=Dash.di.DashContext,Dash.dependencies.DashAdapter=function(){"use strict";function n(e,t){return t.getRepresentationForQuality(e.quality)}function o(e){return c[e.streamInfo.id][e.index]}function u(e){for(var t,a=r.length,i=0;i<a;i+=1)if(t=r[i],e.id===t.id)return t;return null}function i(e,t){var a=new MediaPlayer.vo.TrackInfo,i=t.adaptation.period.mpd.manifest.Period_asArray[t.adaptation.period.index].AdaptationSet_asArray[t.adaptation.index],i=this.manifestExt.getRepresentationFor(t.index,i);return a.id=t.id,a.quality=t.index,a.bandwidth=this.manifestExt.getBandwidth(i),a.DVRWindow=t.segmentAvailabilityRange,a.fragmentDuration=t.segmentDuration||(t.segments&&0<t.segments.length?t.segments[0].duration:NaN),a.MSETimeOffset=t.MSETimeOffset,a.useCalculatedLiveEdgeTime=t.useCalculatedLiveEdgeTime,a.mediaInfo=h.call(this,e,t.adaptation),a}var r=[],c={},h=function(e,t){var a=new MediaPlayer.vo.MediaInfo,i=this,n=t.period.mpd.manifest.Period_asArray[t.period.index].AdaptationSet_asArray[t.index];return a.id=t.id,a.index=t.index,a.type=t.type,a.streamInfo=s.call(this,e,t.period),a.representationCount=this.manifestExt.getRepresentationCount(n),a.lang=this.manifestExt.getLanguageForAdaptation(n),t=this.manifestExt.getViewpointForAdaptation(n),a.viewpoint=t?t.value:void 0,a.accessibility=this.manifestExt.getAccessibilityForAdaptation(n).map(function(e){return e.value}),a.audioChannelConfiguration=this.manifestExt.getAudioChannelConfigurationForAdaptation(n).map(function(e){return e.value}),a.roles=this.manifestExt.getRolesForAdaptation(n).map(function(e){return e.value}),a.codec=this.manifestExt.getCodec(n),a.mimeType=this.manifestExt.getMimeType(n),a.contentProtection=this.manifestExt.getContentProtectionData(n),a.bitrateList=this.manifestExt.getBitrateListForAdaptation(n),a.contentProtection&&a.contentProtection.forEach(function(e){e.KID=i.manifestExt.getKID(e)}),a.isText=this.manifestExt.getIsTextTrack(a.mimeType),a},s=function(e,t){var a=new MediaPlayer.vo.StreamInfo;return a.id=t.id,a.index=t.index,a.start=t.start,a.duration=t.duration,a.manifestInfo=l.call(this,e,t.mpd),a.isLast=1===e.Period_asArray.length||Math.abs(a.start+a.duration-a.manifestInfo.duration)<1,a},l=function(e,t){var a=new MediaPlayer.vo.ManifestInfo;return a.DVRWindowSize=t.timeShiftBufferDepth,a.loadedTime=t.manifest.loadedTime,a.availableFrom=t.availabilityStartTime,a.minBufferTime=t.manifest.minBufferTime,a.maxFragmentDuration=t.maxSegmentDuration,a.duration=this.manifestExt.getDuration(e),a.isDynamic=this.manifestExt.getIsDynamic(e),a};return{system:void 0,manifestExt:void 0,timelineConverter:void 0,metricsList:{TCP_CONNECTION:"TcpConnection",HTTP_REQUEST:"HttpRequest",HTTP_REQUEST_TRACE:"HttpRequestTrace",TRACK_SWITCH:"RepresentationSwitch",BUFFER_LEVEL:"BufferLevel",BUFFER_STATE:"BufferState",DVR_INFO:"DVRInfo",DROPPED_FRAMES:"DroppedFrames",SCHEDULING_INFO:"SchedulingInfo",REQUESTS_QUEUE:"RequestsQueue",MANIFEST_UPDATE:"ManifestUpdate",MANIFEST_UPDATE_STREAM_INFO:"ManifestUpdatePeriodInfo",MANIFEST_UPDATE_TRACK_INFO:"ManifestUpdateRepresentationInfo",PLAY_LIST:"PlayList",PLAY_LIST_TRACE:"PlayListTrace"},convertDataToTrack:i,convertDataToMedia:h,convertDataToStream:s,getDataForTrack:n,getDataForMedia:o,getDataForStream:u,getStreamsInfo:function(e){var t,a,i,n=[];if(!e)return null;for(t=this.manifestExt.getMpd(e),r=this.manifestExt.getRegularPeriods(e,t),t.checkTime=this.manifestExt.getCheckTime(e,r[0]),c={},a=r.length,i=0;i<a;i+=1)n.push(s.call(this,e,r[i]));return n},getManifestInfo:function(e){var t=this.manifestExt.getMpd(e);return l.call(this,e,t)},getMediaInfoForType:function(e,t,a){var i=u(t),n=i.id,a=this.manifestExt.getAdaptationForType(e,t.index,a);return a?(t=this.manifestExt.getIndexForAdaptation(a,e,t.index),c[n]=c[n]||this.manifestExt.getAdaptationsForPeriod(e,i),h.call(this,e,c[n][t])):null},getAllMediaInfoForType:function(e,t,a){var i,n=u(t),r=n.id,s=this.manifestExt.getAdaptationsForType(e,t.index,a),o=[];if(!s)return o;c[r]=c[r]||this.manifestExt.getAdaptationsForPeriod(e,n);for(var l=0,d=s.length;l<d;l+=1)i=s[l],i=this.manifestExt.getIndexForAdaptation(i,e,t.index),(i=h.call(this,e,c[r][i]))&&o.push(i);return o},getCurrentRepresentationInfo:function(e,t){t=t.getCurrentRepresentation();return t?i.call(this,e,t):null},getRepresentationInfoForQuality:function(e,t,a){a=t.getRepresentationForQuality(a);return a?i.call(this,e,a):null},updateData:function(e,t){var a=u(t.getStreamInfo()),i=t.getMediaInfo(),n=o(i),r=t.getType(),s=i.id,a=s?this.manifestExt.getAdaptationForId(s,e,a.index):this.manifestExt.getAdaptationForIndex(i.index,e,a.index);t.representationController.updateData(a,n,r)},getInitRequest:function(e,t){t=e.representationController.getRepresentationForQuality(t);return e.indexHandler.getInitRequest(t)},getNextFragmentRequest:function(e,t){t=n(t,e.representationController);return e.indexHandler.getNextSegmentRequest(t)},getFragmentRequestForTime:function(e,t,a,i){t=n(t,e.representationController);return e.indexHandler.getSegmentRequestForTime(t,a,i)},generateFragmentRequestForTime:function(e,t,a){t=n(t,e.representationController);return e.indexHandler.generateSegmentRequestForTime(t,a)},getIndexHandlerTime:function(e){return e.indexHandler.getCurrentTime()},setIndexHandlerTime:function(e,t){return e.indexHandler.setCurrentTime(t)},getEventsFor:function(e,t,a){var i=[];return t instanceof MediaPlayer.vo.StreamInfo?i=this.manifestExt.getEventsForPeriod(e,u(t)):t instanceof MediaPlayer.vo.MediaInfo?i=this.manifestExt.getEventStreamForAdaptationSet(e,o(t)):t instanceof MediaPlayer.vo.TrackInfo&&(i=this.manifestExt.getEventStreamForRepresentation(e,n(t,a.representationController))),i},getEvent:function(e,t,a){var i=new Dash.vo.Event,n=e.scheme_id_uri,r=e.value,s=e.timescale,o=e.presentation_time_delta,l=e.event_duration,d=e.id,e=e.message_data,a=a*s+o;return t[n]?(i.eventStream=t[n],i.eventStream.value=r,i.eventStream.timescale=s,i.duration=l,i.id=d,i.presentationTime=a,i.messageData=e,i.presentationTimeDelta=o,i):null},reset:function(){r=[],c={}}}},Dash.dependencies.DashAdapter.prototype={constructor:Dash.dependencies.DashAdapter},Dash.create=function(e,t,a){if(void 0===e||"VIDEO"!=e.nodeName)return null;var i=e.id||e.name||"video element";if(a=a||new Dash.di.DashContext,void 0===(t=t||[].slice.call(e.querySelectorAll("source")).filter(function(e){return e.type==Dash.supportedManifestMimeTypes.mimeType})[0])&&e.src)(t=document.createElement("source")).src=e.src;else if(void 0===t&&!e.src)return null;return(a=new MediaPlayer(a)).startup(),a.attachView(e),a.setAutoPlay(e.autoplay),a.attachSource(t.src),a.getDebug().log("Converted "+i+" to dash.js player and added content: "+t.src),a},Dash.createAll=function(e,t,a){var i=[];e=e||".dashjs-player",t=t||document,a=a||new Dash.di.DashContext;for(var n=t.querySelectorAll(e),r=0;r<n.length;r++){var s=Dash.create(n[r],void 0,a);i.push(s)}return i},Dash.supportedManifestMimeTypes={mimeType:"application/dash+xml"},Dash.dependencies.DashHandler=function(){"use strict";function c(e,t){for(;e.length<t;)e="0"+e;return e}function h(e,t,a){for(var i,n,r,s,o,l,d=t.length,u="%0".length;;){if((i=e.indexOf("$"+t))<0)return e;if((n=e.indexOf("$",i+d))<0)return e;if(i<(r=e.indexOf("%0",i+d))&&r<n)switch(s=e.charAt(n-1),o=parseInt(e.substring(r+u,n-1),10),s){case"d":case"i":case"u":l=c(a.toString(),o);break;case"x":l=c(a.toString(16),o);break;case"X":l=c(a.toString(16),o).toUpperCase();break;case"o":l=c(a.toString(8),o);break;default:return this.log("Unsupported/invalid IEEE 1003.1 format identifier string in URL"),e}else l=a;e=e.substring(0,i)+l+e.substring(n+1)}}function u(e,t){return e.representation.startNumber+t}function r(e,t){return t=t.adaptation.period.mpd.manifest.Period_asArray[t.adaptation.period.index].AdaptationSet_asArray[t.adaptation.index].Representation_asArray[t.index].BaseURL,e===t||o.test(e)?e:t+e}function l(e){var t,a=e.adaptation.period,i=!1;return y<0?i=!1:S||y<e.availableSegmentsNumber?(t=M(y,e))&&(t=t.presentationStartTime-a.start,a=e.adaptation.period.duration,this.log(e.segmentInfoType+": "+t+" / "+a),i=a<=t):i=!0,i}function f(e,t){var a,i,n,r=e.segmentDuration;return isNaN(r)&&(r=e.adaptation.period.duration),n=(i=e.adaptation.period.start+t*r)+r,(a=new Dash.vo.Segment).representation=e,a.duration=r,a.presentationStartTime=i,a.mediaStartTime=this.timelineConverter.calcMediaTimeFromPresentationTime(a.presentationStartTime,e),a.availabilityStartTime=this.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(a.presentationStartTime,e.adaptation.period.mpd,S),a.availabilityEndTime=this.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(n,e.adaptation.period.mpd,S),a.wallStartTime=this.timelineConverter.calcWallTimeForSegment(a,S),a.replacementNumber=u(a,t),a.availabilityIdx=t,a}function n(t){function e(e){return b.call(d,t,p,e.d,y,u.media,e.mediaRange,m)}var a,i,n,r,s,o,l,d=this,u=t.adaptation.period.mpd.manifest.Period_asArray[t.adaptation.period.index].AdaptationSet_asArray[t.adaptation.index].Representation_asArray[t.index].SegmentTemplate,c=u.SegmentTimeline,h=0<t.availableSegmentsNumber,f=[],p=0,g=0,m=-1,y=t.timescale,E=c.S_asArray,v=A.call(d,t);for(v?(o=v.start,l=v.end):s=d.timelineConverter.calcMediaTimeFromPresentationTime(C||0,t),a=0,i=E.length;a<i;a+=1){var M,P,T,_=0;if((T=E[a]).hasOwnProperty("r")&&(_=T.r),T.hasOwnProperty("t")&&(g=(p=T.t)/y),_<0&&((M=E[a+1])&&M.hasOwnProperty("t")?P=M.t/y:(M=(t.segmentAvailabilityRange||this.timelineConverter.calcSegmentAvailabilityRange(t,S)).end,P=d.timelineConverter.calcMediaTimeFromPresentationTime(M,t),t.segmentDuration=T.d/y),_=Math.ceil((P-g)/(T.d/y))-1),r){if(h)break;m+=_+1}else for(n=0;n<=_;n+=1){if(m+=1,v){if(l<m){if(r=!0,h)break;continue}o<=m&&f.push(e.call(d,T))}else{if(10<f.length){if(r=!0,h)break;continue}g>=s-T.d/y*1.5&&f.push(e.call(d,T))}g=(p+=T.d)/y}}return h||(t.availableSegmentsNumber=m+1),f}function d(e){var t,a=this,i=e.segmentInfoType;return"SegmentBase"!==i&&"BaseURL"!==i&&P.call(a,e)?("SegmentTimeline"===i?t=n.call(a,e):"SegmentTemplate"===i?t=function(e){for(var t,a=[],i=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate,n=e.segmentDuration,r=e.segmentAvailabilityRange,s=null,o=e.startNumber,l=isNaN(n)&&!S?{start:o,end:o}:E.call(this,e),d=l.start,u=l.end,c=d;c<=u;c+=1)(s=f.call(this,e,c)).replacementTime=(o+c-1)*e.segmentDuration,t=i.media,t=h(t,"Number",s.replacementNumber),t=h(t,"Time",s.replacementTime),s.media=t,a.push(s),s=null;return isNaN(n)?e.availableSegmentsNumber=1:e.availableSegmentsNumber=Math.ceil((r.end-r.start)/n),a}.call(a,e):"SegmentList"===i&&(t=function(e){for(var t,a,i=[],n=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,r=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].BaseURL,s=n.SegmentURL_asArray.length,o=e.startNumber,l=E.call(this,e),d=Math.max(l.start,0),u=Math.min(l.end,n.SegmentURL_asArray.length-1),c=d;c<=u;c+=1)a=n.SegmentURL_asArray[c],(t=f.call(this,e,c)).replacementTime=(o+c-1)*e.segmentDuration,t.media=a.media||r,t.mediaRange=a.mediaRange,t.index=a.index,t.indexRange=a.indexRange,i.push(t),t=null;return e.availableSegmentsNumber=s,i}.call(a,e)),v.call(a,e,t)):t=e.segments,t}function s(e){if(!e)throw new Error("no representation");return e.segments=null,d.call(this,e),e}function p(e,t,a){var i,n,r,s,o,l=t.segments,d=l?l.length:null,u=-1;if(l&&0<d)for(o=0;o<d;o+=1)if(r=(n=l[o]).presentationStartTime,s=n.duration,r<=e+(i=null==a?s/2:a)&&e-i<r+s){u=n.availabilityIdx;break}return u}function g(e){if(null==e)return null;var t=new MediaPlayer.vo.FragmentRequest,a=e.representation,i=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].bandwidth,n=r(e.media,a);return n=h(n,"Number",e.replacementNumber),n=h(n,"Time",e.replacementTime),n=function(e,t){if(null===t||-1===e.indexOf("$RepresentationID$"))return e;t=t.toString();return e.split("$RepresentationID$").join(t)}(h(n,"Bandwidth",i),a.id).split("$$").join("$"),t.mediaType=m,t.type=MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE,t.url=n,t.range=e.mediaRange,t.startTime=e.presentationStartTime,t.duration=e.duration,t.timescale=a.timescale,t.availabilityStartTime=e.availabilityStartTime,t.availabilityEndTime=e.availabilityEndTime,t.wallStartTime=e.wallStartTime,t.quality=a.index,t.index=e.availabilityIdx,t.mediaInfo=this.streamProcessor.getMediaInfo(),t}function i(e,t,a){var i,n=y,r=!!a&&a.keepIdx,s=a?a.timeThreshold:null,o=!(!a||!a.ignoreIsFinished),a=this;return e?(C=t,a.log("Getting the request for time: "+t),y=p.call(a,t,e,s),d.call(a,e),y<0&&(y=p.call(a,t,e,s)),a.log("Index for time "+t+" is "+y),!o&&l.call(a,e)?((i=new MediaPlayer.vo.FragmentRequest).action=i.ACTION_COMPLETE,i.index=y,i.mediaType=m,i.mediaInfo=a.streamProcessor.getMediaInfo(),a.log("Signal complete."),a.log(i)):(e=M(y,e),i=g.call(a,e)),r&&(y=n),i):null}function e(e){(e=e.data.representation).segments&&this.notify(Dash.dependencies.DashHandler.eventList.ENAME_REPRESENTATION_UPDATED,{representation:e})}function t(e){if(!e.error&&m===e.data.mediaType){for(var t,a=e.data.segments,i=e.data.representation,n=[],r=0,s=0,o=a.length;s<o;s+=1)t=a[s],t=b.call(this,i,t.startTime,t.duration,t.timescale,t.media,t.mediaRange,r),n.push(t),r+=1;i.segmentAvailabilityRange={start:n[0].presentationStartTime,end:n[o-1].presentationStartTime},i.availableSegmentsNumber=o,v.call(this,i,n),i.initialization&&this.notify(Dash.dependencies.DashHandler.eventList.ENAME_REPRESENTATION_UPDATED,{representation:i})}}var C,S,m,y=-1,a=0,o=new RegExp("^(?:(?:[a-z]+:)?/)?/","i"),E=function(e){var t,a,i=this,n=e.segmentDuration,r=e.adaptation.period.mpd.manifest.minBufferTime,s=e.segmentAvailabilityRange,o={start:i.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(e,s.start),end:i.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(e,s.end)},l=NaN,d=e.segments,s=2*n,r=Math.max(2*r,10*n);return(o=o||i.timelineConverter.calcSegmentAvailabilityRange(e,S)).start=Math.max(o.start,0),n=S&&!i.timelineConverter.isTimeSyncCompleted()?(t=Math.floor(o.start/n),Math.floor(o.end/n)):(l=d&&0<d.length?(a=M(y,e))?i.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(e,a.presentationStartTime):0<y?y*n:i.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(e,C||d[0].presentationStartTime):0<y?y*n:S?o.end:o.start,t=Math.floor(Math.max(l-s,o.start)/n),Math.floor(Math.min(t+r/n,o.end/n))),{start:t,end:n}},A=function(){var e=Number.POSITIVE_INFINITY;return S&&!this.timelineConverter.isTimeSyncCompleted()?{start:0,end:e}:!S&&C||y<0?null:{start:Math.max(y-2,0),end:Math.min(y+10,e)}},b=function(e,t,a,i,n,r,s){var o=t/i,l=Math.min(a/i,e.adaptation.period.mpd.maxSegmentDuration),d=this.timelineConverter.calcPresentationTimeFromMediaTime(o,e),a=d+l,i=new Dash.vo.Segment;return i.representation=e,i.duration=l,i.mediaStartTime=o,i.presentationStartTime=d,i.availabilityStartTime=e.adaptation.period.mpd.manifest.loadedTime,i.availabilityEndTime=this.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(a,e.adaptation.period.mpd,S),i.wallStartTime=this.timelineConverter.calcWallTimeForSegment(i,S),i.replacementTime=t,i.replacementNumber=u(i,s),n=h(n,"Number",i.replacementNumber),n=h(n,"Time",i.replacementTime),i.media=n,i.mediaRange=r,i.availabilityIdx=s,i},v=function(e,t){var e=(e.segments=t).length-1;S&&isNaN(this.timelineConverter.getExpectedLiveEdge())&&(t=t[e].presentationStartTime,e=this.metricsModel.getMetricsFor("stream"),this.timelineConverter.setExpectedLiveEdge(t),this.metricsModel.updateManifestUpdateInfo(this.metricsExt.getCurrentManifestUpdate(e),{presentationStartTime:t}))},M=function(e,t){if(!t||!t.segments)return null;for(var a,i=t.segments.length,n=0;n<i;n+=1)if((a=t.segments[n]).availabilityIdx===e)return a;return null},P=function(e){var t=e.segments;return!t||0===t.length||(e=t[0].availabilityIdx,t=t[t.length-1].availabilityIdx,y<e||t<y)};return{log:void 0,baseURLExt:void 0,timelineConverter:void 0,metricsModel:void 0,metricsExt:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this[Dash.dependencies.BaseURLExtensions.eventList.ENAME_INITIALIZATION_LOADED]=e,this[Dash.dependencies.BaseURLExtensions.eventList.ENAME_SEGMENTS_LOADED]=t},initialize:function(e){this.subscribe(Dash.dependencies.DashHandler.eventList.ENAME_REPRESENTATION_UPDATED,e.representationController),m=e.getType(),this.setMediaType(m),S=e.isDynamic(),this.streamProcessor=e},getType:function(){return m},setType:function(e){m=e},getIsDynamic:function(){return S},setIsDynamic:function(e){S=e},setCurrentTime:function(e){a=e},getCurrentTime:function(){return a},reset:function(){y=-1,S=C=void(a=0),this.unsubscribe(Dash.dependencies.DashHandler.eventList.ENAME_REPRESENTATION_UPDATED,this.streamProcessor.representationController)},getInitRequest:function(e){return e?function(e,t){var a=new MediaPlayer.vo.FragmentRequest,i=e.adaptation.period;return a.mediaType=t,a.type=MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE,a.url=r(e.initialization,e),a.range=e.range,t=i.start,a.availabilityStartTime=this.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(t,e.adaptation.period.mpd,S),a.availabilityEndTime=this.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(t+i.duration,i.mpd,S),a.quality=e.index,a.mediaInfo=this.streamProcessor.getMediaInfo(),a}.call(this,e,m):null},getSegmentRequestForTime:i,getNextSegmentRequest:function(e){var t,a,i=this;if(!e)return null;if(-1===y)throw"You must call getSegmentRequestForTime first.";return C=null,a=y+=1,l.call(i,e)?((t=new MediaPlayer.vo.FragmentRequest).action=t.ACTION_COMPLETE,t.index=a,t.mediaType=m,t.mediaInfo=i.streamProcessor.getMediaInfo(),i.log("Signal complete.")):(d.call(i,e),e=M(a,e),t=g.call(i,e)),t},generateSegmentRequestForTime:function(e,t){var a=(e.segmentAvailabilityRange.end-e.segmentAvailabilityRange.start)/2;return e.segments=null,e.segmentAvailabilityRange={start:t-a,end:t+a},i.call(this,e,t,{keepIdx:!1,ignoreIsFinished:!0})},updateRepresentation:function(e,t){var a,i=this,n=e.initialization,r="BaseURL"!==e.segmentInfoType&&"SegmentBase"!==e.segmentInfoType;return e.segmentDuration||e.segments||s.call(i,e),e.segmentAvailabilityRange=null,e.segmentAvailabilityRange=i.timelineConverter.calcSegmentAvailabilityRange(e,S),e.segmentAvailabilityRange.end<e.segmentAvailabilityRange.start&&!e.useCalculatedLiveEdgeTime?(a=new MediaPlayer.vo.Error(Dash.dependencies.DashHandler.SEGMENTS_UNAVAILABLE_ERROR_CODE,"no segments are available yet",{availabilityDelay:e.segmentAvailabilityRange.start-e.segmentAvailabilityRange.end}),void i.notify(Dash.dependencies.DashHandler.eventList.ENAME_REPRESENTATION_UPDATED,{representation:e},a)):(t||(y=-1),e.segmentDuration&&s.call(i,e),n||i.baseURLExt.loadInitialization(e),r||i.baseURLExt.loadSegments(e,m,e.indexRange),void(n&&r&&i.notify(Dash.dependencies.DashHandler.eventList.ENAME_REPRESENTATION_UPDATED,{representation:e})))}}},Dash.dependencies.DashHandler.prototype={constructor:Dash.dependencies.DashHandler},Dash.dependencies.DashHandler.SEGMENTS_UNAVAILABLE_ERROR_CODE=1,Dash.dependencies.DashHandler.eventList={ENAME_REPRESENTATION_UPDATED:"representationUpdated"},Dash.dependencies.DashParser=function(){"use strict";function d(){var e,t,a,i,n=[];return n.push(((i={name:"AdaptationSet",isRoot:!(a=[{name:"profiles",merge:!1},{name:"width",merge:!1},{name:"height",merge:!1},{name:"sar",merge:!1},{name:"frameRate",merge:!1},{name:"audioSamplingRate",merge:!1},{name:"mimeType",merge:!1},{name:"segmentProfiles",merge:!1},{name:"codecs",merge:!1},{name:"maximumSAPPeriod",merge:!1},{name:"startsWithSap",merge:!1},{name:"maxPlayoutRate",merge:!1},{name:"codingDependency",merge:!1},{name:"scanType",merge:!1},{name:"FramePacking",merge:!0},{name:"AudioChannelConfiguration",merge:!0},{name:"ContentProtection",merge:!0}]),isArray:!0,parent:null,children:[]}).properties=a,(e={name:"Representation",isRoot:!1,isArray:!0}).parent=i,e.children=[],e.properties=a,i.children.push(e),(t={name:"SubRepresentation",isRoot:!1,isArray:!0}).parent=e,t.children=[],t.properties=a,e.children.push(t),i)),n.push(((e={name:"Period",isRoot:!(a=[{name:"SegmentBase",merge:!0},{name:"SegmentTemplate",merge:!0},{name:"SegmentList",merge:!0}]),isArray:!0,parent:null,children:[]}).properties=a,(t={name:"AdaptationSet",isRoot:!1,isArray:!0}).parent=e,t.children=[],t.properties=a,e.children.push(t),(i={name:"Representation",isRoot:!1,isArray:!0}).parent=t,i.children=[],i.properties=a,t.children.push(i),e)),n.push(((a={name:"mpd",isRoot:!0,isArray:!0,parent:null,children:[]}).properties=t=[{name:"BaseURL",merge:!0,mergeFunction:function(e,t){return r.test(t)?t:e+t}}],(i={name:"Period",isRoot:!1,isArray:!0,parent:null,children:[]}).properties=t,a.children.push(i),(e={name:"AdaptationSet",isRoot:!1,isArray:!0}).parent=i,e.children=[],e.properties=t,i.children.push(e),(i={name:"Representation",isRoot:!1,isArray:!0}).parent=e,i.children=[],i.properties=t,e.children.push(i),a)),n}var n=/^([-])?P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,i=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})([0-9]{2}))?/,t=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,r=/^https?:\/\//i,u=[{type:"duration",test:function(e){for(var t=["minBufferTime","mediaPresentationDuration","minimumUpdatePeriod","timeShiftBufferDepth","maxSegmentDuration","maxSubsegmentDuration","suggestedPresentationDelay","start","starttime","duration"],a=t.length,i=0;i<a;i++)if(e.nodeName===t[i])return n.test(e.value);return!1},converter:function(e){var t=n.exec(e),e=31536e3*parseFloat(t[2]||0)+2592e3*parseFloat(t[4]||0)+86400*parseFloat(t[6]||0)+3600*parseFloat(t[8]||0)+60*parseFloat(t[10]||0)+parseFloat(t[12]||0);return e=void 0!==t[1]?-e:e}},{type:"datetime",test:function(e){return i.test(e.value)},converter:function(e){var t=i.exec(e),a=Date.UTC(parseInt(t[1],10),parseInt(t[2],10)-1,parseInt(t[3],10),parseInt(t[4],10),parseInt(t[5],10),t[6]&&parseInt(t[6],10)||0,t[7]&&1e3*parseFloat(t[7])||0);return t[9]&&t[10]&&(e=60*parseInt(t[9],10)+parseInt(t[10],10),a+=("+"===t[8]?-1:1)*e*60*1e3),new Date(a)}},{type:"numeric",test:function(e){return t.test(e.value)},converter:function(e){return parseFloat(e)}}];return{log:void 0,errHandler:void 0,parse:function(t,e,a){var i,n=new X2JS(u,"",!0),r=new ObjectIron(d()),s=new Date,o=null,l=null;try{i=n.xml_str2json(t),o=new Date,i.hasOwnProperty("BaseURL")?(i.BaseURL=i.BaseURL_asArray[0],0!==i.BaseURL.toString().indexOf("http")&&(i.BaseURL=e+i.BaseURL)):i.BaseURL=e,i.hasOwnProperty("Location")&&(i.Location=i.Location_asArray[0]),r.run(i),l=new Date,a.setMatchers(u),a.setIron(r),this.log("Parsing complete: ( xml2json: "+(o.getTime()-s.getTime())+"ms, objectiron: "+(l.getTime()-o.getTime())+"ms, total: "+(l.getTime()-s.getTime())/1e3+"s)")}catch(e){return this.errHandler.manifestError("parsing the manifest failed","parse",t),null}return i}}},Dash.dependencies.DashParser.prototype={constructor:Dash.dependencies.DashParser},Dash.dependencies.TimelineConverter=function(){"use strict";function i(e,t,a,i){return i?a&&t.timeShiftBufferDepth!=Number.POSITIVE_INFINITY?new Date(t.availabilityStartTime.getTime()+1e3*(e+t.timeShiftBufferDepth)):t.availabilityEndTime:a?new Date(t.availabilityStartTime.getTime()+1e3*(e-n)):t.availabilityStartTime}function s(e,t){return(e.getTime()-t.mpd.availabilityStartTime.getTime()+1e3*n)/1e3}function e(e){o||e.error||(n+=e.data.liveEdge-(a+e.data.searchTime),o=!0)}function t(e){o||e.error||(n=e.data.offset/1e3,o=!0)}var n=0,o=!1,a=NaN;return{setup:function(){this[MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED]=e,this[MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED]=t},calcAvailabilityStartTimeFromPresentationTime:function(e,t,a){return i.call(this,e,t,a)},calcAvailabilityEndTimeFromPresentationTime:function(e,t,a){return i.call(this,e,t,a,!0)},calcPresentationTimeFromWallTime:s,calcPresentationTimeFromMediaTime:function(e,t){return e+(t.adaptation.period.start-t.presentationTimeOffset)},calcPeriodRelativeTimeFromMpdRelativeTime:function(e,t){return t-e.adaptation.period.start},calcMpdRelativeTimeFromPeriodRelativeTime:function(e,t){return t+e.adaptation.period.start},calcMediaTimeFromPresentationTime:function(e,t){return e-t.adaptation.period.start+t.presentationTimeOffset},calcSegmentAvailabilityRange:function(e,t){var a=(r=e.adaptation.period.start)+e.adaptation.period.duration,i={start:r,end:a},n=e.segmentDuration||(e.segments&&e.segments.length?e.segments[e.segments.length-1].duration:0);if(!t)return i;if(!o&&e.segmentAvailabilityRange)return e.segmentAvailabilityRange;var t=e.adaptation.period.mpd.checkTime,i=s(new Date,e.adaptation.period),r=Math.max(i-e.adaptation.period.mpd.timeShiftBufferDepth,e.adaptation.period.start),i=isNaN(t)?i:Math.min(t,i),e=e.adaptation.period.start+e.adaptation.period.duration;return{start:r,end:a=e<=i&&i-n<e?e:i-n}},calcWallTimeForSegment:function(e,t){var a;return t&&(a=e.representation.adaptation.period.mpd.suggestedPresentationDelay,a=e.presentationStartTime+a,a=new Date(e.availabilityStartTime.getTime()+1e3*a)),a},calcMSETimeOffset:function(e){var t=e.presentationTimeOffset;return e.adaptation.period.start-t},reset:function(){n=0,o=!1,a=NaN},isTimeSyncCompleted:function(){return o},setTimeSyncCompleted:function(e){o=e},getClientTimeOffset:function(){return n},getExpectedLiveEdge:function(){return a},setExpectedLiveEdge:function(e){a=e}}},Dash.dependencies.TimelineConverter.prototype={constructor:Dash.dependencies.TimelineConverter},Dash.dependencies.RepresentationController=function(){"use strict";function d(){var e=new Date,t=this.getCurrentRepresentation(),a=this.streamProcessor.playbackController.getTime();this.metricsModel.addRepresentationSwitch(t.adaptation.type,e,a,t.id)}function u(){var e=this.streamProcessor,t=this.timelineConverter.calcSegmentAvailabilityRange(c,e.isDynamic());this.metricsModel.addDVRInfo(e.getType(),e.playbackController.getTime(),e.getStreamInfo().manifestInfo,t)}function i(e){for(var t,a=0,i=p.length;a<i;a+=1)(t=p[a]).segmentAvailabilityRange=this.timelineConverter.calcSegmentAvailabilityRange(t,e)}function e(e){if(this.isUpdating()){var t,a=this,i=e.data.representation,n=a.metricsModel.getMetricsFor("stream"),r=a.metricsModel.getMetricsFor(this.getCurrentRepresentation().adaptation.type),s=a.metricsExt.getCurrentManifestUpdate(n),o=!1;if(e.error&&e.error.code===Dash.dependencies.DashHandler.SEGMENTS_UNAVAILABLE_ERROR_CODE)return u.call(this),function(e){var t=this,e=1e3*(e+c.segmentDuration*this.liveDelayFragmentCount);f=!1,setTimeout(function(){if(!this.isUpdating()){f=!0,t.notify(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_STARTED);for(var e=0;e<p.length;e+=1)t.indexHandler.updateRepresentation(p[e],!0)}}.bind(this),e)}.call(this,e.error.data.availabilityDelay),e=new MediaPlayer.vo.Error(Dash.dependencies.RepresentationController.SEGMENTS_UPDATE_FAILED_ERROR_CODE,"Segments update failed",null),void this.notify(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,{data:h,currentRepresentation:c},e);if(s){for(var l=0;l<s.trackInfo.length;l+=1)if((t=s.trackInfo[l]).index===i.index&&t.mediaType===a.streamProcessor.getType()){o=!0;break}o||a.metricsModel.addManifestUpdateRepresentationInfo(s,i.id,i.index,i.adaptation.period.index,a.streamProcessor.getType(),i.presentationTimeOffset,i.startNumber,i.segmentInfoType)}!function(){for(var e=0,t=p.length;e<t;e+=1){var a=p[e].segmentInfoType;if(null===p[e].segmentAvailabilityRange||null===p[e].initialization||("SegmentBase"===a||"BaseURL"===a)&&!p[e].segments)return!1}return!0}()||(f=!1,a.abrController.setPlaybackQuality(a.streamProcessor.getType(),a.streamProcessor.getStreamInfo(),function(e){return p.indexOf(e)}.call(this,c)),a.metricsModel.updateManifestUpdateInfo(s,{latency:c.segmentAvailabilityRange.end-a.streamProcessor.playbackController.getTime()}),a.metricsExt.getCurrentRepresentationSwitch(r)||d.call(a),this.notify(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,{data:h,currentRepresentation:c}))}}function t(e){i.call(this,e.data.isDynamic)}function a(e){var t,a;e.error||(i.call(this,!0),this.indexHandler.updateRepresentation(c,!1),t=this.manifestModel.getValue(),a=c.adaptation.period,(e=this.streamController.getActiveStreamInfo()).isLast&&(a.mpd.checkTime=this.manifestExt.getCheckTime(t,a),a.duration=this.manifestExt.getEndTimeForLastPeriod(this.manifestModel.getValue(),a)-a.start,e.duration=a.duration))}function n(){u.call(this)}function r(e){var t=this;e.data.mediaType===t.streamProcessor.getType()&&t.streamProcessor.getStreamInfo().id===e.data.streamInfo.id&&(c=t.getRepresentationForQuality(e.data.newQuality),o.call(t,e.data.mediaType,c.bandwidth),d.call(t))}var c,h=null,s=-1,f=!0,p=[],l=function(e){return p[e]},g=function(e){var t=this.manifestModel.getValue();return s=this.manifestExt.getIndexForAdaptation(h,t,e.period.index),this.manifestExt.getRepresentationsForAdaptation(t,e)},o=function(e,t){!this.DOMStorage.isSupported(MediaPlayer.utils.DOMStorage.STORAGE_TYPE_LOCAL)||"video"!==e&&"audio"!==e||localStorage.setItem(MediaPlayer.utils.DOMStorage["LOCAL_STORAGE_"+e.toUpperCase()+"_BITRATE_KEY"],JSON.stringify({bitrate:t/1e3,timestamp:(new Date).getTime()}))};return{system:void 0,log:void 0,manifestExt:void 0,manifestModel:void 0,metricsModel:void 0,metricsExt:void 0,abrController:void 0,streamController:void 0,timelineConverter:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,DOMStorage:void 0,liveDelayFragmentCount:void 0,setup:function(){this[MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED]=r,this[Dash.dependencies.DashHandler.eventList.ENAME_REPRESENTATION_UPDATED]=e,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED]=t,this[MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED]=a,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED]=n},initialize:function(e){this.streamProcessor=e,this.indexHandler=e.indexHandler},getData:function(){return h},getDataIndex:function(){return s},isUpdating:function(){return f},updateData:function(e,t,a){var i,n=this,r=n.streamProcessor.getStreamInfo(),s=n.abrController.getTopQualityIndexFor(a,r.id);if(f=!0,n.notify(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_STARTED),p=g.call(n,t),r=null===h?(i=n.abrController.getAverageThroughput(a)||n.abrController.getInitialBitrateFor(a,r),n.abrController.getQualityForBitrate(n.streamProcessor.getMediaInfo(),i)):n.abrController.getQualityFor(a,r),c=l.call(n,r=s<r?s:r),h=e,"video"!==a&&"audio"!==a&&"fragmentedText"!==a)return f=!1,void n.notify(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,{data:h,currentRepresentation:c});for(var o=0;o<p.length;o+=1)n.indexHandler.updateRepresentation(p[o],!0)},getRepresentationForQuality:l,getCurrentRepresentation:function(){return c}}},Dash.dependencies.RepresentationController.prototype={constructor:Dash.dependencies.RepresentationController},Dash.dependencies.RepresentationController.SEGMENTS_UPDATE_FAILED_ERROR_CODE=1,Dash.dependencies.RepresentationController.eventList={ENAME_DATA_UPDATE_COMPLETED:"dataUpdateCompleted",ENAME_DATA_UPDATE_STARTED:"dataUpdateStarted"},Dash.dependencies.BaseURLExtensions=function(){"use strict";var d=function(e,t){var a,i,n=new XMLHttpRequest,r=!0,s=this,o=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].BaseURL,l=t||{url:o,range:{start:0,end:1500},searching:!1,bytesLoaded:0,bytesToLoad:1500,request:n};s.log("Start searching for initialization."),n.onload=function(){n.status<200||299<n.status||(r=!1,l.bytesLoaded=l.range.end,i=s.boxParser.parse(n.response),(a=function(e){var t=e.getBox("ftyp"),a=e.getBox("moov"),e=null;return this.log("Searching for initialization."),a&&a.isComplete&&(t=(t||a).offset,a=a.offset+a.size-1,this.log("Found the initialization.  Range: "+(e=t+"-"+a))),e}.call(s,i))?(e.range=a,e.initialization=o,s.notify(Dash.dependencies.BaseURLExtensions.eventList.ENAME_INITIALIZATION_LOADED,{representation:e})):(l.range.end=l.bytesLoaded+l.bytesToLoad,d.call(s,e,l)))},n.onloadend=n.onerror=function(){r&&(r=!1,s.errHandler.downloadError("initialization",l.url,n),s.notify(Dash.dependencies.BaseURLExtensions.eventList.ENAME_INITIALIZATION_LOADED,{representation:e}))},u.call(s,n,l),s.log("Perform init search: "+l.url)},P=function(h,f,e,t,p){var g,m=this,a=null!==e,y=new XMLHttpRequest,i=h.adaptation.period.mpd.manifest.Period_asArray[h.adaptation.period.index].AdaptationSet_asArray[h.adaptation.index].Representation_asArray[h.index].BaseURL,E=!0,v=null,M={url:i,range:a?e:{start:0,end:1500},searching:!a,bytesLoaded:t?t.bytesLoaded:0,bytesToLoad:1500,request:y};y.onload=function(){if(!(y.status<200||299<y.status)){var e=M.bytesToLoad,t=y.response.byteLength;if(E=!1,M.bytesLoaded=M.range.end-M.range.start,v=m.boxParser.parse(y.response),(g=v.getBox("sidx"))&&g.isComplete){var a,i=g.references;if(a=null!=i&&0<i.length?1===i[0].reference_type:a){m.log("Initiate multiple SIDX load."),M.range.end=M.range.start+g.size;for(var n,r,s=[],o=0,l=(g.offset||M.range.start)+g.size,d=function(e){e?(s=s.concat(e),c<=(o+=1)&&p.call(m,s,h,f)):p.call(m,null,h,f)},u=0,c=i.length;u<c;u+=1)r=(n=l)+i[u].referenced_size-1,l+=i[u].referenced_size,P.call(m,h,null,{start:n,end:r},M,d)}else m.log("Parsing segments from SIDX."),a=function(e,t){for(var a,i,n,r=e.references,s=r.length,o=e.timescale,l=e.earliest_presentation_time,d=t.range.start+e.first_offset+e.size,u=[],c=0;c<s;c+=1)i=r[c].subsegment_duration,n=r[c].referenced_size,(a=new Dash.vo.Segment).duration=i,a.media=t.url,a.startTime=l,a.timescale=o,a.mediaRange=d+"-"+(d+n-1),u.push(a),l+=i,d+=n;return u}.call(m,g,M),p.call(m,a,h,f)}else{if(g)M.range.start=g.offset||M.range.start,M.range.end=M.range.start+(g.size||e);else{if(t<M.bytesLoaded)return void p.call(m,null,h,f);t=v.getLastBox();t&&t.size?(M.range.start=t.offset+t.size,M.range.end=M.range.start+e):M.range.end+=e}P.call(m,h,f,M.range,M,p)}}},y.onloadend=y.onerror=function(){E&&(E=!1,m.errHandler.downloadError("SIDX",M.url,y),p.call(m,null,h,f))},u.call(m,y,M),m.log("Perform SIDX load: "+M.url)},u=function(e,t){e.open("GET",this.requestModifierExt.modifyRequestURL(t.url)),e.responseType="arraybuffer",e.setRequestHeader("Range","bytes="+t.range.start+"-"+t.range.end),(e=this.requestModifierExt.modifyRequestHeader(e)).send(null)};return{log:void 0,errHandler:void 0,requestModifierExt:void 0,boxParser:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,loadSegments:function(e,t,a){var i=a?a.split("-"):null;a=i?{start:parseFloat(i[0]),end:parseFloat(i[1])}:null,P.call(this,e,t,a,null,function(e,t,a){e?this.notify(Dash.dependencies.BaseURLExtensions.eventList.ENAME_SEGMENTS_LOADED,{segments:e,representation:t,mediaType:a}):this.notify(Dash.dependencies.BaseURLExtensions.eventList.ENAME_SEGMENTS_LOADED,{segments:null,representation:t,mediaType:a},new MediaPlayer.vo.Error(null,"error loading segments",null))}.bind(this))},loadInitialization:d}},Dash.dependencies.BaseURLExtensions.prototype={constructor:Dash.dependencies.BaseURLExtensions},Dash.dependencies.BaseURLExtensions.eventList={ENAME_INITIALIZATION_LOADED:"initializationLoaded",ENAME_SEGMENTS_LOADED:"segmentsLoaded"},Dash.dependencies.DashManifestExtensions=function(){"use strict";this.timelineConverter=void 0},Dash.dependencies.DashManifestExtensions.prototype={constructor:Dash.dependencies.DashManifestExtensions,getIsTypeOf:function(e,t){"use strict";var a,i,n,r=e.ContentComponent_asArray,s="text"!==t?new RegExp(t):new RegExp("(vtt|ttml)"),o=!1,l=!1;if(0<e.Representation_asArray.length&&e.Representation_asArray[0].hasOwnProperty("codecs")&&"stpp"==e.Representation_asArray[0].codecs)return"fragmentedText"==t;if(r){if(1<r.length)return"muxed"==t;r[0]&&r[0].contentType===t&&(l=o=!0)}if(e.hasOwnProperty("mimeType")&&(o=s.test(e.mimeType),l=!0),!l)for(a=0,i=e.Representation_asArray.length;!l&&a<i;)(n=e.Representation_asArray[a]).hasOwnProperty("mimeType")&&(o=s.test(n.mimeType),l=!0),a+=1;return o},getIsAudio:function(e){"use strict";return this.getIsTypeOf(e,"audio")},getIsVideo:function(e){"use strict";return this.getIsTypeOf(e,"video")},getIsFragmentedText:function(e){"use strict";return this.getIsTypeOf(e,"fragmentedText")},getIsText:function(e){"use strict";return this.getIsTypeOf(e,"text")},getIsMuxed:function(e){return this.getIsTypeOf(e,"muxed")},getIsTextTrack:function(e){return"text/vtt"===e||"application/ttml+xml"===e},getLanguageForAdaptation:function(e){var t="";return t=e.hasOwnProperty("lang")?e.lang:t},getViewpointForAdaptation:function(e){return e.hasOwnProperty("Viewpoint")?e.Viewpoint:null},getRolesForAdaptation:function(e){return e.hasOwnProperty("Role_asArray")?e.Role_asArray:[]},getAccessibilityForAdaptation:function(e){return e.hasOwnProperty("Accessibility_asArray")?e.Accessibility_asArray:[]},getAudioChannelConfigurationForAdaptation:function(e){return e.hasOwnProperty("AudioChannelConfiguration_asArray")?e.AudioChannelConfiguration_asArray:[]},getIsMain:function(e){"use strict";return this.getRolesForAdaptation(e).filter(function(e){return"main"===e.value})[0]},processAdaptation:function(e){"use strict";return void 0!==e.Representation_asArray&&null!==e.Representation_asArray&&e.Representation_asArray.sort(function(e,t){return e.bandwidth-t.bandwidth}),e},getAdaptationForId:function(e,t,a){"use strict";for(var i=t.Period_asArray[a].AdaptationSet_asArray,n=0,r=i.length;n<r;n+=1)if(i[n].hasOwnProperty("id")&&i[n].id===e)return i[n];return null},getAdaptationForIndex:function(e,t,a){"use strict";return t.Period_asArray[a].AdaptationSet_asArray[e]},getIndexForAdaptation:function(e,t,a){"use strict";for(var i=t.Period_asArray[a].AdaptationSet_asArray,n=0,r=i.length;n<r;n+=1)if(i[n]===e)return n;return-1},getAdaptationsForType:function(e,t,a){"use strict";for(var i=e.Period_asArray[t].AdaptationSet_asArray,n=[],r=0,s=i.length;r<s;r+=1)this.getIsTypeOf(i[r],a)&&n.push(this.processAdaptation(i[r]));return n},getAdaptationForType:function(e,t,a){"use strict";var i,n,r=this.getAdaptationsForType(e,t,a);if(!r||0===r.length)return null;for(i=0,n=r.length;i<n;i+=1)if(this.getIsMain(r[i]))return r[i];return r[0]},getCodec:function(e){"use strict";e=e.Representation_asArray[0];return e.mimeType+';codecs="'+e.codecs+'"'},getMimeType:function(e){"use strict";return e.Representation_asArray[0].mimeType},getKID:function(e){"use strict";return e&&e.hasOwnProperty("cenc:default_KID")?e["cenc:default_KID"]:null},getContentProtectionData:function(e){"use strict";return e&&e.hasOwnProperty("ContentProtection_asArray")&&0!==e.ContentProtection_asArray.length?e.ContentProtection_asArray:null},getIsDynamic:function(e){"use strict";var t=!1;return t=e.hasOwnProperty("type")?"dynamic"===e.type:t},getIsDVR:function(e){"use strict";var t=this.getIsDynamic(e),e=!isNaN(e.timeShiftBufferDepth);return t&&e},getIsOnDemand:function(e){"use strict";var t=!1;return t=e.profiles&&0<e.profiles.length?-1!==e.profiles.indexOf("urn:mpeg:dash:profile:isoff-on-demand:2011"):t},getDuration:function(e){return e.hasOwnProperty("mediaPresentationDuration")?e.mediaPresentationDuration:Number.MAX_VALUE},getBandwidth:function(e){"use strict";return e.bandwidth},getRefreshDelay:function(e){"use strict";var t=NaN;return t=e.hasOwnProperty("minimumUpdatePeriod")?Math.max(parseFloat(e.minimumUpdatePeriod),2):t},getRepresentationCount:function(e){"use strict";return e.Representation_asArray.length},getBitrateListForAdaptation:function(e){if(!e||!e.Representation_asArray||!e.Representation_asArray.length)return null;for(var t=this.processAdaptation(e).Representation_asArray,a=t.length,i=[],n=0;n<a;n+=1)i.push(t[n].bandwidth);return i},getRepresentationFor:function(e,t){"use strict";return t.Representation_asArray[e]},getRepresentationsForAdaptation:function(e,t){for(var a,i,n,r,s=this.processAdaptation(e.Period_asArray[t.period.index].AdaptationSet_asArray[t.index]),o=[],l=0;l<s.Representation_asArray.length;l+=1)n=s.Representation_asArray[l],(a=new Dash.vo.Representation).index=l,a.adaptation=t,n.hasOwnProperty("id")&&(a.id=n.id),n.hasOwnProperty("bandwidth")&&(a.bandwidth=n.bandwidth),n.hasOwnProperty("maxPlayoutRate")&&(a.maxPlayoutRate=n.maxPlayoutRate),n.hasOwnProperty("SegmentBase")?(i=n.SegmentBase,a.segmentInfoType="SegmentBase"):n.hasOwnProperty("SegmentList")?(i=n.SegmentList,a.segmentInfoType="SegmentList",a.useCalculatedLiveEdgeTime=!0):n.hasOwnProperty("SegmentTemplate")?((i=n.SegmentTemplate).hasOwnProperty("SegmentTimeline")?(a.segmentInfoType="SegmentTimeline",(!(r=i.SegmentTimeline.S_asArray[i.SegmentTimeline.S_asArray.length-1]).hasOwnProperty("r")||0<=r.r)&&(a.useCalculatedLiveEdgeTime=!0)):a.segmentInfoType="SegmentTemplate",i.hasOwnProperty("initialization")&&(a.initialization=i.initialization.split("$Bandwidth$").join(n.bandwidth).split("$RepresentationID$").join(n.id))):(i=n.BaseURL,a.segmentInfoType="BaseURL"),i.hasOwnProperty("Initialization")?(r=i.Initialization).hasOwnProperty("sourceURL")?a.initialization=r.sourceURL:r.hasOwnProperty("range")&&(a.initialization=n.BaseURL,a.range=r.range):n.hasOwnProperty("mimeType")&&this.getIsTextTrack(n.mimeType)&&(a.initialization=n.BaseURL,a.range=0),i.hasOwnProperty("timescale")&&(a.timescale=i.timescale),i.hasOwnProperty("duration")&&(a.segmentDuration=i.duration/a.timescale),i.hasOwnProperty("startNumber")&&(a.startNumber=i.startNumber),i.hasOwnProperty("indexRange")&&(a.indexRange=i.indexRange),i.hasOwnProperty("presentationTimeOffset")&&(a.presentationTimeOffset=i.presentationTimeOffset/a.timescale),a.MSETimeOffset=this.timelineConverter.calcMSETimeOffset(a),o.push(a);return o},getAdaptationsForPeriod:function(e,t){for(var a,i,n=e.Period_asArray[t.index],r=[],s=0;s<n.AdaptationSet_asArray.length;s+=1)i=n.AdaptationSet_asArray[s],a=new Dash.vo.AdaptationSet,i.hasOwnProperty("id")&&(a.id=i.id),a.index=s,a.period=t,this.getIsMuxed(i)?a.type="muxed":this.getIsAudio(i)?a.type="audio":this.getIsVideo(i)?a.type="video":this.getIsFragmentedText(i)?a.type="fragmentedText":a.type="text",r.push(a);return r},getRegularPeriods:function(e,t){for(var a=[],i=this.getIsDynamic(e),n=null,r=null,s=null,o=null,l=0,d=e.Period_asArray.length;l<d;l+=1)(r=e.Period_asArray[l]).hasOwnProperty("start")?(o=new Dash.vo.Period).start=r.start:null!==n&&r.hasOwnProperty("duration")&&null!==s?((o=new Dash.vo.Period).start=s.start+s.duration,o.duration=r.duration):0!==l||i||((o=new Dash.vo.Period).start=0),null!==s&&isNaN(s.duration)&&(s.duration=o.start-s.start),null!==o&&r.hasOwnProperty("id")&&(o.id=r.id),null!==o&&r.hasOwnProperty("duration")&&(o.duration=r.duration),null!==o&&(o.index=l,o.mpd=t,a.push(o),n=r,s=o),o=r=null;return 0===a.length||null!==s&&isNaN(s.duration)&&(s.duration=this.getEndTimeForLastPeriod(e,s)-s.start),a},getMpd:function(e){var t=new Dash.vo.Mpd;return(t.manifest=e).hasOwnProperty("availabilityStartTime")?t.availabilityStartTime=new Date(e.availabilityStartTime.getTime()):t.availabilityStartTime=new Date(e.loadedTime.getTime()),e.hasOwnProperty("availabilityEndTime")&&(t.availabilityEndTime=new Date(e.availabilityEndTime.getTime())),e.hasOwnProperty("suggestedPresentationDelay")&&(t.suggestedPresentationDelay=e.suggestedPresentationDelay),e.hasOwnProperty("timeShiftBufferDepth")&&(t.timeShiftBufferDepth=e.timeShiftBufferDepth),e.hasOwnProperty("maxSegmentDuration")&&(t.maxSegmentDuration=e.maxSegmentDuration),t},getFetchTime:function(e,t){return this.timelineConverter.calcPresentationTimeFromWallTime(e.loadedTime,t)},getCheckTime:function(e,t){var a=NaN;return a=e.hasOwnProperty("minimumUpdatePeriod")?this.getFetchTime(e,t)+e.minimumUpdatePeriod:a},getEndTimeForLastPeriod:function(e,t){var a,t=this.getCheckTime(e,t);if(e.mediaPresentationDuration)a=e.mediaPresentationDuration;else{if(isNaN(t))throw new Error("Must have @mediaPresentationDuration or @minimumUpdatePeriod on MPD or an explicit @duration on the last period.");a=t}return a},getEventsForPeriod:function(e,t){var a=e.Period_asArray[t.index].EventStream_asArray,i=[];if(a)for(var n=0;n<a.length;n+=1){var r=new Dash.vo.EventStream;if(r.period=t,r.timescale=1,!a[n].hasOwnProperty("schemeIdUri"))throw"Invalid EventStream. SchemeIdUri has to be set";r.schemeIdUri=a[n].schemeIdUri,a[n].hasOwnProperty("timescale")&&(r.timescale=a[n].timescale),a[n].hasOwnProperty("value")&&(r.value=a[n].value);for(var s=0;s<a[n].Event_asArray.length;s+=1){var o=new Dash.vo.Event;o.presentationTime=0,o.eventStream=r,a[n].Event_asArray[s].hasOwnProperty("presentationTime")&&(o.presentationTime=a[n].Event_asArray[s].presentationTime),a[n].Event_asArray[s].hasOwnProperty("duration")&&(o.duration=a[n].Event_asArray[s].duration),a[n].Event_asArray[s].hasOwnProperty("id")&&(o.id=a[n].Event_asArray[s].id),i.push(o)}}return i},getEventStreams:function(e,t){var a=[];if(!e)return a;for(var i=0;i<e.length;i++){var n=new Dash.vo.EventStream;if(n.timescale=1,n.representation=t,!e[i].hasOwnProperty("schemeIdUri"))throw"Invalid EventStream. SchemeIdUri has to be set";n.schemeIdUri=e[i].schemeIdUri,e[i].hasOwnProperty("timescale")&&(n.timescale=e[i].timescale),e[i].hasOwnProperty("value")&&(n.value=e[i].value),a.push(n)}return a},getEventStreamForAdaptationSet:function(e,t){t=e.Period_asArray[t.period.index].AdaptationSet_asArray[t.index].InbandEventStream_asArray;return this.getEventStreams(t,null)},getEventStreamForRepresentation:function(e,t){e=e.Period_asArray[t.adaptation.period.index].AdaptationSet_asArray[t.adaptation.index].Representation_asArray[t.index].InbandEventStream_asArray;return this.getEventStreams(e,t)},getUTCTimingSources:function(e){"use strict";var t=this.getIsDynamic(e),a=e.hasOwnProperty("availabilityStartTime"),e=e.UTCTiming_asArray,i=[];return(t||a)&&e&&e.forEach(function(e){var t=new Dash.vo.UTCTiming;e.hasOwnProperty("schemeIdUri")&&(t.schemeIdUri=e.schemeIdUri,e.hasOwnProperty("value")&&(t.value=e.value.toString(),i.push(t)))}),i}},Dash.dependencies.DashMetricsExtensions=function(){"use strict";function s(e,t){return this.manifestExt.getIsTypeOf(e,t)}function a(e){if(null===e)return null;var t,a=e.HttpList,i=null;if(null===a||a.length<=0)return null;for(t=a.length-1;0<=t;){if(a[t].responsecode){i=a[t];break}--t}return i}function o(e){return null!==e&&e.HttpList||[]}var l=function(e){var t={};if(!e)return t;for(var a=e.split("\r\n"),i=0,n=a.length;i<n;i++){var r=a[i],s=r.indexOf(": ");0<s&&(t[r.substring(0,s)]=r.substring(s+2))}return t};return{manifestModel:void 0,manifestExt:void 0,system:void 0,getBandwidthForRepresentation:function(e,t){t=this.manifestModel.getValue().Period_asArray[t],e=function(e,t){for(var a,i,n,r=e.AdaptationSet_asArray,s=0;s<r.length;s+=1)for(i=r[s].Representation_asArray,n=0;n<i.length;n+=1)if(t===(a=i[n]).id)return a;return null}.call(this,t,e);return null===e?null:e.bandwidth},getIndexForRepresentation:function(e,t){t=this.manifestModel.getValue().Period_asArray[t];return function(e,t){for(var a,i,n=e.AdaptationSet_asArray,r=0;r<n.length;r+=1)for(a=n[r].Representation_asArray,i=0;i<a.length;i+=1)if(t===a[i].id)return i;return-1}.call(this,t,e)},getMaxIndexForBufferType:function(e,t){t=this.manifestModel.getValue().Period_asArray[t];return function(e,t){var a,i,n,r;if(!e||!t)return-1;for(i=e.AdaptationSet_asArray,r=0;r<i.length;r+=1)if(n=(a=i[r]).Representation_asArray,s.call(this,a,t))return n.length;return-1}.call(this,t,e)},getMaxAllowedIndexForBufferType:function(e,t){var a=this.system.getObject("abrController"),i=0;return i=a?a.getTopQualityIndexFor(e,t):i},getCurrentRepresentationSwitch:function(e){if(null===e)return null;e=e.RepSwitchList;return null===e||e.length<=0?null:e[e.length-1]},getCurrentBufferLevel:function(e){if(null===e)return null;e=e.BufferLevel;return null===e||e.length<=0?null:e[e.length-1]},getCurrentPlaybackRate:function(e){if(null===e)return null;var e=e.PlayList;return null===e||e.length<=0?null:null===(e=e[e.length-1].trace)||e.length<=0?null:e[e.length-1].playbackspeed},getCurrentHttpRequest:a,getHttpRequests:o,getCurrentDroppedFrames:function(e){if(null===e)return null;e=e.DroppedFrames;return null===e||e.length<=0?null:e[e.length-1]},getCurrentSchedulingInfo:function(e){if(null===e)return null;e=e.SchedulingInfo;return null===e||e.length<=0?null:e[e.length-1]},getCurrentDVRInfo:function(e){if(null===e)return null;e=e.DVRInfo;return null===e||e.length<=0?null:e[e.length-1]},getCurrentManifestUpdate:function(e){if(null===e)return null;e=e.ManifestUpdate;return null===e||e.length<=0?null:e[e.length-1]},getLatestFragmentRequestHeaderValueByID:function(e,t){if(null===e)return null;var e=a(e);return null===e||null===e.responseHeaders?null:void 0===(e=l(e.responseHeaders))[t]?null:e[t]},getLatestMPDRequestHeaderValueByID:function(e,t){var a,i,n,r={};if(null===e)return null;for(n=(a=o(e)).length-1;0<=n;--n)if((i=a[n]).type===MediaPlayer.vo.metrics.HTTPRequest.MPD_TYPE){r=l(i.responseHeaders);break}return void 0===r[t]?null:r[t]},getRequestsQueue:function(e){return e.RequestsQueue}}},Dash.dependencies.DashMetricsExtensions.prototype={constructor:Dash.dependencies.DashMetricsExtensions},Dash.dependencies.FragmentExtensions=function(){"use strict";return{log:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,boxParser:void 0,getSamplesInfo:function(e){for(var t,a,i,n=this.boxParser.parse(e),r=n.getBox("tfhd"),e=n.getBox("tfdt"),s=n.getBox("trun"),o=n.getBox("moof"),l=s.sample_count,d=e.baseMediaDecodeTime,u=(r.base_data_offset||0)+(s.data_offset||0),c=[],h=0;h<l;h++)t=void 0!==(i=s.samples[h]).sample_duration?i.sample_duration:r.default_sample_duration,a=void 0!==i.sample_size?i.sample_size:r.default_sample_size,i=void 0!==i.sample_composition_time_offset?i.sample_composition_time_offset:0,c.push({dts:d,cts:d+i,duration:t,offset:o.offset+u,size:a}),u+=a,d+=t;return c},getMediaTimescaleFromMoov:function(e){e=this.boxParser.parse(e).getBox("mdhd");return e?e.timescale:NaN}}},Dash.dependencies.FragmentExtensions.prototype={constructor:Dash.dependencies.FragmentExtensions},Dash.dependencies.FragmentExtensions.eventList={ENAME_FRAGMENT_LOADING_COMPLETED:"fragmentLoadingCompleted"},Dash.vo.AdaptationSet=function(){"use strict";this.period=null,this.index=-1,this.type=null},Dash.vo.AdaptationSet.prototype={constructor:Dash.vo.AdaptationSet},Dash.vo.Event=function(){"use strict";this.duration=NaN,this.presentationTime=NaN,this.id=NaN,this.messageData="",this.eventStream=null,this.presentationTimeDelta=NaN},Dash.vo.Event.prototype={constructor:Dash.vo.Event},Dash.vo.EventStream=function(){"use strict";this.adaptionSet=null,this.representation=null,this.period=null,this.timescale=1,this.value="",this.schemeIdUri=""},Dash.vo.EventStream.prototype={constructor:Dash.vo.EventStream},Dash.vo.Mpd=function(){"use strict";this.manifest=null,this.suggestedPresentationDelay=0,this.availabilityStartTime=null,this.availabilityEndTime=Number.POSITIVE_INFINITY,this.timeShiftBufferDepth=Number.POSITIVE_INFINITY,this.maxSegmentDuration=Number.POSITIVE_INFINITY,this.checkTime=NaN,this.clientServerTimeShift=0,this.isClientServerTimeSyncCompleted=!1},Dash.vo.Mpd.prototype={constructor:Dash.vo.Mpd},Dash.vo.Period=function(){"use strict";this.id=null,this.index=-1,this.duration=NaN,this.start=NaN,this.mpd=null},Dash.vo.Period.prototype={constructor:Dash.vo.Period},Dash.vo.Representation=function(){"use strict";this.id=null,this.index=-1,this.adaptation=null,this.segmentInfoType=null,this.initialization=null,this.segmentDuration=NaN,this.timescale=1,this.startNumber=1,this.indexRange=null,this.range=null,this.presentationTimeOffset=0,this.MSETimeOffset=NaN,this.segmentAvailabilityRange=null,this.availableSegmentsNumber=0,this.bandwidth=NaN,this.maxPlayoutRate=NaN},Dash.vo.Representation.prototype={constructor:Dash.vo.Representation},Dash.vo.Segment=function(){"use strict";this.indexRange=null,this.index=null,this.mediaRange=null,this.media=null,this.duration=NaN,this.replacementTime=null,this.replacementNumber=NaN,this.mediaStartTime=NaN,this.presentationStartTime=NaN,this.availabilityStartTime=NaN,this.availabilityEndTime=NaN,this.availabilityIdx=NaN,this.wallStartTime=NaN,this.representation=null},Dash.vo.Segment.prototype={constructor:Dash.vo.Segment},Dash.vo.UTCTiming=function(){"use strict";this.schemeIdUri="",this.value=""},Dash.vo.UTCTiming.prototype={constructor:Dash.vo.UTCTiming},MediaPlayer.dependencies.ErrorHandler=function(){"use strict";var i=MediaPlayer.events.ERROR;return{eventBus:void 0,capabilityError:function(e){this.eventBus.dispatchEvent({type:i,error:"capability",event:e})},downloadError:function(e,t,a){this.eventBus.dispatchEvent({type:i,error:"download",event:{id:e,url:t,request:a}})},manifestError:function(e,t,a){this.eventBus.dispatchEvent({type:i,error:"manifestError",event:{message:e,id:t,manifest:a}})},closedCaptionsError:function(e,t,a){this.eventBus.dispatchEvent({type:i,error:"cc",event:{message:e,id:t,cc:a}})},mediaSourceError:function(e){this.eventBus.dispatchEvent({type:i,error:"mediasource",event:e})},mediaKeySessionError:function(e){this.eventBus.dispatchEvent({type:i,error:"key_session",event:e})},mediaKeyMessageError:function(e){this.eventBus.dispatchEvent({type:i,error:"key_message",event:e})},mediaKeySystemSelectionError:function(e){this.eventBus.dispatchEvent({type:i,error:"key_system_selection",event:e})}}},MediaPlayer.dependencies.ErrorHandler.prototype={constructor:MediaPlayer.dependencies.ErrorHandler},MediaPlayer.dependencies.FragmentLoader=function(){"use strict";var t=MediaPlayer.dependencies.FragmentLoader.RETRY_ATTEMPTS,i=MediaPlayer.dependencies.FragmentLoader.RETRY_INTERVAL,n=[],c=function(r,e){function t(e,t){l=!1;var a,i=new Date,n=s.response;o.push({s:i,d:i.getTime()-d.getTime(),b:[n?n.byteLength:0]}),e.firstByteDate||(e.firstByteDate=e.requestStartDate),e.requestEndDate=i,n=e.firstByteDate.getTime()-e.requestStartDate.getTime(),i=e.requestEndDate.getTime()-e.firstByteDate.getTime(),u.log((t?"loaded ":"failed ")+e.mediaType+":"+e.type+":"+e.startTime+" ("+s.status+", "+n+"ms, "+i+"ms)"),a=u.metricsModel.addHttpRequest(r.mediaType,null,r.type,r.url,s.responseURL||null,r.range,r.requestStartDate,e.firstByteDate,e.requestEndDate,s.status,r.duration,s.getAllResponseHeaders()),t&&o.forEach(function(e){u.metricsModel.appendHttpTrace(a,e.s,e.d,e.b)})}var s=new XMLHttpRequest,o=[],a=!0,l=!0,d=null,u=this;n.push(s),r.requestStartDate=new Date,o.push({s:r.requestStartDate,d:0,b:[0]}),d=r.requestStartDate,s.open("GET",u.requestModifierExt.modifyRequestURL(r.url),!0),s.responseType="arraybuffer",s=u.requestModifierExt.modifyRequestHeader(s),r.range&&s.setRequestHeader("Range","bytes="+r.range),s.onprogress=function(e){var t=new Date;a&&(a=!1,(!e.lengthComputable||e.lengthComputable&&e.total!=e.loaded)&&(r.firstByteDate=t)),e.lengthComputable&&(r.bytesLoaded=e.loaded,r.bytesTotal=e.total),o.push({s:t,d:t.getTime()-d.getTime(),b:[s.response?s.response.byteLength:0]}),d=t,u.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_PROGRESS,{request:r})},s.onload=function(){s.status<200||299<s.status||(t(r,!0),u.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_COMPLETED,{request:r,response:s.response}))},s.onloadend=s.onerror=function(){-1!==n.indexOf(s)&&(n.splice(n.indexOf(s),1),l&&(t(r,!1),0<e?(u.log("Failed loading fragment: "+r.mediaType+":"+r.type+":"+r.startTime+", retry in "+i+"ms attempts: "+e),e--,setTimeout(function(){c.call(u,r,e)},i)):(u.log("Failed loading fragment: "+r.mediaType+":"+r.type+":"+r.startTime+" no retry attempts left"),u.errHandler.downloadError("content",r.url,s),u.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_COMPLETED,{request:r,bytes:null},new MediaPlayer.vo.Error(null,"failed loading fragment",null)))))},s.send()};return{metricsModel:void 0,errHandler:void 0,log:void 0,requestModifierExt:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,load:function(e){e?c.call(this,e,t):this.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_COMPLETED,{request:e,bytes:null},new MediaPlayer.vo.Error(null,"request is null",null))},checkForExistence:function(e){return e?void function(e){var t=this,a=new XMLHttpRequest,i=!1;a.open("HEAD",e.url,!0),a.onload=function(){a.status<200||299<a.status||(i=!0,t.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,{request:e,exists:!0}))},a.onloadend=a.onerror=function(){i||t.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,{request:e,exists:!1})},a.send()}.call(this,e):void this.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,{request:e,exists:!1})},abort:function(){for(var e,t=n.length,a=0;a<t;a+=1)e=n[a],n[a]=null,e.abort(),e=null;n=[]}}},MediaPlayer.dependencies.FragmentLoader.RETRY_ATTEMPTS=3,MediaPlayer.dependencies.FragmentLoader.RETRY_INTERVAL=500,MediaPlayer.dependencies.FragmentLoader.prototype={constructor:MediaPlayer.dependencies.FragmentLoader},MediaPlayer.dependencies.FragmentLoader.eventList={ENAME_LOADING_COMPLETED:"loadingCompleted",ENAME_LOADING_PROGRESS:"loadingProgress",ENAME_CHECK_FOR_EXISTENCE_COMPLETED:"checkForExistenceCompleted"},MediaPlayer.dependencies.LiveEdgeFinder=function(){"use strict";function e(e){var t=this;!t.streamProcessor.isDynamic()||i||e.error||(a=t.synchronizationRulesCollection.getRules(s),i=!0,n=(new Date).getTime(),t.rulesController.applyRules(a,t.streamProcessor,function(e){var t=((new Date).getTime()-n)/1e3;r=e.value,this.notify(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,{liveEdge:r,searchTime:t},null===r?new MediaPlayer.vo.Error(MediaPlayer.dependencies.LiveEdgeFinder.LIVE_EDGE_NOT_FOUND_ERROR_CODE,"live edge has not been found",null):null)}.bind(t),null,function(e,t){return t}))}function t(e){s=e.error?MediaPlayer.rules.SynchronizationRulesCollection.prototype.BEST_GUESS_RULES:MediaPlayer.rules.SynchronizationRulesCollection.prototype.TIME_SYNCHRONIZED_RULES}var a,i=!1,n=NaN,r=null,s=MediaPlayer.rules.SynchronizationRulesCollection.prototype.BEST_GUESS_RULES;return{system:void 0,synchronizationRulesCollection:void 0,rulesController:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this[MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED]=e,this[MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED]=t},initialize:function(e){this.streamProcessor=e,this.fragmentLoader=e.fragmentLoader},abortSearch:function(){i=!1,n=NaN},getLiveEdge:function(){return r},reset:function(){this.abortSearch(),r=null}}},MediaPlayer.dependencies.LiveEdgeFinder.prototype={constructor:MediaPlayer.dependencies.LiveEdgeFinder},MediaPlayer.dependencies.LiveEdgeFinder.eventList={ENAME_LIVE_EDGE_SEARCH_COMPLETED:"liveEdgeFound"},MediaPlayer.dependencies.LiveEdgeFinder.LIVE_EDGE_NOT_FOUND_ERROR_CODE=1,MediaPlayer.dependencies.ManifestLoader=function(){"use strict";function f(e){var t="";return t=-1!==e.indexOf("/")?(e=-1!==e.indexOf("?")?e.substring(0,e.indexOf("?")):e).substring(0,e.lastIndexOf("/")+1):t}var p=function(t,e){var a,i,n,r=f(t),s=new XMLHttpRequest,o=new Date,l=!0,d=this,u=function(){var e=null;s.status<200||299<s.status||(l=!1,n=new Date,s.responseURL&&s.responseURL!==t&&(r=f(s.responseURL),e=s.responseURL),d.metricsModel.addHttpRequest("stream",null,MediaPlayer.vo.metrics.HTTPRequest.MPD_TYPE,t,e,null,o,s.firstByteDate||null,n,s.status,null,s.getAllResponseHeaders()),(a=d.parser.parse(s.responseText,r,d.xlinkController))?(a.url=e||t,a.loadedTime=n,d.metricsModel.addManifestUpdate("stream",a.type,o,n,a.availabilityStartTime),d.xlinkController.resolveManifestOnLoad(a)):d.notify(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,{manifest:null},new MediaPlayer.vo.Error(null,"Failed loading manifest: "+t,null)))},c=function(){l&&(l=!1,d.metricsModel.addHttpRequest("stream",null,MediaPlayer.vo.metrics.HTTPRequest.MPD_TYPE,t,s.responseURL||null,null,o,s.firstByteDate||null,new Date,s.status,null,s.getAllResponseHeaders()),0<e?(d.log("Failed loading manifest: "+t+", retry in 500ms attempts: "+e),e--,setTimeout(function(){p.call(d,t,e)},500)):(d.log("Failed loading manifest: "+t+" no retry attempts left"),d.errHandler.downloadError("manifest",t,s),d.notify(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,null,new Error("Failed loading manifest: "+t+" no retry attempts left"))))},h=function(e){i&&(i=!1,(!e.lengthComputable||e.lengthComputable&&e.total!=e.loaded)&&(s.firstByteDate=new Date))};try{s.onload=u,s.onloadend=c,s.onerror=c,s.onprogress=h,s.open("GET",d.requestModifierExt.modifyRequestURL(t),!0),s.send()}catch(e){s.onerror()}},e=function(e){this.notify(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,{manifest:e.data.manifest})};return{log:void 0,parser:void 0,errHandler:void 0,metricsModel:void 0,requestModifierExt:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,system:void 0,load:function(e){p.call(this,e,3)},setup:function(){e=e.bind(this),this.xlinkController=this.system.getObject("xlinkController"),this.xlinkController.subscribe(MediaPlayer.dependencies.XlinkController.eventList.ENAME_XLINK_READY,this,e)}}},MediaPlayer.dependencies.ManifestLoader.prototype={constructor:MediaPlayer.dependencies.ManifestLoader},MediaPlayer.dependencies.ManifestLoader.eventList={ENAME_MANIFEST_LOADED:"manifestLoaded"},MediaPlayer.dependencies.ManifestUpdater=function(){"use strict";function e(){null!==d&&(clearInterval(d),d=null)}function i(){e.call(this),isNaN(l)||(this.log("Refresh manifest in "+l+" seconds."),d=setTimeout(h.bind(this),Math.min(1e3*l,Math.pow(2,31)-1),this))}function t(e){var t,a;this.manifestModel.setValue(e),this.log("Manifest has been refreshed."),t=this.manifestExt.getRefreshDelay(e),a=((new Date).getTime()-e.loadedTime.getTime())/1e3,l=Math.max(t-a,0),this.notify(MediaPlayer.dependencies.ManifestUpdater.eventList.ENAME_MANIFEST_UPDATED,{manifest:e}),u||i.call(this)}function a(e){e.error||t.call(this,e.data.manifest)}function n(){u=!1,i.call(this)}function r(){u=!0,e.call(this)}function s(){c=!1}var o,l=NaN,d=null,u=!0,c=!1,h=function(){var e,t;u||c||(c=!0,t=(e=this.manifestModel.getValue()).url,e.hasOwnProperty("Location")&&(t=e.Location),o.load(t))};return{log:void 0,system:void 0,subscribe:void 0,unsubscribe:void 0,notify:void 0,manifestModel:void 0,manifestExt:void 0,setup:function(){this[MediaPlayer.dependencies.StreamController.eventList.ENAME_STREAMS_COMPOSED]=s,this[MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED]=a,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_STARTED]=n,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PAUSED]=r},initialize:function(e){u=!(c=!1),(o=e).subscribe(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,this)},setManifest:function(e){t.call(this,e)},getManifestLoader:function(){return o},reset:function(){c=!(u=!0),e.call(this),o.unsubscribe(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,this),l=NaN}}},MediaPlayer.dependencies.ManifestUpdater.prototype={constructor:MediaPlayer.dependencies.ManifestUpdater},MediaPlayer.dependencies.ManifestUpdater.eventList={ENAME_MANIFEST_UPDATED:"manifestUpdated"},MediaPlayer.dependencies.Notifier=function(){"use strict";function n(){return this[e]||(t+=1,this[e]="_id_"+t),this[e]}var r,e="observableId",t=0;return{system:void 0,setup:function(){(r=this.system).mapValue("notify",this.notify),r.mapValue("subscribe",this.subscribe),r.mapValue("unsubscribe",this.unsubscribe)},notify:function(){var e=arguments[0]+n.call(this),t=new MediaPlayer.vo.Event;t.sender=this,t.type=arguments[0],t.data=arguments[1],t.error=arguments[2],t.timestamp=(new Date).getTime(),r.notify.call(r,e,t)},subscribe:function(e,t,a,i){if(!a&&t[e]&&(a=t[e]=t[e].bind(t)),!t)throw"observer object cannot be null or undefined";if(!a)throw"event handler cannot be null or undefined";e+=n.call(this),r.mapHandler(e,void 0,a,i)},unsubscribe:function(e,t,a){a=a||t[e],e+=n.call(this),r.unmapHandler(e,void 0,a)}}},MediaPlayer.dependencies.Notifier.prototype={constructor:MediaPlayer.dependencies.Notifier},MediaPlayer.dependencies.Stream=function(){"use strict";function d(e,t,a){var i,n,r=this,s=e.type;if("muxed"===s&&e)return this.log(n="Multiplexed representations are intentionally not supported, as they are not compliant with the DASH-AVC/264 guidelines"),this.errHandler.manifestError(n,"multiplexedrep",this.manifestModel.getValue()),!1;if("text"===s||"fragmentedText"===s)return!0;if(i=e.codec,r.log(s+" codec: "+i),e.contentProtection&&!r.capabilities.supportsEncryptedMedia())r.errHandler.capabilityError("encryptedmedia");else if(!r.capabilities.supportsCodec(r.videoModel.getElement(),i))return r.errHandler.manifestError(n=s+"Codec ("+i+") is not supported.","codec",a),r.log(n),!1;return!0}function e(e){var t,a,i,n,r,s=v.call(this,e.data.oldMediaInfo);s&&(t=this.playbackController.getTime(),a=s.getBuffer(),i=e.data.newMediaInfo,n=this.manifestModel.getValue(),r=u.indexOf(s),e=s.getMediaSource(),"fragmentedText"!==i.type?(s.reset(!0),g.call(this,i,n,e,{buffer:a,replaceIdx:r,currentTime:t}),this.playbackController.seek(this.playbackController.getTime())):(s.setIndexHandlerTime(t),s.updateMediaInfo(n,i)))}function n(e,t){var a,i,n=this,r=n.manifestModel.getValue(),s=this.adapter.getAllMediaInfoForType(r,c,e);if(s&&0!==s.length){for(var o=0,l=s.length;o<l;o+=1)i=s[o],d.call(n,i,t,r)&&n.mediaController.isMultiTrackSupportedByType(i.type)&&n.mediaController.addTrack(i,c);0!==this.mediaController.getTracksFor(e,c).length&&(this.mediaController.checkInitialMediaSettings(c),a=this.mediaController.getCurrentTrackFor(e,c),g.call(this,a,r,t))}else n.log("No "+e+" data.")}function t(){for(var e=M(),t=e.length,a=0;a<t;a+=1)if(!e[a].isBufferingCompleted())return;this.notify(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_BUFFERING_COMPLETED,{streamInfo:c})}function a(e){var t=e.sender.streamProcessor.getType();l[t]=e.error,m.call(this)}var i,r,u=[],o=!1,s=!1,c=null,l={},h=!1,f=!1,p=null,g=function(e,t,a,i){var n=this,r=n.system.getObject("streamProcessor"),s=this.adapter.getAllMediaInfoForType(t,c,e.type);if(r.initialize(function(e){return"text"===e.type?e.mimeType:e.type}.call(n,e),n.fragmentController,a,n,p),n.abrController.updateTopQualityIndex(e),i?(r.setBuffer(i.buffer),(u[i.replaceIdx]=r).setIndexHandlerTime(i.currentTime)):u.push(r),"text"===e.type||"fragmentedText"===e.type){for(var o,l=0;l<s.length;l++)s[l].index===e.index&&(o=l),r.updateMediaInfo(t,s[l]);"fragmentedText"===e.type&&r.updateMediaInfo(t,s[o])}else r.updateMediaInfo(t,e);return r},m=function(){for(var e=u.length,t=!!l.audio||!!l.video?new MediaPlayer.vo.Error(MediaPlayer.dependencies.Stream.DATA_UPDATE_FAILED_ERROR_CODE,"Data update failed",null):null,a=0;a<e;a+=1)if(u[a].isUpdating()||h)return;f=!0,this.eventBus.dispatchEvent({type:MediaPlayer.events.STREAM_INITIALIZED,data:{streamInfo:c}}),this.notify(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED,{streamInfo:c},t),s&&!o&&(i.init(this.manifestModel.getValue(),y.call(this,"audio"),y.call(this,"video")),o=!0)},y=function(e){for(var t=u.length,a=null,i=0;i<t;i+=1)if((a=u[i]).getType()===e)return a.getMediaInfo();return null},E=function(){for(var e=0,t=u.length;e<t;e+=1)u[e].createBuffer()},v=function(t){return!!t&&M.call(this).filter(function(e){return e.getType()===t.type})[0]},M=function(){for(var e,t,a=[],i=0,n=u.length;i<n;i+=1)"audio"!==(e=(t=u[i]).getType())&&"video"!==e&&"fragmentedText"!==e||a.push(t);return a};return{system:void 0,eventBus:void 0,manifestModel:void 0,sourceBufferExt:void 0,adapter:void 0,videoModel:void 0,fragmentController:void 0,playbackController:void 0,mediaController:void 0,capabilities:void 0,log:void 0,errHandler:void 0,liveEdgeFinder:void 0,abrController:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFERING_COMPLETED]=t,this[Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED]=a,this[MediaPlayer.dependencies.MediaController.eventList.CURRENT_TRACK_CHANGED]=e},initialize:function(e,t){c=e,i=t,r=function(e){e.error&&(this.errHandler.mediaKeySessionError(e.error),this.log(e.error),this.reset())}.bind(this),i.addEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,r),i.addEventListener(MediaPlayer.dependencies.ProtectionController.events.SERVER_CERTIFICATE_UPDATED,r),i.addEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_ADDED,r),i.addEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CREATED,r),i.addEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,r),i.addEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,r),i.addEventListener(MediaPlayer.dependencies.ProtectionController.events.LICENSE_REQUEST_COMPLETE,r)},activate:function(e){o?E.call(this):function(e){var t,a=this,i=a.manifestModel.getValue();p=a.system.getObject("eventController"),t=a.adapter.getEventsFor(i,c),p.addInlineEvents(t),h=!0,n.call(a,"video",e),n.call(a,"audio",e),n.call(a,"text",e),n.call(a,"fragmentedText",e),n.call(a,"muxed",e),E.call(a),h=!(s=!0),0===u.length?(a.errHandler.manifestError(e="No streams to play.","nostreams",i),a.log(e)):(a.liveEdgeFinder.initialize(u[0]),a.liveEdgeFinder.subscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,a.playbackController),m.call(this))}.call(this,e)},deactivate:function(){for(var e=u.length,t=0;t<e;t+=1)u[t].reset();s=o=!(u=[]),this.resetEventController()},reset:function(e){this.playbackController.pause();for(var t=u.length,a=0;a<t;a+=1)u[a].reset(e),0;p&&p.reset(),f=h=!(u=[]),this.fragmentController&&this.fragmentController.reset(),this.fragmentController=void 0,this.liveEdgeFinder.abortSearch(),this.liveEdgeFinder.unsubscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,this.playbackController),i.removeEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,r),i.removeEventListener(MediaPlayer.dependencies.ProtectionController.events.SERVER_CERTIFICATE_UPDATED,r),i.removeEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_ADDED,r),i.removeEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CREATED,r),i.removeEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,r),i.removeEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,r),i.removeEventListener(MediaPlayer.dependencies.ProtectionController.events.LICENSE_REQUEST_COMPLETE,r),o=s=!1,l={}},getDuration:function(){return c.duration},getStartTime:function(){return c.start},getStreamIndex:function(){return c.index},getId:function(){return c.id},getStreamInfo:function(){return c},hasMedia:function(e){return null!==y.call(this,e)},getBitrateListFor:function(e){e=y.call(this,e);return this.abrController.getBitrateList(e)},startEventController:function(){p.start()},resetEventController:function(){p.reset()},isActivated:function(){return o},isInitialized:function(){return f},updateData:function(e){var t,a,i=this,n=u.length,r=i.manifestModel.getValue(),s=0;for(o=!1,c=e,i.log("Manifest updated... set new data on buffers."),p&&(e=i.adapter.getEventsFor(r,c),p.addInlineEvents(e)),f=!(h=!0);s<n;s+=1)a=u[s],t=i.adapter.getMediaInfoForType(r,c,a.getType()),this.abrController.updateTopQualityIndex(t),a.updateMediaInfo(r,t);h=!1,m.call(i)}}},MediaPlayer.dependencies.Stream.prototype={constructor:MediaPlayer.dependencies.Stream},MediaPlayer.dependencies.Stream.DATA_UPDATE_FAILED_ERROR_CODE=1,MediaPlayer.dependencies.Stream.eventList={ENAME_STREAM_UPDATED:"streamUpdated",ENAME_STREAM_BUFFERING_COMPLETED:"streamBufferingCompleted"},MediaPlayer.dependencies.StreamProcessor=function(){"use strict";var m,y=null,f=null,E=null,v=null,a=[];return{system:void 0,videoModel:void 0,indexHandler:void 0,liveEdgeFinder:void 0,timelineConverter:void 0,abrController:void 0,playbackController:void 0,baseURLExt:void 0,adapter:void 0,manifestModel:void 0,initialize:function(e,t,a,i,n){var r=this,s=r.system.getObject("representationController"),o=r.system.getObject("scheduleController"),l=r.liveEdgeFinder,d=r.abrController,u=r.indexHandler,c=r.baseURLExt,h=r.playbackController,f=r.system.getObject("mediaController"),p=this.system.getObject("fragmentLoader"),g=function(e){return this.system.getObject("video"===e||"audio"===e||"fragmentedText"===e?"bufferController":"textController")}.call(r,e);E=e,v=n,m=(y=i).getStreamInfo().manifestInfo.isDynamic,r.bufferController=g,r.scheduleController=o,r.representationController=s,r.fragmentController=t,r.fragmentLoader=p,s.subscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,g),t.subscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_INIT_FRAGMENT_LOADED,g),"video"===E||"audio"===E||"fragmentedText"===E?(d.subscribe(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,g),d.subscribe(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,s),d.subscribe(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,o),l.subscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,this.timelineConverter),l.subscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,s),l.subscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,o),s.subscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_STARTED,o),s.subscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,o),y.subscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED,o),s.subscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,h),t.subscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADED,g),t.subscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADING_START,o),t.subscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,o),t.subscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,g),t.subscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,o.scheduleRulesCollection.bufferLevelRule),g.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,h),g.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_CLEARED,o),g.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_APPENDED,o),g.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED,o),g.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED,s),g.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,o),g.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_INIT_REQUESTED,o),g.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFERING_COMPLETED,y),g.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_QUOTA_EXCEEDED,o),g.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN,o.scheduleRulesCollection.bufferLevelRule),g.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED,o.scheduleRulesCollection.bufferLevelRule),g.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_APPENDED,h),h.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PROGRESS,g),h.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_TIME_UPDATED,g),h.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_RATE_CHANGED,g),h.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_RATE_CHANGED,o),h.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,g),h.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,o),h.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_STARTED,o),h.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,o.scheduleRulesCollection.playbackTimeRule),h.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,d.abrRulesCollection.insufficientBufferRule),m&&h.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,s),h.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,g),h.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,o),c.subscribe(Dash.dependencies.BaseURLExtensions.eventList.ENAME_INITIALIZATION_LOADED,u),c.subscribe(Dash.dependencies.BaseURLExtensions.eventList.ENAME_SEGMENTS_LOADED,u),"video"!==E&&"audio"!==E||f.subscribe(MediaPlayer.dependencies.MediaController.eventList.CURRENT_TRACK_CHANGED,g)):g.subscribe(MediaPlayer.dependencies.TextController.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED,o),s.subscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,y),u.initialize(this),u.setCurrentTime(h.getStreamStartTime(this.getStreamInfo())),g.initialize(E,a,r),o.initialize(E,this),d.initialize(E,this),(r=this.getFragmentModel()).setLoader(p),r.subscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_STARTED,t),r.subscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,t),r.subscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_STREAM_COMPLETED,t),r.subscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,o),p.subscribe(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_COMPLETED,r),p.subscribe(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_PROGRESS,d),"video"!==E&&"audio"!==E&&"fragmentedText"!==E||(g.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN,r),g.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED,r),g.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_REJECTED,r)),s.initialize(this)},isUpdating:function(){return this.representationController.isUpdating()},getType:function(){return E},getABRController:function(){return this.abrController},getFragmentLoader:function(){return this.fragmentLoader},getBuffer:function(){return this.bufferController.getBuffer()},setBuffer:function(e){this.bufferController.setBuffer(e)},getFragmentModel:function(){return this.scheduleController.getFragmentModel()},getStreamInfo:function(){return y.getStreamInfo()},updateMediaInfo:function(e,t){t===f||t&&f&&t.type!==f.type||(f=t),-1===a.indexOf(t)&&a.push(t),this.adapter.updateData(e,this)},getMediaInfoArr:function(){return a},getMediaInfo:function(){return f},getMediaSource:function(){return this.bufferController.getMediaSource()},getScheduleController:function(){return this.scheduleController},getEventController:function(){return v},start:function(){this.scheduleController.start()},stop:function(){this.scheduleController.stop()},getIndexHandlerTime:function(){return this.adapter.getIndexHandlerTime(this)},setIndexHandlerTime:function(e){this.adapter.setIndexHandlerTime(this,e)},getCurrentRepresentationInfo:function(){return this.adapter.getCurrentRepresentationInfo(this.manifestModel.getValue(),this.representationController)},getRepresentationInfoForQuality:function(e){return this.adapter.getRepresentationInfoForQuality(this.manifestModel.getValue(),this.representationController,e)},isBufferingCompleted:function(){return this.bufferController.isBufferingCompleted()},createBuffer:function(){return this.bufferController.getBuffer()||this.bufferController.createBuffer(f)},isDynamic:function(){return m},reset:function(e){var t=this,a=t.bufferController,i=t.representationController,n=t.scheduleController,r=t.liveEdgeFinder,s=t.fragmentController,o=t.abrController,l=t.playbackController,d=this.system.getObject("mediaController"),u=this.indexHandler,c=this.baseURLExt,h=this.getFragmentModel(),t=this.fragmentLoader;o.unsubscribe(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,a),o.unsubscribe(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,i),o.unsubscribe(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,n),r.unsubscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,this.timelineConverter),r.unsubscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,n),r.unsubscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,i),i.unsubscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_STARTED,n),i.unsubscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,a),i.unsubscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,n),i.unsubscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,y),i.unsubscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,l),y.unsubscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED,n),s.unsubscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_INIT_FRAGMENT_LOADED,a),s.unsubscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADED,a),s.unsubscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADING_START,n),s.unsubscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,n),s.unsubscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,a),s.unsubscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,n.scheduleRulesCollection.bufferLevelRule),a.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,l),a.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_CLEARED,n),a.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_APPENDED,n),a.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED,n),a.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED,i),a.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,n),a.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_INIT_REQUESTED,n),a.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFERING_COMPLETED,y),a.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED,n),a.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN,n.scheduleRulesCollection.bufferLevelRule),a.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED,n.scheduleRulesCollection.bufferLevelRule),a.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_APPENDED,l),l.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PROGRESS,a),l.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_TIME_UPDATED,a),l.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_RATE_CHANGED,a),l.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_RATE_CHANGED,n),l.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,a),l.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,n),l.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_STARTED,n),l.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,i),l.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,a),l.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,n),l.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,n.scheduleRulesCollection.playbackTimeRule),l.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,o.abrRulesCollection.insufficientBufferRule),c.unsubscribe(Dash.dependencies.BaseURLExtensions.eventList.ENAME_INITIALIZATION_LOADED,u),c.unsubscribe(Dash.dependencies.BaseURLExtensions.eventList.ENAME_SEGMENTS_LOADED,u),a.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN,h),a.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED,h),a.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_REJECTED,h),h.unsubscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_STARTED,s),h.unsubscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,s),h.unsubscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_STREAM_COMPLETED,s),h.unsubscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,n),t.unsubscribe(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_COMPLETED,h),t.unsubscribe(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_PROGRESS,o),h.reset(),"video"!==E&&"audio"!==E||d.unsubscribe(MediaPlayer.dependencies.MediaController.eventList.CURRENT_TRACK_CHANGED,a),u.reset(),this.bufferController.reset(e),this.scheduleController.reset(),this.bufferController=null,this.scheduleController=null,this.representationController=null,this.videoModel=null,this.fragmentController=null,m=void 0,v=E=f=y=null}}},MediaPlayer.dependencies.StreamProcessor.prototype={constructor:MediaPlayer.dependencies.StreamProcessor},MediaPlayer.utils.TTMLParser=function(){"use strict";function R(e){var t,a;if(!i.test(e))return NaN;if(t=e.split(":"),a=3600*parseFloat(t[0])+60*parseFloat(t[1])+parseFloat(t[2]),t[3]){if(!(e=B.tt.frameRate)||isNaN(e))return NaN;a+=parseFloat(t[3])/e}return a}function s(t,a){var e=Object.keys(t).filter(function(e){return("xmlns"===e.split(":")[0]||"xmlns"===e.split(":")[1])&&t[e]===a}).map(function(e){return e.split(":")[2]||e.split(":")[1]});return 1!=e.length?null:e[0]}function l(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function d(e){var t=e.slice(1).match(/.{2}/g),e=parseFloat(parseInt(parseInt(t[3],16)/255*1e3)/1e3);return"rgba("+t.slice(0,3).map(function(e){return parseInt(e,16)}).join(",")+","+e+");"}function N(e,t){for(var a=0;a<t.length;a++)if(-1<t[a].indexOf(e))return 1}function D(e,t){for(var a=0;a<t.length;a++)if(-1<t[a].indexOf(e))return t[a];return null}function I(e,t){t.splice(t.indexOf(D(e,t)),1)}function O(e,t){for(var a=0;a<e.length;a++)for(var i=0;i<t.length;i++)e[a]&&-1<e[a].split(":")[0].indexOf(t[i].split(":")[0])&&e.splice(a,1);return e.concat(t)}function x(e,t){var a=[];return e.match(/\S+/g).forEach(function(e){e=function(e,t){for(var a=0;a<e.length;a++){var i=e[a];if(i["xml:id"]===t||i.id===t)return i}return null}(u,e);e&&(e=function(e,t){var a,i,n,r,s,o=[];for(a in e)e.hasOwnProperty(a)&&(i=(i=(i=a.replace("ebutts:","")).replace("xml:","")).replace("tts:",""),e[i=l(i)]=e[a],delete e[a]);return"line-padding"in e&&(n=parseFloat(e["line-padding"].slice(e["line-padding"].indexOf(":")+1,e["line-padding"].indexOf("c"))),"id"in e&&(U[e.id]=n),n=n*t[0]+"px;",o.push("padding-left:"+n),o.push("padding-right:"+n)),"font-size"in e&&(r=parseFloat(e["font-size"].slice(e["font-size"].indexOf(":")+1,e["font-size"].indexOf("%"))),"id"in e&&(k[e.id]=r),r=r/100*t[1]+"px;",o.push("font-size:"+r)),"line-heigt"in e&&("normal"===e["line-height"]?o.push("line-heigth: normal;"):(r=parseFloat(e["line-heigt"].slice(e["line-heigt"].indexOf(":")+1,e["line-heigt"].indexOf("%"))),"id"in e&&(F[e.id]=r),t=r/100*t[1]+"px;",o.push(a+":"+t))),"font-family"in e&&(e["font-family"]in h?o.push(h[e["font-family"]]):o.push("font-family:"+e["font-family"]+";")),"text-align"in e&&e["text-align"]in f&&(o.push(f[e["text-align"]][0]),o.push(f[e["text-align"]][1])),"multi-row-align"in e&&(N("text-align",o)&&"auto"!=e["multi-row-align"]&&I("text-align",o),e["multi-row-align"]in p&&o.push(p[e["multi-row-align"]])),"background-color"in e&&(-1<e["background-color"].indexOf("#")&&e["background-color"].length-1==8?(s=d(e["background-color"]),o.push("background-color: "+s)):o.push("background-color:"+e["background-color"]+";")),"color"in e&&(-1<e.color.indexOf("#")&&e.color.length-1==8?(s=d(e.color),o.push("color: "+s)):o.push("color:"+e.color+";")),"wrap-option"in e&&(e["wrap-option"]in g?o.push(g[e["wrap-option"]]):o.push("white-space:"+e["wrap-option"])),"unicode-bidi"in e&&(e["unicode-bidi"]in m?o.push(m[e["unicode-bidi"]]):o.push("unicode-bidi:"+e["unicode-bidi"])),"font-style"in e&&o.push("font-style:"+e["font-style"]+";"),"font-weight"in e&&o.push("font-weight:"+e["font-weight"]+";"),"direction"in e&&o.push("direction:"+e.direction+";"),"text-decoration"in e&&o.push("text-decoration:"+e["text-decoration"]+";"),o}(JSON.parse(JSON.stringify(e)),t),a=a.concat(e))}),a}function o(e,t){var a,i,n=[];for(a in e){var r=(r=a.replace("tts:","")).replace("xml:","");e[r=l(r)]=e[a],r!==a&&delete e[a]}return"extent"in e&&(i=e.extent.split(/\s/),n.push("width: "+i[0]+";"),n.push("height: "+i[1]+";")),"origin"in e&&(i=e.origin.split(/\s/),n.push("left: "+i[0]+";"),n.push("top: "+i[1]+";")),"display-align"in e&&n.push(y[e["display-align"]]),"writing-mode"in e&&n.push(E[e["writing-mode"]]),"style"in e&&(t=x(e.style,t),n=n.concat(t)),"padding"in e&&n.push("padding:"+e.padding+";"),"overflow"in e&&n.push("overflow:"+e.overflow+";"),"show-background"in e&&n.push("show-background:"+e["show-background"]+";"),"id"in e&&n.push("regionID:"+e.id+";"),n}function w(e,t){var a=[];return e.match(/\S+/g).forEach(function(e){e=function(e,t){for(var a=0;a<e.length;a++){var i=e[a];if(i["xml:id"]===t||i.id===t)return i}return null}(c,e);e&&(e=o(JSON.parse(JSON.stringify(e)),t),a=a.concat(e))}),a}var B,u,c,i=/^([0-9][0-9]+):([0-5][0-9]):([0-5][0-9])|(60)(\.([0-9])+)?$/,k={},F={},U={},H={top:"85%;",left:"5%;",width:"90%;",height:"10%;","align-items":"flex-start;",overflow:"visible;","-ms-writing-mode":"lr-tb, horizontal-tb;;","-webkit-writing-mode":"horizontal-tb;","-moz-writing-mode":"horizontal-tb;","writing-mode":"horizontal-tb;"},K={color:"rgb(255,255,255);",direction:"ltr;","font-family":"monospace, sans-serif;","font-style":"normal;","line-height":"normal;","font-weight":"normal;","text-align":"start;","justify-content":"flex-start;","text-decoration":"none;","unicode-bidi":"normal;","white-space":"normal;",width:"100%;"},h={monospace:"font-family: monospace;",sansSerif:"font-family: sans-serif;",serif:"font-family: serif;",monospaceSansSerif:"font-family: monospace, sans-serif;",monospaceSerif:"font-family: monospace, serif;",proportionalSansSerif:"font-family: Arial;",proportionalSerif:"font-family: Times New Roman;",default:"font-family: monospace, sans-serif;"},f={right:["justify-content: flex-end;","text-align: right;"],start:["justify-content: flex-start;","text-align: start;"],center:["justify-content: center;","text-align: center;"],end:["justify-content: flex-end;","text-align: end;"],left:["justify-content: flex-start;","text-align: left;"]},p={start:"text-align: start;",center:"text-align: center;",end:"text-align: end;",auto:""},g={wrap:"white-space: normal;",noWrap:"white-space: nowrap;"},m={normal:"unicode-bidi: normal;",embed:"unicode-bidi: embed;",bidiOverride:"unicode-bidi: bidi-override;"},y={before:"align-items: flex-start;",center:"align-items: center;",after:"align-items: flex-end;"},E={lrtb:"-webkit-writing-mode: horizontal-tb;writing-mode: horizontal-tb;",rltb:"-webkit-writing-mode: horizontal-tb;writing-mode: horizontal-tb;direction: rtl;unicode-bidi: bidi-override;",tbrl:"-webkit-writing-mode: vertical-rl;writing-mode: vertical-rl;-webkit-text-orientation: upright;text-orientation: upright;",tblr:"-webkit-writing-mode: vertical-lr;writing-mode: vertical-lr;-webkit-text-orientation: upright;text-orientation: upright;",lr:"-webkit-writing-mode: horizontal-tb;writing-mode: horizontal-tb;",rl:"-webkit-writing-mode: horizontal-tb;writing-mode: horizontal-tb;direction: rtl;",tb:"-webkit-writing-mode: vertical-rl;writing-mode: vertical-rl;-webkit-text-orientation: upright;text-orientation: upright;"},v=function(e,t){for(var a in e)if(e.hasOwnProperty(a)){if(("object"==typeof e[a]||e[a]instanceof Object)&&!Array.isArray(e[a]))v(e[a],t);else if(Array.isArray(e[a]))for(var i=0;i<e[a].length;i++)v(e[a][i],t);e[a.slice(a.indexOf(t)+t.length+1)]=e[a],delete e[a]}},G=function(e,t){for(var a in t)t.hasOwnProperty(a)&&(N(a,e)||e.push(a+":"+t[a]))};return{parse:function(e){var T,t=new X2JS([],"",!1);B=t.xml_str2json(e),this.videoModel.getTTMLRenderingDiv()&&(T="html");var a,i,n=s(B,"http://www.w3.org/ns/ttml");if(n&&v(B,n),c=B.tt.head.layout.region_asArray,u=B.tt.head.styling.style_asArray,a=B.hasOwnProperty("tt"),i=!!a&&B.tt.hasOwnProperty("head"),t=!!i&&B.tt.head.hasOwnProperty("layout"),e=!!i&&B.tt.head.hasOwnProperty("styling"),n=!!a&&B.tt.hasOwnProperty("body"),!(a&&i&&t&&e&&n))throw"TTML document has incorrect structure";var _=B.tt.hasOwnProperty("ttp:cellResolution")?B.tt["ttp:cellResolution"].split(" ").map(parseFloat):[32,15],C=this.videoModel.getElement().clientWidth,S=this.videoModel.getElement().clientHeight,A=[C/_[0],S/_[1]];K["font-size"]=A[1]+"px;";for(var b=[],r=0;r<c.length;r++)b.push(o(JSON.parse(JSON.stringify(c[r])),A));n=s(B.tt,"http://www.w3.org/ns/ttml#parameter");B.tt.hasOwnProperty(n+":frameRate")&&(B.tt.frameRate=parseInt(B.tt[n+":frameRate"],10));var L=[];return B.tt.body_asArray[0].__children.forEach(function(m){var y,E,v,M,e=m.div.p_asArray;if(!e||0===e.length){var P="TTML document does not contain any cues";throw P}e.forEach(function(e){if(e.hasOwnProperty("begin")&&e.hasOwnProperty("end"))y=R(e.begin),E=R(e.end);else{if(!e.span.hasOwnProperty("begin")||!e.span.hasOwnProperty("end"))throw P="TTML document has incorrect timing value";v=R(e.span.begin),M=R(e.span.end)}if(void 0!==e["smpte:backgroundImage"])for(var t=B.tt.head.metadata.image_asArray,a=0;a<t.length;a+=1)"#"+t[a]["xml:id"]==e["smpte:backgroundImage"]&&L.push({start:v||y,end:M||E,id:t[a]["xml:id"],data:"data:image/"+t[a].imagetype.toLowerCase()+";base64, "+t[a].__text,type:"image"});else if("html"===T){F={},U={},k={};var i="";if((e.hasOwnProperty("id")||e.hasOwnProperty("xml:id"))&&(i=e["xml:id"]||e.id),(isNaN(y)||isNaN(E))&&(isNaN(v)||isNaN(M)))throw P="TTML document has incorrect timing value";var n=(h=e,f=m.div,s=A,g=[],h=h.region,(f=f.region)&&(p=w(f,s)),h?(s=g.concat(w(h,s)),g=p?O(p,s):s):p&&(g=p),G(g,H),g),r=(s=(c=A,f=[],s=(h=e).style,p=B.tt.body.style,g=B.tt.body.div.style,h="",p&&(r=x(p,c),h="paragraph "+p),g&&(o=x(g,c),r?(o=O(r,o),h+=" "+g):h="paragraph "+g),s?(c=x(s,c),r&&o?(f=O(o,c),h+=" "+s):r?(f=O(r,c),h+=" "+s):o?(f=O(o,c),h+=" "+s):(f=c,h="paragraph "+s)):r&&!o?f=r:!r&&o&&(f=o),G(f,K),[f,h]))[1],s=s[0],o=document.createElement("div");o.className=r;f=e.__children,r=(h=f,d=A,u=document.createElement("div"),h.forEach(function(e){var a,i,t,n;e.hasOwnProperty("metadata")||(e.hasOwnProperty("span")?(a=e.span.__children,i=document.createElement("span"),e.span.hasOwnProperty("style")&&(t=x(e.span.style,d),i.className="spanPadding "+e.span.style,i.style.cssText=t.join(" ")),a.forEach(function(e){var t;a.hasOwnProperty("metadata")||(e.hasOwnProperty("#text")?(t=document.createTextNode(e["#text"]),i.appendChild(t)):"br"in e&&(i.hasChildNodes()&&u.appendChild(i),(e=document.createElement("br")).className="lineBreak",u.appendChild(e),(e=document.createElement("span")).className=i.className,e.style.cssText=i.style.cssText,i=e))}),u.appendChild(i)):e.hasOwnProperty("br")?((n=document.createElement("br")).className="lineBreak",u.appendChild(n)):e.hasOwnProperty("#text")&&((n=document.createElement("span")).innerHTML=e["#text"],u.appendChild(n)))}),u);r.className="cueDirUniWrapper",N("unicode-bidi",s)&&(r.style.cssText+=D("unicode-bidi",s),I("unicode-bidi",s)),N("direction",s)&&(r.style.cssText+=D("direction",s),I("direction",s)),N("padding-left",s)&&N("padding-right",s)&&(r.innerHTML=function(e,t){for(var a=D("padding-left",t),t=D("padding-right",t),s=a.concat(" "+t),o="",l="",d="",u=Array.prototype.slice.call(e.children),i=e.getElementsByClassName("lineBreak")[0],n=u.indexOf(i),c=[];-1!=n;)c.push(n),n=u.indexOf(i,n+1);var h="</span>",f="<br>",p='<span class="spanPadding" style="-webkit-box-decoration-break: clone; ';if(c.length)c.forEach(function(e,t){if(0===t){for(var a="",i=0;i<e;i++)o+=u[i].outerHTML,0===i&&(a=s.concat(u[i].style.cssText));o=p+a+'">'+o}for(var n="",r=e+1;r<u.length;r++)l+=u[r].outerHTML,r===u.length-1&&(n+=s.concat(u[r].style.cssText));l=p+n+'">'+l,o&&l&&t===c.length-1?d+=o+h+f+l+h:o&&l&&t!==c.length-1?d+=o+h+f+l+h+f:o&&!l?d+=o+h:!o&&l&&t===c.length-1?d+=l+h:!o&&l&&t!==c.length-1&&(d+=l+h+f)});else{for(var r="",g=0;g<u.length;g++)r+=u[g].style.cssText;d=p+s+r+'">'+e.innerHTML+h}return d}(r,s)),N("padding-left",s)&&N("padding-right",s)&&(I("padding-left",s),I("padding-right",s));f="";N("regionID",n)&&(f=(h=D("regionID",n)).slice(h.indexOf(":")+1,h.length-1)),s&&(o.style.cssText=s.join(" ")+"display:flex;"),n=n&&n.join(" "),o.appendChild(r);r=document.createElement("div");r.appendChild(o),r.id="subtitle_"+i,r.style.cssText="position: absolute; z-index: 2147483647; margin: 0; display: flex; box-sizing: border-box; pointer-events: none;"+n,0===Object.keys(k).length&&(k.defaultFontSize="100"),L.push({start:v||y,end:M||E,type:"html",cueHTMLElement:r,regions:b,regionID:f,cueID:i,videoHeight:S,videoWidth:C,cellResolution:_,fontSize:k||{defaultFontSize:"100"},lineHeight:F,linePadding:U})}else{var l="",i=e.__children;i.length&&i.forEach(function(e){var t;e.hasOwnProperty("span")?(t=e.span.__children).forEach(function(e){t.hasOwnProperty("metadata")||(e.hasOwnProperty("#text")?l+=e["#text"].replace(/[\r\n]+/gm," ").trim():"br"in e&&(l+="\n"))}):l+=e.hasOwnProperty("br")?"\n":e["#text"].replace(/[\r\n]+/gm," ").trim()}),L.push({start:v||y,end:M||E,data:l,type:"text"})}var d,u,c,r,o,h,f,s,p,g})}),L},videoModel:void 0}},MediaPlayer.dependencies.TextSourceBuffer=function(){var r=!1,c=null;return{system:void 0,videoModel:void 0,errHandler:void 0,adapter:void 0,manifestExt:void 0,mediaController:void 0,streamController:void 0,initialize:function(e,t){this.sp=t.streamProcessor,this.mediaInfos=this.sp.getMediaInfoArr(),this.textTrackExtensions=this.system.getObject("textTrackExtensions"),this.isFragmented=!this.manifestExt.getIsTextTrack(e),this.isFragmented&&(this.fragmentModel=this.sp.getFragmentModel(),this.buffered=this.system.getObject("customTimeRanges"),this.initializationSegmentReceived=!1,this.timescale=9e4,this.allTracks=this.mediaController.getTracksFor("fragmentedText",this.streamController.getActiveStreamInfo()))},append:function(e,t){function a(e,t){var a,i=new MediaPlayer.vo.TextTrackInfo,n={subtitle:"subtitles",caption:"captions"};i.captionData=e,i.lang=t.lang,i.label=t.id,i.video=o.videoModel.getElement(),i.defaultTrack=o.getIsDefault(t),i.isFragmented=o.isFragmented,i.kind=(a=0<t.roles.length?n[t.roles[0]]:n.caption)!==n.caption||a!==n.subtitle?n.caption:a,o.textTrackExtensions.addTextTrack(i,o.mediaInfos.length)}var i,n,r,s,o=this,l=t.mediaInfo,d=l.type,u=l.mimeType;if("fragmentedText"===d){d=o.system.getObject("fragmentExt");if(this.initializationSegmentReceived)for(n=d.getSamplesInfo(e),r=0;r<n.length;r++){this.firstSubtitleStart||(this.firstSubtitleStart=n[0].cts-t.start*this.timescale),n[r].cts-=this.firstSubtitleStart,this.buffered.add(n[r].cts/this.timescale,(n[r].cts+n[r].duration)/this.timescale),s=window.UTF8.decode(new Uint8Array(e.slice(n[r].offset,n[r].offset+n[r].size))),c=null!==c?c:o.getParser(u);try{i=c.parse(s),this.textTrackExtensions.addCaptions(this.firstSubtitleStart/this.timescale,i)}catch(e){}}else{for(this.initializationSegmentReceived=!0,r=0;r<this.mediaInfos.length;r++)a(null,this.mediaInfos[r]);this.timescale=d.getMediaTimescaleFromMoov(e)}}else{e=new Uint8Array(e),s=window.UTF8.decode(e);try{a(i=o.getParser(u).parse(s),l)}catch(e){o.errHandler.closedCaptionsError(e,"parse",s)}}},getIsDefault:function(e){return e.index===this.mediaInfos[0].index},abort:function(){this.textTrackExtensions.deleteAllTextTracks(),r=!1,c=null},getParser:function(e){var t;return"text/vtt"===e?t=this.system.getObject("vttParser"):"application/ttml+xml"!==e&&"application/mp4"!==e||(t=this.system.getObject("ttmlParser")),t},getAllTracksAreDisabled:function(){return r},setTextTrack:function(){for(var e=this.videoModel.getElement().textTracks,t=e.length,a=this,i=0;i<t;i++){var n=e[i];if(r="showing"!==n.mode,"showing"===n.mode){a.textTrackExtensions.getCurrentTrackIdx()!==i&&(null!==(n=a.textTrackExtensions.getCurrentTextTrack())&&(a.textTrackExtensions.deleteTrackCues(n),"html"===n.renderingType&&(a.textTrackExtensions.removeCueStyle(),a.textTrackExtensions.clearCues())),a.textTrackExtensions.setCurrentTrackIdx(i),a.mediaController.isCurrentTrack(a.allTracks[i])||(a.textTrackExtensions.deleteTrackCues(a.textTrackExtensions.getCurrentTextTrack()),a.fragmentModel.cancelPendingRequests(),a.fragmentModel.abortRequests(),a.buffered.clear(),a.mediaController.setTrack(a.allTracks[i])));break}}r&&a.textTrackExtensions.setCurrentTrackIdx(-1)}}},MediaPlayer.dependencies.TextSourceBuffer.prototype={constructor:MediaPlayer.dependencies.TextSourceBuffer},MediaPlayer.dependencies.TimeSyncController=function(){"use strict";function r(e){c=e}function a(e){0}function s(e){u=e}function i(e){var t,a,i=Date.parse(e);return isNaN(i)&&(a=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+\-])([0-9]{2})([0-9]{2}))?/.exec(t=e),e=Date.UTC(parseInt(a[1],10),parseInt(a[2],10)-1,parseInt(a[3],10),parseInt(a[4],10),parseInt(a[5],10),a[6]&&(parseInt(a[6],10)||0),a[7]&&1e3*parseFloat(a[7])||0),a[9]&&a[10]&&(t=60*parseInt(a[9],10)+parseInt(a[10],10),e+=("+"===a[8]?-1:1)*t*60*1e3),i=new Date(e).getTime()),i}function e(e){return Date.parse(e)}function n(e){return Date.parse(e)}function t(e,t,a){a()}function o(e,t,a){return e=i(e),isNaN(e)?void a():void t(e)}function l(e,t,a){h.call(this,n,e,t,a,!0)}var d,u=0,c=!1,h=function(t,e,a,i,n){var r,s,o=!1,l=new XMLHttpRequest,d=n?"HEAD":"GET",u=e.match(/\S+/g);e=u.shift(),r=function(){o||(o=!0,u.length?h(t,u.join(" "),a,i,n):i())},s=function(){var e;200===l.status&&(e=n?l.getResponseHeader("Date"):l.response,e=t(e),isNaN(e)||(a(e),o=!0))},l.open(d,e),l.timeout=5e3,l.onload=s,l.onloadend=r,l.send()},f={"urn:mpeg:dash:utc:http-head:2014":l,"urn:mpeg:dash:utc:http-xsdate:2014":h.bind(null,i),"urn:mpeg:dash:utc:http-iso:2014":h.bind(null,e),"urn:mpeg:dash:utc:direct:2014":o,"urn:mpeg:dash:utc:http-head:2012":l,"urn:mpeg:dash:utc:http-xsdate:2012":h.bind(null,i),"urn:mpeg:dash:utc:http-iso:2012":h.bind(null,e),"urn:mpeg:dash:utc:direct:2012":o,"urn:mpeg:dash:utc:http-ntp:2014":t,"urn:mpeg:dash:utc:ntp:2014":t,"urn:mpeg:dash:utc:sntp:2014":t},p=function(e,t,a){r(!1),this.notify(MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED,{time:t,offset:a},e?new MediaPlayer.vo.Error(MediaPlayer.dependencies.TimeSyncController.TIME_SYNC_FAILED_ERROR_CODE):null)},g=function(e,t){function i(e,t){var a=!e||!t;a&&d?function(){var e=this.metricsModel.getReadOnlyMetricsFor("stream"),e=this.metricsExt.getLatestMPDRequestHeaderValueByID(e,"Date"),e=null!==e?new Date(e).getTime():Number.NaN;isNaN(e)?p.call(this,!0):(s(e-(new Date).getTime()),p.call(this,!1,e/1e3,u))}.call(n):p.call(n,a,e,t)}var n=this,a=t||0,t=e[a];r(!0),t?f.hasOwnProperty(t.schemeIdUri)?f[t.schemeIdUri](t.value,function(e){var t=(new Date).getTime(),a=e-t;s(a),n.log("Local time:      "+new Date(t)),n.log("Server time:     "+new Date(e)),n.log("Difference (ms): "+a),i.call(n,e,a)},function(){g.call(n,e,a+1)}):g.call(n,e,a+1):(s(0),i.call(n))};return{log:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,metricsModel:void 0,metricsExt:void 0,getOffsetToDeviceTimeMs:function(){return u},initialize:function(e,t){d=t,c||(g.call(this,e),a(!0))},reset:function(){a(!1),r(!1)}}},MediaPlayer.dependencies.TimeSyncController.prototype={constructor:MediaPlayer.dependencies.TimeSyncController},MediaPlayer.dependencies.TimeSyncController.eventList={ENAME_TIME_SYNCHRONIZATION_COMPLETED:"timeSynchronizationComplete"},MediaPlayer.dependencies.TimeSyncController.TIME_SYNC_FAILED_ERROR_CODE=1,MediaPlayer.utils.VTTParser=function(){"use strict";function d(e){var t=e.split(":"),a=t.length-1;return e=60*parseInt(t[a-1],10)+parseFloat(t[a]),2==a&&(e+=3600*parseInt(t[0],10)),e}var u=/(?:\r\n|\r|\n)/gm,c=/-->/,h=/(^[\s]+|[\s]+$)/g,f=/\s\b/g,p=function(e){var a={};return e.forEach(function(e){var t;1<e.split(/:/).length&&((t=e.split(/:/)[1])&&-1!=t.search(/%/)&&(t=parseInt(t.replace(/%/,""))),(e.match(/align/)||e.match(/A/))&&(a.align=t),(e.match(/line/)||e.match(/L/))&&(a.line=t),(e.match(/position/)||e.match(/P/))&&(a.position=t),(e.match(/size/)||e.match(/S/))&&(a.size=t))}),a};return{log:void 0,parse:function(e){for(var t=[],a=(e=e.split(u)).length,i=-1,n=0;n<a;n++){var r,s,o,l=e[n];0<l.length&&"WEBVTT"!==l&&l.match(c)&&(r=void 0,(s=(r=(s=l).split(c))[1].split(f)).shift(),r[1]=s[0],s.shift(),l=(o={cuePoints:r,styles:p(s)}).cuePoints,r=o.styles,s=function(e,t){for(var a,i=t,n="",r="";""!==e[i]&&i<e.length;)i++;if(1<(a=i-t))for(var s=0;s<a;s++){if((r=e[t+s]).match(c)){n="";break}n+=r,s!==a-1&&(n+="\n")}else(r=e[t]).match(c)||(n=r);return decodeURI(n)}(e,n+1),o=d(l[0].replace(h,"")),l=d(l[1].replace(h,"")),!isNaN(o)&&!isNaN(l)&&i<=o&&o<l?""!==s?t.push({start:i=o,end:l,data:s,styles:r}):this.log("Skipping cue due to empty/malformed cue text"):this.log("Skipping cue due to incorrect cue timing"))}return t}}},MediaPlayer.dependencies.XlinkLoader=function(){"use strict";var f=function(e,t,a,i){var n,r=new XMLHttpRequest,s=this,o=!0,l=!0,d=new Date,u=function(){r.status<200||299<r.status||(l=!1,s.metricsModel.addHttpRequest("stream",null,MediaPlayer.vo.metrics.HTTPRequest.XLINK_EXPANSION_TYPE,e,r.responseURL||null,null,d,r.firstByteDate||null,new Date,r.status,null,r.getAllResponseHeaders()),n=r.responseText,t.resolved=!0,n?(t.resolvedContent=n,s.notify(MediaPlayer.dependencies.XlinkLoader.eventList.ENAME_XLINKELEMENT_LOADED,{element:t,resolveObject:a})):(t.resolvedContent=null,s.notify(MediaPlayer.dependencies.XlinkLoader.eventList.ENAME_XLINKELEMENT_LOADED,{element:t,resolveObject:a},new MediaPlayer.vo.Error(null,"Failed loading Xlink element: "+e,null))))},c=function(){l&&(l=!1,s.metricsModel.addHttpRequest("stream",null,MediaPlayer.vo.metrics.HTTPRequest.XLINK_EXPANSION_TYPE,e,r.responseURL||null,null,d,r.firstByteDate||null,new Date,r.status,null,r.getAllResponseHeaders()),0<i?(console.log("Failed loading xLink content: "+e+", retry in 500ms attempts: "+i),i--,setTimeout(function(){f.call(s,e,t,a,i)},500)):(console.log("Failed loading Xlink content: "+e+" no retry attempts left"),s.errHandler.downloadError("xlink",e,r),t.resolved=!0,t.resolvedContent=null,s.notify(MediaPlayer.dependencies.XlinkLoader.eventList.ENAME_XLINKELEMENT_LOADED,{element:t,resolveObject:a},new Error("Failed loading xlink Element: "+e+" no retry attempts left"))))},h=function(e){o&&(o=!1,(!e.lengthComputable||e.lengthComputable&&e.total!=e.loaded)&&(r.firstByteDate=new Date))};try{r.onload=u,r.onloadend=c,r.onerror=c,r.onprogress=h,r.open("GET",s.requestModifierExt.modifyRequestURL(e),!0),r.send()}catch(e){console.log("Error"),r.onerror()}};return{errHandler:void 0,metricsModel:void 0,requestModifierExt:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,load:function(e,t,a){"urn:mpeg:dash:resolve-to-zero:2013"===e?(t.resolvedContent=null,t.resolved=!0,this.notify(MediaPlayer.dependencies.XlinkLoader.eventList.ENAME_XLINKELEMENT_LOADED,{element:t,resolveObject:a})):f.call(this,e,t,a,1)}}},MediaPlayer.dependencies.XlinkLoader.prototype={constructor:MediaPlayer.dependencies.XlinkLoader},MediaPlayer.dependencies.XlinkLoader.eventList={ENAME_XLINKELEMENT_LOADED:"xlinkElementLoaded"},MediaPlayer.dependencies.AbrController=function(){"use strict";function u(e,t){return r[t]=r[t]||{},r[t].hasOwnProperty(e)||(r[t][e]=0),r[t][e]}function c(e,t,a){r[t]=r[t]||{},r[t][e]=a}function a(e,t){return p[t]=p[t]||{},p[t].hasOwnProperty(e)||(p[t][e]=0),p[t][e]}function i(e){return s.hasOwnProperty("max")&&s.max.hasOwnProperty(e)?s.max[e]:NaN}function h(e,t){return n[t]=n[t]||{},n[t].hasOwnProperty(e)||(n[t][e]=0),m.call(this,n[t][e],e)}function e(e){var i,n,t,r,s;0===MediaPlayer.dependencies.ScheduleController.LOADING_REQUEST_THRESHOLD&&f&&(n=e.data.request.mediaType,t=(i=this).abrRulesCollection.getRules(MediaPlayer.rules.ABRRulesCollection.prototype.ABANDON_FRAGMENT_RULES),r=d[n].getScheduleController(),s=r.getFragmentModel(),i.rulesController.applyRules(t,d[n],function(e){var t,a;e.confidence===MediaPlayer.rules.SwitchRequest.prototype.STRONG&&(t=s.getRequests({state:MediaPlayer.dependencies.FragmentModel.states.LOADING}),(e=e.value)<i.getQualityFor(n,i.streamController.getActiveStreamInfo())&&(s.abortRequests(),i.setAbandonmentStateFor(n,MediaPlayer.dependencies.AbrController.ABANDON_LOAD),i.setPlaybackQuality(n,i.streamController.getActiveStreamInfo(),e),r.replaceCanceledRequests(t),a=n,o=setTimeout(function(){i.setAbandonmentStateFor(a,MediaPlayer.dependencies.AbrController.ALLOW_LOAD)},MediaPlayer.dependencies.AbrController.ABANDON_TIMEOUT)))},e,function(e,t){return t}))}var o,f=!0,n={},r={},p={},s={},l={},d={},g={},m=function(e,t){var a=i(t);if(isNaN(a))return e;a=this.getQualityForBitrate(d[t].getMediaInfo(),a);return Math.min(e,a)};return{log:void 0,abrRulesCollection:void 0,rulesController:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,streamController:void 0,setup:function(){this[MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_PROGRESS]=e},initialize:function(e,t){d[e]=t,g[e]=g[e]||{},g[e].state=MediaPlayer.dependencies.AbrController.ALLOW_LOAD},getAutoSwitchBitrate:function(){return f},setAutoSwitchBitrate:function(e){f=e},getPlaybackQuality:function(i){var n,e,r=this,s=i.getType(),o=i.getStreamInfo().id,l=u(s,o),d=a(s,o);f&&(e=r.abrRulesCollection.getRules(MediaPlayer.rules.ABRRulesCollection.prototype.QUALITY_SWITCH_RULES),r.rulesController.applyRules(e,i,function(e){var t,a=h.call(r,s,o);l=e.value,d=e.confidence,a<(l=l<0?0:l)&&(l=a),n=u(s,o),l===n||g[s].state===MediaPlayer.dependencies.AbrController.ABANDON_LOAD&&n<l||(c(s,o,l),t=s,e=d,p[a=o]=p[a]||{},p[a][t]=e,r.notify(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,{mediaType:s,streamInfo:i.getStreamInfo(),oldQuality:n,newQuality:l}))}.bind(r),l,function(e,t){return e=e===MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE?0:e,Math.max(e,t)}))},setPlaybackQuality:function(e,t,a){var i=t.id,n=u(e,i);if(!(null!==a&&!isNaN(a)&&a%1==0))throw"argument is not an integer";a!==n&&0<=a&&a<=h.call(this,e,i)&&(c(e,t.id,a),this.notify(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,{mediaType:e,streamInfo:t,oldQuality:n,newQuality:a}))},setAbandonmentStateFor:function(e,t){g[e].state=t},getAbandonmentStateFor:function(e){return g[e].state},getQualityFor:function(e,t){return u(e,t.id)},getConfidenceFor:function(e,t){return a(e,t.id)},setInitialBitrateFor:function(e,t){t=t,s[e]=t},getInitialBitrateFor:function(e){return s[e]},setMaxAllowedBitrateFor:function(e,t){e=e,t=t,s.max=s.max||{},s.max[e]=t},getMaxAllowedBitrateFor:i,getQualityForBitrate:function(e,t){for(var a=this.getBitrateList(e),i=a.length,n=0;n<i;n+=1)if(1e3*t<=a[n].bitrate)return Math.max(n-1,0);return i-1},getBitrateList:function(e){if(!e||!e.bitrateList)return null;for(var t,a=e.bitrateList,i=e.type,n=[],r=0,s=a.length;r<s;r+=1)(t=new MediaPlayer.vo.BitrateInfo).mediaType=i,t.qualityIndex=r,t.bitrate=a[r],n.push(t);return n},setAverageThroughput:function(e,t){l[e]=t},getAverageThroughput:function(e){return l[e]},updateTopQualityIndex:function(e){var t=e.type,a=e.streamInfo.id,i=e.representationCount-1;return e=t,t=i,n[a=a]=n[a]||{},n[a][e]=t,i},isPlayingAtTopQuality:function(e){var t=e.id,a=this.getQualityFor("audio",e),e=this.getQualityFor("video",e);return a===h.call(this,"audio",t)&&e===h.call(this,"video",t)},getTopQualityIndexFor:h,reset:function(){f=!0,n={},r={},p={},d={},g={},l={},clearTimeout(o),o=null}}},MediaPlayer.dependencies.AbrController.prototype={constructor:MediaPlayer.dependencies.AbrController},MediaPlayer.dependencies.AbrController.eventList={ENAME_QUALITY_CHANGED:"qualityChanged"},MediaPlayer.dependencies.AbrController.DEFAULT_VIDEO_BITRATE=1e3,MediaPlayer.dependencies.AbrController.DEFAULT_AUDIO_BITRATE=100,MediaPlayer.dependencies.AbrController.ABANDON_LOAD="abandonload",MediaPlayer.dependencies.AbrController.ALLOW_LOAD="allowload",MediaPlayer.dependencies.AbrController.ABANDON_TIMEOUT=1e4,MediaPlayer.dependencies.AbrController.BANDWIDTH_SAFETY=.9,MediaPlayer.dependencies.BufferController=function(){"use strict";function t(){var e=this.streamProcessor.getFragmentModel().getRequests({state:MediaPlayer.dependencies.FragmentModel.states.LOADING}),t=j.call(this),t=this.virtualBuffer.getChunks({streamId:t,mediaType:p,segmentType:MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE,quality:E});return!(y<E&&(D(t,E)||D(e,E)))&&E!==y}function e(e){e.data.fragmentModel===this.streamProcessor.getFragmentModel()&&(this.log("Initialization finished loading"),e=e.data.chunk,this.virtualBuffer.append(e),e.quality===y&&t.call(this)&&te.call(this))}function a(e){var t,a,i,n,r;e.data.fragmentModel===this.streamProcessor.getFragmentModel()&&(a=(t=e.data.chunk).bytes,r=t.quality,n=t.index,i=this.streamProcessor.getFragmentModel().getRequests({state:MediaPlayer.dependencies.FragmentModel.states.EXECUTED,quality:r,index:n})[0],e=this.streamProcessor.getRepresentationInfoForQuality(r),n=this.manifestModel.getValue(),r=this.adapter.getEventsFor(n,e.mediaInfo,this.streamProcessor),e=this.adapter.getEventsFor(n,e,this.streamProcessor),(0<r.length||0<e.length)&&(e=x.call(this,a,i,r,e),this.streamProcessor.getEventController().addInbandEvents(e)),t.bytes=w.call(this,a),this.virtualBuffer.append(t),Y.call(this))}function i(e){R=!0;var t=(m=e).quality,a=isNaN(e.index);return t!==y&&a||t!==E&&!a?(this.log("reject request - required quality = "+y+" current quality = "+E+" chunk media type = "+e.mediaType+" chunk quality = "+t+" chunk index = "+e.index),void W.call(this,t,e.index)):void this.sourceBufferExt.append(S,e)}function n(){_!==C-1||v||(v=!0,this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFERING_COMPLETED))}function r(){return A?MediaPlayer.dependencies.BufferController.BUFFER_LOADED:MediaPlayer.dependencies.BufferController.BUFFER_EMPTY}function s(){S&&(O.call(this),Y.call(this))}function o(e){e.error||(V.call(this,e.data.currentRepresentation.MSETimeOffset),e=this.streamProcessor.getStreamInfo().manifestInfo.minBufferTime,g!==e&&(this.setMinBufferTime(e),this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_MIN_BUFFER_TIME_UPDATED,{minBufferTime:e})))}function l(e){e.data.fragmentModel===this.streamProcessor.getFragmentModel()&&(C=e.data.request.index,n.call(this))}function d(e){p===e.data.mediaType&&this.streamProcessor.getStreamInfo().id===e.data.streamInfo.id&&(e=e.data.newQuality,y!==e&&(V.call(this,this.streamProcessor.getRepresentationInfoForQuality(e).MSETimeOffset),y=e,t.call(this)&&te.call(this)))}function u(e){if(S){var t=e.data.newMediaInfo.type,a=e.data.switchMode,i={start:0,end:this.playbackController.getTime()};if(p===t)switch(a){case MediaPlayer.dependencies.MediaController.trackSwitchModes.ALWAYS_REPLACE:H.call(this,i);break;case MediaPlayer.dependencies.MediaController.trackSwitchModes.NEVER_REPLACE:break;default:this.log("track switch mode is not supported: "+a)}}}function c(){Y.call(this),(b+=1)%MediaPlayer.dependencies.BufferController.BUFFER_PRUNING_INTERVAL==0&&function(){var e,t=this.playbackController.getTime(),a=this.sourceBufferExt.getBufferRange(S,t);null===a||0<(e=t-a.start-MediaPlayer.dependencies.BufferController.BUFFER_TO_KEEP)&&this.sourceBufferExt.remove(S,0,Math.round(a.start+e),f)}.call(this)}function h(){G.call(this)}var f,p,g,m,y=0,E=-1,v=!1,M=0,P=0,T=Number.POSITIVE_INFINITY,_=-1,C=-1,S=null,A=null,b=0,L=!1,R=!1,N=!1,D=function(e,t){for(var a=0,i=e.length;a<i;a+=1)if(e[a].quality===t)return!0;return!1},I=function(e){if(S===e.data.buffer){this.isBufferingCompleted()&&this.streamProcessor.getStreamInfo().isLast&&this.mediaSourceExt.signalEndOfStream(f);var t,a=this;if(e.error)return e.error.code===MediaPlayer.dependencies.SourceBufferExtensions.QUOTA_EXCEEDED_ERROR_CODE&&(a.virtualBuffer.append(m),T=.8*a.sourceBufferExt.getTotalBufferedTime(S),a.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_QUOTA_EXCEEDED,{criticalBufferLevel:T}),H.call(a,U.call(a))),void(R=!1);if(O.call(a),F.call(a)||(a.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_QUOTA_EXCEEDED,{criticalBufferLevel:T}),H.call(a,U.call(a))),(t=a.sourceBufferExt.getAllRanges(S))&&0<t.length)for(var i=0,n=t.length;i<n;i+=1)a.log("Buffered Range: "+t.start(i)+" - "+t.end(i));a.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_APPENDED,{quality:m.quality,index:m.index,bufferedRanges:t}),$.call(a,m.quality,m.index)}},O=function(){var e=this,t=e.playbackController.getTime(),a=this.streamProcessor.getScheduleController().getFragmentToLoadCount(),i=this.streamProcessor.getCurrentRepresentationInfo().fragmentDuration;return M=e.sourceBufferExt.getBufferLength(S,t),P=0<a?a*i+M:P,z.call(this),e.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED,{bufferLevel:M}),B.call(e),G.call(e),!0},x=function(e,t,a,i){var n,r=[],s=Math.max(isNaN(t.startTime)?0:t.startTime,0),o=[];N=!1;for(var l=a.concat(i),d=0;d<l.length;d++)o[l[d].schemeIdUri]=l[d];for(var u,c=0,h=(u=this.boxParser.parse(e).getBoxes("emsg")).length;c<h;c+=1)(n=this.adapter.getEvent(u[c],o,s))&&r.push(n);return r},w=function(e){if(!N)return e;for(var t,a,i=e.length,n=0,r=0,s=Math.pow(256,2),o=Math.pow(256,3),l=new Uint8Array(e.length);n<i;){if(t=String.fromCharCode(e[n+4],e[n+5],e[n+6],e[n+7]),a=e[n]*o+e[n+1]*s+256*e[n+2]+ +e[n+3],"emsg"!=t)for(var d=n;d<n+a;d++)l[r]=e[d],r+=1;n+=a}return l.subarray(0,r)},B=function(){var e=k.call(this),t=2*g,e=M-e;t<=e&&!L?(L=!0,this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN)):e<t/2&&L&&(this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED),L=!1,Y.call(this))},k=function(){var e=this.metricsModel.getReadOnlyMetricsFor("video"),t=this.metricsExt.getCurrentBufferLevel(e),e=this.metricsModel.getReadOnlyMetricsFor("audio"),e=this.metricsExt.getCurrentBufferLevel(e);return null===t||null===e?null!==e?e.level:null!==t?t.level:null:Math.min(e.level,t.level)},F=function(){return this.sourceBufferExt.getTotalBufferedTime(S)<T},U=function(){var e,t;return S?(e=this.playbackController.getTime(),t=(t=this.streamProcessor.getFragmentModel().getRequests({state:MediaPlayer.dependencies.FragmentModel.states.EXECUTED,time:e})[0])&&!isNaN(t.startTime)?t.startTime:Math.floor(e),null===this.sourceBufferExt.getBufferRange(S,e)&&0<S.buffered.length&&(t=S.buffered.end(S.buffered.length-1)),{start:S.buffered.start(0),end:t}):null},H=function(e){var t;e&&S&&(t=e.start,e=e.end,this.sourceBufferExt.remove(S,t,e,f))},K=function(e){S===e.data.buffer&&(this.virtualBuffer.updateBufferedRanges({streamId:j.call(this),mediaType:p},this.sourceBufferExt.getAllRanges(S)),O.call(this),this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_CLEARED,{from:e.data.from,to:e.data.to,hasEnoughSpaceToAppend:F.call(this)}),F.call(this)||setTimeout(H.bind(this,U.call(this)),1e3*g))},G=function(){M<.5&&!v?q.call(this,!1):q.call(this,!0)},q=function(e){var t;A===e||"fragmentedText"===p&&this.textSourceBuffer.getAllTracksAreDisabled()||(A=e,t=r()===MediaPlayer.dependencies.BufferController.BUFFER_LOADED?MediaPlayer.events.BUFFER_LOADED:MediaPlayer.events.BUFFER_EMPTY,z.call(this),this.eventBus.dispatchEvent({type:t,data:{bufferType:p}}),this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,{hasSufficientBuffer:e}),this.log(A?"Got enough buffer to start.":"Waiting for more buffer before starting playback."))},V=function(e){S&&S.timestampOffset!==e&&!isNaN(e)&&(S.timestampOffset=e)},Y=function(){(t.call(this)?te:J).call(this)},z=function(){var e,t;!function(){return this.streamProcessor.getStreamInfo().id===this.streamController.getActiveStreamInfo().id}.call(this)||(this.metricsModel.addBufferState(p,r(),P),e=M,(t=this.virtualBuffer.getTotalBufferLevel(this.streamProcessor.getMediaInfo()))&&(e+=t),this.metricsModel.addBufferLevel(p,new Date,e))},j=function(){return this.streamProcessor.getStreamInfo().id},$=function(e,t){R=!1,isNaN(t)?Q.call(this,e):X.call(this,t),Y.call(this)},W=function(e,t){R=!1,this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_REJECTED,{quality:e,index:t}),Y.call(this)},Q=function(e){E=e},X=function(e){this.virtualBuffer.storeAppendedChunk(m,S),Z.call(this),_=Math.max(e,_),n.call(this)},Z=function(){var e,t=this,a=this.virtualBuffer.getChunks({streamId:j.call(this),mediaType:p,segmentType:MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE,appended:!0}),i=new MediaPlayer.utils.CustomTimeRanges,n=new MediaPlayer.utils.CustomTimeRanges,r=this.playbackController.getTime(),s=2*this.streamProcessor.getCurrentRepresentationInfo().fragmentDuration;if(a.forEach(function(e){(t.mediaController.isCurrentTrack(e.mediaInfo)?n:i).add(e.bufferedRange.start,e.bufferedRange.end)}),0!==i.length&&0!==n.length&&!(this.sourceBufferExt.getBufferLength({buffered:n},r)<s))for(var o=0,l=i.length;o<l;o+=1)e={start:i.start(o),end:i.end(o)},(t.mediaController.getSwitchMode(p)===MediaPlayer.dependencies.MediaController.trackSwitchModes.ALWAYS_REPLACE||r<e.start)&&H.call(t,e)},J=function(){var e=j.call(this);!S||L||R||t.call(this)||!F.call(this)||(e=this.virtualBuffer.extract({streamId:e,mediaType:p,segmentType:MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE,limit:1})[0])&&i.call(this,e)},ee=function(){z.call(this)},te=function(){var e={streamId:j.call(this),mediaType:p,segmentType:MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE,quality:y},e=this.virtualBuffer.getChunks(e)[0];e?!R&&S&&i.call(this,e):this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_INIT_REQUESTED,{requiredQuality:y})};return{sourceBufferExt:void 0,eventBus:void 0,bufferMax:void 0,manifestModel:void 0,errHandler:void 0,mediaSourceExt:void 0,metricsModel:void 0,metricsExt:void 0,streamController:void 0,playbackController:void 0,mediaController:void 0,adapter:void 0,log:void 0,abrController:void 0,boxParser:void 0,system:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,virtualBuffer:void 0,textSourceBuffer:void 0,setup:function(){this[Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED]=o,this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_INIT_FRAGMENT_LOADED]=e,this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADED]=a,this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED]=l,this[MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED]=d,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PROGRESS]=s,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING]=s,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_TIME_UPDATED]=s,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_RATE_CHANGED]=h,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED]=c,this[MediaPlayer.dependencies.MediaController.eventList.CURRENT_TRACK_CHANGED]=u,I=I.bind(this),K=K.bind(this),ee=ee.bind(this),this.sourceBufferExt.subscribe(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,this,I),this.sourceBufferExt.subscribe(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,this,K),this.virtualBuffer.subscribe(MediaPlayer.utils.VirtualBuffer.eventList.CHUNK_APPENDED,this,ee)},initialize:function(e,t,a){var i=this;p=e,i.setMediaType(p),i.setMediaSource(t),i.streamProcessor=a,i.fragmentController=a.fragmentController,i.scheduleController=a.scheduleController,y=i.abrController.getQualityFor(p,a.getStreamInfo())},createBuffer:function(e){if(!e||!f||!this.streamProcessor)return null;var t=null;try{(t=this.sourceBufferExt.createSourceBuffer(f,e))&&t.hasOwnProperty("initialize")&&t.initialize(p,this)}catch(e){this.errHandler.mediaSourceError("Error creating "+p+" source buffer.")}return this.setBuffer(t),V.call(this,this.streamProcessor.getRepresentationInfoForQuality(y).MSETimeOffset),t},getStreamProcessor:function(){return this.streamProcessor},setStreamProcessor:function(e){this.streamProcessor=e},getBuffer:function(){return S},setBuffer:function(e){S=e},getBufferLevel:function(){return M},getMinBufferTime:function(){return g},setMinBufferTime:function(e){g=e},getCriticalBufferLevel:function(){return T},setMediaSource:function(e){f=e},getMediaSource:function(){return f},isBufferingCompleted:function(){return v},reset:function(e){var t=this;T=Number.POSITIVE_INFINITY,g=A=null,_=C=E=-1,y=0,t.sourceBufferExt.unsubscribe(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,t,I),t.sourceBufferExt.unsubscribe(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,t,K),m=null,this.virtualBuffer.unsubscribe(MediaPlayer.utils.VirtualBuffer.eventList.CHUNK_APPENDED,t,ee),R=L=!1,e||(t.sourceBufferExt.abort(f,S),t.sourceBufferExt.removeSourceBuffer(f,S)),S=null}}},MediaPlayer.dependencies.BufferController.BUFFER_SIZE_REQUIRED="required",MediaPlayer.dependencies.BufferController.BUFFER_SIZE_MIN="min",MediaPlayer.dependencies.BufferController.BUFFER_SIZE_INFINITY="infinity",MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME=12,MediaPlayer.dependencies.BufferController.LOW_BUFFER_THRESHOLD=4,MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY=30,MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY_LONG_FORM=300,MediaPlayer.dependencies.BufferController.LONG_FORM_CONTENT_DURATION_THRESHOLD=600,MediaPlayer.dependencies.BufferController.RICH_BUFFER_THRESHOLD=20,MediaPlayer.dependencies.BufferController.BUFFER_LOADED="bufferLoaded",MediaPlayer.dependencies.BufferController.BUFFER_EMPTY="bufferStalled",MediaPlayer.dependencies.BufferController.BUFFER_TO_KEEP=30,MediaPlayer.dependencies.BufferController.BUFFER_PRUNING_INTERVAL=30,MediaPlayer.dependencies.BufferController.prototype={constructor:MediaPlayer.dependencies.BufferController},MediaPlayer.dependencies.BufferController.eventList={ENAME_BUFFER_LEVEL_STATE_CHANGED:"bufferLevelStateChanged",ENAME_BUFFER_LEVEL_UPDATED:"bufferLevelUpdated",ENAME_QUOTA_EXCEEDED:"quotaExceeded",ENAME_BYTES_APPENDED:"bytesAppended",ENAME_BYTES_REJECTED:"bytesRejected",ENAME_BUFFERING_COMPLETED:"bufferingCompleted",ENAME_BUFFER_CLEARED:"bufferCleared",ENAME_INIT_REQUESTED:"initRequested",ENAME_BUFFER_LEVEL_OUTRUN:"bufferLevelOutrun",ENAME_BUFFER_LEVEL_BALANCED:"bufferLevelBalanced",ENAME_MIN_BUFFER_TIME_UPDATED:"minBufferTimeUpdated"},MediaPlayer.dependencies.EventController=function(){"use strict";var i={},n={},o={},e=null,t=function(){null!==e&&(clearInterval(e),e=null)},a=function(){r.call(this,n),r.call(this,i),s.call(this)},r=function(e){var t,a=this.videoModel.getCurrentTime();if(e)for(var i=Object.keys(e),n=0;n<i.length;n++){var r=i[n],s=e[r];void 0!==s&&((0==(t=s.presentationTime/s.eventStream.timescale)||t<=a&&a<.1+t)&&(this.log("Start Event "+r+" at "+a),0<s.duration&&(o[r]=s),"urn:mpeg:dash:event:2012"==s.eventStream.schemeIdUri&&1==s.eventStream.value&&l.call(this),delete e[r]))}},s=function(){if(o)for(var e=this.videoModel.getCurrentTime(),t=Object.keys(o),a=0;a<t.length;a++){var i=t[a],n=o[i];null!==n&&(n.duration+n.presentationTime)/n.eventStream.timescale<e&&(this.log("Remove Event "+i+" at time "+e),n=null,delete o[i])}},l=function(){var e=this.manifestModel.getValue(),t=e.url;e.hasOwnProperty("Location")&&(t=e.Location),this.log("Refresh manifest @ "+t),this.manifestUpdater.getManifestLoader().load(t)};return{manifestModel:void 0,manifestUpdater:void 0,log:void 0,system:void 0,videoModel:void 0,addInlineEvents:function(e){if(i={},e)for(var t=0;t<e.length;t++){var a=e[t];i[a.id]=a,this.log("Add inline event with id "+a.id)}this.log("Added "+e.length+" inline events")},addInbandEvents:function(e){for(var t=0;t<e.length;t++){var a=e[t];a.id in n?this.log("Repeated event with id "+a.id):(n[a.id]=a,this.log("Add inband event with id "+a.id))}},reset:function(){t(),o=n=i=null},clear:t,start:function(){this.log("Start Event Controller"),isNaN(100)||(e=setInterval(a.bind(this),100))}}},MediaPlayer.dependencies.EventController.prototype={constructor:MediaPlayer.dependencies.EventController},MediaPlayer.dependencies.FragmentController=function(){"use strict";function e(e){var t=e.data.request;this.isInitializationRequest(t)?this.notify(MediaPlayer.dependencies.FragmentController.eventList.ENAME_INIT_FRAGMENT_LOADING_START,{request:t,fragmentModel:e.sender}):this.notify(MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADING_START,{request:t,fragmentModel:e.sender})}function t(e){var t=e.data.request,a=e.data.response,i=e.sender.getContext().streamProcessor.getStreamInfo().id,n=this.isInitializationRequest(t)?MediaPlayer.dependencies.FragmentController.eventList.ENAME_INIT_FRAGMENT_LOADED:MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADED;return a?(i=function(e,t,a){var i=new MediaPlayer.vo.DataChunk;return i.streamId=a,i.mediaInfo=t.mediaInfo,i.segmentType=t.type,i.start=t.startTime,i.duration=t.duration,i.end=i.start+i.duration,i.bytes=e,i.index=t.index,i.quality=t.quality,i}.call(this,a,t,i),this.notify(n,{chunk:i,fragmentModel:e.sender}),void r.call(this)):void this.log("No "+t.mediaType+" bytes to push.")}function a(e){this.notify(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,{request:e.data.request,fragmentModel:e.sender})}function i(){r.call(this)}var o=[],l=!1,r=function(e){l||(l=!0,function(e,t){var a=o[0].getContext().streamProcessor,i=a.getStreamInfo().id,n=this.scheduleRulesCollection.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_EXECUTE_RULES);-1!==n.indexOf(this.scheduleRulesCollection.sameTimeRequestRule)&&this.scheduleRulesCollection.sameTimeRequestRule.setFragmentModels(o,i),this.rulesController.applyRules(n,a,t,e,function(e,t){return t})}.call(this,e,function(e){for(var t,a,i,n,r=e.value,s=0;s<r.length;s+=1)if(a=r[s])for(n=0;n<o.length;n+=1)t=(i=o[n]).getContext().streamProcessor.getType(),a.mediaType===t&&(a instanceof MediaPlayer.vo.FragmentRequest||(a=i.getRequests({state:MediaPlayer.dependencies.FragmentModel.states.PENDING,time:a.startTime})[0]),i.executeRequest(a));l=!1}.bind(this)))};return{system:void 0,log:void 0,scheduleRulesCollection:void 0,rulesController:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this[MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_STARTED]=e,this[MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED]=t,this[MediaPlayer.dependencies.FragmentModel.eventList.ENAME_STREAM_COMPLETED]=a,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED]=i,this.scheduleRulesCollection.sameTimeRequestRule&&this.subscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,this.scheduleRulesCollection.sameTimeRequestRule)},process:function(e){var t=null;return t=null!=e&&0<e.byteLength?new Uint8Array(e):t},getModel:function(e){if(!e)return null;var t=function(e){for(var t=o.length,a=0;a<t;a++)if(o[a].getContext()==e)return o[a];return null}(e);return t||((t=this.system.getObject("fragmentModel")).setContext(e),o.push(t)),t},detachModel:function(e){e=o.indexOf(e);-1<e&&o.splice(e,1)},isInitializationRequest:function(e){return e&&e.type&&e.type===MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE},prepareFragmentForLoading:function(e,t){e&&t&&e.addRequest(t)&&r.call(this,t)},executePendingRequests:function(){r.call(this)},reset:function(){o=[],this.scheduleRulesCollection.sameTimeRequestRule&&this.unsubscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,this.scheduleRulesCollection.sameTimeRequestRule)}}},MediaPlayer.dependencies.FragmentController.prototype={constructor:MediaPlayer.dependencies.FragmentController},MediaPlayer.dependencies.FragmentController.eventList={ENAME_STREAM_COMPLETED:"streamCompleted",ENAME_INIT_FRAGMENT_LOADING_START:"initFragmentLoadingStart",ENAME_MEDIA_FRAGMENT_LOADING_START:"mediaFragmentLoadingStart",ENAME_INIT_FRAGMENT_LOADED:"initFragmentLoaded",ENAME_MEDIA_FRAGMENT_LOADED:"mediaFragmentLoaded"},MediaPlayer.dependencies.MediaController=function(){function s(t,e){var a=!t.lang||t.lang===e.lang,i=!t.viewpoint||t.viewpoint===e.viewpoint,n=!t.role||!!e.roles.filter(function(e){return e===t.role})[0],r=!t.accessibility||!!e.accessibility.filter(function(e){return e===t.accessibility})[0],e=!t.audioChannelConfiguration||!!e.audioChannelConfiguration.filter(function(e){return e===t.audioChannelConfiguration})[0];return a&&i&&n&&r&&e}function e(){n={audio:MediaPlayer.dependencies.MediaController.trackSwitchModes.ALWAYS_REPLACE,video:MediaPlayer.dependencies.MediaController.trackSwitchModes.NEVER_REPLACE}}function o(e){function t(e){var t,a=0,i=[];return e.forEach(function(e){t=Math.max.apply(Math,e.bitrateList),a<t?(a=t,i=[e]):t===a&&i.push(e)}),i}function a(e){var t,a=0,i=[];return e.forEach(function(e){t=e.representationCount,a<t?(a=t,i=[e]):t===a&&i.push(e)}),i}var i=this.getSelectionModeForInitialTrack(),n=[];switch(i){case MediaPlayer.dependencies.MediaController.trackSelectionModes.HIGHEST_BITRATE:1<(n=t(e)).length&&(n=a(n));break;case MediaPlayer.dependencies.MediaController.trackSelectionModes.WIDEST_RANGE:1<(n=a(e)).length&&(n=t(e));break;default:this.log("track selection mode is not supported: "+i)}return n[0]}var a,t,n,r={};return{log:void 0,system:void 0,errHandler:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,DOMStorage:void 0,setup:function(){(function(){a={audio:null,video:null}}).call(this),e.call(this)},checkInitialMediaSettings:function(n){var r=this;["audio","video","text","fragmentedText"].forEach(function(e){var t=r.getInitialSettings(e),a=r.getTracksFor(e,n),i=!1;t||(t=r.DOMStorage.getSavedMediaSettings(e),r.setInitialSettings(e,t)),a&&0!==a.length&&(t&&a.forEach(function(e){!i&&s.call(r,t,e)&&(r.setTrack(e),i=!0)}),i||r.setTrack(o.call(r,a)))})},addTrack:function(e){var t=e?e.type:null,a=e?e.streamInfo.id:null,i=this.getInitialSettings(t);return!(!e||!this.isMultiTrackSupportedByType(t))&&(r[a]=r[a]||function(){return{audio:{list:[],storeLastSettings:!0,current:null},video:{list:[],storeLastSettings:!0,current:null},text:{list:[],storeLastSettings:!0,current:null},fragmentedText:{list:[],storeLastSettings:!0,current:null}}}.call(this),!(0<=r[a][t].list.indexOf(e))&&(r[a][t].list.push(e),i&&s.call(this,i,e)&&!this.getCurrentTrackFor(t,e.streamInfo)&&this.setTrack(e),!0))},getTracksFor:function(e,t){if(!e||!t)return[];t=t.id;return r[t]&&r[t][e]?r[t][e].list:[]},getCurrentTrackFor:function(e,t){return e&&t?r[t.id][e].current:null},isCurrentTrack:function(e){var t=e.type,a=e.streamInfo.id;return r[a]&&r[a][t]&&this.isTracksEqual(r[a][t].current,e)},setTrack:function(e){var t,a,i;e&&(t=e.type,a=(i=e.streamInfo).id,i=this.getCurrentTrackFor(t,i),!r[a]||!r[a][t]||i&&this.isTracksEqual(e,i)||(r[a][t].current=e,i&&this.notify(MediaPlayer.dependencies.MediaController.eventList.CURRENT_TRACK_CHANGED,{oldMediaInfo:i,newMediaInfo:e,switchMode:n[t]}),(e=function(e){e={lang:e.lang,viewpoint:e.viewpoint,roles:e.roles,accessibility:e.accessibility,audioChannelConfiguration:e.audioChannelConfiguration};return e.lang||e.viewpoint||e.role&&0<e.role.length||e.accessibility&&0<e.accessibility.length||e.audioChannelConfiguration&&0<e.audioChannelConfiguration.length?e:null}.call(this,e))&&r[a][t].storeLastSettings&&(e.roles&&(e.role=e.roles[0],delete e.roles),e.accessibility&&(e.accessibility=e.accessibility[0]),e.audioChannelConfiguration&&(e.audioChannelConfiguration=e.audioChannelConfiguration[0]),function(e,t){!this.DOMStorage.isSupported(MediaPlayer.utils.DOMStorage.STORAGE_TYPE_LOCAL)||"video"!==e&&"audio"!==e||localStorage.setItem(MediaPlayer.utils.DOMStorage["LOCAL_STORAGE_"+e.toUpperCase()+"_SETTINGS_KEY"],JSON.stringify({settings:t,timestamp:(new Date).getTime()}))}.call(this,t,e))))},setInitialSettings:function(e,t){e&&t&&(a[e]=t)},getInitialSettings:function(e){return e?a[e]:null},setSwitchMode:function(e,t){return!!MediaPlayer.dependencies.MediaController.trackSwitchModes[t]?void(n[e]=t):void this.log("track switch mode is not supported: "+t)},getSwitchMode:function(e){return n[e]},setSelectionModeForInitialTrack:function(e){return!!MediaPlayer.dependencies.MediaController.trackSelectionModes[e]?void(t=e):void this.log("track selection mode is not supported: "+e)},getSelectionModeForInitialTrack:function(){return t||MediaPlayer.dependencies.MediaController.DEFAULT_INIT_TRACK_SELECTION_MODE},isMultiTrackSupportedByType:function(e){return"audio"===e||"video"===e||"text"===e||"fragmentedText"===e},isTracksEqual:function(e,t){var a=e.id===t.id,i=e.viewpoint===t.viewpoint,n=e.lang===t.lang,r=e.roles.toString()==t.roles.toString(),s=e.accessibility.toString()==t.accessibility.toString(),t=e.audioChannelConfiguration.toString()==t.audioChannelConfiguration.toString();return a&&i&&n&&r&&s&&t},reset:function(){e.call(this),r={},a={audio:null,video:null}}}},MediaPlayer.dependencies.MediaController.prototype={constructor:MediaPlayer.dependencies.MediaController},MediaPlayer.dependencies.MediaController.eventList={CURRENT_TRACK_CHANGED:"currenttrackchanged"},MediaPlayer.dependencies.MediaController.trackSwitchModes={NEVER_REPLACE:"NEVER_REPLACE",ALWAYS_REPLACE:"ALWAYS_REPLACE"},MediaPlayer.dependencies.MediaController.trackSelectionModes={HIGHEST_BITRATE:"HIGHEST_BITRATE",WIDEST_RANGE:"WIDEST_RANGE"},MediaPlayer.dependencies.MediaController.DEFAULT_INIT_TRACK_SELECTION_MODE=MediaPlayer.dependencies.MediaController.trackSelectionModes.HIGHEST_BITRATE,MediaPlayer.dependencies.PlaybackController=function(){"use strict";function l(e){var t=parseInt(this.uriQueryFragModel.getURIFragmentData().s),a=h?(!isNaN(t)&&1262304e3<t&&(a=t-e.manifestInfo.availableFrom.getTime()/1e3,(g<a||a<g-e.manifestInfo.DVRWindowSize)&&(a=null)),a||g):!isNaN(t)&&t<e.duration&&0<=t?t:e.start;return a}function e(){var e;null===m&&(e=this,m=setInterval(function(){I.call(e)},1e3))}function t(){clearInterval(m),m=null}function a(){var e;E[u.id]||this.isSeeking()||(e=l.call(this,u),this.log("Starting playback at offset: "+e),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,{seekTime:e}))}function i(){var e,t;!this.isPaused()&&h&&0!==c.getElement().readyState&&(e=this.getTime(),t=function(e){var t=this.metricsModel.getReadOnlyMetricsFor("video")||this.metricsModel.getReadOnlyMetricsFor("audio"),t=this.metricsExt.getCurrentDVRInfo(t),t=t?t.range:null;return t?e>=t.start&&e<=t.end?e:Math.max(t.end-2*u.manifestInfo.minBufferTime,t.start):NaN}.call(this,e),isNaN(t)||t===e||this.seek(t))}function n(e){var t;e.error||(e=(t=this.adapter.convertDataToTrack(this.manifestModel.getValue(),e.data.currentRepresentation)).mediaInfo.streamInfo,u.id===e.id&&(u=t.mediaInfo.streamInfo,i.call(this)))}function r(e){e.error||0===c.getElement().readyState||a.call(this)}function s(){c&&(c.unlisten("canplay",M),c.unlisten("play",P),c.unlisten("playing",T),c.unlisten("pause",_),c.unlisten("error",D),c.unlisten("seeking",C),c.unlisten("seeked",S),c.unlisten("timeupdate",A),c.unlisten("progress",b),c.unlisten("ratechange",L),c.unlisten("loadedmetadata",R),c.unlisten("ended",N))}function o(e){var t=e.data.bufferedRanges,a=u.id,i=this.getTime(),n=(o=e.sender.streamProcessor).getType(),r=this.system.getObject("streamController").getStreamById(u.id),s=l.call(this,u),s=(o=this.adapter.getFragmentRequestForTime(o,o.getCurrentRepresentationInfo(),s,{ignoreIsFinished:!0}))?o.index:null,o=y[a];e.data.index===s&&(E[a]=E[a]||{},E[a][n]=!0,E[a].ready=!(r.hasMedia("audio")&&!E[a].audio||r.hasMedia("video")&&!E[a].video)),!t||!t.length||E[a]&&E[a].seekCompleted||(t=Math.max(t.start(0),u.start),y[a]=void 0===y[a]?t:Math.max(y[a],t),o===y[a]&&i===o||!E[a]||!E[a].ready||i>y[a]||(this.isSeeking()?y={}:(this.seek(y[a]),E[a].seekCompleted=!0)))}function d(e){var t=e.sender.streamProcessor.getType();e.sender.streamProcessor.getStreamInfo().id===u.id&&c.setStallState(t,!e.data.hasSufficientBuffer)}var u,c,h,f,p=0,g=NaN,m=null,y={},E={},v=NaN,M=function(){this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_CAN_PLAY)},P=function(){this.log("<video> play"),i.call(this),e.call(this),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_STARTED,{startTime:this.getTime()})},T=function(){this.log("<video> playing"),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PLAYING,{playingTime:this.getTime()})},_=function(){this.log("<video> pause"),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PAUSED)},C=function(){this.log("<video> seek"),e.call(this),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,{seekTime:this.getTime()})},S=function(){this.log("<video> seeked"),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKED)},A=function(){var e=this.getTime();e!==p&&(p=e,this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_TIME_UPDATED,{timeToEnd:this.getTimeToStreamEnd()}))},b=function(){var e,t=c.getElement().buffered;t.length&&(e=t.length-1,e=t.end(e),e=l.call(this,u)+u.duration-e),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PROGRESS,{bufferedRanges:c.getElement().buffered,remainingUnbufferedDuration:e})},L=function(){this.log("<video> ratechange: ",this.getPlaybackRate()),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_RATE_CHANGED)},R=function(){this.log("<video> loadedmetadata"),h&&!this.timelineConverter.isTimeSyncCompleted()||a.call(this),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_METADATA_LOADED),e.call(this)},N=function(){this.log("<video> ended"),t.call(this),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ENDED)},D=function(e){e=e.target||e.srcElement;this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ERROR,{error:e.error})},I=function(){this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,{isDynamic:h,time:new Date})};return{system:void 0,log:void 0,timelineConverter:void 0,uriQueryFragModel:void 0,metricsModel:void 0,metricsExt:void 0,manifestModel:void 0,manifestExt:void 0,videoModel:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,adapter:void 0,setup:function(){this[Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED]=n,this[MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED]=r,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_APPENDED]=o,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED]=d,M=M.bind(this),P=P.bind(this),T=T.bind(this),_=_.bind(this),D=D.bind(this),C=C.bind(this),S=S.bind(this),A=A.bind(this),b=b.bind(this),L=L.bind(this),R=R.bind(this),N=N.bind(this)},initialize:function(e){c=this.videoModel,u=e,y={},s.call(this),function(){c.listen("canplay",M),c.listen("play",P),c.listen("playing",T),c.listen("pause",_),c.listen("error",D),c.listen("seeking",C),c.listen("seeked",S),c.listen("timeupdate",A),c.listen("progress",b),c.listen("ratechange",L),c.listen("loadedmetadata",R),c.listen("ended",N)}.call(this),h=u.manifestInfo.isDynamic,g=e.start},getStreamStartTime:l,getTimeToStreamEnd:function(){var e=c.getCurrentTime();return l.call(this,u)+u.duration-e},getStreamId:function(){return u.id},getStreamDuration:function(){return u.duration},getTime:function(){return c.getCurrentTime()},getPlaybackRate:function(){return c.getPlaybackRate()},getPlayedRanges:function(){return c.getElement().played},getIsDynamic:function(){return h},setLiveStartTime:function(e){g=e},getLiveStartTime:function(){return g},setLiveDelayAttributes:function(e,t){v=e,f=t},getLiveDelay:function(e){var t=this.manifestExt.getMpd(this.manifestModel.getValue());return f&&t.hasOwnProperty("suggestedPresentationDelay")?t.suggestedPresentationDelay:isNaN(e)?2*u.manifestInfo.minBufferTime:e*v},start:function(){c.play()},isPaused:function(){return c.isPaused()},pause:function(){c&&c.pause()},isSeeking:function(){return c.getElement().seeking},seek:function(e){c&&e!==this.getTime()&&(this.log("Do seek: "+e),c.setCurrentTime(e))},reset:function(){t.call(this),s.call(this),u=c=null,y={},E={},f=h=void(p=0),v=g=NaN}}},MediaPlayer.dependencies.PlaybackController.prototype={constructor:MediaPlayer.dependencies.PlaybackController},MediaPlayer.dependencies.PlaybackController.eventList={ENAME_CAN_PLAY:"canPlay",ENAME_PLAYBACK_STARTED:"playbackStarted",ENAME_PLAYBACK_PLAYING:"playbackPlaying",ENAME_PLAYBACK_STOPPED:"playbackStopped",ENAME_PLAYBACK_PAUSED:"playbackPaused",ENAME_PLAYBACK_ENDED:"playbackEnded",ENAME_PLAYBACK_SEEKING:"playbackSeeking",ENAME_PLAYBACK_SEEKED:"playbackSeeked",ENAME_PLAYBACK_TIME_UPDATED:"playbackTimeUpdated",ENAME_PLAYBACK_PROGRESS:"playbackProgress",ENAME_PLAYBACK_RATE_CHANGED:"playbackRateChanged",ENAME_PLAYBACK_METADATA_LOADED:"playbackMetaDataLoaded",ENAME_PLAYBACK_ERROR:"playbackError",ENAME_WALLCLOCK_TIME_UPDATED:"wallclockTimeUpdated"},MediaPlayer.dependencies.ProtectionController=function(){"use strict";function r(t,a){var i=this,e=[],n=[];f&&n.push(new MediaPlayer.vo.protection.MediaCapability(f.codec)),h&&e.push(new MediaPlayer.vo.protection.MediaCapability(h.codec));var r,s=new MediaPlayer.vo.protection.KeySystemConfiguration(e,n,"optional","temporary"===i.sessionType?"optional":"required",[i.sessionType]),o=[];if(this.keySystem){for(r=0;r<t.length;r++)if(this.keySystem===t[r].ks){o.push({ks:t[r].ks,configs:[s]});var l={};l[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE]=function(e){e.error?a||i.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,error:"DRM: KeySystem Access Denied! -- "+e.error}):(i.log("KeySystem Access Granted"),i.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,data:e.data}),i.createKeySession(t[r].initData))},this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,l,void 0,!0),this.protectionModel.requestKeySystemAccess(o);break}}else if(void 0===this.keySystem){this.keySystem=null,g.push(t);for(var d=0;d<t.length;d++)o.push({ks:t[d].ks,configs:[s]});var u,c={};c[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE]=function(e){e.error?(i.keySystem=void 0,i.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED,c),a||i.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,error:"DRM: KeySystem Access Denied! -- "+e.error})):(u=e.data,i.log("KeySystem Access Granted ("+u.keySystem.systemString+")!  Selecting key system..."),i.protectionModel.selectKeySystem(u))},c[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED]=function(e){if(e.error)i.keySystem=void 0,a||i.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,error:"DRM: Error selecting key system! -- "+e.error});else{i.keySystem=i.protectionModel.keySystem,i.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,data:u});for(var t=0;t<g.length;t++)for(r=0;r<g[t].length;r++)if(i.keySystem===g[t][r].ks){i.createKeySession(g[t][r].initData);break}}},this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED,c,void 0,!0),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,c,void 0,!0),this.protectionModel.requestKeySystemAccess(o)}else g.push(t)}function e(e){if(e.error)this.log(e.error);else{var t=e.data;this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_MESSAGE,data:t});var a=t.messageType||"license-request",i=t.message,n=t.sessionToken,r=(r=this.keySystem,t=null,r=r.systemString,t=p?r in p?p[r]:null:t),s=this.keySystem.systemString,o=this.protectionExt.getLicenseServer(this.keySystem,r,a),l=function(e,t){this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.LICENSE_REQUEST_COMPLETE,data:e,error:t})}.bind(this),d={sessionToken:n,messageType:a};if(!o)return this.log("DRM: License server request not required for this message (type = "+e.data.messageType+").  Session ID = "+n.getSessionID()),void l(d);if(this.protectionExt.isClearKey(this.keySystem)){var u=this.protectionExt.processClearKeyLicenseRequest(r,i);if(u)return this.log("DRM: ClearKey license request handled by application!"),l(d),void this.protectionModel.updateKeySession(n,u)}var c=new XMLHttpRequest,h=this,t=null;r?r.serverURL?"string"==typeof(u=r.serverURL)&&""!==u?t=u:"object"==typeof u&&u.hasOwnProperty(a)&&(t=u[a]):r.laURL&&""!==r.laURL&&(t=r.laURL):t=(t=this.keySystem.getLicenseServerURLFromInitData(MediaPlayer.dependencies.protection.CommonEncryption.getPSSHData(n.initData)))||e.data.laURL,(t=o.getServerURLFromMessage(t,i,a))?(c.open(o.getHTTPMethod(a),t,!0),c.responseType=o.getResponseType(s,a),c.onload=function(){200==this.status?(l(d),h.protectionModel.updateKeySession(n,o.getLicenseMessage(this.response,s,a))):l(d,"DRM: "+s+' update, XHR status is "'+this.statusText+'" ('+this.status+"), expected to be 200. readyState is "+this.readyState+".  Response is "+(this.response?o.getErrorResponse(this.response,s,a):"NONE"))},c.onabort=function(){l(d,"DRM: "+s+' update, XHR aborted. status is "'+this.statusText+'" ('+this.status+"), readyState is "+this.readyState)},c.onerror=function(){l(d,"DRM: "+s+' update, XHR error. status is "'+this.statusText+'" ('+this.status+"), readyState is "+this.readyState)},t=function(e){if(e)for(var t in e)"authorization"===t.toLowerCase()&&(c.withCredentials=!0),c.setRequestHeader(t,e[t])},r&&t(r.httpRequestHeaders),t(this.keySystem.getRequestHeadersFromMessage(i)),r&&r.withCredentials&&(c.withCredentials=!0),c.send(this.keySystem.getLicenseRequestFromMessage(i))):l(d,"DRM: No license server URL specified!")}}var h,f,p,g=[],s=!1;return{system:void 0,log:void 0,protectionExt:void 0,keySystem:void 0,sessionType:"temporary",setup:function(){this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE]=e.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY]=function(e){if("cenc"===e.data.initDataType){var t=e.data.initData;ArrayBuffer.isView(t)&&(t=t.buffer);t=this.protectionExt.getSupportedKeySystems(t);return 0===t.length?void this.log("Received needkey event with initData, but we don't support any of the key systems!"):void r.call(this,t,!1)}this.log("DRM:  Only 'cenc' initData is supported!  Ignoring initData of type: "+e.data.initDataType)}.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED]=function(e){e.error?this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.SERVER_CERTIFICATE_UPDATED,data:null,error:"DRM: Failed to update license server certificate. -- "+e.error}):(this.log("DRM: License server certificate successfully updated."),this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.SERVER_CERTIFICATE_UPDATED,data:null,error:null}))}.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ADDED]=function(){this.log("DRM: Key added."),this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_ADDED,data:null,error:null})}.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR]=function(e){this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_ADDED,data:null,error:"DRM: MediaKeyError - sessionId: "+e.data.sessionToken.getSessionID()+".  "+e.data.error})}.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED]=function(e){e.error?this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CREATED,data:null,error:"DRM: Failed to create key session. -- "+e.error}):(this.log("DRM: Session created.  SessionID = "+e.data.getSessionID()),this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CREATED,data:e.data,error:null}))}.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED]=function(e){e.error?this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CLOSED,data:null,error:"DRM Failed to close key session. -- "+e.error}):(this.log("DRM: Session closed.  SessionID = "+e.data),this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CLOSED,data:e.data,error:null}))}.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED]=function(e){e.error?this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_REMOVED,data:null,error:"DRM Failed to remove key session. -- "+e.error}):(this.log("DRM: Session removed.  SessionID = "+e.data),this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_REMOVED,data:e.data,error:null}))}.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_STATUSES_CHANGED]=function(e){this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_STATUSES_CHANGED,data:e.data,error:null})}.bind(this),this.protectionExt.getKeySystems(),this.protectionModel=this.system.getObject("protectionModel"),this.protectionModel.init(),this.eventBus=this.system.getObject("eventBusCl"),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ADDED,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_STATUSES_CHANGED,this)},init:function(e,t,a){var i,n;s||(t||a||(n=(i=this.system.getObject("adapter")).getStreamsInfo(e)[0]),h=t||(n?i.getMediaInfoForType(e,n,"audio"):null),f=a||(n?i.getMediaInfoForType(e,n,"video"):null),(n=this.protectionExt.getSupportedKeySystemsFromContentProtection((f||h).contentProtection))&&0<n.length&&r.call(this,n,!0),s=!0)},addEventListener:function(e,t){this.eventBus.addEventListener(e,t)},removeEventListener:function(e,t){this.eventBus.removeEventListener(e,t)},teardown:function(){this.setMediaElement(null),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ADDED,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_STATUSES_CHANGED,this),this.keySystem=void 0,this.protectionModel.teardown(),this.protectionModel=void 0},createKeySession:function(e){var t=MediaPlayer.dependencies.protection.CommonEncryption.getPSSHForKeySystem(this.keySystem,e);if(t){for(var a=this.protectionModel.getAllInitData(),i=0;i<a.length;i++)if(this.protectionExt.initDataEquals(t,a[i]))return void this.log("Ignoring initData because we have already seen it!");try{this.protectionModel.createKeySession(t,this.sessionType)}catch(e){this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CREATED,data:null,error:"Error creating key session! "+e.message})}}else this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CREATED,data:null,error:"Selected key system is "+this.keySystem.systemString+".  needkey/encrypted event contains no initData corresponding to that key system!"})},loadKeySession:function(e){this.protectionModel.loadKeySession(e)},removeKeySession:function(e){this.protectionModel.removeKeySession(e)},closeKeySession:function(e){this.protectionModel.closeKeySession(e)},setServerCertificate:function(e){this.protectionModel.setServerCertificate(e)},setMediaElement:function(e){e?(this.protectionModel.setMediaElement(e),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY,this)):null===e&&(this.protectionModel.setMediaElement(e),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY,this))},setSessionType:function(e){this.sessionType=e},setProtectionData:function(e){p=e}}},MediaPlayer.dependencies.ProtectionController.events={KEY_SYSTEM_SELECTED:"keySystemSelected",SERVER_CERTIFICATE_UPDATED:"serverCertificateUpdated",KEY_ADDED:"keyAdded",KEY_SESSION_CREATED:"keySessionCreated",KEY_SESSION_REMOVED:"keySessionRemoved",KEY_SESSION_CLOSED:"keySessionClosed",KEY_STATUSES_CHANGED:"keyStatusesChanged",KEY_MESSAGE:"keyMessage",LICENSE_REQUEST_COMPLETE:"licenseRequestComplete"},MediaPlayer.dependencies.ProtectionController.prototype={constructor:MediaPlayer.dependencies.ProtectionController},MediaPlayer.dependencies.ScheduleController=function(){"use strict";function i(e,t){var a=null;!1===w&&(a=x.start,a=e.getTime()-a.getTime(),x.duration=a,x.stopreason=t,w=!0)}function t(){S&&(I=!1,N=N&&!1,this.log("start"),F.call(this))}function a(e){I||(I=!0,this.log("stop"),e&&A.cancelPendingRequests(),i(new Date,MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON))}function n(e){for(var t,a,i=e.length,n=0;n<i;n+=1)a=(t=e[n]).startTime+t.duration/2+.1,t=this.adapter.getFragmentRequestForTime(this.streamProcessor,L,a,{timeThreshold:0,ignoreIsFinished:!0}),this.fragmentController.prepareFragmentForLoading(A,t)}function r(e){return(R=e.value)<=0?void this.fragmentController.executePendingRequests():void function(e){var t=this.scheduleRulesCollection.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.NEXT_FRAGMENT_RULES);this.rulesController.applyRules(t,this.streamProcessor,e,null,function(e,t){return t})}.call(this,k.bind(this))}function e(e){e.error||(L=this.adapter.convertDataToTrack(this.manifestModel.getValue(),e.data.currentRepresentation))}function s(e){e.error||(L=this.streamProcessor.getCurrentRepresentationInfo(),(S=!b||null!==this.liveEdgeFinder.getLiveEdge()?!0:S)&&function(){N&&(B.call(this,L.quality),U.call(this,MediaPlayer.vo.metrics.PlayList.INITIAL_PLAY_START_REASON)),t.call(this)}.call(this))}function o(e){e.data.fragmentModel===this.streamProcessor.getFragmentModel()&&(this.log("Stream is complete"),i(new Date,MediaPlayer.vo.metrics.PlayList.Trace.END_OF_CONTENT_STOP_REASON))}function l(e){e.data.fragmentModel===this.streamProcessor.getFragmentModel()&&F.call(this)}function d(e){e.error&&a.call(this)}function u(){H.call(this)}function c(){a.call(this,!1)}function h(e){B.call(this,e.data.requiredQuality)}function f(e){A.removeExecutedRequestsBeforeTime(e.data.to),e.data.hasEnoughSpaceToAppend&&t.call(this)}function p(e){e.data.hasSufficientBuffer||this.playbackController.isSeeking()||(this.log("Stalling Buffer"),i(new Date,MediaPlayer.vo.metrics.PlayList.Trace.REBUFFERING_REASON))}function g(){F.call(this)}function m(){a.call(this,!1)}function y(e){if(C===e.data.mediaType&&this.streamProcessor.getStreamInfo().id===e.data.streamInfo.id){var t=A.cancelPendingRequests(e.data.oldQuality);if(null==(L=this.streamProcessor.getRepresentationInfoForQuality(e.data.newQuality)))throw"Unexpected error!";n.call(this,t),i(new Date,MediaPlayer.vo.metrics.PlayList.Trace.REPRESENTATION_SWITCH_STOP_REASON)}}function E(e){e=B.call(this,e.data.CCIndex),A.executeRequest(e)}function v(){t.call(this)}function M(e){N||A.cancelPendingRequests();var t=this.metricsModel.getMetricsFor("stream"),t=this.metricsExt.getCurrentManifestUpdate(t);this.log("seek: "+e.data.seekTime),U.call(this,MediaPlayer.vo.metrics.PlayList.SEEK_START_REASON),this.metricsModel.updateManifestUpdateInfo(t,{latency:L.DVRWindow.end-this.playbackController.getTime()})}function P(){H.call(this)}function T(){F.call(this)}function _(e){var t,a,i,n;e.error||(t=this,a=e.data.liveEdge,i=L.mediaInfo.streamInfo.manifestInfo,n=a-Math.min(t.playbackController.getLiveDelay(L.fragmentDuration),i.DVRWindowSize/2),e=t.metricsModel.getMetricsFor("stream"),i=t.metricsExt.getCurrentManifestUpdate(e),e=t.playbackController.getLiveStartTime(),n=t.adapter.getFragmentRequestForTime(t.streamProcessor,L,n,{ignoreIsFinished:!0}).startTime,(isNaN(e)||e<n)&&t.playbackController.setLiveStartTime(n),t.metricsModel.updateManifestUpdateInfo(i,{currentTime:n,presentationStartTime:a,latency:a-n,clientTimeOffset:t.timelineConverter.getClientTimeOffset()}),S=!0)}var C,S,A,b,L,R=0,N=!0,D=null,I=!1,O=null,x=null,w=!0,B=function(e){e=this.adapter.getInitRequest(this.streamProcessor,e);return null!==e&&this.fragmentController.prepareFragmentForLoading(A,e),e},k=function(e){e=e.value;(e=!(null===e||e instanceof MediaPlayer.vo.FragmentRequest)?this.adapter.getFragmentRequestForTime(this.streamProcessor,L,e.startTime):e)?(R--,this.fragmentController.prepareFragmentForLoading(A,e)):this.fragmentController.executePendingRequests()},F=function(){var e=(new Date).getTime(),t=!D||e-D>A.getLoadingTime();this.abrController.getPlaybackQuality(this.streamProcessor),!t||I||this.playbackController.isPaused()&&0<this.playbackController.getPlayedRanges().length&&(!this.scheduleWhilePaused||b)||(D=e,function(e){var t=this.scheduleRulesCollection.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_SCHEDULE_RULES);this.rulesController.applyRules(t,this.streamProcessor,e,R,function(e,t){return e=e===MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE?0:e,Math.max(e,t)})}.call(this,r.bind(this)))},U=function(e){var t=new Date,a=this.playbackController.getTime();i(t,MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON),O=this.metricsModel.addPlayList(C,t,a,e)},H=function(){var e=this.playbackController.getTime(),t=this.playbackController.getPlaybackRate(),a=new Date;!0===w&&L&&O&&(w=!1,x=this.metricsModel.appendPlayListTrace(O,L.id,null,a,e,null,t,null))};return{log:void 0,system:void 0,metricsModel:void 0,manifestModel:void 0,metricsExt:void 0,scheduleWhilePaused:void 0,timelineConverter:void 0,abrController:void 0,playbackController:void 0,adapter:void 0,scheduleRulesCollection:void 0,rulesController:void 0,numOfParallelRequestAllowed:void 0,setup:function(){this[MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED]=_,this[MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED]=y,this[Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_STARTED]=c,this[Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED]=e,this[MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED]=s,this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADING_START]=l,this[MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED]=d,this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED]=o,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_CLEARED]=f,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_APPENDED]=u,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED]=p,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED]=g,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_INIT_REQUESTED]=h,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_QUOTA_EXCEEDED]=m,this[MediaPlayer.dependencies.TextController.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED]=E,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_STARTED]=v,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING]=M,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_RATE_CHANGED]=P,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED]=T},initialize:function(e,t){var a=this;C=e,a.setMediaType(C),a.streamProcessor=t,a.fragmentController=t.fragmentController,a.liveEdgeFinder=t.liveEdgeFinder,a.bufferController=t.bufferController,b=t.isDynamic(),A=this.fragmentController.getModel(this),MediaPlayer.dependencies.ScheduleController.LOADING_REQUEST_THRESHOLD=a.numOfParallelRequestAllowed,a.scheduleRulesCollection.bufferLevelRule&&a.scheduleRulesCollection.bufferLevelRule.setScheduleController(a),a.scheduleRulesCollection.pendingRequestsRule&&a.scheduleRulesCollection.pendingRequestsRule.setScheduleController(a),a.scheduleRulesCollection.playbackTimeRule&&a.scheduleRulesCollection.playbackTimeRule.setScheduleController(a)},getFragmentModel:function(){return A},getFragmentToLoadCount:function(){return R},replaceCanceledRequests:n,reset:function(){var e=this;a.call(e,!0),e.bufferController.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN,e.scheduleRulesCollection.bufferLevelRule),e.bufferController.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED,e.scheduleRulesCollection.bufferLevelRule),A.abortRequests(),e.fragmentController.detachModel(A),R=0},start:t,stop:a}},MediaPlayer.dependencies.ScheduleController.prototype={constructor:MediaPlayer.dependencies.ScheduleController},MediaPlayer.dependencies.ScheduleController.LOADING_REQUEST_THRESHOLD=0,MediaPlayer.dependencies.StreamController=function(){"use strict";function h(e){this.system.getObject("mediaController").subscribe(MediaPlayer.dependencies.MediaController.eventList.CURRENT_TRACK_CHANGED,e),e.subscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED,this.liveEdgeFinder),e.subscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_BUFFERING_COMPLETED,this)}function o(e){e.unsubscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED,this.liveEdgeFinder),e.unsubscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_BUFFERING_COMPLETED,this)}function f(e,t,a){this.eventBus.dispatchEvent({type:e,data:{fromStreamInfo:t?t.getStreamInfo():null,toStreamInfo:a.getStreamInfo()}})}function a(){p.isActivated()&&T&&0===p.getStreamInfo().index&&(p.startEventController(),P&&this.playbackController.start())}function e(){T=!0,a.call(this)}function t(e){var t=e.data.error?e.data.error.code:0,a="";if(-1!==t){switch(t){case 1:a="MEDIA_ERR_ABORTED";break;case 2:a="MEDIA_ERR_NETWORK";break;case 3:a="MEDIA_ERR_DECODE";break;case 4:a="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:a="MEDIA_ERR_ENCRYPTED";break;default:a="UNKNOWN"}S=!0,this.log("Video Element Error: "+a),e.error&&this.log(e.error),this.errHandler.mediaSourceError(a),this.reset()}}function i(e){var t=this.videoExt.getPlaybackQuality(this.videoModel.getElement());t&&this.metricsModel.addDroppedFrames("video",t),this.playbackController.isSeeking()||e.data.timeToEnd<.2&&this.mediaSourceExt.signalEndOfStream(y)}function n(){L.call(this,p,A())}function r(e){var t=b(e.data.seekTime);t&&t!==p&&L.call(this,p,t,e.data.seekTime)}function s(e){var t=A(),e=e.data.streamInfo.isLast;y&&e&&this.mediaSourceExt.signalEndOfStream(y),t&&t.activate(y)}function l(){D.call(this)}function d(){!function(){var e,t,a,i,n,r,s,o=this,l=o.manifestModel.getValue(),d=o.metricsModel.getMetricsFor("stream"),u=o.metricsExt.getCurrentManifestUpdate(d),c=[];if(l){r=o.adapter.getStreamsInfo(l),this.capabilities.supportsEncryptedMedia()&&(g||(g=this.system.getObject("protectionController"),this.eventBus.dispatchEvent({type:MediaPlayer.events.PROTECTION_CREATED,data:{controller:g,manifest:l}}),M=!0),g.setMediaElement(this.videoModel.getElement()),m&&g.setProtectionData(m));try{if(0===r.length)throw new Error("There are no streams");for(o.metricsModel.updateManifestUpdateInfo(u,{currentTime:o.videoModel.getCurrentTime(),buffered:o.videoModel.getElement().buffered,presentationStartTime:r[0].start,clientTimeOffset:o.timelineConverter.getClientTimeOffset()}),C=!0,i=0,t=r.length;i<t;i+=1){for(e=r[i],n=0,a=v.length;n<a;n+=1)v[n].getId()===e.id&&(s=v[n],c.push(s),s.updateData(e));s||((s=o.system.getObject("stream")).initialize(e,g,m),s.subscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED,o),c.push(s),p&&s.updateData(e)),o.metricsModel.addManifestUpdateStreamInfo(u,e.id,e.index,e.start,e.duration),s=null}v=c,p||(p=v[0],f.call(o,MediaPlayer.events.STREAM_SWITCH_STARTED,null,p),o.playbackController.initialize(p.getStreamInfo()),h.call(o,p),f.call(o,MediaPlayer.events.STREAM_SWITCH_COMPLETED,null,p)),y||R.call(this),C=!1,D.call(o)}catch(e){o.errHandler.manifestError(e.message,"nostreamscomposed",l),o.reset()}}}.call(this)}function u(e){var t,a;e.error?this.reset():(this.log("Manifest has loaded."),a=e.data.manifest,t=this.adapter.getStreamsInfo(a)[0],t=this.adapter.getMediaInfoForType(a,t,"video")||this.adapter.getMediaInfoForType(a,t,"audio"),t=this.adapter.getDataForMedia(t),(t=this.manifestExt.getRepresentationsForAdaptation(a,t)[0].useCalculatedLiveEdgeTime)&&(this.log("SegmentTimeline detected using calculated Live Edge Time"),E=!1),e=this.manifestExt.getUTCTimingSources(e.data.manifest),a=!this.manifestExt.getIsDynamic(a)||t?e:e.concat(c),this.timeSyncController.initialize(t?e:a,E))}var p,g,m,y,c,E,v=[],M=!1,P=!0,T=!1,_=!1,C=!1,S=!1,A=function(){var t=p.getStreamInfo().start,a=p.getStreamInfo().duration;return v.filter(function(e){return e.getStreamInfo().start===t+a})[0]},b=function(e){var t=0,a=null,i=v.length;0<i&&(t+=v[0].getStartTime());for(var n=0;n<i;n++)if(e<(t+=(a=v[n]).getDuration()))return a;return null},L=function(e,t,a){var i,n;!_&&e&&t&&e!==t&&(f.call(this,MediaPlayer.events.STREAM_SWITCH_STARTED,e,t),_=!0,i=this,n=function(){void 0!==a&&i.playbackController.seek(a),i.playbackController.start(),p.startEventController(),_=!1,f.call(i,MediaPlayer.events.STREAM_SWITCH_COMPLETED,e,t)},setTimeout(function(){o.call(i,e),e.deactivate(),h.call(i,p=t),i.playbackController.initialize(p.getStreamInfo()),R.call(i,n)},0))},R=function(t){var a,i=this,n=function(e){i.log("MediaSource is open!"),i.log(e),window.URL.revokeObjectURL(a),y.removeEventListener("sourceopen",n),y.removeEventListener("webkitsourceopen",n),N.call(i),p.activate(y),t&&t()};y?i.mediaSourceExt.detachMediaSource(i.videoModel):y=i.mediaSourceExt.createMediaSource(),y.addEventListener("sourceopen",n,!1),y.addEventListener("webkitsourceopen",n,!1),a=i.mediaSourceExt.attachMediaSource(y,i.videoModel)},N=function(){var e=p.getStreamInfo().manifestInfo.duration,e=this.mediaSourceExt.setDuration(y,e);this.log("Duration successfully set to: "+e)},D=function(){if(!C){var e=v.length,t=0;for(a.call(this);t<e;t+=1)if(!v[t].isInitialized())return;this.notify(MediaPlayer.dependencies.StreamController.eventList.ENAME_STREAMS_COMPOSED)}};return{system:void 0,capabilities:void 0,videoModel:void 0,manifestUpdater:void 0,manifestLoader:void 0,manifestModel:void 0,manifestExt:void 0,adapter:void 0,playbackController:void 0,log:void 0,metricsModel:void 0,metricsExt:void 0,videoExt:void 0,liveEdgeFinder:void 0,mediaSourceExt:void 0,timelineConverter:void 0,protectionExt:void 0,timeSyncController:void 0,virtualBuffer:void 0,errHandler:void 0,eventBus:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this[MediaPlayer.dependencies.ManifestUpdater.eventList.ENAME_MANIFEST_UPDATED]=u,this[MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED]=l,this[MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_BUFFERING_COMPLETED]=s,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING]=r,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_TIME_UPDATED]=i,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ENDED]=n,this[MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED]=d,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_CAN_PLAY]=e,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ERROR]=t},getAutoPlay:function(){return P},getActiveStreamInfo:function(){return p?p.getStreamInfo():null},isStreamActive:function(e){return p.getId()===e.id},setUTCTimingSources:function(e,t){c=e,E=t},getStreamById:function(t){return v.filter(function(e){return e.getId()===t})[0]},initialize:function(e,t,a){P=e,g=t,m=a,this.timeSyncController.subscribe(MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED,this.timelineConverter),this.timeSyncController.subscribe(MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED,this.liveEdgeFinder),this.timeSyncController.subscribe(MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED,this),this.playbackController.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_STARTED,this.manifestUpdater),this.playbackController.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PAUSED,this.manifestUpdater),this.playbackController.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ENDED,this),this.subscribe(MediaPlayer.dependencies.StreamController.eventList.ENAME_STREAMS_COMPOSED,this.manifestUpdater),this.manifestUpdater.subscribe(MediaPlayer.dependencies.ManifestUpdater.eventList.ENAME_MANIFEST_UPDATED,this),this.manifestUpdater.initialize(this.manifestLoader)},load:function(e){this.manifestLoader.load(e)},loadWithManifest:function(e){this.manifestUpdater.setManifest(e)},reset:function(){p&&o.call(this,p);var e,t=this.system.getObject("mediaController");this.timeSyncController.unsubscribe(MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED,this.timelineConverter),this.timeSyncController.unsubscribe(MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED,this.liveEdgeFinder),this.timeSyncController.unsubscribe(MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED,this),this.timeSyncController.reset();for(var a=0,i=v.length;a<i;a++)(e=v[a]).unsubscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED,this),t.unsubscribe(MediaPlayer.dependencies.MediaController.eventList.CURRENT_TRACK_CHANGED,e),e.reset(S);v=[],this.unsubscribe(MediaPlayer.dependencies.StreamController.eventList.ENAME_STREAMS_COMPOSED,this.manifestUpdater),this.playbackController.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_STARTED,this.manifestUpdater),this.playbackController.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PAUSED,this.manifestUpdater),this.playbackController.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ENDED,this),this.manifestUpdater.unsubscribe(MediaPlayer.dependencies.ManifestUpdater.eventList.ENAME_MANIFEST_UPDATED,this),this.manifestUpdater.reset(),this.metricsModel.clearAllCurrentMetrics();var n,r,s=this.manifestModel.getValue()?this.manifestModel.getValue().url:null;this.manifestModel.setValue(null),this.timelineConverter.reset(),this.liveEdgeFinder.reset(),this.adapter.reset(),this.virtualBuffer.reset(),p=null,S=T=C=_=!1,y&&(this.mediaSourceExt.detachMediaSource(this.videoModel),y=null),g?M?(r=this,(n={})[MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE]=function(){M=!1,m=g=null,s&&r.eventBus.dispatchEvent({type:MediaPlayer.events.PROTECTION_DESTROYED,data:s}),r.notify(MediaPlayer.dependencies.StreamController.eventList.ENAME_TEARDOWN_COMPLETE)},g.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE,n,void 0,!0),g.teardown()):(g.setMediaElement(null),m=g=null,this.notify(MediaPlayer.dependencies.StreamController.eventList.ENAME_TEARDOWN_COMPLETE)):this.notify(MediaPlayer.dependencies.StreamController.eventList.ENAME_TEARDOWN_COMPLETE)}}},MediaPlayer.dependencies.StreamController.prototype={constructor:MediaPlayer.dependencies.StreamController},MediaPlayer.dependencies.StreamController.eventList={ENAME_STREAMS_COMPOSED:"streamsComposed",ENAME_TEARDOWN_COMPLETE:"streamTeardownComplete"},MediaPlayer.dependencies.TextController=function(){function e(){this.notify(MediaPlayer.dependencies.TextController.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED,{CCIndex:0})}function t(e){e.data.fragmentModel===this.streamProcessor.getFragmentModel()&&e.data.chunk.bytes&&this.sourceBufferExt.append(n,e.data.chunk)}var a=!1,i=null,n=null,r=null;return{sourceBufferExt:void 0,log:void 0,system:void 0,errHandler:void 0,videoModel:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this[Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED]=e,this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_INIT_FRAGMENT_LOADED]=t},initialize:function(e,t,a){r=e,this.setMediaSource(t),this.representationController=a.representationController,this.streamProcessor=a},createBuffer:function(e){try{n=this.sourceBufferExt.createSourceBuffer(i,e),a||(n.hasOwnProperty("initialize")&&n.initialize(r,this),a=!0)}catch(e){this.errHandler.mediaSourceError("Error creating "+r+" source buffer.")}return n},getBuffer:function(){return n},setBuffer:function(e){n=e},setMediaSource:function(e){i=e},reset:function(e){e||(this.sourceBufferExt.abort(i,n),this.sourceBufferExt.removeSourceBuffer(i,n))}}},MediaPlayer.dependencies.TextController.prototype={constructor:MediaPlayer.dependencies.TextController},MediaPlayer.dependencies.TextController.eventList={ENAME_CLOSED_CAPTIONING_REQUESTED:"closedCaptioningRequested"},MediaPlayer.dependencies.XlinkController=function(){"use strict";var t,l,d,n,r="onLoad",s="Period",o="AdaptationSet",u="EventStream",c=function(e,t,a){var i,n,r,s={};for(s.elements=e,s.type=t,s.resolveType=a,0===s.elements.length&&h.call(this,s),r=0;r<s.elements.length;r+=1)n=-1!==(i=s.elements[r]).url.indexOf("http://")?i.url:i.originalContent.BaseURL+i.url,this.xlinkLoader.load(n,i,s)},e=function(e){var t,a=e.data.element,i=e.data.resolveObject;a.resolvedContent&&(e=a.resolvedContent.indexOf(">")+1,t=a.resolvedContent.substr(0,e)+"<response>"+a.resolvedContent.substr(e)+"</response>",a.resolvedContent=n.xml_str2json(t)),m.call(this,i)&&h.call(this,i)},h=function(e){var t,a,i=[];if(p.call(this,e),"onActuate"===e.resolveType&&this.notify(MediaPlayer.dependencies.XlinkController.eventList.ENAME_XLINK_READY,{manifest:d}),e.resolveType===r)switch(e.type){case s:for(t=0;t<d.Period_asArray.length;t++)(a=d.Period_asArray[t]).hasOwnProperty(o+"_asArray")&&(i=i.concat(f.call(this,a[o+"_asArray"],a,o,r))),a.hasOwnProperty(u+"_asArray")&&(i=i.concat(f.call(this,a[u+"_asArray"],a,u,r)));c.call(this,i,o,r);break;case o:this.notify(MediaPlayer.dependencies.XlinkController.eventList.ENAME_XLINK_READY,{manifest:d})}},f=function(e,t,a,i){for(var n,r,s=[],o=e.length-1;0<=o;--o)(n=e[o]).hasOwnProperty("xlink:href")&&"urn:mpeg:dash:resolve-to-zero:2013"===n["xlink:href"]&&e.splice(o,1);for(o=0;o<e.length;o++)(n=e[o]).hasOwnProperty("xlink:href")&&n.hasOwnProperty("xlink:actuate")&&n["xlink:actuate"]===i&&(r=g(n["xlink:href"],t,a,o,i,n),s.push(r));return s},p=function(e){for(var t,a,i,n,r,s=[],o=e.elements.length-1;0<=o;o--){if(a=(t=e.elements[o]).type+"_asArray",!t.resolvedContent||y())delete t.originalContent["xlink:actuate"],delete t.originalContent["xlink:href"],s.push(t.originalContent);else if(t.resolvedContent)for(n=0;n<t.resolvedContent[a].length;n++)i=t.resolvedContent[a][n],s.push(i);for(t.parentElement[a].splice(t.index,1),r=0;r<s.length;r++)t.parentElement[a].splice(t.index+r,0,s[r]);s=[]}0<e.elements.length&&l.run(d)},g=function(e,t,a,i,n,r){return{url:e,parentElement:t,type:a,index:i,resolveType:n,originalContent:r,resolvedContent:null,resolved:!1}},m=function(e){for(var t=0;t<e.elements.length;t++)if(!1===e.elements[t].resolved)return!1;return!0},y=function(){return!1};return{xlinkLoader:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){e=e.bind(this),this.xlinkLoader.subscribe(MediaPlayer.dependencies.XlinkLoader.eventList.ENAME_XLINKELEMENT_LOADED,this,e)},resolveManifestOnLoad:function(e){!function(e){n=new X2JS(t,"",!0),e=f((d=e).Period_asArray,d,s,r),c.call(this,e,s,r)}.call(this,e)},setMatchers:function(e){t=e},setIron:function(e){l=e}}},MediaPlayer.dependencies.XlinkController.prototype={constructor:MediaPlayer.dependencies.XlinkController},MediaPlayer.dependencies.XlinkController.eventList={ENAME_XLINK_ALLELEMENTSLOADED:"xlinkAllElementsLoaded",ENAME_XLINK_READY:"xlinkReady"},MediaPlayer.dependencies.MediaSourceExtensions=function(){},MediaPlayer.dependencies.MediaSourceExtensions.prototype={constructor:MediaPlayer.dependencies.MediaSourceExtensions,createMediaSource:function(){"use strict";var e="WebKitMediaSource"in window;return"MediaSource"in window?new MediaSource:e?new WebKitMediaSource:null},attachMediaSource:function(e,t){"use strict";e=window.URL.createObjectURL(e);return t.setSource(e),e},detachMediaSource:function(e){"use strict";e.setSource("")},setDuration:function(e,t){"use strict";return e.duration!=t&&(e.duration=t),e.duration},signalEndOfStream:function(e){"use strict";var t=e.sourceBuffers,a=t.length,i=0;if("open"===e.readyState){for(;i<a;i+=1)if(t[i].updating)return;e.endOfStream()}}},MediaPlayer.dependencies.ProtectionExtensions=function(){"use strict";this.system=void 0,this.log=void 0,this.keySystems=[],this.notify=void 0,this.subscribe=void 0,this.unsubscribe=void 0,this.clearkeyKeySystem=void 0},MediaPlayer.dependencies.ProtectionExtensions.prototype={constructor:MediaPlayer.dependencies.ProtectionExtensions,setup:function(){var e=this.system.getObject("ksPlayReady");this.keySystems.push(e),e=this.system.getObject("ksWidevine"),this.keySystems.push(e),e=this.system.getObject("ksClearKey"),this.keySystems.push(e),this.clearkeyKeySystem=e},getKeySystems:function(){return this.keySystems},getKeySystemBySystemString:function(e){for(var t=0;t<this.keySystems.length;t++)if(this.keySystems[t].systemString===e)return this.keySystems[t];return null},isClearKey:function(e){return e===this.clearkeyKeySystem},initDataEquals:function(e,t){if(e.byteLength!==t.byteLength)return!1;for(var a=new Uint8Array(e),i=new Uint8Array(t),n=0;n<a.length;n++)if(a[n]!==i[n])return!1;return!0},getSupportedKeySystemsFromContentProtection:function(e){var t,a,i,n,r,s=[];if(e)for(a=0;a<this.keySystems.length;++a)for(t=this.keySystems[a],i=0;i<e.length;++i)(r=e[i]).schemeIdUri.toLowerCase()===t.schemeIdURI&&(n=t.getInitData(r))&&s.push({ks:this.keySystems[a],initData:n});return s},getSupportedKeySystems:function(e){for(var t=[],a=MediaPlayer.dependencies.protection.CommonEncryption.parsePSSHList(e),i=0;i<this.keySystems.length;++i)this.keySystems[i].uuid in a&&t.push({ks:this.keySystems[i],initData:a[this.keySystems[i].uuid]});return t},getLicenseServer:function(e,t,a){if("license-release"===a||"individualization-request"==a)return null;a=null;return t&&t.hasOwnProperty("drmtoday")?a=this.system.getObject("serverDRMToday"):"com.widevine.alpha"===e.systemString?a=this.system.getObject("serverWidevine"):"com.microsoft.playready"===e.systemString?a=this.system.getObject("serverPlayReady"):"org.w3.clearkey"===e.systemString&&(a=this.system.getObject("serverClearKey")),a},processClearKeyLicenseRequest:function(e,t){try{return MediaPlayer.dependencies.protection.KeySystem_ClearKey.getClearKeysFromProtectionData(e,t)}catch(e){return this.log("Failed to retrieve clearkeys from ProtectionData"),null}}},MediaPlayer.dependencies.RequestModifierExtensions=function(){"use strict";return{modifyRequestURL:function(e){return e},modifyRequestHeader:function(e){return e}}},MediaPlayer.dependencies.SourceBufferExtensions=function(){"use strict";this.system=void 0,this.notify=void 0,this.subscribe=void 0,this.unsubscribe=void 0,this.manifestExt=void 0},MediaPlayer.dependencies.SourceBufferExtensions.prototype={constructor:MediaPlayer.dependencies.SourceBufferExtensions,createSourceBuffer:function(e,t){"use strict";var a=t.codec,i=null;try{if(a.match(/application\/mp4;\s*codecs="stpp"/i))throw new Error("not really supported");i=e.addSourceBuffer(a)}catch(e){if(!t.isText&&-1===a.indexOf('codecs="stpp"'))throw e;i=this.system.getObject("textSourceBuffer")}return i},removeSourceBuffer:function(e,t){"use strict";try{e.removeSourceBuffer(t)}catch(e){}},getBufferRange:function(e,t,a){"use strict";var i,n,r,s,o=null,l=null,d=null,u=0,c=a||.15;try{o=e.buffered}catch(e){return null}if(null!=o){for(n=0,i=o.length;n<i;n+=1)if(r=o.start(n),s=o.end(n),null===l)u=Math.abs(r-t),(r<=t&&t<s||u<=c)&&(l=r,d=s);else{if(!((u=r-d)<=c))break;d=s}if(null!==l)return{start:l,end:d}}return null},getAllRanges:function(e){try{return e.buffered}catch(e){return null}},getTotalBufferedTime:function(e){var t,a,i=this.getAllRanges(e),n=0;if(!i)return n;for(a=0,t=i.length;a<t;a+=1)n+=i.end(a)-i.start(a);return n},getBufferLength:function(e,t,a){"use strict";a=this.getBufferRange(e,t,a);return null===a?0:a.end-t},getRangeDifference:function(e,t){if(!t)return null;var a,i,n,r,s,o,l=this.getAllRanges(t);if(!l)return null;for(var d=0,u=l.length;d<u;d+=1){if(s=e.length>d?{start:e.start(d),end:e.end(d)}:null,r=l.start(d),a=l.end(d),!s)return{start:r,end:a};if(i=s.start===r,n=s.end===a,!i||!n){if(i)o={start:s.end,end:a};else{if(!n)return{start:r,end:a};o={start:r,end:s.start}}return r=e.length>d+1?{start:e.start(d+1),end:e.end(d+1)}:null,s=d+1<u?{start:l.start(d+1),end:l.end(d+1)}:null,!r||s&&s.start===r.start&&s.end===r.end||(o.end=r.start),o}}return null},waitForUpdateEnd:function(e,t){"use strict";function a(){e.updating||(clearInterval(i),t())}var i,n=function(){e.updating||(e.removeEventListener("updateend",n,!1),t())};if(e.updating)if("function"==typeof e.addEventListener)try{e.addEventListener("updateend",n,!1)}catch(e){i=setInterval(a,50)}else i=setInterval(a,50);else t()},append:function(t,e){var a=this,i=e.bytes,n="append"in t?"append":"appendBuffer"in t?"appendBuffer":null,r="Object"===Object.prototype.toString.call(t).slice(8,-1);if(n)try{a.waitForUpdateEnd(t,function(){r?t[n](i,e):t[n](i),a.waitForUpdateEnd(t,function(){a.notify(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,{buffer:t,bytes:i})})})}catch(e){a.notify(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,{buffer:t,bytes:i},new MediaPlayer.vo.Error(e.code,e.message,null))}},remove:function(t,a,i,e){var n=this;try{n.waitForUpdateEnd(t,function(){0<=a&&a<i&&"ended"!==e.readyState&&t.remove(a,i),n.waitForUpdateEnd(t,function(){n.notify(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,{buffer:t,from:a,to:i})})})}catch(e){n.notify(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,{buffer:t,from:a,to:i},new MediaPlayer.vo.Error(e.code,e.message,null))}},abort:function(e,t){"use strict";try{"open"===e.readyState&&t.abort()}catch(e){}}},MediaPlayer.dependencies.SourceBufferExtensions.QUOTA_EXCEEDED_ERROR_CODE=22,MediaPlayer.dependencies.SourceBufferExtensions.eventList={ENAME_SOURCEBUFFER_REMOVE_COMPLETED:"sourceBufferRemoveCompleted",ENAME_SOURCEBUFFER_APPEND_COMPLETED:"sourceBufferAppendCompleted"},MediaPlayer.utils.TextTrackExtensions=function(){"use strict";var r,l,d=[],u=[],c=-1,h=0,f=0,p=null,s=null,g=!1;return{mediaController:void 0,videoModel:void 0,eventBus:void 0,setup:function(){r=window.VTTCue||window.TextTrackCue,g=!!navigator.userAgent.match(/Trident.*rv[ :]*11\./)},addTextTrack:function(e,t){if(d.push(e),void 0===l&&(l=e.video),p=this.videoModel.getTTMLRenderingDiv(),d.length===t){for(var a=0,i=0;i<d.length;i++){n=(o=s=r=void 0,r=d[n=i].kind,s=void 0!==d[n].label?d[n].label:d[n].lang,o=d[n].lang,n=g?l.addTextTrack(r,s,o):document.createElement("track"),g||(n.kind=r,n.label=s,n.srclang=o),n);c=i,u.push(n),d[i].defaultTrack&&(n.default=!0,a=i),g||l.appendChild(n),this.addCaptions(0,d[i].captionData),this.eventBus.dispatchEvent({type:MediaPlayer.events.TEXT_TRACK_ADDED})}c=a,this.eventBus.dispatchEvent({type:MediaPlayer.events.TEXT_TRACKS_ADDED,data:{index:c,tracks:d}})}var n,r,s,o},checkVideoSize:function(){var e=this.getCurrentTextTrack();if(e&&"html"===e.renderingType){var t=l.clientWidth,a=l.clientHeight;if(t!=h||a!=f){h=t,f=a,p.style.width=h+"px",p.style.height=f+"px";for(var i=0;i<e.activeCues.length;++i){var n=e.activeCues[i];n.scaleCue(n)}}}},scaleCue:function(e){var t,a=[h/e.cellResolution[0],f/e.cellResolution[1]];if(e.linePadding)for(t in e.linePadding)if(e.linePadding.hasOwnProperty(t))for(var i=(e.linePadding[t]*a[0]).toString(),n=document.getElementsByClassName("spanPadding"),r=0;r<n.length;r++)n[r].style.cssText=n[r].style.cssText.replace(/(padding-left\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+i),n[r].style.cssText=n[r].style.cssText.replace(/(padding-right\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+i);if(e.fontSize)for(t in e.fontSize)if(e.fontSize.hasOwnProperty(t)){i=(e.fontSize[t]/100*a[1]).toString();for(var s="defaultFontSize"!==t?document.getElementsByClassName(t):document.getElementsByClassName("paragraph"),o=0;o<s.length;o++)s[o].style.cssText=s[o].style.cssText.replace(/(font-size\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+i)}if(e.lineHeight)for(t in e.lineHeight)if(e.lineHeight.hasOwnProperty(t)){i=(e.lineHeight[t]/100*a[1]).toString(),s=document.getElementsByClassName(t);for(var l=0;l<s.length;l++)s[l].style.cssText=s[l].style.cssText.replace(/(line-height\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+i)}},addCaptions:function(e,t){var a=this.getCurrentTextTrack();if(a){for(var i in a.mode="showing",t){var n,i=t[i];s||"html"!=i.type||(s=setInterval(this.checkVideoSize.bind(this),500)),"image"==i.type?((n=new r(i.start-e,i.end-e,"")).image=i.data,n.id=i.id,n.size=0,n.type="image",n.onenter=function(){var e=new Image;e.id="ttmlImage_"+this.id,e.src=this.image,e.className="cue-image",(p||l.parentNode).appendChild(e)},n.onexit=function(){for(var e=p||l.parentNode,t=e.childNodes,a=0;a<t.length;a++)t[a].id=="ttmlImage_"+this.id&&e.removeChild(t[a])}):"html"==i.type?("html"!==a.renderingType&&(a.renderingType="html"),r!==window.TextTrackCue&&(document.getElementById("caption-style")&&document.getElementById("caption-style").sheet.cssRules.length||this.setCueStyle()),(n=new r(i.start-e,i.end-e,"")).cueHTMLElement=i.cueHTMLElement,n.regions=i.regions,n.regionID=i.regionID,n.cueID=i.cueID,n.videoWidth=i.videoWidth,n.videoHeight=i.videoHeight,n.cellResolution=i.cellResolution,n.fontSize=i.fontSize,n.lineHeight=i.lineHeight,n.linePadding=i.linePadding,n.scaleCue=this.scaleCue,p.style.width=l.clientWidth+"px",p.style.height=l.clientHeight+"px",n.onenter=function(){"showing"==a.mode&&(p.appendChild(this.cueHTMLElement),this.scaleCue(this))},n.onexit=function(){for(var e=p.childNodes,t=0;t<e.length;++t)e[t].id=="subtitle_"+this.cueID&&p.removeChild(e[t])}):(n=new r(i.start-e,i.end-e,i.data),i.styles&&(void 0!==i.styles.align&&n.hasOwnProperty("align")&&(n.align=i.styles.align),void 0!==i.styles.line&&n.hasOwnProperty("line")&&(n.line=i.styles.line),void 0!==i.styles.position&&n.hasOwnProperty("position")&&(n.position=i.styles.position),void 0!==i.styles.size&&n.hasOwnProperty("size")&&(n.size=i.styles.size))),a.addCue(n)}d[c].isFragmented||(a.mode=d[c].defaultTrack?"showing":"hidden")}},getCurrentTextTrack:function(){return 0<=c?l.textTracks[c]:null},getCurrentTrackIdx:function(){return c},setCurrentTrackIdx:function(e){c=e},getTextTrack:function(e){return l.textTracks[e]},deleteTrackCues:function(e){if(e.cues){for(var t=e.cues,a=t.length-1;0<=a;a--)e.removeCue(t[a]);e.mode="disabled"}},deleteAllTextTracks:function(){for(var e=u.length,t=0;t<e;t++)g?this.deleteTrackCues(this.getTextTrack(t)):l.removeChild(u[t]);u=[],d=[],s&&(clearInterval(s),s=null)},deleteTextTrack:function(e){l.removeChild(u[e]),u.splice(e,1)},setCueStyle:function(){document.getElementById("caption-style")?e=document.getElementById("caption-style"):(e=document.createElement("style")).id="caption-style",document.head.appendChild(e);var e=e.sheet;l.id?e.addRule("#"+l.id+"::cue","background: transparent"):0!==l.classList.length?e.addRule("."+l.className+"::cue","background: transparent"):e.addRule("video::cue","background: transparent")},removeCueStyle:function(){var e;r===window.TextTrackCue||(e=document.getElementById("caption-style").sheet).cssRules&&0<e.cssRules.length&&e.deleteRule(0)},clearCues:function(){for(;p.firstChild;)p.removeChild(p.firstChild)}}},MediaPlayer.dependencies.VideoModelExtensions=function(){"use strict";return{getPlaybackQuality:function(e){var t="webkitDroppedFrameCount"in e,a=null;return"getVideoPlaybackQuality"in e?a=e.getVideoPlaybackQuality():t&&(a={droppedVideoFrames:e.webkitDroppedFrameCount,creationTime:new Date}),a}}},MediaPlayer.dependencies.VideoModelExtensions.prototype={constructor:MediaPlayer.dependencies.VideoModelExtensions},MediaPlayer.dependencies.FragmentModel=function(){"use strict";function n(e,t){-1!==(t=e.indexOf(t))&&e.splice(t,1)}function s(e,a){return a?a.hasOwnProperty("time")?[function(e,t,a){for(var i,n,r,s=e.length-1;0<=s;--s)if(n=(i=(r=e[s]).startTime)+r.duration,a=a||r.duration/2,!isNaN(i)&&!isNaN(n)&&i<=t+a&&t-a<n||isNaN(i)&&isNaN(t))return r;return null}.call(this,e,a.time,a.threshold)]:e.filter(function(e){for(var t in a)if("state"!==t&&a.hasOwnProperty(t)&&e[t]!=a[t])return!1;return!0}):e}function o(e){var t;switch(e){case MediaPlayer.dependencies.FragmentModel.states.PENDING:t=u;break;case MediaPlayer.dependencies.FragmentModel.states.LOADING:t=c;break;case MediaPlayer.dependencies.FragmentModel.states.EXECUTED:t=d;break;case MediaPlayer.dependencies.FragmentModel.states.REJECTED:t=h;break;default:t=[]}return t}function r(e,t){var a,i,n,r,s,o,l;e&&(a=e.mediaType,i=new Date,n=e.type,r=e.startTime,s=e.availabilityStartTime,o=e.duration,l=e.quality,e=e.range,this.metricsModel.addSchedulingInfo(a,i,n,r,s,o,l,e,t),this.metricsModel.addRequestsQueue(a,u,c,d,h))}function e(e){var t=e.data.request,a=e.data.response,e=e.error;c.splice(c.indexOf(t),1),a&&!e&&d.push(t),r.call(this,t,e?MediaPlayer.dependencies.FragmentModel.states.FAILED:MediaPlayer.dependencies.FragmentModel.states.EXECUTED),this.notify(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,{request:t,response:a},e)}function t(e){var t=this.getRequests({state:MediaPlayer.dependencies.FragmentModel.states.EXECUTED,quality:e.data.quality,index:e.data.index})[0];t&&(n.call(this,d,t),isNaN(e.data.index)||(h.push(t),r.call(this,t,MediaPlayer.dependencies.FragmentModel.states.REJECTED)))}function a(){f=!0}function i(){f=!1}var l=null,d=[],u=[],c=[],h=[],f=!1;return{system:void 0,log:void 0,metricsModel:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,manifestExt:void 0,setup:function(){this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN]=a,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED]=i,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_REJECTED]=t,this[MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_COMPLETED]=e},setLoader:function(e){this.fragmentLoader=e},setContext:function(e){l=e},getContext:function(){return l},getIsPostponed:function(){return f},addRequest:function(e){return!!(this.manifestExt.getIsTextTrack(e.mediaType)||e&&!this.isFragmentLoadedOrPending(e))&&(u.push(e),r.call(this,e,MediaPlayer.dependencies.FragmentModel.states.PENDING),!0)},isFragmentLoadedOrPending:function(l){function e(e){for(var t,a,i,n,r=!1,s=e.length,o=0;o<s;o+=1)if(t=e[o],n=t,(i=l).url===n.url&&i.startTime===n.startTime||(n=l,a=t,isNaN(n.index)&&isNaN(a.index)&&n.quality===a.quality)||(a=t,"complete"===(t=l).action&&t.action===a.action)){r=!0;break}return r}return e(u)||e(c)||e(d)},getRequests:function(e){var t=[],a=[],i=1;if(!e||!e.state)return t;for(var n=e.state instanceof Array?(i=e.state.length,e.state):[e.state],r=0;r<i;r+=1)t=o.call(this,n[r]),a=a.concat(s.call(this,t,e));return a},getLoadingTime:function(){for(var e,t=0,a=d.length-1;0<=a;--a)if((e=d[a]).requestEndDate instanceof Date&&e.firstByteDate instanceof Date){t=e.requestEndDate.getTime()-e.firstByteDate.getTime();break}return t},removeExecutedRequest:function(e){n.call(this,d,e)},removeRejectedRequest:function(e){n.call(this,h,e)},removeExecutedRequestsBeforeTime:function(e){for(var t,a,i=d.length-1;0<=i;--i)t=(a=d[i]).startTime,!isNaN(t)&&t<e&&n.call(this,d,a)},cancelPendingRequests:function(t){var a=this,e=u,i=e;return u=[],void 0!==t&&(u=e.filter(function(e){return e.quality!==t&&(i.splice(i.indexOf(e),1),!0)})),i.forEach(function(e){r.call(a,e,MediaPlayer.dependencies.FragmentModel.states.CANCELED)}),i},abortRequests:function(){var e=[];for(this.fragmentLoader.abort();0<c.length;)e.push(c[0]),n.call(this,c,c[0]);return c=[],e},executeRequest:function(e){var t=u.indexOf(e);if(e&&-1!==t)switch(u.splice(t,1),e.action){case"complete":d.push(e),r.call(this,e,MediaPlayer.dependencies.FragmentModel.states.EXECUTED),this.notify(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_STREAM_COMPLETED,{request:e});break;case"download":c.push(e),r.call(this,e,MediaPlayer.dependencies.FragmentModel.states.LOADING),function(e){this.notify(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_STARTED,{request:e}),this.fragmentLoader.load(e)}.call(this,e);break;default:this.log("Unknown request action.")}},reset:function(){this.abortRequests(),this.cancelPendingRequests(),l=null,d=[],u=[],c=[],f=!(h=[])}}},MediaPlayer.dependencies.FragmentModel.prototype={constructor:MediaPlayer.dependencies.FragmentModel},MediaPlayer.dependencies.FragmentModel.eventList={ENAME_STREAM_COMPLETED:"streamCompleted",ENAME_FRAGMENT_LOADING_STARTED:"fragmentLoadingStarted",ENAME_FRAGMENT_LOADING_COMPLETED:"fragmentLoadingCompleted"},MediaPlayer.dependencies.FragmentModel.states={PENDING:"pending",LOADING:"loading",EXECUTED:"executed",REJECTED:"rejected",CANCELED:"canceled",FAILED:"failed"},MediaPlayer.models.ManifestModel=function(){"use strict";var t;return{system:void 0,eventBus:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,getValue:function(){return t},setValue:function(e){t=e,this.eventBus.dispatchEvent({type:MediaPlayer.events.MANIFEST_LOADED,data:e}),this.notify(MediaPlayer.models.ManifestModel.eventList.ENAME_MANIFEST_UPDATED,{manifest:e})}}},MediaPlayer.models.ManifestModel.prototype={constructor:MediaPlayer.models.ManifestModel},MediaPlayer.models.ManifestModel.eventList={ENAME_MANIFEST_UPDATED:"manifestUpdated"},MediaPlayer.models.MetricsModel=function(){"use strict";return{system:void 0,eventBus:void 0,adapter:void 0,streamMetrics:{},metricsChanged:function(){this.eventBus.dispatchEvent({type:MediaPlayer.events.METRICS_CHANGED,data:{}})},metricChanged:function(e){this.eventBus.dispatchEvent({type:MediaPlayer.events.METRIC_CHANGED,data:{stream:e}}),this.metricsChanged()},metricUpdated:function(e,t,a){this.eventBus.dispatchEvent({type:MediaPlayer.events.METRIC_UPDATED,data:{stream:e,metric:t,value:a}}),this.metricChanged(e)},metricAdded:function(e,t,a){this.eventBus.dispatchEvent({type:MediaPlayer.events.METRIC_ADDED,data:{stream:e,metric:t,value:a}}),this.metricChanged(e)},clearCurrentMetricsForType:function(e){delete this.streamMetrics[e],this.metricChanged(e)},clearAllCurrentMetrics:function(){this.streamMetrics={},this.metricsChanged.call(this)},getReadOnlyMetricsFor:function(e){return this.streamMetrics.hasOwnProperty(e)?this.streamMetrics[e]:null},getMetricsFor:function(e){var t;return this.streamMetrics.hasOwnProperty(e)?t=this.streamMetrics[e]:(t=this.system.getObject("metrics"),this.streamMetrics[e]=t),t},addTcpConnection:function(e,t,a,i,n,r){var s=new MediaPlayer.vo.metrics.TCPConnection;return s.tcpid=t,s.dest=a,s.topen=i,s.tclose=n,s.tconnect=r,this.getMetricsFor(e).TcpList.push(s),this.metricAdded(e,this.adapter.metricsList.TCP_CONNECTION,s),s},addHttpRequest:function(e,t,a,i,n,r,s,o,l,d,u,c){var h=new MediaPlayer.vo.metrics.HTTPRequest;return n&&n!==i&&(this.addHttpRequest(e,null,a,i,null,r,s,null,null,null,u,null),h.actualurl=n),h.stream=e,h.tcpid=t,h.type=a,h.url=i,h.range=r,h.trequest=s,h.tresponse=o,h.tfinish=l,h.responsecode=d,h.mediaduration=u,h.responseHeaders=c,this.getMetricsFor(e).HttpList.push(h),this.metricAdded(e,this.adapter.metricsList.HTTP_REQUEST,h),h},appendHttpTrace:function(e,t,a,i){var n=new MediaPlayer.vo.metrics.HTTPRequest.Trace;return n.s=t,n.d=a,n.b=i,e.trace.push(n),e.interval||(e.interval=0),e.interval+=a,this.metricUpdated(e.stream,this.adapter.metricsList.HTTP_REQUEST_TRACE,e),n},addRepresentationSwitch:function(e,t,a,i,n){var r=new MediaPlayer.vo.metrics.RepresentationSwitch;return r.t=t,r.mt=a,r.to=i,r.lto=n,this.getMetricsFor(e).RepSwitchList.push(r),this.metricAdded(e,this.adapter.metricsList.TRACK_SWITCH,r),r},addBufferLevel:function(e,t,a){var i=new MediaPlayer.vo.metrics.BufferLevel;return i.t=t,i.level=a,this.getMetricsFor(e).BufferLevel.push(i),this.metricAdded(e,this.adapter.metricsList.BUFFER_LEVEL,i),i},addBufferState:function(e,t,a){var i=new MediaPlayer.vo.metrics.BufferState;return i.target=a,i.state=t,this.getMetricsFor(e).BufferState.push(i),this.metricAdded(e,this.adapter.metricsList.BUFFER_STATE,i),i},addDVRInfo:function(e,t,a,i){var n=new MediaPlayer.vo.metrics.DVRInfo;return n.time=t,n.range=i,n.manifestInfo=a,this.getMetricsFor(e).DVRInfo.push(n),this.metricAdded(e,this.adapter.metricsList.DVR_INFO,n),n},addDroppedFrames:function(e,t){var a=new MediaPlayer.vo.metrics.DroppedFrames,i=this.getMetricsFor(e).DroppedFrames;return a.time=t.creationTime,a.droppedFrames=t.droppedVideoFrames,0<i.length&&i[i.length-1]==a?i[i.length-1]:(i.push(a),this.metricAdded(e,this.adapter.metricsList.DROPPED_FRAMES,a),a)},addSchedulingInfo:function(e,t,a,i,n,r,s,o,l){var d=new MediaPlayer.vo.metrics.SchedulingInfo;return d.mediaType=e,d.t=t,d.type=a,d.startTime=i,d.availabilityStartTime=n,d.duration=r,d.quality=s,d.range=o,d.state=l,this.getMetricsFor(e).SchedulingInfo.push(d),this.metricAdded(e,this.adapter.metricsList.SCHEDULING_INFO,d),d},addRequestsQueue:function(e,t,a,i,n){var r=new MediaPlayer.vo.metrics.RequestsQueue;r.pendingRequests=t,r.loadingRequests=a,r.executedRequests=i,r.rejectedRequests=n,this.getMetricsFor(e).RequestsQueue=r,this.metricAdded(e,this.adapter.metricsList.REQUESTS_QUEUE,r)},addManifestUpdate:function(e,t,a,i,n,r,s,o,l,d){var u=new MediaPlayer.vo.metrics.ManifestUpdate,c=this.getMetricsFor("stream");return u.mediaType=e,u.type=t,u.requestTime=a,u.fetchTime=i,u.availabilityStartTime=n,u.presentationStartTime=r,u.clientTimeOffset=s,u.currentTime=o,u.buffered=l,u.latency=d,c.ManifestUpdate.push(u),this.metricAdded(e,this.adapter.metricsList.MANIFEST_UPDATE,u),u},updateManifestUpdateInfo:function(e,t){if(e){for(var a in t)e[a]=t[a];this.metricUpdated(e.mediaType,this.adapter.metricsList.MANIFEST_UPDATE,e)}},addManifestUpdateStreamInfo:function(e,t,a,i,n){if(e){var r=new MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo;return r.id=t,r.index=a,r.start=i,r.duration=n,e.streamInfo.push(r),this.metricUpdated(e.mediaType,this.adapter.metricsList.MANIFEST_UPDATE_STREAM_INFO,e),r}return null},addManifestUpdateRepresentationInfo:function(e,t,a,i,n,r,s,o){if(e){var l=new MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo;return l.id=t,l.index=a,l.streamIndex=i,l.mediaType=n,l.startNumber=s,l.fragmentInfoType=o,l.presentationTimeOffset=r,e.trackInfo.push(l),this.metricUpdated(e.mediaType,this.adapter.metricsList.MANIFEST_UPDATE_TRACK_INFO,e),l}return null},addPlayList:function(e,t,a,i){var n=new MediaPlayer.vo.metrics.PlayList;return n.stream=e,n.start=t,n.mstart=a,n.starttype=i,this.getMetricsFor(e).PlayList.push(n),this.metricAdded(e,this.adapter.metricsList.PLAY_LIST,n),n},appendPlayListTrace:function(e,t,a,i,n,r,s,o){var l=new MediaPlayer.vo.metrics.PlayList.Trace;return l.representationid=t,l.subreplevel=a,l.start=i,l.mstart=n,l.duration=r,l.playbackspeed=s,l.stopreason=o,e.trace.push(l),this.metricUpdated(e.stream,this.adapter.metricsList.PLAY_LIST_TRACE,e),l}}},MediaPlayer.models.MetricsModel.prototype={constructor:MediaPlayer.models.MetricsModel},MediaPlayer.models.ProtectionModel=function(){},MediaPlayer.models.ProtectionModel.eventList={ENAME_NEED_KEY:"needkey",ENAME_KEY_SYSTEM_ACCESS_COMPLETE:"keySystemAccessComplete",ENAME_KEY_SYSTEM_SELECTED:"keySystemSelected",ENAME_VIDEO_ELEMENT_SELECTED:"videoElementSelected",ENAME_SERVER_CERTIFICATE_UPDATED:"serverCertificateUpdated",ENAME_KEY_MESSAGE:"keyMessage",ENAME_KEY_ADDED:"keyAdded",ENAME_KEY_ERROR:"keyError",ENAME_KEY_SESSION_CREATED:"keySessionCreated",ENAME_KEY_SESSION_REMOVED:"keySessionRemoved",ENAME_KEY_SESSION_CLOSED:"keySessionClosed",ENAME_KEY_STATUSES_CHANGED:"keyStatusesChanged",ENAME_TEARDOWN_COMPLETE:"protectionTeardownComplete"},MediaPlayer.models.ProtectionModel_01b=function(){function t(){f.removeEventListener(s.keyerror,a),f.removeEventListener(s.needkey,a),f.removeEventListener(s.keymessage,a),f.removeEventListener(s.keyadded,a)}var r,f=null,s=null,o=[],l=[],a=null,d=function(e,t){if(t&&e){for(var a=e.length,i=0;i<a;i++)if(e[i].sessionID==t)return e[i];return null}return null};return{system:void 0,log:void 0,errHandler:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,protectionExt:void 0,keySystem:null,setup:function(){a=function(){var n=this;return{handleEvent:function(e){var t=null;switch(e.type){case s.needkey:var a=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;n.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY,new MediaPlayer.vo.protection.NeedKey(a,"cenc"));break;case s.keyerror:if(t=(t=d(l,e.sessionId))||d(o,e.sessionId)){var i="";switch(e.errorCode.code){case 1:i+="MEDIA_KEYERR_UNKNOWN - An unspecified error occurred. This value is used for errors that don't match any of the other codes.";break;case 2:i+="MEDIA_KEYERR_CLIENT - The Key System could not be installed or updated.";break;case 3:i+="MEDIA_KEYERR_SERVICE - The message passed into update indicated an error from the license service.";break;case 4:i+="MEDIA_KEYERR_OUTPUT - There is no available output device with the required characteristics for the content protection system.";break;case 5:i+="MEDIA_KEYERR_HARDWARECHANGE - A hardware configuration change caused a content protection error.";break;case 6:i+="MEDIA_KEYERR_DOMAIN - An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain."}i+="  System Code = "+e.systemCode,n.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR,new MediaPlayer.vo.protection.KeyError(t,i))}else n.log("No session token found for key error");break;case s.keyadded:(t=(t=d(l,e.sessionId))||d(o,e.sessionId))?n.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ADDED,t):n.log("No session token found for key added");break;case s.keymessage:(r=null!==e.sessionId&&void 0!==e.sessionId)?!(t=d(l,e.sessionId))&&0<o.length&&(t=o.shift(),l.push(t),t.sessionID=e.sessionId):0<o.length&&(t=o.shift(),l.push(t),0!==o.length&&n.errHandler.mediaKeyMessageError("Multiple key sessions were creates with a user-agent that does not support sessionIDs!! Unpredictable behavior ahead!")),t?(a=ArrayBuffer.isView(e.message)?e.message.buffer:e.message,t.keyMessage=a,n.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,new MediaPlayer.vo.protection.KeyMessage(t,a,e.defaultURL))):n.log("No session token found for key message")}}}}.call(this)},init:function(){var e=document.createElement("video");s=MediaPlayer.models.ProtectionModel_01b.detect(e)},teardown:function(){f&&t();for(var e=0;e<l.length;e++)this.closeKeySession(l[e]);this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE)},getAllInitData:function(){for(var e=[],t=0;t<o.length;t++)e.push(o[t].initData);for(t=0;t<l.length;t++)e.push(l[t].initData);return e},requestKeySystemAccess:function(e){for(var t=(t=f)||document.createElement("video"),a=!1,i=0;i<e.length;i++)for(var n=e[i].ks.systemString,r=e[i].configs,s=null,o=null,l=0;l<r.length;l++){var d=r[l].videoCapabilities;if(d&&0!==d.length)for(var o=[],u=0;u<d.length;u++)""!==t.canPlayType(d[u].contentType,n)&&o.push(d[u]);if(o&&(!o||0!==o.length)){var a=!0,c=new MediaPlayer.vo.protection.KeySystemConfiguration(s,o),h=this.protectionExt.getKeySystemBySystemString(n),c=new MediaPlayer.vo.protection.KeySystemAccess(h,c);this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,c);break}}a||this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,null,"Key system access denied! -- No valid audio/video content configurations detected!")},selectKeySystem:function(e){this.keySystem=e.keySystem,this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED)},setMediaElement:function(e){f!==e&&(f&&t(),(f=e)&&(f.addEventListener(s.keyerror,a),f.addEventListener(s.needkey,a),f.addEventListener(s.keymessage,a),f.addEventListener(s.keyadded,a),this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_VIDEO_ELEMENT_SELECTED)))},createKeySession:function(e){if(!this.keySystem)throw new Error("Can not create sessions until you have selected a key system");if(r||0===l.length){var t={sessionID:null,initData:e,getSessionID:function(){return this.sessionID},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"}};return o.push(t),f[s.generateKeyRequest](this.keySystem.systemString,new Uint8Array(e)),t}throw new Error("Multiple sessions not allowed!")},updateKeySession:function(e,t){var a=e.sessionID;if(this.protectionExt.isClearKey(this.keySystem))for(var i=0;i<t.keyPairs.length;i++)f[s.addKey](this.keySystem.systemString,t.keyPairs[i].key,t.keyPairs[i].keyID,a);else f[s.addKey](this.keySystem.systemString,new Uint8Array(t),e.initData,a)},closeKeySession:function(e){f[s.cancelKeyRequest](this.keySystem.systemString,e.sessionID)},setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){}}},MediaPlayer.models.ProtectionModel_01b.prototype={constructor:MediaPlayer.models.ProtectionModel_01b},MediaPlayer.models.ProtectionModel_01b.APIs=[{generateKeyRequest:"generateKeyRequest",addKey:"addKey",cancelKeyRequest:"cancelKeyRequest",needkey:"needkey",keyerror:"keyerror",keyadded:"keyadded",keymessage:"keymessage"},{generateKeyRequest:"webkitGenerateKeyRequest",addKey:"webkitAddKey",cancelKeyRequest:"webkitCancelKeyRequest",needkey:"webkitneedkey",keyerror:"webkitkeyerror",keyadded:"webkitkeyadded",keymessage:"webkitkeymessage"}],MediaPlayer.models.ProtectionModel_01b.detect=function(e){for(var t=MediaPlayer.models.ProtectionModel_01b.APIs,a=0;a<t.length;a++){var i=t[a];if("function"==typeof e[i.generateKeyRequest]&&"function"==typeof e[i.addKey]&&"function"==typeof e[i.cancelKeyRequest])return i}return null},MediaPlayer.models.ProtectionModel_21Jan2015=function(){function r(e){var t=e.session;return t.removeEventListener("keystatuseschange",e),t.removeEventListener("message",e),t.close()}function s(e){for(var t=0;t<u.length;t++)if(u[t]===e){u.splice(t,1);break}}function o(e,t,a){var i=this,n={session:e,initData:t,handleEvent:function(e){switch(e.type){case"keystatuseschange":i.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_STATUSES_CHANGED,this);break;case"message":var t=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;i.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,new MediaPlayer.vo.protection.KeyMessage(this,t,void 0,e.messageType))}},getSessionID:function(){return this.session.sessionId},getExpirationTime:function(){return this.session.expiration},getKeyStatuses:function(){return this.session.keyStatuses},getSessionType:function(){return a}};return e.addEventListener("keystatuseschange",n),e.addEventListener("message",n),e.closed.then(function(){s(n),i.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,n.getSessionID())}),u.push(n),n}var l=null,d=null,u=[],c=function(e,t){var a,i,n=this;i=e[a=t].ks,t=e[a].configs,navigator.requestMediaKeySystemAccess(i.systemString,t).then(function(e){var t="function"==typeof e.getConfiguration?e.getConfiguration():null,t=new MediaPlayer.vo.protection.KeySystemAccess(i,t);t.mksa=e,n.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,t)}).catch(function(){++a<e.length?c.call(n,e,a):n.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,null,"Key system access denied!")})},h=null;return{system:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,protectionExt:void 0,keySystem:null,setup:function(){h=function(){var a=this;return{handleEvent:function(e){var t;"encrypted"===e.type&&e.initData&&(t=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData,a.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY,new MediaPlayer.vo.protection.NeedKey(t,e.initDataType)))}}}.call(this)},init:function(){},teardown:function(){var t,e=u.length,a=this;if(0!==e){function i(e){s(e),0===u.length&&(l?(l.removeEventListener("encrypted",h),l.setMediaKeys(null).then(function(){a.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE)})):a.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE))}for(var n=0;n<e;n++)(function(e){t.session.closed.then(function(){i(e)}),r(t).catch(function(){i(e)})})(t=u[n])}else this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE)},getAllInitData:function(){for(var e=[],t=0;t<u.length;t++)e.push(u[t].initData);return e},requestKeySystemAccess:function(e){c.call(this,e,0)},selectKeySystem:function(t){var a=this;t.mksa.createMediaKeys().then(function(e){a.keySystem=t.keySystem,d=e,l&&l.setMediaKeys(d),a.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED)}).catch(function(){a.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED,null,"Error selecting keys system ("+t.keySystem.systemString+")! Could not create MediaKeys -- TODO")})},setMediaElement:function(e){l!==e&&(l&&(l.removeEventListener("encrypted",h),l.setMediaKeys(null)),(l=e)&&(l.addEventListener("encrypted",h),d&&l.setMediaKeys(d)))},setServerCertificate:function(e){if(!this.keySystem||!d)throw new Error("Can not set server certificate until you have selected a key system");var t=this;d.setServerCertificate(e).then(function(){t.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED)}).catch(function(e){t.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED,null,"Error updating server certificate -- "+e.name)})},createKeySession:function(e,t){if(!this.keySystem||!d)throw new Error("Can not create sessions until you have selected a key system");var a=d.createSession(t),i=o.call(this,a,e,t),n=this;a.generateRequest("cenc",e).then(function(){n.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,i)}).catch(function(e){s(i),n.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,null,"Error generating key request -- "+e.name)})},updateKeySession:function(t,e){var a=t.session,i=this;this.protectionExt.isClearKey(this.keySystem)&&(e=e.toJWK()),a.update(e).catch(function(e){i.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR,new MediaPlayer.vo.protection.KeyError(t,"Error sending update() message! "+e.name))})},loadKeySession:function(t){if(!this.keySystem||!d)throw new Error("Can not load sessions until you have selected a key system");var a=d.createSession(),i=this;a.load(t).then(function(e){e?(e=o.call(this,a),i.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,e)):i.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,null,"Could not load session! Invalid Session ID ("+t+")")}).catch(function(e){i.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,null,"Could not load session ("+t+")! "+e.name)})},removeKeySession:function(t){var e=t.session,a=this;e.remove().then(function(){a.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED,t.getSessionID())},function(e){a.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED,null,"Error removing session ("+t.getSessionID()+"). "+e.name)})},closeKeySession:function(t){var a=this;r(t).catch(function(e){s(t),a.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,null,"Error closing session ("+t.getSessionID()+") "+e.name)})}}},MediaPlayer.models.ProtectionModel_21Jan2015.detect=function(e){return void 0!==e.onencrypted&&void 0!==e.mediaKeys&&(void 0!==navigator.requestMediaKeySystemAccess&&"function"==typeof navigator.requestMediaKeySystemAccess)},MediaPlayer.models.ProtectionModel_21Jan2015.prototype={constructor:MediaPlayer.models.ProtectionModel_21Jan2015},MediaPlayer.models.ProtectionModel_3Feb2014=function(){function t(){function e(){a.removeEventListener("loadedmetadata",t),a[p.setMediaKeys](i),this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_VIDEO_ELEMENT_SELECTED)}var t=null;1<=a.readyState?e.call(this):(t=e.bind(this),a.addEventListener("loadedmetadata",t))}var a=null,i=null,n=null,p=null,r=[],s=null;return{system:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,protectionExt:void 0,keySystem:null,setup:function(){s=function(){var t=this;return{handleEvent:function(e){e.type===p.needkey&&e.initData&&(e=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData,t.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY,new MediaPlayer.vo.protection.NeedKey(e,"cenc")))}}}.call(this)},init:function(){var e=document.createElement("video");p=MediaPlayer.models.ProtectionModel_3Feb2014.detect(e)},teardown:function(){try{for(var e=0;e<r.length;e++)this.closeKeySession(r[e]);a&&a.removeEventListener(p.needkey,s),this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE)}catch(e){this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE,null,"Error tearing down key sessions and MediaKeys! -- "+e.message)}},getAllInitData:function(){for(var e=[],t=0;t<r.length;t++)e.push(r[t].initData);return e},requestKeySystemAccess:function(e){for(var t=!1,a=0;a<e.length;a++)for(var i=e[a].ks.systemString,n=e[a].configs,r=null,s=null,o=0;o<n.length;o++){var l=n[o].audioCapabilities,d=n[o].videoCapabilities;if(l&&0!==l.length)for(var r=[],u=0;u<l.length;u++)window[p.MediaKeys].isTypeSupported(i,l[u].contentType)&&r.push(l[u]);if(d&&0!==d.length)for(var s=[],c=0;c<d.length;c++)window[p.MediaKeys].isTypeSupported(i,d[c].contentType)&&s.push(d[c]);if(!(!r&&!s||r&&0===r.length||s&&0===s.length)){var t=!0,h=new MediaPlayer.vo.protection.KeySystemConfiguration(r,s),f=this.protectionExt.getKeySystemBySystemString(i),h=new MediaPlayer.vo.protection.KeySystemAccess(f,h);this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,h);break}}t||this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,null,"Key system access denied! -- No valid audio/video content configurations detected!")},selectKeySystem:function(e){try{i=e.mediaKeys=new window[p.MediaKeys](e.keySystem.systemString),this.keySystem=e.keySystem,n=e,a&&t.call(this),this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED)}catch(e){this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED,null,"Error selecting keys system ("+this.keySystem.systemString+")! Could not create MediaKeys -- TODO")}},setMediaElement:function(e){a!==e&&(a&&a.removeEventListener(p.needkey,s),(a=e)&&(a.addEventListener(p.needkey,s),i&&t.call(this)))},createKeySession:function(e){if(!this.keySystem||!i||!n)throw new Error("Can not create sessions until you have selected a key system");var t=n.ksConfiguration.videoCapabilities[0].contentType,t=i.createSession(t,new Uint8Array(e)),e=function(e,t){var a=this;return{session:e,initData:t,handleEvent:function(e){switch(e.type){case p.error:a.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR,new MediaPlayer.vo.protection.KeyError(this,"KeyError"));break;case p.message:var t=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;a.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,new MediaPlayer.vo.protection.KeyMessage(this,t,e.destinationURL));break;case p.ready:a.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ADDED,this);break;case p.close:a.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,this.getSessionID())}},getSessionID:function(){return this.session.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"}}}.call(this,t,e);t.addEventListener(p.error,e),t.addEventListener(p.message,e),t.addEventListener(p.ready,e),t.addEventListener(p.close,e),r.push(e),this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,e)},updateKeySession:function(e,t){e=e.session;this.protectionExt.isClearKey(this.keySystem)?e.update(new Uint8Array(t.toJWK())):e.update(new Uint8Array(t))},closeKeySession:function(e){var t=e.session;t.removeEventListener(p.error,e),t.removeEventListener(p.message,e),t.removeEventListener(p.ready,e),t.removeEventListener(p.close,e);for(var a=0;a<r.length;a++)if(r[a]===e){r.splice(a,1);break}t[p.release]()},setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){}}},MediaPlayer.models.ProtectionModel_3Feb2014.APIs=[{setMediaKeys:"setMediaKeys",MediaKeys:"MediaKeys",release:"close",needkey:"needkey",error:"keyerror",message:"keymessage",ready:"keyadded",close:"keyclose"},{setMediaKeys:"msSetMediaKeys",MediaKeys:"MSMediaKeys",release:"close",needkey:"msneedkey",error:"mskeyerror",message:"mskeymessage",ready:"mskeyadded",close:"mskeyclose"}],MediaPlayer.models.ProtectionModel_3Feb2014.detect=function(e){for(var t=MediaPlayer.models.ProtectionModel_3Feb2014.APIs,a=0;a<t.length;a++){var i=t[a];if("function"==typeof e[i.setMediaKeys]&&"function"==typeof window[i.MediaKeys])return i}return null},MediaPlayer.models.ProtectionModel_3Feb2014.prototype={constructor:MediaPlayer.models.ProtectionModel_3Feb2014},MediaPlayer.models.URIQueryAndFragmentModel=function(){"use strict";var o=new MediaPlayer.vo.URIFragmentData,l=[];return{parseURI:function(e){function t(e,t,a,i){var n=i[0].split(/[=]/);return i.push({key:n[0],value:n[1]}),i.shift(),i}if(!e)return null;var i=[],a=new RegExp(/[?]/),n=new RegExp(/[#]/),r=a.test(e),s=n.test(e);e.split(/[?#]/).map(function(e,t,a){return 0<t&&(r&&0===l.length?l=a[t].split(/[&]/):s&&(i=a[t].split(/[&]/))),a});return 0<l.length&&(l=l.reduce(t,null)),0<i.length&&(i=i.reduce(t,null)).forEach(function(e){o[e.key]=e.value}),e},getURIFragmentData:function(){return o},getURIQueryData:function(){return l},reset:function(){o=new MediaPlayer.vo.URIFragmentData,l=[]}}},MediaPlayer.models.URIQueryAndFragmentModel.prototype={constructor:MediaPlayer.models.URIQueryAndFragmentModel},MediaPlayer.models.VideoModel=function(){"use strict";function a(e){null!==e&&(r[e]=!1,-1!==(e=r.indexOf(e))&&r.splice(e,1),0<r.length==!1&&this.setPlaybackRate(1))}function i(e,t){(t?function(e){null===e||n.seeking||(this.setPlaybackRate(0),!0!==r[e]&&(r.push(e),r[e]=!0))}:a).call(this,e)}var n,t,r=[];return{system:void 0,play:function(){n.play()},pause:function(){n.pause()},isPaused:function(){return n.paused},getPlaybackRate:function(){return n.playbackRate},setPlaybackRate:function(e){!n||n.readyState<2||(n.playbackRate=e)},getCurrentTime:function(){return n.currentTime},setCurrentTime:function(t){if(n.currentTime!=t)try{n.currentTime=t}catch(e){0===n.readyState&&e.code===e.INVALID_STATE_ERR&&setTimeout(function(){n.currentTime=t},400)}},setStallState:function(e,t){i.call(this,e,t)},listen:function(e,t){n.addEventListener(e,t,!1)},unlisten:function(e,t){n.removeEventListener(e,t,!1)},getElement:function(){return n},setElement:function(e){n=e},getTTMLRenderingDiv:function(){return t},setTTMLRenderingDiv:function(e){(t=e).style.position="absolute",t.style.display="flex",t.style.overflow="hidden",t.style.zIndex=2147483647,t.style.pointerEvents="none",t.style.top=0,t.style.left=0},setSource:function(e){n.src=e}}},MediaPlayer.models.VideoModel.prototype={constructor:MediaPlayer.models.VideoModel},MediaPlayer.dependencies.protection.CommonEncryption={findCencContentProtection:function(e){for(var t=null,a=0;a<e.length;++a){var i=e[a];"urn:mpeg:dash:mp4protection:2011"===i.schemeIdUri.toLowerCase()&&"cenc"===i.value.toLowerCase()&&(t=i)}return t},getPSSHData:function(e){var t=8,a=new DataView(e),i=a.getUint8(t);return t+=20,0<i&&(t+=4+16*a.getUint32(t)),e.slice(t+=4)},getPSSHForKeySystem:function(e,t){t=MediaPlayer.dependencies.protection.CommonEncryption.parsePSSHList(t);return t.hasOwnProperty(e.uuid.toLowerCase())?t[e.uuid.toLowerCase()]:null},parseInitDataFromContentProtection:function(e){return"pssh"in e?BASE64.decodeArray(e.pssh.__text).buffer:null},parsePSSHList:function(e){if(null===e)return[];for(var t=new DataView(e),a={},i=0;;){var n,r,s,o,l,d=i;if(i>=t.buffer.byteLength)break;if(n=i+t.getUint32(i),i+=4,1886614376===t.getUint32(i))if(i+=4,0===(r=t.getUint8(i))||1===r){for(i+=1,i+=3,s="",o=0;o<4;o++)s+=1===(l=t.getUint8(i+o).toString(16)).length?"0"+l:l;for(i+=4,s+="-",o=0;o<2;o++)s+=1===(l=t.getUint8(i+o).toString(16)).length?"0"+l:l;for(i+=2,s+="-",o=0;o<2;o++)s+=1===(l=t.getUint8(i+o).toString(16)).length?"0"+l:l;for(i+=2,s+="-",o=0;o<2;o++)s+=1===(l=t.getUint8(i+o).toString(16)).length?"0"+l:l;for(i+=2,s+="-",o=0;o<6;o++)s+=1===(l=t.getUint8(i+o).toString(16)).length?"0"+l:l;i+=6,s=s.toLowerCase(),t.getUint32(i),i+=4,a[s]=t.buffer.slice(d,n),i=n}else i=n;else i=n}return a}},MediaPlayer.dependencies.protection.KeySystem=function(){},MediaPlayer.dependencies.protection.KeySystem_Access=function(){},MediaPlayer.dependencies.protection.KeySystem_Access.prototype={constructor:MediaPlayer.dependencies.protection.KeySystem_Access},MediaPlayer.dependencies.protection.KeySystem_ClearKey=function(){"use strict";var e="1077efec-c0b2-4d02-ace3-3c1e52e2fb4b";return{system:void 0,schemeIdURI:"urn:uuid:"+e,systemString:"org.w3.clearkey",uuid:e,getInitData:MediaPlayer.dependencies.protection.CommonEncryption.parseInitDataFromContentProtection,getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null}}},MediaPlayer.dependencies.protection.KeySystem_ClearKey.prototype={constructor:MediaPlayer.dependencies.protection.KeySystem_ClearKey},MediaPlayer.dependencies.protection.KeySystem_ClearKey.getClearKeysFromProtectionData=function(e,t){var a=null;if(e){for(var i=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),n=[],r=0;r<i.kids.length;r++){var s=i.kids[r],o=e.clearkeys.hasOwnProperty(s)?e.clearkeys[s]:null;if(!o)throw new Error("DRM: ClearKey keyID ("+s+") is not known!");n.push(new MediaPlayer.vo.protection.KeyPair(s,o))}a=new MediaPlayer.vo.protection.ClearKeyKeySet(n)}return a},MediaPlayer.dependencies.protection.KeySystem_PlayReady=function(){"use strict";var e="9a04f079-9840-4286-ab92-e65be0885f95",s="utf16";return{schemeIdURI:"urn:uuid:"+e,systemString:"com.microsoft.playready",uuid:e,getInitData:function(e){var t,a,i,n=0,r=new Uint8Array([112,115,115,104,0,0,0,0]),s=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),o=null;if("pssh"in e)return MediaPlayer.dependencies.protection.CommonEncryption.parseInitDataFromContentProtection(e);if("pro"in e)o=BASE64.decodeArray(e.pro.__text);else{if(!("prheader"in e))return null;o=BASE64.decodeArray(e.prheader.__text)}return t=o.length,a=4+r.length+s.length+4+t,i=new ArrayBuffer(a),e=new Uint8Array(i),(i=new DataView(i)).setUint32(0,a),n+=4,e.set(r,4),n+=r.length,e.set(s,n),n+=s.length,i.setUint32(n,t),e.set(o,n+=4),e.buffer},getRequestHeadersFromMessage:function(e){for(var t={},a=new DOMParser,e=new("utf16"===s?Uint16Array:Uint8Array)(e),e=String.fromCharCode.apply(null,e),e=a.parseFromString(e,"application/xml"),i=e.getElementsByTagName("name"),n=e.getElementsByTagName("value"),r=0;r<i.length;r++)t[i[r].childNodes[0].nodeValue]=n[r].childNodes[0].nodeValue;return t.hasOwnProperty("Content")&&(t["Content-Type"]=t.Content,delete t.Content),t},getLicenseRequestFromMessage:function(e){var t,a=new DOMParser,i=null,e=new("utf16"===s?Uint16Array:Uint8Array)(e),e=String.fromCharCode.apply(null,e);return i=(e=a.parseFromString(e,"application/xml")).getElementsByTagName("Challenge")[0]&&(t=e.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue)?BASE64.decode(t):i},getLicenseServerURLFromInitData:function(e){if(e)for(var t=new DataView(e),a=t.getUint16(4,!0),i=6,n=new DOMParser,r=0;r<a;r++){var s=t.getUint16(i,!0);i+=2;var o=t.getUint16(i,!0);if(i+=2,1===s){var l=e.slice(i,i+o),s=String.fromCharCode.apply(null,new Uint16Array(l)),l=n.parseFromString(s,"application/xml");if(l.getElementsByTagName("LA_URL")[0]){s=l.getElementsByTagName("LA_URL")[0].childNodes[0].nodeValue;if(s)return s}if(l.getElementsByTagName("LUI_URL")[0]){l=l.getElementsByTagName("LUI_URL")[0].childNodes[0].nodeValue;if(l)return l}}else i+=o}return null},setPlayReadyMessageFormat:function(e){if("utf8"!==e&&"utf16"!==e)throw new Error("Illegal PlayReady message format! -- "+e);s=e}}},MediaPlayer.dependencies.protection.KeySystem_PlayReady.prototype={constructor:MediaPlayer.dependencies.protection.KeySystem_PlayReady},MediaPlayer.dependencies.protection.KeySystem_Widevine=function(){"use strict";var e="edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";return{schemeIdURI:"urn:uuid:"+e,systemString:"com.widevine.alpha",uuid:e,getInitData:MediaPlayer.dependencies.protection.CommonEncryption.parseInitDataFromContentProtection,getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null}}},MediaPlayer.dependencies.protection.KeySystem_Widevine.prototype={constructor:MediaPlayer.dependencies.protection.KeySystem_Widevine},MediaPlayer.dependencies.protection.servers.ClearKey=function(){"use strict";return{getServerURLFromMessage:function(e,t){var a=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t)));e+="/?";for(var i=0;i<a.kids.length;i++)e+=a.kids[i]+"&";return e.substring(0,e.length-1)},getHTTPMethod:function(){return"GET"},getResponseType:function(){return"json"},getLicenseMessage:function(e){if(!e.hasOwnProperty("keys"))return null;for(var t=[],a=0;a<e.keys.length;a++){var i=e.keys[a],n=i.kid.replace(/=/g,""),i=i.k.replace(/=/g,"");t.push(new MediaPlayer.vo.protection.KeyPair(n,i))}return new MediaPlayer.vo.protection.ClearKeyKeySet(t)},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}},MediaPlayer.dependencies.protection.servers.ClearKey.prototype={constructor:MediaPlayer.dependencies.protection.servers.ClearKey},MediaPlayer.dependencies.protection.servers.DRMToday=function(){"use strict";var a={"com.widevine.alpha":{responseType:"json",getLicenseMessage:function(e){return BASE64.decodeArray(e.license)},getErrorResponse:function(e){return e}},"com.microsoft.playready":{responseType:"arraybuffer",getLicenseMessage:function(e){return e},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}};return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(e){return a[e].responseType},getLicenseMessage:function(e,t){return a[t].getLicenseMessage(e)},getErrorResponse:function(e,t){return a[t].getErrorResponse(e)}}},MediaPlayer.dependencies.protection.servers.DRMToday.prototype={constructor:MediaPlayer.dependencies.protection.servers.DRMToday},MediaPlayer.dependencies.protection.servers.LicenseServer=function(){},MediaPlayer.dependencies.protection.servers.PlayReady=function(){"use strict";return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(e){return e},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}},MediaPlayer.dependencies.protection.servers.PlayReady.prototype={constructor:MediaPlayer.dependencies.protection.servers.PlayReady},MediaPlayer.dependencies.protection.servers.Widevine=function(){"use strict";return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(e){return e},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}},MediaPlayer.dependencies.protection.servers.Widevine.prototype={constructor:MediaPlayer.dependencies.protection.servers.Widevine},MediaPlayer.rules.ABRRulesCollection=function(){"use strict";var t=[],a=[];return{insufficientBufferRule:void 0,bufferOccupancyRule:void 0,throughputRule:void 0,abandonRequestRule:void 0,getRules:function(e){switch(e){case MediaPlayer.rules.ABRRulesCollection.prototype.QUALITY_SWITCH_RULES:return t;case MediaPlayer.rules.ABRRulesCollection.prototype.ABANDON_FRAGMENT_RULES:return a;default:return null}},setup:function(){t.push(this.insufficientBufferRule),t.push(this.throughputRule),t.push(this.bufferOccupancyRule),a.push(this.abandonRequestRule)}}},MediaPlayer.rules.ABRRulesCollection.prototype={constructor:MediaPlayer.rules.ABRRulesCollection,QUALITY_SWITCH_RULES:"qualitySwitchRules",ABANDON_FRAGMENT_RULES:"abandonFragmentRules"},MediaPlayer.rules.AbandonRequestsRule=function(){"use strict";var u={},c={};return{metricsExt:void 0,log:void 0,execute:function(e,t){var a=(new Date).getTime(),i=e.getMediaInfo(),n=i.type,r=e.getCurrentValue(),s=e.getTrackInfo(),o=r.data.request,l=e.getStreamProcessor().getABRController(),d=new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,MediaPlayer.rules.SwitchRequest.prototype.WEAK);if(!isNaN(o.index)){if(r=n,e=o.index,u[r]=u[r]||{},u[r][e]=u[r][e]||{},null===(e=u[n][o.index])||null===o.firstByteDate||c.hasOwnProperty(e.id))return void t(d);if(void 0===e.firstByteTime&&(e.firstByteTime=o.firstByteDate.getTime(),e.segmentDuration=o.duration,e.bytesTotal=o.bytesTotal,e.id=o.index),e.bytesLoaded=o.bytesLoaded,e.elapsedTime=a-e.firstByteTime,e.bytesLoaded<e.bytesTotal&&500<=e.elapsedTime){if(e.measuredBandwidthInKbps=Math.round(8*e.bytesLoaded/e.elapsedTime),e.estimatedTimeOfDownload=(8*e.bytesTotal*.001/e.measuredBandwidthInKbps).toFixed(2),e.estimatedTimeOfDownload<1.5*e.segmentDuration||0===s.quality)return void t(d);c.hasOwnProperty(e.id)||(i=l.getQualityForBitrate(i,e.measuredBandwidthInKbps*MediaPlayer.dependencies.AbrController.BANDWIDTH_SAFETY),d=new MediaPlayer.rules.SwitchRequest(i,MediaPlayer.rules.SwitchRequest.prototype.STRONG),c[e.id]=e,this.log("AbandonRequestsRule ( ",n,"frag id",e.id,") is asking to abandon and switch to quality to ",i," measured bandwidth was",e.measuredBandwidthInKbps),delete u[n][e.id])}else e.bytesLoaded===e.bytesTotal&&delete u[n][e.id]}t(d)},reset:function(){u={},c={}}}},MediaPlayer.rules.AbandonRequestsRule.prototype={constructor:MediaPlayer.rules.AbandonRequestsRule},MediaPlayer.rules.BufferOccupancyRule=function(){"use strict";var c=0;return{log:void 0,metricsModel:void 0,execute:function(e,t){var a=(new Date).getTime()/1e3,i=e.getMediaInfo(),n=e.getTrackInfo(),r=i.type,s=isNaN(n.fragmentDuration)?2:n.fragmentDuration/2,o=e.getCurrentValue(),l=e.getStreamProcessor().getABRController(),d=this.metricsModel.getReadOnlyMetricsFor(r),u=0<d.BufferLevel.length?d.BufferLevel[d.BufferLevel.length-1]:null,n=0<d.BufferState.length?d.BufferState[d.BufferState.length-1]:null,e=i.representationCount-1,d=new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,MediaPlayer.rules.SwitchRequest.prototype.WEAK);a-c<s||l.getAbandonmentStateFor(r)===MediaPlayer.dependencies.AbrController.ABANDON_LOAD||(null!==u&&null!==n&&u.level>n.target&&(u.level-n.target>MediaPlayer.dependencies.BufferController.RICH_BUFFER_THRESHOLD&&1<i.representationCount&&(d=new MediaPlayer.rules.SwitchRequest(e,MediaPlayer.rules.SwitchRequest.prototype.STRONG))),d.value!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&d.value!==o&&this.log("BufferOccupancyRule requesting switch to index: ",d.value,"type: ",r," Priority: ",d.priority===MediaPlayer.rules.SwitchRequest.prototype.DEFAULT?"Default":d.priority===MediaPlayer.rules.SwitchRequest.prototype.STRONG?"Strong":"Weak")),t(d)},reset:function(){c=0}}},MediaPlayer.rules.BufferOccupancyRule.prototype={constructor:MediaPlayer.rules.BufferOccupancyRule},MediaPlayer.rules.InsufficientBufferRule=function(){"use strict";function e(){l={}}var l={},d=0;return{log:void 0,metricsModel:void 0,playbackController:void 0,setup:function(){this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING]=e},execute:function(e,t){var a=(new Date).getTime(),i=e.getMediaInfo().type,n=e.getCurrentValue(),r=this.metricsModel.getReadOnlyMetricsFor(i),s=0<r.BufferState.length?r.BufferState[r.BufferState.length-1]:null,o=new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,MediaPlayer.rules.SwitchRequest.prototype.WEAK);a-d<1e3||null===s||(e=i,r=s.state,l[e]=l[e]||{},(l[e].state=r)!==MediaPlayer.dependencies.BufferController.BUFFER_LOADED||l[e].firstBufferLoadedEvent||(l[e].firstBufferLoadedEvent=!0),(o=s.state===MediaPlayer.dependencies.BufferController.BUFFER_EMPTY&&void 0!==l[i].firstBufferLoadedEvent?new MediaPlayer.rules.SwitchRequest(0,MediaPlayer.rules.SwitchRequest.prototype.STRONG):o).value!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&o.value!==n&&this.log("InsufficientBufferRule requesting switch to index: ",o.value,"type: ",i," Priority: ",o.priority===MediaPlayer.rules.SwitchRequest.prototype.DEFAULT?"Default":o.priority===MediaPlayer.rules.SwitchRequest.prototype.STRONG?"Strong":"Weak"),d=a),t(o)},reset:function(){l={},d=0}}},MediaPlayer.rules.InsufficientBufferRule.prototype={constructor:MediaPlayer.rules.InsufficientBufferRule},MediaPlayer.rules.ThroughputRule=function(){"use strict";var p=[],g=0;return{log:void 0,metricsExt:void 0,metricsModel:void 0,manifestExt:void 0,manifestModel:void 0,execute:function(e,t){var a,i=(new Date).getTime()/1e3,n=e.getMediaInfo(),r=n.type,s=e.getCurrentValue(),o=e.getTrackInfo(),l=this.metricsModel.getReadOnlyMetricsFor(r),d=e.getStreamProcessor(),u=d.getABRController(),c=d.isDynamic(),h=this.metricsExt.getCurrentHttpRequest(l),f=isNaN(o.fragmentDuration)?2:o.fragmentDuration/2,e=0<l.BufferState.length?l.BufferState[l.BufferState.length-1]:null,d=0<l.BufferLevel.length?l.BufferLevel[l.BufferLevel.length-1]:null,o=new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,MediaPlayer.rules.SwitchRequest.prototype.WEAK);i-g<f||!l||null===h||h.type!==MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE||null===e||null===d||(l=(h.tfinish.getTime()-h.tresponse.getTime())/1e3,h.trace.length&&(l=Math.round(8*h.trace[h.trace.length-1].b/l),a=l,p[l=r]=p[l]||[],a!==1/0&&a!==p[l][p[l].length-1]&&p[l].push(a)),a=Math.round(function(e,t){var a=0,i=p[e],n=i.length,t=n<(t=t?2:3)?n:t;if(0<n){for(var r=0,s=n-t;s<n;s++)r+=i[s];a=r/t}return i.length>t&&i.shift(),a*MediaPlayer.dependencies.AbrController.BANDWIDTH_SAFETY/1e3}(r,c)),u.setAverageThroughput(r,a),u.getAbandonmentStateFor(r)!==MediaPlayer.dependencies.AbrController.ABANDON_LOAD&&(e.state===MediaPlayer.dependencies.BufferController.BUFFER_LOADED&&(d.level>=2*MediaPlayer.dependencies.BufferController.LOW_BUFFER_THRESHOLD||c)&&(n=u.getQualityForBitrate(n,a),o=new MediaPlayer.rules.SwitchRequest(n,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT)),o.value!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&o.value!==s&&this.log("ThroughputRule requesting switch to index: ",o.value,"type: ",r," Priority: ",o.priority===MediaPlayer.rules.SwitchRequest.prototype.DEFAULT?"Default":o.priority===MediaPlayer.rules.SwitchRequest.prototype.STRONG?"Strong":"Weak","Average throughput",Math.round(a),"kbps"))),t(o)},reset:function(){p=[],g=0}}},MediaPlayer.rules.ThroughputRule.prototype={constructor:MediaPlayer.rules.ThroughputRule},MediaPlayer.rules.RulesContext=function(e,t){"use strict";var a=e.getCurrentRepresentationInfo(),i=e;return{getStreamInfo:function(){return a.mediaInfo.streamInfo},getMediaInfo:function(){return a.mediaInfo},getTrackInfo:function(){return a},getCurrentValue:function(){return t},getManifestInfo:function(){return a.mediaInfo.streamInfo.manifestInfo},getStreamProcessor:function(){return i}}},MediaPlayer.rules.RulesContext.prototype={constructor:MediaPlayer.rules.RulesContext},MediaPlayer.rules.RulesController=function(){"use strict";function a(e){return e===this.SCHEDULING_RULE||e===this.ABR_RULE}function h(e){for(var t=n.length,a=0;a<t;a+=1)if(!e.hasOwnProperty(n[a]))return!1;return!0}function d(a){var i=a.execute.bind(a);return a.execute=function(e,t){i(e,function(e){t.call(a,new MediaPlayer.rules.SwitchRequest(e.value,e.priority))})},"function"!=typeof a.reset&&(a.reset=function(){}),a}function i(e,t,a){var i,n,r,s,o,l;for(n in t)if(s=t[n],o=s.length)for(l=0;l<o;l+=1)i=s[l],h.call(this,i)&&(i=d.call(this,i),r=e.getRules(n),a&&(a=!1,r.length=0),this.system.injectInto(i),r.push(i))}var o={},n=["execute"];return{system:void 0,log:void 0,SCHEDULING_RULE:0,ABR_RULE:1,SYNC_RULE:2,initialize:function(){o[this.ABR_RULE]=this.system.getObject("abrRulesCollection"),o[this.SCHEDULING_RULE]=this.system.getObject("scheduleRulesCollection"),o[this.SYNC_RULE]=this.system.getObject("synchronizationRulesCollection")},setRules:function(e,t){a.call(this,e)&&t&&i.call(this,o[e],t,!0)},addRules:function(e,t){a.call(this,e)&&t&&i.call(this,o[e],t,!1)},applyRules:function(e,t,i,n,r){function a(e){var t,a;e.value!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(u[e.priority]=r(u[e.priority],e.value)),--l||(u[MediaPlayer.rules.SwitchRequest.prototype.WEAK]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(a=MediaPlayer.rules.SwitchRequest.prototype.WEAK,t=u[MediaPlayer.rules.SwitchRequest.prototype.WEAK]),u[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(a=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,t=u[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]),u[MediaPlayer.rules.SwitchRequest.prototype.STRONG]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(a=MediaPlayer.rules.SwitchRequest.prototype.STRONG,t=u[MediaPlayer.rules.SwitchRequest.prototype.STRONG]),a!=MediaPlayer.rules.SwitchRequest.prototype.STRONG&&a!=MediaPlayer.rules.SwitchRequest.prototype.WEAK&&(a=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT),i({value:void 0!==t?t:n,confidence:a}))}var s,o,l=e.length,d=l,u={},c=function(e,t){return new MediaPlayer.rules.RulesContext(e,t)}.call(this,t,n);for(u[MediaPlayer.rules.SwitchRequest.prototype.STRONG]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,u[MediaPlayer.rules.SwitchRequest.prototype.WEAK]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,u[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,o=0;o<d;o+=1)s=e[o],h.call(this,s)?s.execute(c,a):l--},reset:function(){for(var e,t=o[this.ABR_RULE],a=o[this.SCHEDULING_RULE],i=o[this.SYNC_RULE],n=(t.getRules(MediaPlayer.rules.ABRRulesCollection.prototype.QUALITY_SWITCH_RULES)||[]).concat(a.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.NEXT_FRAGMENT_RULES)||[]).concat(a.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_SCHEDULE_RULES)||[]).concat(a.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_EXECUTE_RULES)||[]).concat(i.getRules(MediaPlayer.rules.SynchronizationRulesCollection.prototype.TIME_SYNCHRONIZED_RULES)||[]).concat(i.getRules(MediaPlayer.rules.SynchronizationRulesCollection.prototype.BEST_GUESS_RULES)||[]),r=n.length,s=0;s<r;s+=1)"function"==typeof(e=n[s]).reset&&e.reset();o={}}}},MediaPlayer.rules.RulesController.prototype={constructor:MediaPlayer.rules.RulesController},MediaPlayer.rules.BufferLevelRule=function(){"use strict";function u(e){return null!==(e=this.metricsExt.getCurrentHttpRequest(e))?(e.tresponse.getTime()-e.trequest.getTime())/1e3:0}function c(e,t,a){var i=a.bufferController.getCriticalBufferLevel(),n=this.metricsModel.getReadOnlyMetricsFor("video"),r=this.metricsModel.getReadOnlyMetricsFor("audio"),s=function(e,t,a){return a?this.playbackController.getLiveDelay():isNaN(t)||MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME<t&&e<t?Math.max(MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME,e):t<=e?Math.min(t,MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME):Math.min(t,e)}.call(this,a.bufferController.getMinBufferTime(),t,e),o=s,l=a.bufferController.bufferMax,d=0;return l===MediaPlayer.dependencies.BufferController.BUFFER_SIZE_MIN?d=s:l===MediaPlayer.dependencies.BufferController.BUFFER_SIZE_INFINITY?d=t:l===MediaPlayer.dependencies.BufferController.BUFFER_SIZE_REQUIRED&&(d=(o=!e&&this.abrController.isPlayingAtTopQuality(a.streamProcessor.getStreamInfo())?MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY:o)+Math.max(u.call(this,n),u.call(this,r))),Math.min(d,i)}function e(e){var t=e.data.fragmentModel.getContext().streamProcessor.getStreamInfo().id;f[t]=f[t]||{},f[t][e.data.request.mediaType]=!0}function t(e){var t=e.sender.streamProcessor.getStreamInfo().id;h[t]=h[t]||{},h[t][e.sender.streamProcessor.getType()]=!0}function a(e){var t=e.sender.streamProcessor.getStreamInfo().id;h[t]=h[t]||{},h[t][e.sender.streamProcessor.getType()]=!1}var h={},f={},p={};return{metricsExt:void 0,metricsModel:void 0,abrController:void 0,playbackController:void 0,mediaController:void 0,virtualBuffer:void 0,setup:function(){this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN]=t,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED]=a,this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED]=e},setScheduleController:function(e){var t=e.streamProcessor.getStreamInfo().id;p[t]=p[t]||{},p[t][e.streamProcessor.getType()]=e},execute:function(e,t){var a,i,n,r,s=e.getStreamInfo(),o=s.id,l=e.getMediaInfo(),d=l.type;a=d,h[n=o]&&h[n][a]?t(new MediaPlayer.rules.SwitchRequest(0,MediaPlayer.rules.SwitchRequest.prototype.STRONG)):(i=this.metricsModel.getReadOnlyMetricsFor(d),r=this.mediaController.getSwitchMode(),e=this.metricsExt.getCurrentBufferLevel(i)?this.metricsExt.getCurrentBufferLevel(i).level:0,n=this.playbackController.getTime(),l=(a=this.virtualBuffer.getChunks({streamId:o,mediaType:d,appended:!0,mediaInfo:l,forRange:{start:n,end:n+e}}))&&0<a.length?a[a.length-1].bufferedRange.end-n:null,a=r===MediaPlayer.dependencies.MediaController.trackSwitchModes.NEVER_REPLACE?e:l||0,e=(r=p[o][d]).streamProcessor.getCurrentRepresentationInfo(),l=r.streamProcessor.isDynamic(),i=this.metricsExt.getCurrentPlaybackRate(i),s=s.manifestInfo.duration,i=a/Math.max(i,1),e=e.fragmentDuration,n=l?Number.POSITIVE_INFINITY:s-n,r=Math.min(c.call(this,l,s,r),n),r=Math.max(r-i,0),e=Math.ceil(r/e),n<=i&&(d=d,!f[o=o]||!f[o][d])&&(e=e||1),t(new MediaPlayer.rules.SwitchRequest(e,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT)))},reset:function(){h={},f={},p={}}}},MediaPlayer.rules.BufferLevelRule.prototype={constructor:MediaPlayer.rules.BufferLevelRule},MediaPlayer.rules.PendingRequestsRule=function(){"use strict";var r={};return{metricsExt:void 0,setScheduleController:function(e){var t=e.streamProcessor.getStreamInfo().id;r[t]=r[t]||{},r[t][e.streamProcessor.getType()]=e},execute:function(e,t){var a=e.getMediaInfo().type,i=e.getStreamInfo().id,n=e.getCurrentValue(),e=r[i][a].getFragmentModel(),i=e.getRequests({state:[MediaPlayer.dependencies.FragmentModel.states.PENDING,MediaPlayer.dependencies.FragmentModel.states.LOADING]}),a=e.getRequests({state:MediaPlayer.dependencies.FragmentModel.states.REJECTED}).length,e=i.length,i=Math.max(n-e,0);return 0<a?void t(new MediaPlayer.rules.SwitchRequest(a,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT)):3<e?void t(new MediaPlayer.rules.SwitchRequest(0,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT)):0===n?void t(new MediaPlayer.rules.SwitchRequest(i,MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE)):void t(new MediaPlayer.rules.SwitchRequest(i,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT))},reset:function(){r={}}}},MediaPlayer.rules.PendingRequestsRule.prototype={constructor:MediaPlayer.rules.PendingRequestsRule},MediaPlayer.rules.PlaybackTimeRule=function(){"use strict";function e(t){setTimeout(function(){var e=t.data.seekTime;E.audio=e,E.video=e,E.fragmentedText=e},0)}var E={},v={};return{adapter:void 0,sourceBufferExt:void 0,virtualBuffer:void 0,playbackController:void 0,textSourceBuffer:void 0,setup:function(){this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING]=e},setScheduleController:function(e){var t=e.streamProcessor.getStreamInfo().id;v[t]=v[t]||{},v[t][e.streamProcessor.getType()]=e},execute:function(e,t){var a,i=e.getMediaInfo(),n=i.type,r=e.getStreamInfo().id,s=v[r][n],o=v[r][n].streamProcessor,l=o.getCurrentRepresentationInfo(),d=E?E[n]:null,u=null!=d,c=u?MediaPlayer.rules.SwitchRequest.prototype.STRONG:MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,h=s.getFragmentModel().getRequests({state:MediaPlayer.dependencies.FragmentModel.states.REJECTED})[0],f=!!h&&!u,p=o.getIndexHandlerTime(),g=this.playbackController.getTime(),m=h?h.startTime+h.duration:null,y=!u&&h&&(g<m&&h.startTime<=p||isNaN(p)),e=o.bufferController.getBuffer(),p=u?d:y?h.startTime:p;if(!u&&!h&&p>g+MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY)t(new MediaPlayer.rules.SwitchRequest(null,c));else if(h&&s.getFragmentModel().removeRejectedRequest(h),isNaN(p)||"fragmentedText"===n&&this.textSourceBuffer.getAllTracksAreDisabled())t(new MediaPlayer.rules.SwitchRequest(null,c));else{for(u&&(E[n]=null),e&&(null!==(m=this.sourceBufferExt.getBufferRange(o.bufferController.getBuffer(),p))&&((m=this.virtualBuffer.getChunks({streamId:r,mediaType:n,appended:!0,mediaInfo:i,forRange:m}))&&0<m.length&&(p=m[m.length-1].bufferedRange.end))),a=this.adapter.getFragmentRequestForTime(o,l,p,{keepIdx:f}),y&&a&&a.index!==h.index&&(a=this.adapter.getFragmentRequestForTime(o,l,h.startTime+h.duration/2+.1,{keepIdx:f,timeThreshold:0}));a&&o.getFragmentModel().isFragmentLoadedOrPending(a);){if("complete"===a.action){a=null,o.setIndexHandlerTime(NaN);break}a=this.adapter.getNextFragmentRequest(o,l)}a&&!y&&o.setIndexHandlerTime(a.startTime+a.duration),t(new MediaPlayer.rules.SwitchRequest(a,c))}},reset:function(){E={},v={}}}},MediaPlayer.rules.PlaybackTimeRule.prototype={constructor:MediaPlayer.rules.PlaybackTimeRule},MediaPlayer.rules.SameTimeRequestRule=function(){"use strict";function v(e,t){return i[e]&&i[e][t]?i[e][t]:NaN}function e(e){var t=e.data.fragmentModel,a=e.data.request,e=t.getContext().streamProcessor.getStreamInfo().id,t=a.mediaType;i[e]=i[e]||{},i[e][t]=a.index-1}var i={},M=function(e,a){e.sort(function(e,t){return e[a]<t[a]||isNaN(e[a])&&"complete"!==e.action?-1:e[a]>t[a]?1:0})};return{playbackController:void 0,setup:function(){this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED]=e},setFragmentModels:function(e,t){this.fragmentModels=this.fragmentModels||{},this.fragmentModels[t]=e},execute:function(e,t){var a,i,n,r,s,o,l,d,u,c=e.getStreamInfo().id,e=e.getCurrentValue(),h=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,f=this.fragmentModels[c],p=new Date,g=null,m=f?f.length:null,y=!1,E=[];if(f&&m){if(l=function(e,t){for(var a,i=e.length,n=null,r=0;r<i;r+=1)(a=e[r].getRequests({state:MediaPlayer.dependencies.FragmentModel.states.PENDING,time:t})[0])&&(!n||a.startTime>n.startTime)&&(n=a);return n}(f,o=this.playbackController.getTime()),s=l||function(e,t){for(var a,i,n,r,s,o=0,l=e.length;o<l;o+=1)for(n=e[o].getRequests({state:MediaPlayer.dependencies.FragmentModel.states.PENDING}),M.call(this,n,"index"),r=0,s=n.length;r<s;r++){if(a=n[r],isNaN(a.startTime)&&"complete"!==a.action){i=a;break}a.startTime>t&&(!i||a.startTime<i.startTime)&&(i=a)}return i||a}(f,o)||e){for(r=0;r<m;r+=1)if(("video"===(a=(i=f[r]).getContext().streamProcessor.getType())||"audio"===a||"fragmentedText"===a)&&(d=i.getRequests({state:MediaPlayer.dependencies.FragmentModel.states.PENDING}),u=i.getRequests({state:MediaPlayer.dependencies.FragmentModel.states.LOADING}).length,!i.getIsPostponed()||isNaN(s.startTime))){if(u>MediaPlayer.dependencies.ScheduleController.LOADING_REQUEST_THRESHOLD)return void t(new MediaPlayer.rules.SwitchRequest([],h));if(g=g||(s===l?o:s.startTime),-1===d.indexOf(s)){if(n=!(n=i.getRequests({state:MediaPlayer.dependencies.FragmentModel.states.PENDING,time:g})[0])&&0===s.index?d.filter(function(e){return e.index===s.index})[0]:n)E.push(n);else if(!(n=i.getRequests({state:MediaPlayer.dependencies.FragmentModel.states.LOADING,time:g})[0]||i.getRequests({state:MediaPlayer.dependencies.FragmentModel.states.EXECUTED,time:g})[0])&&s.index!==v.call(this,c,s.mediaType)&&"fragmentedText"!==a){y=!0;break}}else E.push(s)}return E=E.filter(function(e){return"complete"===e.action||p.getTime()>=e.availabilityStartTime.getTime()}),y?void t(new MediaPlayer.rules.SwitchRequest([],h)):void t(new MediaPlayer.rules.SwitchRequest(E,h))}t(new MediaPlayer.rules.SwitchRequest([],h))}else t(new MediaPlayer.rules.SwitchRequest([],h))},reset:function(){i={}}}},MediaPlayer.rules.SameTimeRequestRule.prototype={constructor:MediaPlayer.rules.SameTimeRequestRule},MediaPlayer.rules.ScheduleRulesCollection=function(){"use strict";var t=[],a=[],i=[];return{bufferLevelRule:void 0,pendingRequestsRule:void 0,playbackTimeRule:void 0,sameTimeRequestRule:void 0,getRules:function(e){switch(e){case MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_SCHEDULE_RULES:return t;case MediaPlayer.rules.ScheduleRulesCollection.prototype.NEXT_FRAGMENT_RULES:return i;case MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_EXECUTE_RULES:return a;default:return null}},setup:function(){t.push(this.bufferLevelRule),t.push(this.pendingRequestsRule),i.push(this.playbackTimeRule),a.push(this.sameTimeRequestRule)}}},MediaPlayer.rules.ScheduleRulesCollection.prototype={constructor:MediaPlayer.rules.ScheduleRulesCollection,FRAGMENTS_TO_SCHEDULE_RULES:"fragmentsToScheduleRules",NEXT_FRAGMENT_RULES:"nextFragmentRules",FRAGMENTS_TO_EXECUTE_RULES:"fragmentsToExecuteRules"},MediaPlayer.rules.SwitchRequest=function(e,t){"use strict";this.value=e,this.priority=t,void 0===this.value&&(this.value=999),void 0===this.priority&&(this.priority=.5)},MediaPlayer.rules.SwitchRequest.prototype={constructor:MediaPlayer.rules.SwitchRequest,NO_CHANGE:999,DEFAULT:.5,STRONG:1,WEAK:0},MediaPlayer.rules.LiveEdgeBinarySearchRule=function(){"use strict";var n,o,l,r=NaN,s=null,d=NaN,u=null,c=!1,h=NaN,f=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,p=function(t,a,i,e){var n,r,s=this;null===e?(n=s.adapter.generateFragmentRequestForTime(l,u,t),p.call(s,t,a,i,n)):(r=function(e){o.unsubscribe(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,s,r),(e.data.exists?a:i).call(s,e.data.request,t)},o.subscribe(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,s,r),o.checkForExistence(e))},i=function(e,t){var a;return c?void m.call(this,!1,t):void((t=0<(a=t-r)?r-a:r+Math.abs(a)+d)<s.start&&t>s.end?n(new MediaPlayer.rules.SwitchRequest(null,f)):(a=this.adapter.getFragmentRequestForTime(l,u,t,{ignoreIsFinished:!0}),p.call(this,t,g,i,a)))},g=function(e,t){var a,e=e.startTime,i=this;if(!c){if(!u.fragmentDuration)return void n(new MediaPlayer.rules.SwitchRequest(e,f));if(c=!0,s.end=e+2*d,t===r)return e=i.adapter.getFragmentRequestForTime(l,u,a=t+h,{ignoreIsFinished:!0}),void p.call(i,a,function(){m.call(i,!0,a)},function(){n(new MediaPlayer.rules.SwitchRequest(a,f))},e)}m.call(this,!0,t)},m=function(e,t){e?s.start=t:s.end=t,Math.floor(s.end-s.start)<=h?n(new MediaPlayer.rules.SwitchRequest(e?t:t-h,f)):(e=(s.start+s.end)/2,t=this.adapter.getFragmentRequestForTime(l,u,e,{ignoreIsFinished:!0}),p.call(this,e,g,i,t))};return{metricsExt:void 0,adapter:void 0,timelineConverter:void 0,execute:function(e,t){if(n=t,l=e.getStreamProcessor(),o=l.getFragmentLoader(),u=e.getTrackInfo(),h=u.fragmentDuration,t=u.DVRWindow,r=t.end,u.useCalculatedLiveEdgeTime){e=this.timelineConverter.getExpectedLiveEdge();return this.timelineConverter.setExpectedLiveEdge(r),void n(new MediaPlayer.rules.SwitchRequest(e,f))}s={start:Math.max(0,r-43200),end:r+43200},d=Math.floor((t.end-t.start)/2),t=this.adapter.getFragmentRequestForTime(l,u,r,{ignoreIsFinished:!0}),p.call(this,r,g,i,t)},reset:function(){c=!1,h=d=r=NaN,o=l=u=s=null}}},MediaPlayer.rules.LiveEdgeBinarySearchRule.prototype={constructor:MediaPlayer.rules.LiveEdgeBinarySearchRule},MediaPlayer.rules.LiveEdgeWithTimeSynchronizationRule=function(){"use strict";return{timelineConverter:void 0,execute:function(e,t){var a=e.getTrackInfo(),i=a.DVRWindow.end,e=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT;a.useCalculatedLiveEdgeTime?(a=this.timelineConverter.getExpectedLiveEdge(),this.timelineConverter.setExpectedLiveEdge(i),t(new MediaPlayer.rules.SwitchRequest(a,e))):t(new MediaPlayer.rules.SwitchRequest(i,e))}}},MediaPlayer.rules.LiveEdgeWithTimeSynchronizationRule.prototype={constructor:MediaPlayer.rules.LiveEdgeWithTimeSynchronizationRule},MediaPlayer.rules.SynchronizationRulesCollection=function(){"use strict";var t=[],a=[];return{liveEdgeBinarySearchRule:void 0,liveEdgeWithTimeSynchronizationRule:void 0,getRules:function(e){switch(e){case MediaPlayer.rules.SynchronizationRulesCollection.prototype.TIME_SYNCHRONIZED_RULES:return t;case MediaPlayer.rules.SynchronizationRulesCollection.prototype.BEST_GUESS_RULES:return a;default:return null}},setup:function(){t.push(this.liveEdgeWithTimeSynchronizationRule),a.push(this.liveEdgeBinarySearchRule)}}},MediaPlayer.rules.SynchronizationRulesCollection.prototype={constructor:MediaPlayer.rules.SynchronizationRulesCollection,TIME_SYNCHRONIZED_RULES:"withAccurateTimeSourceRules",BEST_GUESS_RULES:"bestGuestRules"},MediaPlayer.utils.BoxParser=function(){"use strict";return{system:void 0,log:void 0,parse:function(e){if(!e)return null;void 0===e.fileStart&&(e.fileStart=0);var t=ISOBoxer.parseBuffer(e),e=this.system.getObject("isoFile");return e.setData(t),e}}},MediaPlayer.utils.BoxParser.prototype={constructor:MediaPlayer.utils.BoxParser},MediaPlayer.utils.Capabilities=function(){},MediaPlayer.utils.Capabilities.prototype={constructor:MediaPlayer.utils.Capabilities,system:void 0,log:void 0,supportsMediaSource:function(){"use strict";var e="WebKitMediaSource"in window,t="MediaSource"in window;return e||t},supportsEncryptedMedia:function(){return this.system.hasMapping("protectionModel")},supportsCodec:function(e,t){"use strict";if(!(e instanceof HTMLMediaElement))throw"element must be of type HTMLMediaElement.";t=e.canPlayType(t);return"probably"===t||"maybe"===t}},MediaPlayer.utils.CustomTimeRanges=function(){return{customTimeRangeArray:[],length:0,add:function(e,t){for(var a=0,a=0;a<this.customTimeRangeArray.length&&e>this.customTimeRangeArray[a].start;a++);for(this.customTimeRangeArray.splice(a,0,{start:e,end:t}),a=0;a<this.customTimeRangeArray.length-1;a++)this.mergeRanges(a,a+1)&&a--;this.length=this.customTimeRangeArray.length},clear:function(){this.customTimeRangeArray=[],this.length=0},remove:function(e,t){for(var a=0;a<this.customTimeRangeArray.length;a++)if(e<=this.customTimeRangeArray[a].start&&t>=this.customTimeRangeArray[a].end)this.customTimeRangeArray.splice(a,1),a--;else{if(e>this.customTimeRangeArray[a].start&&t<this.customTimeRangeArray[a].end){this.customTimeRangeArray.splice(a+1,0,{start:t,end:this.customTimeRangeArray[a].end}),this.customTimeRangeArray[a].end=e;break}e>this.customTimeRangeArray[a].start&&e<this.customTimeRangeArray[a].end?this.customTimeRangeArray[a].end=e:t>this.customTimeRangeArray[a].start&&t<this.customTimeRangeArray[a].end&&(this.customTimeRangeArray[a].start=t)}this.length=this.customTimeRangeArray.length},mergeRanges:function(e,t){var a=this.customTimeRangeArray[e],i=this.customTimeRangeArray[t];return a.start<=i.start&&i.start<=a.end&&a.end<=i.end?(a.end=i.end,this.customTimeRangeArray.splice(t,1),!0):i.start<=a.start&&a.start<=i.end&&i.end<=a.end?(a.start=i.start,this.customTimeRangeArray.splice(t,1),!0):i.start<=a.start&&a.start<=i.end&&a.end<=i.end?(this.customTimeRangeArray.splice(e,1),!0):a.start<=i.start&&i.start<=a.end&&i.end<=a.end&&(this.customTimeRangeArray.splice(t,1),!0)},start:function(e){return this.customTimeRangeArray[e].start},end:function(e){return this.customTimeRangeArray[e].end}}},MediaPlayer.utils.CustomTimeRanges.prototype={constructor:MediaPlayer.utils.CustomTimeRanges},MediaPlayer.utils.DOMStorage=function(){function a(e,t){void 0===t||isNaN(t)||"number"!=typeof t||(MediaPlayer.utils.DOMStorage[e]=t)}var i,n=!0,r=!0;return{system:void 0,log:void 0,abrController:void 0,checkInitialBitrate:function(){["video","audio"].forEach(function(e){var t,a,i;void 0===this.abrController.getInitialBitrateFor(e)&&(this.isSupported(MediaPlayer.utils.DOMStorage.STORAGE_TYPE_LOCAL)&&n&&(t=MediaPlayer.utils.DOMStorage["LOCAL_STORAGE_"+e.toUpperCase()+"_BITRATE_KEY"],i=JSON.parse(localStorage.getItem(t))||{},a=(new Date).getTime()-parseInt(i.timestamp)>=MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_BITRATE_EXPIRATION||!1,i=parseInt(i.bitrate),isNaN(i)||a?a&&localStorage.removeItem(t):(this.abrController.setInitialBitrateFor(e,i),this.log("Last bitrate played for "+e+" was "+i))),void 0===this.abrController.getInitialBitrateFor(e)&&this.abrController.setInitialBitrateFor(e,MediaPlayer.dependencies.AbrController["DEFAULT_"+e.toUpperCase()+"_BITRATE"]))},this)},getSavedMediaSettings:function(e){if(!this.isSupported(MediaPlayer.utils.DOMStorage.STORAGE_TYPE_LOCAL)||!r)return null;var t=MediaPlayer.utils.DOMStorage["LOCAL_STORAGE_"+e.toUpperCase()+"_SETTINGS_KEY"],a=JSON.parse(localStorage.getItem(t))||{},e=(new Date).getTime()-parseInt(a.timestamp)>=MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_MEDIA_SETTINGS_EXPIRATION||!1,a=a.settings;return e&&(localStorage.removeItem(t),a=null),a},enableLastBitrateCaching:function(e,t){n=e,a.call(this,"LOCAL_STORAGE_BITRATE_EXPIRATION",t)},enableLastMediaSettingsCaching:function(e,t){r=e,a.call(this,"LOCAL_STORAGE_MEDIA_SETTINGS_EXPIRATION",t)},isSupported:function(e){if(void 0!==i)return i;i=!1;var t;try{t=window[e]}catch(e){return this.log("Warning: DOMStorage access denied: "+e.message),i}if(!t||e!==MediaPlayer.utils.DOMStorage.STORAGE_TYPE_LOCAL&&e!==MediaPlayer.utils.DOMStorage.STORAGE_TYPE_SESSION)return i;try{t.setItem("1","1"),t.removeItem("1"),i=!0}catch(e){this.log("Warning: DOMStorage is supported, but cannot be used: "+e.message)}return i}}},MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_VIDEO_BITRATE_KEY="dashjs_vbitrate",MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_AUDIO_BITRATE_KEY="dashjs_abitrate",MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_AUDIO_SETTINGS_KEY="dashjs_asettings",MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_VIDEO_SETTINGS_KEY="dashjs_vsettings",MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_BITRATE_EXPIRATION=36e4,MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_MEDIA_SETTINGS_EXPIRATION=36e4,MediaPlayer.utils.DOMStorage.STORAGE_TYPE_LOCAL="localStorage",MediaPlayer.utils.DOMStorage.STORAGE_TYPE_SESSION="sessionStorage",MediaPlayer.utils.DOMStorage.prototype={constructor:MediaPlayer.utils.DOMStorage},MediaPlayer.utils.Debug=function(){"use strict";var a,i=!0,n=!1,r=!1,s=(new Date).getTime();return{system:void 0,eventBus:void 0,setup:function(){this.system.mapValue("log",this.log),this.system.mapOutlet("log"),a=this.eventBus},setLogTimestampVisible:function(e){n=e},showCalleeName:function(e){r=e},setLogToBrowserConsole:function(e){i=e},getLogToBrowserConsole:function(){return i},log:function(){var e,t="";n&&(e=(new Date).getTime(),t+="["+(e-s)+"]"),r&&this.getName&&(t+="["+this.getName()+"]"),this.getMediaType&&this.getMediaType()&&(t+="["+this.getMediaType()+"]"),0<t.length&&(t+=" "),Array.apply(null,arguments).forEach(function(e){t+=e+" "}),i&&console.log(t),a.dispatchEvent({type:"log",message:t})}}},MediaPlayer.utils.EventBus=function(){"use strict";function i(e,t){return(e=(t?"1":"0")+e)in a||(a[e]=[]),a[e]}var a={};return{addEventListener:function(e,t,a){a=i(e,a);-1===a.indexOf(t)&&a.push(t)},removeEventListener:function(e,t,a){a=i(e,a),t=a.indexOf(t);-1!==t&&a.splice(t,1)},dispatchEvent:function(e){for(var t=i(e.type,!1).slice(),a=0;a<t.length;a++)t[a].call(this,e);return!e.defaultPrevented}}},MediaPlayer.utils.IsoFile=function(){"use strict";function n(e,t,a){for(var i in a)t[i]=e[a[i]]}function s(e){if(!e)return null;var t,a,i=new MediaPlayer.vo.IsoBox;switch(n(e,i,r),e.hasOwnProperty("_incomplete")&&(i.isComplete=!e._incomplete),i.type){case"sidx":if(n(e,i,l),i.references)for(t=0,a=i.references.length;t<a;t+=1)n(e.references[t],i.references[t],d);break;case"emsg":n(e,i,u);break;case"mdhd":n(e,i,c);break;case"tfhd":n(e,i,h);break;case"tfdt":n(e,i,f);break;case"trun":if(n(e,i,p),i.samples)for(t=0,a=i.samples.length;t<a;t+=1)n(e.samples[t],i.samples[t],g)}return i}function t(e){for(var t,a=o.fetchAll(e),i=[],n=0,r=a.length;n<r;n+=1)(t=s.call(this,a[n]))&&i.push(t);return i}var o,r={offset:"_offset",size:"size",type:"type"},l={references:"references",timescale:"timescale",earliest_presentation_time:"earliest_presentation_time",first_offset:"first_offset"},d={reference_type:"reference_type",referenced_size:"referenced_size",subsegment_duration:"subsegment_duration"},u={id:"id",value:"value",timescale:"timescale",scheme_id_uri:"scheme_id_uri",presentation_time_delta:"presentation_time_delta",event_duration:"event_duration",message_data:"message_data"},c={timescale:"timescale"},h={base_data_offset:"base_data_offset",sample_description_index:"sample_description_index",default_sample_duration:"default_sample_duration",default_sample_size:"default_sample_size",default_sample_flags:"default_sample_flags",flags:"flags"},f={version:"version",baseMediaDecodeTime:"baseMediaDecodeTime",flags:"flags"},p={sample_count:"sample_count",first_sample_flags:"first_sample_flags",data_offset:"data_offset",flags:"flags",samples:"samples"},g={sample_size:"sample_size",sample_duration:"sample_duration",sample_composition_time_offset:"sample_composition_time_offset"};return{getBox:function(e){return e&&o&&o.boxes&&0!==o.boxes.length?s.call(this,o.fetch(e)):null},getBoxes:t,setData:function(e){o=e},getLastBox:function(){if(!o||!o.boxes||!o.boxes.length)return null;var e=o.boxes[o.boxes.length-1].type,e=t.call(this,e);return e[e.length-1]},getOffset:function(){return o._cursor.offset}}},MediaPlayer.utils.IsoFile.prototype={constructor:MediaPlayer.utils.IsoFile},MediaPlayer.utils.VirtualBuffer=function(){function o(e,a){e.sort(function(e,t){return e[a]<t[a]?-1:e[a]>t[a]?1:0})}function u(e,t,a){var i,n,r,s,o=[],l=t.start,d=t.end;return e.forEach(function(e){i=e.bufferedRange.start,n=e.bufferedRange.end,s=l<n&&n<=d,((r=l<=i&&i<d)||s)&&(o.push(e),a&&(e.bufferedRange.start=r?i:l,e.bufferedRange.end=s?n:d))}),o}var c={};return{system:void 0,sourceBufferExt:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,append:function(e){var t,a=e.streamId,i=e.mediaInfo.type,n=e.segmentType,r=e.start,s=e.end;c[a]=c[a]||((t={}).audio={calculatedBufferedRanges:new MediaPlayer.utils.CustomTimeRanges,actualBufferedRanges:new MediaPlayer.utils.CustomTimeRanges,appended:[]},t.audio[MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE]=[],t.audio[MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE]=[],t.video={calculatedBufferedRanges:new MediaPlayer.utils.CustomTimeRanges,actualBufferedRanges:new MediaPlayer.utils.CustomTimeRanges,appended:[]},t.video[MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE]=[],t.video[MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE]=[],t.fragmentedText={calculatedBufferedRanges:new MediaPlayer.utils.CustomTimeRanges,actualBufferedRanges:new MediaPlayer.utils.CustomTimeRanges,appended:[]},t.fragmentedText[MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE]=[],t.fragmentedText[MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE]=[],t),c[a][i][n].push(e),o(c[a][i][n],"index"),isNaN(r)||isNaN(s)||(c[a][i].calculatedBufferedRanges.add(r,s),this.notify(MediaPlayer.utils.VirtualBuffer.eventList.CHUNK_APPENDED,{chunk:e}))},storeAppendedChunk:function(e,t){var a,i,n,r,s;e&&t&&(i=e.streamId,n=e.mediaInfo.type,r=c[i][n].actualBufferedRanges,(s=this.getChunks({streamId:i,mediaType:n,appended:!0,start:e.start})[0])?(a=c[i][n].appended.indexOf(s),c[i][n].appended[a]=e):c[i][n].appended.push(e),o(c[i][n].appended,"start"),(t=this.sourceBufferExt.getRangeDifference(r,t))?(e.bufferedRange=t,r.add(t.start,t.end),s&&(e.bufferedRange.start=Math.min(s.bufferedRange.start,t.start),e.bufferedRange.end=Math.max(s.bufferedRange.end,t.end))):s&&(e.bufferedRange=s.bufferedRange))},updateBufferedRanges:function(e,t){if(e){var a,i,n=e.streamId,r=e.mediaType,s=this.getChunks({streamId:n,mediaType:r,appended:!0}),o=[];if(c[n][r].actualBufferedRanges=new MediaPlayer.utils.CustomTimeRanges,t&&0!==t.length){for(var l=0,d=t.length;l<d;l+=1)a=t.start(l),i=t.end(l),c[n][r].actualBufferedRanges.add(a,i),o=o.concat(u.call(this,s,{start:a,end:i},!0));c[n][r].appended=o}else c[n][r].appended=[]}},getChunks:function(n){var r=function(e){var t=e.streamId,e=e.mediaType;return c[t]?c[t][e]:null}.call(this,n),e=n.segmentType,t=n.appended,s=n.removeOrigin,o=n.limit||Number.POSITIVE_INFINITY,l=this.system.getObject("mediaController"),d=0,a=[];return r&&(delete n.streamId,delete n.mediaType,delete n.segmentType,delete n.removeOrigin,delete n.limit,delete n.appended,a=(t?r.appended:e?r[e]:[]).filter(function(e,t,a){if(o<=d)return!1;for(var i in n){if("mediaInfo"===i)return l.isTracksEqual(e[i],n[i]);if(n.hasOwnProperty(i)&&e[i]!=n[i])return!1}return s&&(r.calculatedBufferedRanges.remove(e.start,e.end),a.splice(t,1)),d+=1,!0}),n.forRange&&(a=u.call(this,a,n.forRange,!1))),a},extract:function(e){return e.removeOrigin=!0,this.getChunks(e)},getTotalBufferLevel:function(e){var t,a=e.type,i=0;for(t in c)c.hasOwnProperty(t)&&(i+=this.sourceBufferExt.getTotalBufferedTime({buffered:c[t][a].calculatedBufferedRanges}));return i},reset:function(){c={}}}},MediaPlayer.utils.VirtualBuffer.prototype={constructor:MediaPlayer.utils.VirtualBuffer},MediaPlayer.utils.VirtualBuffer.eventList={CHUNK_APPENDED:"chunkAppended"},MediaPlayer.vo.BitrateInfo=function(){"use strict";this.mediaType=null,this.bitrate=null,this.qualityIndex=NaN},MediaPlayer.vo.BitrateInfo.prototype={constructor:MediaPlayer.vo.BitrateInfo},MediaPlayer.vo.DataChunk=function(){"use strict";this.streamId=null,this.mediaInfo=null,this.segmentType=null,this.quality=NaN,this.index=NaN,this.bytes=null,this.start=NaN,this.end=NaN,this.duration=NaN},MediaPlayer.vo.DataChunk.prototype={constructor:MediaPlayer.vo.DataChunk},MediaPlayer.vo.Error=function(e,t,a){"use strict";this.code=e||null,this.message=t||null,this.data=a||null},MediaPlayer.vo.Error.prototype={constructor:MediaPlayer.vo.Error},MediaPlayer.vo.Event=function(){"use strict";this.type=null,this.sender=null,this.data=null,this.error=null,this.timestamp=NaN},MediaPlayer.vo.Event.prototype={constructor:MediaPlayer.vo.Event},MediaPlayer.vo.FragmentRequest=function(){"use strict";this.action="download",this.startTime=NaN,this.mediaType=null,this.mediaInfo=null,this.type=null,this.duration=NaN,this.timescale=NaN,this.range=null,this.url=null,this.requestStartDate=null,this.firstByteDate=null,this.requestEndDate=null,this.quality=NaN,this.index=NaN,this.availabilityStartTime=null,this.availabilityEndTime=null,this.wallStartTime=null,this.bytesLoaded=NaN,this.bytesTotal=NaN},MediaPlayer.vo.FragmentRequest.prototype={constructor:MediaPlayer.vo.FragmentRequest,ACTION_DOWNLOAD:"download",ACTION_COMPLETE:"complete"},MediaPlayer.vo.IsoBox=function(){"use strict";this.offset=NaN,this.type=null,this.size=NaN,this.isComplete=!0},MediaPlayer.vo.IsoBox.prototype={constructor:MediaPlayer.vo.IsoBox},MediaPlayer.vo.ManifestInfo=function(){"use strict";this.DVRWindowSize=NaN,this.loadedTime=null,this.availableFrom=null,this.minBufferTime=NaN,this.duration=NaN,this.isDynamic=!1,this.maxFragmentDuration=null},MediaPlayer.vo.ManifestInfo.prototype={constructor:MediaPlayer.vo.ManifestInfo},MediaPlayer.vo.MediaInfo=function(){"use strict";this.id=null,this.index=null,this.type=null,this.streamInfo=null,this.representationCount=0,this.lang=null,this.viewpoint=null,this.accessibility=null,this.audioChannelConfiguration=null,this.roles=null,this.codec=null,this.mimeType=null,this.contentProtection=null,this.isText=!1,this.KID=null,this.bitrateList=null},MediaPlayer.vo.MediaInfo.prototype={constructor:MediaPlayer.vo.MediaInfo},MediaPlayer.models.MetricsList=function(){"use strict";return{TcpList:[],HttpList:[],RepSwitchList:[],BufferLevel:[],BufferState:[],PlayList:[],DroppedFrames:[],SchedulingInfo:[],DVRInfo:[],ManifestUpdate:[],RequestsQueue:null}},MediaPlayer.models.MetricsList.prototype={constructor:MediaPlayer.models.MetricsList},MediaPlayer.vo.StreamInfo=function(){"use strict";this.id=null,this.index=null,this.start=NaN,this.duration=NaN,this.manifestInfo=null,this.isLast=!0},MediaPlayer.vo.StreamInfo.prototype={constructor:MediaPlayer.vo.StreamInfo},MediaPlayer.vo.TextTrackInfo=function(){"use strict";this.video=null,this.captionData=null,this.label=null,this.lang=null,this.defaultTrack=!1,this.kind=null,this.isFragmented=!1},MediaPlayer.vo.TextTrackInfo.prototype={constructor:MediaPlayer.vo.TextTrackInfo},MediaPlayer.vo.TrackInfo=function(){"use strict";this.id=null,this.quality=null,this.DVRWindow=null,this.fragmentDuration=null,this.mediaInfo=null,this.MSETimeOffset=null},MediaPlayer.vo.TrackInfo.prototype={constructor:MediaPlayer.vo.TrackInfo},MediaPlayer.vo.URIFragmentData=function(){"use strict";this.t=null,this.xywh=null,this.track=null,this.id=null,this.s=null},MediaPlayer.vo.URIFragmentData.prototype={constructor:MediaPlayer.vo.URIFragmentData},MediaPlayer.vo.metrics.BufferLevel=function(){"use strict";this.t=null,this.level=null},MediaPlayer.vo.metrics.BufferLevel.prototype={constructor:MediaPlayer.vo.metrics.BufferLevel},MediaPlayer.vo.metrics.BufferState=function(){"use strict";this.target=null,this.state=MediaPlayer.dependencies.BufferController.BUFFER_EMPTY},MediaPlayer.vo.metrics.BufferState.prototype={constructor:MediaPlayer.vo.metrics.BufferState},MediaPlayer.vo.metrics.DVRInfo=function(){"use strict";this.time=null,this.range=null,this.manifestInfo=null},MediaPlayer.vo.metrics.DVRInfo.prototype={constructor:MediaPlayer.vo.metrics.DVRInfo},MediaPlayer.vo.metrics.DroppedFrames=function(){"use strict";this.time=null,this.droppedFrames=null},MediaPlayer.vo.metrics.DroppedFrames.prototype={constructor:MediaPlayer.vo.metrics.DroppedFrames},MediaPlayer.vo.metrics.HTTPRequest=function(){"use strict";this.stream=null,this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.tfinish=null,this.responsecode=null,this.interval=null,this.mediaduration=null,this.responseHeaders=null,this.trace=[]},MediaPlayer.vo.metrics.HTTPRequest.prototype={constructor:MediaPlayer.vo.metrics.HTTPRequest},MediaPlayer.vo.metrics.HTTPRequest.Trace=function(){"use strict";this.s=null,this.d=null,this.b=[]},MediaPlayer.vo.metrics.HTTPRequest.Trace.prototype={constructor:MediaPlayer.vo.metrics.HTTPRequest.Trace},MediaPlayer.vo.metrics.HTTPRequest.MPD_TYPE="MPD",MediaPlayer.vo.metrics.HTTPRequest.XLINK_EXPANSION_TYPE="XLink Expansion",MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE="Initialization Segment",MediaPlayer.vo.metrics.HTTPRequest.INDEX_SEGMENT_TYPE="Index Segment",MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE="Media Segment",MediaPlayer.vo.metrics.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE="Bitstream Switching Segment",MediaPlayer.vo.metrics.HTTPRequest.OTHER_TYPE="other",MediaPlayer.vo.metrics.ManifestUpdate=function(){"use strict";this.mediaType=null,this.type=null,this.requestTime=null,this.fetchTime=null,this.availabilityStartTime=null,this.presentationStartTime=0,this.clientTimeOffset=0,this.currentTime=null,this.buffered=null,this.latency=0,this.streamInfo=[],this.trackInfo=[]},MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo=function(){"use strict";this.id=null,this.index=null,this.start=null,this.duration=null},MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo=function(){"use strict";this.id=null,this.index=null,this.mediaType=null,this.streamIndex=null,this.presentationTimeOffset=null,this.startNumber=null,this.fragmentInfoType=null},MediaPlayer.vo.metrics.ManifestUpdate.prototype={constructor:MediaPlayer.vo.metrics.ManifestUpdate},MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo.prototype={constructor:MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo},MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo.prototype={constructor:MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo},MediaPlayer.vo.metrics.PlayList=function(){"use strict";this.stream=null,this.start=null,this.mstart=null,this.starttype=null,this.trace=[]},MediaPlayer.vo.metrics.PlayList.Trace=function(){"use strict";this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null},MediaPlayer.vo.metrics.PlayList.prototype={constructor:MediaPlayer.vo.metrics.PlayList},MediaPlayer.vo.metrics.PlayList.INITIAL_PLAY_START_REASON="initial_start",MediaPlayer.vo.metrics.PlayList.SEEK_START_REASON="seek",MediaPlayer.vo.metrics.PlayList.Trace.prototype={constructor:MediaPlayer.vo.metrics.PlayList.Trace()},MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON="user_request",MediaPlayer.vo.metrics.PlayList.Trace.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",MediaPlayer.vo.metrics.PlayList.Trace.END_OF_CONTENT_STOP_REASON="end_of_content",MediaPlayer.vo.metrics.PlayList.Trace.REBUFFERING_REASON="rebuffering",MediaPlayer.vo.metrics.RepresentationSwitch=function(){"use strict";this.t=null,this.mt=null,this.to=null,this.lto=null},MediaPlayer.vo.metrics.RepresentationSwitch.prototype={constructor:MediaPlayer.vo.metrics.RepresentationSwitch},MediaPlayer.vo.metrics.RequestsQueue=function(){"use strict";this.pendingRequests=[],this.loadingRequests=[],this.executedRequests=[],this.rejectedRequests=[]},MediaPlayer.vo.metrics.RequestsQueue.prototype={constructor:MediaPlayer.vo.metrics.RequestsQueue},MediaPlayer.vo.metrics.SchedulingInfo=function(){"use strict";this.mediaType=null,this.t=null,this.type=null,this.startTime=null,this.availabilityStartTime=null,this.duration=null,this.quality=null,this.range=null,this.state=null},MediaPlayer.vo.metrics.SchedulingInfo.prototype={constructor:MediaPlayer.vo.metrics.SchedulingInfo},MediaPlayer.vo.metrics.TCPConnection=function(){"use strict";this.tcpid=null,this.dest=null,this.topen=null,this.tclose=null,this.tconnect=null},MediaPlayer.vo.metrics.TCPConnection.prototype={constructor:MediaPlayer.vo.metrics.TCPConnection},MediaPlayer.vo.protection.ClearKeyKeySet=function(e,t){if(t&&"persistent"!==t&&"temporary"!==t)throw new Error("Invalid ClearKey key set type!  Must be one of 'persistent' or 'temporary'");this.keyPairs=e,this.type=t,this.toJWK=function(){for(var e=this.keyPairs.length,t={keys:[]},a=0;a<e;a++){var i={kty:"oct",alg:"A128KW",kid:this.keyPairs[a].keyID,k:this.keyPairs[a].key};t.keys.push(i)}this.type&&(t.type=this.type);var n=JSON.stringify(t),r=n.length,s=new ArrayBuffer(r),o=new Uint8Array(s);for(a=0;a<r;a++)o[a]=n.charCodeAt(a);return s}},MediaPlayer.vo.protection.ClearKeyKeySet.prototype={constructor:MediaPlayer.vo.protection.ClearKeyKeySet},MediaPlayer.vo.protection.KeyError=function(e,t){"use strict";this.sessionToken=e,this.error=t},MediaPlayer.vo.protection.KeyError.prototype={constructor:MediaPlayer.vo.protection.KeyError},MediaPlayer.vo.protection.KeyMessage=function(e,t,a,i){"use strict";this.sessionToken=e,this.message=t,this.defaultURL=a,this.messageType=i||"license-request"},MediaPlayer.vo.protection.KeyMessage.prototype={constructor:MediaPlayer.vo.protection.KeyMessage},MediaPlayer.vo.protection.KeyPair=function(e,t){"use strict";this.keyID=e,this.key=t},MediaPlayer.vo.protection.KeyPair.prototype={constructor:MediaPlayer.vo.protection.KeyPair},MediaPlayer.vo.protection.KeySystemAccess=function(e,t){this.keySystem=e,this.ksConfiguration=t},MediaPlayer.vo.protection.KeySystemAccess.prototype={constructor:MediaPlayer.vo.protection.KeySystemAccess},MediaPlayer.vo.protection.KeySystemConfiguration=function(e,t,a,i,n){this.initDataTypes=["cenc"],this.audioCapabilities=e,this.videoCapabilities=t,this.distinctiveIdentifier=a,this.persistentState=i,this.sessionTypes=n},MediaPlayer.vo.protection.KeySystemConfiguration.prototype={constructor:MediaPlayer.vo.protection.KeySystemConfiguration},MediaPlayer.vo.protection.LicenseRequestComplete=function(e,t,a){"use strict";this.message=e,this.sessionToken=t,this.messageType=a||"license-request"},MediaPlayer.vo.protection.LicenseRequestComplete.prototype={constructor:MediaPlayer.vo.protection.LicenseRequestComplete},MediaPlayer.vo.protection.MediaCapability=function(e,t){this.contentType=e,this.robustness=t},MediaPlayer.vo.protection.MediaCapability.prototype={constructor:MediaPlayer.vo.protection.MediaCapability},MediaPlayer.vo.protection.NeedKey=function(e,t){this.initData=e,this.initDataType=t},MediaPlayer.vo.protection.NeedKey.prototype={constructor:MediaPlayer.vo.protection.NeedKey},MediaPlayer.vo.protection.ProtectionData=function(e,t,a){this.serverURL=e,this.httpRequestHeaders=t,this.clearkeys=a},MediaPlayer.vo.protection.ProtectionData.prototype={constructor:MediaPlayer.vo.protection.ProtectionData},MediaPlayer.vo.protection.SessionToken=function(){},function(e){var r,s=e.event,o=s.special.debouncedresize={setup:function(){e(this).on("resize",o.handler)},teardown:function(){e(this).off("resize",o.handler)},handler:function(e,t){function a(){e.type="debouncedresize",s.dispatch.apply(i,n)}var i=this,n=arguments;r&&clearTimeout(r),t&&a(),r=setTimeout(a,o.threshold)},threshold:150}}(jQuery),function(t,a){"function"==typeof define&&define.amd?define(["raphael"],function(e){return a(e||t.Raphael)}):a(Raphael)}(this,function(e){e.fn.freeTransform=function(i,e,t){var c,a,n,r,d=this,s=i.getBBox(!0);return i.freeTransform||(Array.prototype.hasOwnProperty("map")||(Array.prototype.map=function(e,t){for(a in n=[],this)this.hasOwnProperty(a)&&(n[a]=e.call(t,this[a],a,this));return n}),Array.prototype.hasOwnProperty("indexOf")||(Array.prototype.indexOf=function(e,t){for(a=t||0,j=this.length;a<j;a++)if(this[a]===e)return a;return-1}),(c=i.freeTransform={attrs:{x:s.x,y:s.y,size:{x:s.width,y:s.height},center:{x:s.x+s.width/2,y:s.y+s.height/2},rotate:0,scale:{x:1,y:1},translate:{x:0,y:0},ratio:1},axes:null,bbox:null,callback:null,items:[],handles:{center:null,x:null,y:null},offset:{rotate:0,scale:{x:1,y:1},translate:{x:0,y:0}},opts:{animate:!1,attrs:{fill:"#fff",stroke:"#000"},boundary:{x:d._left||0,y:d._top||0,width:null,height:null},customCorners:!1,distance:1.3,drag:!0,draw:!1,keepRatio:!1,range:{rotate:[-180,180],scale:[-99999,99999]},rotate:!0,scale:!0,snap:{rotate:0,scale:0,drag:0},snapDist:{rotate:0,scale:0,drag:7},size:5},subject:i}).updateHandles=function(){var r,s,t,a,i,n,o,l=[[-1,-1],[1,-1],[1,1],[-1,1],[0,-1],[1,0],[0,1],[-1,0]];return(c.handles.bbox||0<=c.opts.rotate.indexOf("self"))&&(s=r=u(0),c.opts.customCorners&&"number"==typeof c.opts.customCorners.distance&&(s=u(c.opts.customCorners.distance))),t={x:c.attrs.rotate*Math.PI/180,y:(c.attrs.rotate+90)*Math.PI/180},a={x:c.attrs.size.x/2*c.attrs.scale.x,y:c.attrs.size.y/2*c.attrs.scale.y},c.axes.map(function(e){c.handles[e]&&(i=c.attrs.center.x+c.attrs.translate.x+a[e]*c.opts.distance*Math.cos(t[e]),n=c.attrs.center.y+c.attrs.translate.y+a[e]*c.opts.distance*Math.sin(t[e]),o={x:1,y:1},d._viewBox&&(o={x:d._viewBox[2]/h().x,y:d._viewBox[3]/h().y}),c.opts.boundary&&(i=Math.max(Math.min(i,c.opts.boundary.x+(c.opts.boundary.width||h().x*o.x)),c.opts.boundary.x),n=Math.max(Math.min(n,c.opts.boundary.y+(c.opts.boundary.height||h().y*o.y)),c.opts.boundary.y)),c.handles[e].disc.attr({cx:i,cy:n}),c.handles[e].line.toFront().attr({path:[["M",c.attrs.center.x+c.attrs.translate.x,c.attrs.center.y+c.attrs.translate.y],["L",c.handles[e].disc.attrs.cx,c.handles[e].disc.attrs.cy]]}),c.handles[e].disc.toFront())}),c.bbox&&(c.bbox.toFront().attr({path:[["M",r[0].x,r[0].y],["L",r[1].x,r[1].y],["L",r[2].x,r[2].y],["L",r[3].x,r[3].y],["L",r[0].x,r[0].y]]}),c.handles.bbox&&c.handles.bbox.map(function(e,t){var a,i,n=e.isCorner?(a=s[t].x,s[t].y):(n=(1+(i=t%4))%r.length,a=(s[i].x+s[n].x)/2,(s[i].y+s[n].y)/2);e.element.toFront().attr({x:a-(e.isCorner?c.opts.customCorners?Math.ceil(c.opts.customCorners.size/2):c.opts.size.bboxCorners:c.opts.size.bboxSides),y:n-(e.isCorner?c.opts.customCorners?Math.ceil(c.opts.customCorners.size/2):c.opts.size.bboxCorners:c.opts.size.bboxSides)}).transform(c.opts.customCorners?null:"R"+c.attrs.rotate),e.x=l[t][0],e.y=l[t][1]})),c.circle&&c.circle.attr({cx:c.attrs.center.x+c.attrs.translate.x,cy:c.attrs.center.y+c.attrs.translate.y,r:Math.max(a.x,a.y)*c.opts.distance}),c.handles.center&&c.handles.center.disc.toFront().attr({cx:c.attrs.center.x+c.attrs.translate.x,cy:c.attrs.center.y+c.attrs.translate.y}),0<=c.opts.rotate.indexOf("self")&&(a=Math.max(Math.sqrt(Math.pow(r[1].x-r[0].x,2)+Math.pow(r[1].y-r[0].y,2)),Math.sqrt(Math.pow(r[2].x-r[1].x,2)+Math.pow(r[2].y-r[1].y,2)))/2),c},c.showHandles=function(){var e,t,o,l,a=[];if(draggables=[],c.hideHandles(),c.axes.map(function(e){c.handles[e]={},c.handles[e].line=d.path(["M",c.attrs.center.x,c.attrs.center.y]).attr({stroke:c.opts.attrs.stroke,"stroke-dasharray":"- ",opacity:.5}),c.handles[e].disc=d.circle(c.attrs.center.x,c.attrs.center.y,c.opts.size.axes).attr(c.opts.attrs)}),0<=c.opts.draw.indexOf("bbox"))for(c.bbox=d.path("").attr({stroke:c.opts.attrs.stroke,"stroke-dasharray":"- ",opacity:.5}),c.handles.bbox=[],e=c.opts.scale.indexOf("bboxCorners")||0<=c.opts.customCorners?0:4;e<(-1===c.opts.scale.indexOf("bboxSides")?4:8);e++)(t={}).index=e,t.axis=e%2?"x":"y",t.isCorner=e<4,t.isCorner&&c.opts.customCorners?t.element=d.image(c.opts.customCorners.corners[e].image,c.attrs.center.x,c.attrs.center.y,c.opts.customCorners.size,c.opts.customCorners.size):t.element=d.rect(c.attrs.center.x,c.attrs.center.y,2*c.opts.size[t.isCorner?"bboxCorners":"bboxSides"],2*c.opts.size[t.isCorner?"bboxCorners":"bboxSides"]).attr(c.opts.attrs),c.handles.bbox[e]=t;return-1!==c.opts.draw.indexOf("circle")&&(c.circle=d.circle(0,0,0).attr({stroke:c.opts.attrs.stroke,"stroke-dasharray":"- ",opacity:.3})),-1!==c.opts.drag.indexOf("center")&&(c.handles.center={},c.handles.center.disc=d.circle(c.attrs.center.x,c.attrs.center.y,c.opts.size.center).attr(c.opts.attrs)),c.axes.map(function(e){c.handles[e]&&a.push({element:c.handles[e].disc,rotate:-1!==c.opts.rotate.indexOf("axis"+e.toUpperCase()),scale:-1!==c.opts.scale.indexOf("axis"+e.toUpperCase()),axis:e,isCorner:!1})}),c.opts.customCorners&&c.handles.bbox.map(function(e){var t;void 0!==c.opts.customCorners.corners[e.index]&&("rotate"!==(t=c.opts.customCorners.corners[e.index].action)&&"scale"!==t||a.push({element:e.element,rotate:"rotate"===t,scale:"scale"===t,axis:"x",isCorner:!0}))}),a.map(function(n){n.element.drag(function(e,t){var a,i={x:c.o.scale.x<0,y:c.o.scale.y<0};c.o.viewBoxRatio&&(e*=c.o.viewBoxRatio.x,t*=c.o.viewBoxRatio.y),a=e+n.element.ox,e=t+n.element.oy,n.rotate&&(t=Math.atan2(e-c.o.center.y-c.o.translate.y,a-c.o.center.x-c.o.translate.x),c.attrs.rotate=180*t/Math.PI-c.o.angle,i[n.axis]&&(c.attrs.rotate-=180)),c.opts.boundary&&(a=Math.max(Math.min(a,c.opts.boundary.x+(c.opts.boundary.width||h().x*(c.o.viewBoxRatio&&c.o.viewBoxRatio.x||1))),c.opts.boundary.x),e=Math.max(Math.min(e,c.opts.boundary.y+(c.opts.boundary.height||h().y*(c.o.viewBoxRatio&&c.o.viewBoxRatio.y||1))),c.opts.boundary.y)),a=a-c.o.center.x-c.o.translate.x-(c.opts.customCorners?c.opts.customCorners.distance:0),e=e-c.o.center.y-c.o.translate.y-(c.opts.customCorners?c.opts.customCorners.distance:0),e=Math.sqrt(Math.pow(a,2)+Math.pow(e,2)),n.scale&&(c.attrs.scale[n.axis]=e/(c.o.size[n.axis]/2*c.o.distance),i[n.axis]&&(c.attrs.scale[n.axis]*=-1)),f(),-1!==c.opts.keepRatio.indexOf("axis"+n.axis.toUpperCase())?g(n.axis):c.attrs.ratio=c.attrs.scale.x/c.attrs.scale.y,c.attrs.scale.x&&c.attrs.scale.y&&c.apply(),y([n.rotate?"rotate":null,n.scale?"scale":null])},function(){c.o=m(c.attrs),d._viewBox&&(c.o.viewBoxRatio={x:d._viewBox[2]/h().x,y:d._viewBox[3]/h().y}),n.element.ox=this.attrs.cx||this.attrs.x+this.attrs.width/2,n.element.oy=this.attrs.cy||this.attrs.y+this.attrs.height/2,n.isCorner?(hypotenuse=Math.sqrt(Math.pow(c.o.size.x*c.o.scale.x,2)+Math.pow(c.o.size.y*c.o.scale.y,2))/2,opposite=c.o.size.x*c.o.scale.x/2,pos={x:n.element.ox-(c.o.center.x+c.o.x+c.o.translate.x),y:n.element.oy-(c.o.center.y+c.o.y+c.o.translate.y)},c.o.distance=hypotenuse/opposite,c.o.angle=90-180*Math.atan2(pos.x,pos.y)/Math.PI-c.o.rotate):(c.o.distance=c.opts.distance,c.o.angle="y"===n.axis?90:0),y([n.rotate?"rotate start":null,n.scale?"scale start":null])},function(){y([n.rotate?"rotate end":null,n.scale?"scale end":null])})}),0<=c.opts.draw.indexOf("bbox")&&!c.opts.customCorners&&(-1!==c.opts.scale.indexOf("bboxCorners")||-1!==c.opts.scale.indexOf("bboxSides"))&&c.handles.bbox.map(function(u){u.element.drag(function(e,t){var a,i,n,r,s,o,l=m(c.attrs),d={x:0,y:0};c.o.viewBoxRatio&&(e*=c.o.viewBoxRatio.x,t*=c.o.viewBoxRatio.y),a=c.o.rotate.sin,n=e*(i=c.o.rotate.cos)-t*a,r=e*a+t*i,n*=Math.abs(u.x),r*=Math.abs(u.y),c.attrs.translate={x:c.o.translate.x+(n*i+r*a)/2,y:c.o.translate.y+(n*-a+r*i)/2},n=(e=c.o.handlePos.cx+e-c.attrs.center.x-c.attrs.translate.x)*i-(t=c.o.handlePos.cy+t-c.attrs.center.y-c.attrs.translate.y)*a,r=e*a+t*i,u.isCorner&&-1!==c.opts.keepRatio.indexOf("bboxCorners")&&(o=c.attrs.size.x*c.attrs.scale.x/(c.attrs.size.y*c.attrs.scale.y),(s=n*u.x*(1/o))*o<(o=r*u.y*o)?n=o*u.x:r=s*u.y),o=2*n*u.x/c.o.size.x,s=2*r*u.y/c.o.size.y,c.attrs.scale={x:o||c.attrs.scale.x,y:s||c.attrs.scale.y},p().x&&p().y||(c.attrs=l),f(),(u.isCorner&&-1!==c.opts.keepRatio.indexOf("bboxCorners")||!u.isCorner&&-1!==c.opts.keepRatio.indexOf("bboxSides"))&&(g(u.axis),d.x=(c.attrs.scale.x-c.o.scale.x)*c.o.size.x*u.x,d.y=(c.attrs.scale.y-c.o.scale.y)*c.o.size.y*u.y,n=d.x*i+d.y*a,r=-d.x*a+d.y*i,c.attrs.translate.x=c.o.translate.x+n/2,c.attrs.translate.y=c.o.translate.y+r/2),c.attrs.ratio=c.attrs.scale.x/c.attrs.scale.y,y(["scale"]),c.apply()},function(){var e=(360-c.attrs.rotate)%360/180*Math.PI,t=u.element.attr(["x","y"]);c.o=m(c.attrs),c.o.handlePos={cx:t.x+c.opts.size[u.isCorner?"bboxCorners":"bboxSides"],cy:t.y+c.opts.size[u.isCorner?"bboxCorners":"bboxSides"]},c.o.rotate={sin:Math.sin(e),cos:Math.cos(e)},d._viewBox&&(c.o.viewBoxRatio={x:d._viewBox[2]/h().x,y:d._viewBox[3]/h().y}),y(["scale start"])},function(){y(["scale end"])})}),c.opts.customCorners&&c.handles.bbox.map(function(e){void 0!==c.opts.customCorners.corners[e.index]&&-1===["drag","rotate","scale"].indexOf(c.opts.customCorners.corners[e.index].action)&&(e.element.drag(function(){return!1}),e.element.click(function(){y(["custom:"+c.opts.customCorners.corners[e.index].action])}))}),0<=c.opts.drag.indexOf("self")&&-1===c.opts.scale.indexOf("self")&&-1===c.opts.rotate.indexOf("self")&&draggables.push(i),0<=c.opts.drag.indexOf("center")&&draggables.push(c.handles.center.disc),c.opts.customCorners&&c.handles.bbox.map(function(e){void 0!==c.opts.customCorners.corners[e.index]&&"drag"===c.opts.customCorners.corners[e.index].action&&draggables.push(e.element)}),draggables.map(function(e){e.drag(function(e,t){var a=m(c.o.bbox);c.o.viewBoxRatio&&(e*=c.o.viewBoxRatio.x,t*=c.o.viewBoxRatio.y),c.attrs.translate.x=c.o.translate.x+e,c.attrs.translate.y=c.o.translate.y+t,a.x+=e,a.y+=t,f(a),y(["drag"]),c.apply()},function(){c.o=m(c.attrs),c.opts.snap.drag&&(c.o.bbox=i.getBBox()),d._viewBox&&(c.o.viewBoxRatio={x:d._viewBox[2]/h().x,y:d._viewBox[3]/h().y}),c.axes.map(function(e){c.handles[e]&&(c.handles[e].disc.ox=c.handles[e].disc.attrs.cx,c.handles[e].disc.oy=c.handles[e].disc.attrs.cy)}),y(["drag start"])},function(){y(["drag end"])})}),o=0<=c.opts.rotate.indexOf("self"),l=0<=c.opts.scale.indexOf("self"),(o||l)&&i.drag(function(e,t,a,i){var n,r=c.o.scale.x<0,s=c.o.scale.y<0;o&&(n=Math.atan2(i-c.o.center.y-c.o.translate.y,a-c.o.center.x-c.o.translate.x),c.attrs.rotate=c.o.rotate+180*n/Math.PI-c.o.deg),l&&(i=Math.sqrt(Math.pow(a-c.o.center.x-c.o.translate.x,2)+Math.pow(i-c.o.center.y-c.o.translate.y,2)),c.attrs.scale.x=c.attrs.scale.y=(r?-1:1)*c.o.scale.x+(i-c.o.radius)/(c.o.size.x/2),r&&(c.attrs.scale.x*=-1),s&&(c.attrs.scale.y*=-1)),f(),c.apply(),y([o?"rotate":null,l?"scale":null])},function(e,t){c.o=m(c.attrs),c.o.deg=180*Math.atan2(t-c.o.center.y-c.o.translate.y,e-c.o.center.x-c.o.translate.x)/Math.PI,c.o.radius=Math.sqrt(Math.pow(e-c.o.center.x-c.o.translate.x,2)+Math.pow(t-c.o.center.y-c.o.translate.y,2)),d._viewBox&&(c.o.viewBoxRatio={x:d._viewBox[2]/h().x,y:d._viewBox[3]/h().y}),y([o?"rotate start":null,l?"scale start":null])},function(){y([o?"rotate end":null,l?"scale end":null])}),c.updateHandles(),c},c.hideHandles=function(e){return void 0===(e=e||{}).undrag&&(e.undrag=!0),e.undrag&&c.items.map(function(e){e.el.undrag()}),c.handles.center&&(c.handles.center.disc.remove(),c.handles.center=null),["x","y"].map(function(e){c.handles[e]&&(c.handles[e].disc.remove(),c.handles[e].line.remove(),c.handles[e]=null)}),c.bbox&&(c.bbox.remove(),c.bbox=null,c.handles.bbox&&(c.handles.bbox.map(function(e){e.element.remove()}),c.handles.bbox=null)),c.circle&&(c.circle.remove(),c.circle=null),c},c.setOpts=function(e,t){var a,i;for(a in void 0!==t&&(c.callback="function"==typeof t&&t),e)if(e[a]&&e[a].constructor===Object)for(i in!1===c.opts[a]&&(c.opts[a]={}),e[a])e[a].hasOwnProperty(i)&&(c.opts[a][i]=e[a][i]);else c.opts[a]=e[a];return!0===c.opts.animate&&(c.opts.animate={delay:700,easing:"linear"}),!0===c.opts.drag&&(c.opts.drag=["center","self"]),!0===c.opts.keepRatio&&(c.opts.keepRatio=["axisX","axisY","bboxCorners","bboxSides"]),!0===c.opts.rotate&&(c.opts.rotate=["axisX","axisY"]),!0===c.opts.scale&&(c.opts.scale=["axisX","axisY","bboxCorners","bboxSides"]),["drag","draw","keepRatio","rotate","scale"].map(function(e){!1===c.opts[e]&&(c.opts[e]=[])}),c.axes=[],(0<=c.opts.rotate.indexOf("axisX")||0<=c.opts.scale.indexOf("axisX"))&&c.axes.push("x"),(0<=c.opts.rotate.indexOf("axisY")||0<=c.opts.scale.indexOf("axisY"))&&c.axes.push("y"),["drag","rotate","scale"].map(function(e){c.opts.snapDist[e]||(c.opts.snapDist[e]=c.opts.snap[e])}),c.opts.range={rotate:[parseFloat(c.opts.range.rotate[0]),parseFloat(c.opts.range.rotate[1])],scale:[parseFloat(c.opts.range.scale[0]),parseFloat(c.opts.range.scale[1])]},c.opts.snap={drag:parseFloat(c.opts.snap.drag)||0,rotate:parseFloat(c.opts.snap.rotate)||0,scale:parseFloat(c.opts.snap.scale)||0},c.opts.snapDist={drag:parseFloat(c.opts.snapDist.drag)||0,rotate:parseFloat(c.opts.snapDist.rotate)||0,scale:parseFloat(c.opts.snapDist.scale)||0},"string"==typeof c.opts.size&&(c.opts.size=parseFloat(c.opts.size)||0),isNaN(c.opts.size)||(c.opts.size={axes:c.opts.size,bboxCorners:c.opts.size,bboxSides:c.opts.size,center:c.opts.size}),c.opts.customCorners&&(c.opts.customCorners.size=parseFloat(c.opts.customCorners.size)||0,c.opts.customCorners.distance=parseFloat(c.opts.customCorners.distance)||0),c.showHandles(),y(["init"]),c},c.setOpts(e,t),c.apply=function(){return c.items.map(function(e,t){var a=c.attrs.center.x+c.offset.translate.x,i=c.attrs.center.y+c.offset.translate.y,n=c.attrs.rotate-c.offset.rotate,r=c.attrs.scale.x/c.offset.scale.x,s=c.attrs.scale.y/c.offset.scale.y,o=c.attrs.translate.x-c.offset.translate.x,l=c.attrs.translate.y-c.offset.translate.y;c.opts.animate?(y(["animate start"]),e.el.animate({transform:["R",n,a,i,"S",r,s,a,i,"T",o,l]+c.items[t].transformString},c.opts.animate.delay,c.opts.animate.easing,function(){y(["animate end"]),c.updateHandles()})):(e.el.transform(["R",n,a,i,"S",r,s,a,i,"T",o,l]+c.items[t].transformString),y(["apply"]),c.updateHandles())}),c},c.unplug=function(){var e=c.attrs;return c.hideHandles(),delete i.freeTransform,e},function t(e){("set"===e.type?e.items:[e]).map(function(e){"set"===e.type?t(e):c.items.push({el:e,attrs:{rotate:0,scale:{x:1,y:1},translate:{x:0,y:0}},transformString:e.matrix.toTransformString()})})}(i),c.items.map(function(e,t){e.el._&&e.el._.transform&&"object"==typeof e.el._.transform&&e.el._.transform.map(function(e){if(e[0])switch(e[0].toUpperCase()){case"T":c.items[t].attrs.translate.x+=e[1],c.items[t].attrs.translate.y+=e[2];break;case"S":c.items[t].attrs.scale.x*=e[1],c.items[t].attrs.scale.y*=e[2];break;case"R":c.items[t].attrs.rotate+=e[1]}})}),"set"!==i.type&&(c.attrs.rotate=c.items[0].attrs.rotate,c.attrs.scale=c.items[0].attrs.scale,c.attrs.translate=c.items[0].attrs.translate,c.items[0].attrs={rotate:0,scale:{x:1,y:1},translate:{x:0,y:0}},c.items[0].transformString=""),c.attrs.ratio=c.attrs.scale.x/c.attrs.scale.y,c.updateHandles(),c);function u(e){var t,a,i=[];return"number"!=typeof e&&(e=0),t={x:c.attrs.rotate*Math.PI/180,y:(c.attrs.rotate+90)*Math.PI/180},a={x:c.attrs.size.x/2*c.attrs.scale.x+e,y:c.attrs.size.y/2*c.attrs.scale.y+e},[{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}].map(function(e){i.push({x:c.attrs.center.x+c.attrs.translate.x+e.x*a.x*Math.cos(t.x)+e.y*a.y*Math.cos(t.y),y:c.attrs.center.y+c.attrs.translate.y+e.x*a.x*Math.sin(t.x)+e.y*a.y*Math.sin(t.y)})}),i}function h(){var e={x:/^([0-9]+)%$/.exec(d.width),y:/^([0-9]+)%$/.exec(d.height)};return{x:e.x?d.canvas.clientWidth||d.canvas.parentNode.clientWidth*parseInt(e.x[1],10)*.01:d.canvas.clientWidth||d.width,y:e.y?d.canvas.clientHeight||d.canvas.parentNode.clientHeight*parseInt(e.y[1],10)*.01:d.canvas.clientHeight||d.height}}function f(e){var t,a,i,n={x:0,y:0},r={x:0,y:0};e&&c.opts.snap.drag&&(t=e.x,a=e.y,[0,1].map(function(){n.x=t-Math.round(t/c.opts.snap.drag)*c.opts.snap.drag,n.y=a-Math.round(a/c.opts.snap.drag)*c.opts.snap.drag,Math.abs(n.x)<=c.opts.snapDist.drag&&(r.x=n.x),Math.abs(n.y)<=c.opts.snapDist.drag&&(r.y=n.y),t+=e.width-r.x,a+=e.height-r.y}),c.attrs.translate.x-=r.x,c.attrs.translate.y-=r.y),c.opts.boundary&&(c.opts.boundarywidth=c.opts.boundarywidth||h().x*(c.o.viewBoxRatio&&c.o.viewBoxRatio.x||1),c.opts.boundaryheight=c.opts.boundaryheight||h().y*(c.o.viewBoxRatio&&c.o.viewBoxRatio.y||1),c.attrs.center.x+c.attrs.translate.x<c.opts.boundaryx&&(c.attrs.translate.x+=c.opts.boundaryx-(c.attrs.center.x+c.attrs.translate.x)),c.attrs.center.y+c.attrs.translate.y<c.opts.boundaryy&&(c.attrs.translate.y+=c.opts.boundaryy-(c.attrs.center.y+c.attrs.translate.y)),c.attrs.center.x+c.attrs.translate.x>c.opts.boundaryx+c.opts.boundarywidth&&(c.attrs.translate.x+=c.opts.boundaryx+c.opts.boundarywidth-(c.attrs.center.x+c.attrs.translate.x)),c.attrs.center.y+c.attrs.translate.y>c.opts.boundaryy+c.opts.boundaryheight&&(c.attrs.translate.y+=c.opts.boundaryy+c.opts.boundaryheight-(c.attrs.center.y+c.attrs.translate.y))),n=Math.abs(c.attrs.rotate%c.opts.snap.rotate),(n=Math.min(n,c.opts.snap.rotate-n))<c.opts.snapDist.rotate&&(c.attrs.rotate=Math.round(c.attrs.rotate/c.opts.snap.rotate)*c.opts.snap.rotate),n={x:Math.abs(c.attrs.scale.x*c.attrs.size.x%c.opts.snap.scale),y:Math.abs(c.attrs.scale.y*c.attrs.size.x%c.opts.snap.scale)},(n={x:Math.min(n.x,c.opts.snap.scale-n.x),y:Math.min(n.y,c.opts.snap.scale-n.y)}).x<c.opts.snapDist.scale&&(c.attrs.scale.x=Math.round(c.attrs.scale.x*c.attrs.size.x/c.opts.snap.scale)*c.opts.snap.scale/c.attrs.size.x),n.y<c.opts.snapDist.scale&&(c.attrs.scale.y=Math.round(c.attrs.scale.y*c.attrs.size.y/c.opts.snap.scale)*c.opts.snap.scale/c.attrs.size.y),c.opts.range.rotate&&(180<(i=(360+c.attrs.rotate)%360)&&(i-=360),i<c.opts.range.rotate[0]&&(c.attrs.rotate+=c.opts.range.rotate[0]-i),i>c.opts.range.rotate[1]&&(c.attrs.rotate+=c.opts.range.rotate[1]-i)),c.opts.range.scale&&(c.attrs.scale.x*c.attrs.size.x<c.opts.range.scale[0]&&(c.attrs.scale.x=c.opts.range.scale[0]/c.attrs.size.x),c.attrs.scale.y*c.attrs.size.y<c.opts.range.scale[0]&&(c.attrs.scale.y=c.opts.range.scale[0]/c.attrs.size.y),c.attrs.scale.x*c.attrs.size.x>c.opts.range.scale[1]&&(c.attrs.scale.x=c.opts.range.scale[1]/c.attrs.size.x),c.attrs.scale.y*c.attrs.size.y>c.opts.range.scale[1]&&(c.attrs.scale.y=c.opts.range.scale[1]/c.attrs.size.y))}function p(){return{x:c.attrs.scale.x*c.attrs.size.x>=c.opts.range.scale[0]&&c.attrs.scale.x*c.attrs.size.x<=c.opts.range.scale[1],y:c.attrs.scale.y*c.attrs.size.y>=c.opts.range.scale[0]&&c.attrs.scale.y*c.attrs.size.y<=c.opts.range.scale[1]}}function g(e){"x"===e?c.attrs.scale.y=c.attrs.scale.x/c.attrs.ratio:c.attrs.scale.x=c.attrs.scale.y*c.attrs.ratio}function m(e){var t,a={};for(t in e)a[t]="object"==typeof e[t]?m(e[t]):e[t];return a}function y(e){var a=[];c.callback&&(e.map(function(e,t){e&&a.push(e)}),clearTimeout(r),r=setTimeout(function(){c.callback&&c.callback(c,a,u())},.1))}}}),function(d){function e(e){var o,l;"string"==typeof e.data&&(e.data={keys:e.data}),e.data&&e.data.keys&&"string"==typeof e.data.keys&&(o=e.handler,l=e.data.keys.toLowerCase().split(" "),e.handler=function(a){if(this===a.target||!(d.hotkeys.options.filterInputAcceptingElements&&d.hotkeys.textInputTypes.test(a.target.nodeName)||d.hotkeys.options.filterContentEditable&&d(a.target).attr("contenteditable")||d.hotkeys.options.filterTextInputs&&-1<d.inArray(a.target.type,d.hotkeys.textAcceptingInputTypes))){var i="keypress"!==a.type&&d.hotkeys.specialKeys[a.which],e=String.fromCharCode(a.which).toLowerCase(),n="",t={};d.each(["alt","ctrl","shift"],function(e,t){a[t+"Key"]&&i!==t&&(n+=t+"+")}),a.metaKey&&!a.ctrlKey&&"meta"!==i&&(n+="meta+"),a.metaKey&&"meta"!==i&&-1<n.indexOf("alt+ctrl+shift+")&&(n=n.replace("alt+ctrl+shift+","hyper+")),i?t[n+i]=!0:(t[n+e]=!0,t[n+d.hotkeys.shiftNums[e]]=!0,"shift+"===n&&(t[d.hotkeys.shiftNums[e]]=!0));for(var r=0,s=l.length;r<s;r++)if(t[l[r]])return o.apply(this,arguments)}})}d.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"},textAcceptingInputTypes:["text","password","number","email","url","range","date","month","week","time","datetime","datetime-local","search","color","tel"],textInputTypes:/textarea|input|select/i,options:{filterInputAcceptingElements:!0,filterTextInputs:!0,filterContentEditable:!0}},d.each(["keydown","keyup","keypress"],function(){d.event.special[this]={add:e}})}(jQuery||this.jQuery||window.jQuery),$.Class("fr.ina.amalia.player.helpers.BrowserFeatureDetection",{isMobilePlatform:function(){return navigator.userAgent.match(/(iPod|iPhone|iPad)/)||-1<navigator.userAgent.toLowerCase().indexOf("android")}},{settings:{},logger:null,init:function(e){this.settings=$.extend({debug:!1},e||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug}))},isSupportsVideos:function(){return document.createElement("video").canPlayType?(null!==this.logger&&this.logger.info("Support html5"),!0):(null!==this.logger&&this.logger.info("Can't support html5"),!1)},isSupportsMp4:function(){return!!this.isSupportsVideos()&&(document.createElement("video").canPlayType("video/mp4")?(null!==this.logger&&this.logger.info("Support mp4"),!0):(null!==this.logger&&this.logger.info("Can't support mp4"),!1))}}),$.Class("fr.ina.amalia.player.helpers.HTML5Helper",{inFullScreen:function(){return!(!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)||!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement))},toggleFullScreen:function(e,t){if(!1===fr.ina.amalia.player.helpers.HTML5Helper.inFullScreen()||!0===t){t=e.requestFullScreen||e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullscreen||e.webkitEnterFullscreen;if(void 0!==t&&t)return t.call(e),!0}else{e=document.cancelFullScreen||document.mozCancelFullScreen||document.webkitCancelFullScreen||document.exitFullscreen||document.msExitFullscreen;if(void 0!==e&&e)return e.call(document),!1}}},{}),$.Class("fr.ina.amalia.player.helpers.UtilitiesHelper",{formatTime:function(e,t,a){var i=i||"f",t=t||25,n=Math.floor(Math.floor(1e5*(e-Math.floor(e)))*t/1e5),r=Math.floor(e/60),s=Math.floor(r/60),o=e%60;switch(e=Math.floor(e%60),r=10<=(r=Math.floor(r%60))?r:"0"+r,s=10<=s?s:"0"+s,e=10<=e?e:"0"+e,n=10<=n?n:"0"+n,a){case"h":i=s;break;case"m":i=s+":"+r;break;case"s":i=s+":"+r+":"+e;break;case"seconds":i=parseFloat(3600*parseFloat(s)+60*parseFloat(r)+parseFloat(o)).toFixed(4);break;case"mms":i=s+":"+r+":"+e+"."+o.toFixed(4).split(".")[1];break;case"ms":i=s+":"+r+":"+e+"."+o.toFixed(2).split(".")[1];break;case"f":i=s+":"+r+":"+e+":"+n;break;default:i=s+":"+r+":"+e+":"+o.toFixed(2).split(".")[1]}return i},getTimeRange:function(e,t,a){var i=[],n=a||25,r=void 0===t?"1":t;e=Math.floor(e);for(var s=0;s<=e;s+=r)if("f"===t)for(var s=Math.floor(s),o=0;o<n;o++)s+=1e3/n/1e3,i.push(fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(s,a));else i.push(fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(s,a));return i},getRangesWithStartAndEndTime:function(e,t,a){for(var i=[],n=void 0===a?"1":a,r=e;r<=t;r+=n)i.push(r);return i},convertHourToSeconde:function(e){var t=null,a=/\d{2}:\d{2}:\d{2}/.exec(e);return null!==a&&(a=e.split(":"),t=60*Math.floor(a[0])*60+60*Math.floor(a[1])+parseFloat(a[2])),t},convertTimeFPSToSeconde:function(e,t){var a=null,i=t||25,t=/\d{2}:\d{2}:\d{2}:\d{2}/.exec(e);return null!==t&&(t=e.split(":"),a=60*Math.floor(t[0])*60+60*Math.floor(t[1])+parseFloat(t[2])+1e3*parseFloat(t[3])/i/1e3),a},uint6ToB64:function(e){return e<26?e+65:e<52?e+71:e<62?e-4:62===e?43:63===e?47:65},b64ToUint6:function(e){return 64<e&&e<91?e-65:96<e&&e<123?e-71:47<e&&e<58?e+4:43===e?62:47===e?63:0},base64DecToArr:function(e,t){for(var a,i,n=e.replace(/[^A-Za-z0-9\+\/]/g,""),r=n.length,s=t?Math.ceil((3*r+1>>2)/t)*t:3*r+1>>2,o=new Uint8Array(s),l=0,d=0,u=0;u<r;u++)if(i=3&u,l|=fr.ina.amalia.player.helpers.UtilitiesHelper.b64ToUint6(n.charCodeAt(u))<<18-6*i,3==i||r-u==1){for(a=0;a<3&&d<s;a++,d++)o[d]=l>>>(16>>>a&24)&255;l=0}return o},generateUUID:function(e){var a=(new Date).getTime();return(e||"")+"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"===e?t:t&&11).toString(16)})},htmlEscape:function(e){return String(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}},{}),$.Class("fr.ina.amalia.player.PlayerErrorCode",{ACCESS_DENIED:1001,MEDIA_FILE_NOT_FOUND:2001,CUSTOM_ERROR:3001,EXCEPTION:4001,HTTP_ERROR:5001,ABORT:6001,TIMEOUT:7008,ERROR:8008,ERROR_HTML5_SUPPORT:8e3,ERROR_LOAD_PLUGIN:9001,ERROR_MANIFEST_DASH:9002,getMessage:function(e){var t=fr.ina.amalia.player.PlayerErrorCode,a=fr.ina.amalia.player.PlayerErrorMessage;switch(e){case t.ACCESS_DENIED:return a.ACCESS_DENIED;case t.MEDIA_FILE_NOT_FOUND:return a.MEDIA_FILE_NOT_FOUND;case t.EXCEPTION:return a.EXCEPTION;case t.HTTP_ERROR:return a.HTTP_ERROR;case t.ABORT:return a.ABORT;case t.TIMEOUT:return a.TIMEOUT;case t.ERROR_LOAD_PLUGIN:return a.ERROR_LOAD_PLUGIN;case t.CUSTOM_ERROR:return a.CUSTOM_ERROR;case t.ERROR:return a.ERROR;case t.ERROR_HTML5_SUPPORT:return a.ERROR_HTML5_SUPPORT;case t.ERROR_MANIFEST_DASH:return a.ERROR_MANIFEST_DASH;default:return a.DEFAULT}}},{}),$.Class("fr.ina.amalia.player.PlayerErrorMessage",{ACCESS_DENIED:"AccÃ¨s refusÃ©.",MEDIA_FILE_NOT_FOUND:"Erreur lors du chargement du mÃ©dia.",EXCEPTION:"An exception occurred.",HTTP_ERROR:"Http response at 400 or 500 level.",ABORT:"Votre requÃªte a Ã©tÃ© interrompue.",TIMEOUT:"Demande dÃ©passÃ©.",ERROR_LOAD_PLUGIN:"Erreur inattendue lors de l'initialisation du plug-in.",CUSTOM_ERROR:"Une erreur s'est produite sur votre lecteur.",ERROR:"Une erreur s'est produite sur votre lecteur.",DEFAULT:"Une erreur s'est produite sur votre lecteur.",ERROR_HTML5_SUPPORT:"Une erreur s'est produite sur votre lecteur: Votre navigateur ne gÃ¨re pas les balises HTML5.",ERROR_MANIFEST_DASH:"Erreur lors du chargement du manifest dash"},{}),$.Class("fr.ina.amalia.player.PlayerEventType",{INIT:"fr.ina.amalia.player.PlayerEventType.INIT",STARTED:"fr.ina.amalia.player.PlayerEventType.STARTED",CAST_PLAYING:"fr.ina.amalia.player.PlayerEventType.CAST_PLAYING",CAST_PAUSED:"fr.ina.amalia.player.PlayerEventType.CAST_PAUSED",PLAYING:"fr.ina.amalia.player.PlayerEventType.PLAYING",PAUSED:"fr.ina.amalia.player.PlayerEventType.PAUSED",ENDED:"fr.ina.amalia.player.PlayerEventType.ENDED",MUTE:"fr.ina.amalia.player.PlayerEventType.MUTE",UN_MUTE:"fr.ina.amalia.player.PlayerEventType.UN_MUTE",VOLUME_CHANGE:"fr.ina.amalia.player.PlayerEventType.VOLUME_CHANGE",TIME_CHANGE:"fr.ina.amalia.player.PlayerEventType.TIME_CHANGE",FULLSCREEN_CHANGE:"fr.ina.amalia.player.PlayerEventType.FULLSCREEN_CHANGES",SEEK:"fr.ina.amalia.player.PlayerEventType.SEEK",ERROR:"fr.ina.amalia.player.PlayerEventType.ERROR",PLUGIN_READY:"fr.ina.amalia.player.PlayerEventType.PLUGIN_READY",PLUGIN_ERROR:"fr.ina.amalia.player.PlayerEventType.PLUGIN_ERROR",DATA_CHANGE:"fr.ina.amalia.player.PlayerEventType.DATA_CHANGE",BEGIN_DATA_CHANGE:"fr.ina.amalia.player.PlayerEventType.BEGIN_DATA_CHANGE",END_DATA_CHANGE:"fr.ina.amalia.player.PlayerEventType.END_DATA_CHANGE",IMAGE_CAPTURE:"fr.ina.amalia.player.PlayerEventType.IMAGE_CAPTURE",ZOOM_RANGE_CHANGE:"fr.ina.amalia.player.PlayerEventType.ZOOM_RANGE_CHANGE",SELECTED_METADATA_CHANGE:"fr.ina.amalia.player.PlayerEventType.SELECTED_METADATA_CHANGE",SELECTED_ITEMS_CHANGE:"fr.ina.amalia.player.PlayerEventType.SELECTED_ITEMS_CHANGE",BIND_METADATA:"fr.ina.amalia.player.PlayerEventType.BIND_METADATA",UNBIND_METADATA:"fr.ina.amalia.player.PlayerEventType.UNBIND_METADATA",PLAYBACK_RATE_CHANGE:"fr.ina.amalia.player.PlayerEventType.PLAYBACK_RATE_CHANGE",START_SEEKING:"fr.ina.amalia.player.PlayerEventType.START_SEEKING",STOP_SEEKING:"fr.ina.amalia.player.PlayerEventType.STOP_SEEKING",SEEKING:"fr.ina.amalia.player.PlayerEventType.SEEKING"},{}),$.Class("fr.ina.amalia.player.PlayerMessage",{PLAYER_OPENSOURCE_LINK:"Disponibles en open source.",PLUGIN_OVERLAY_CONTEXT_MENU_ENABLED_DISABLED_PLUGIN:"Activer/dÃ©sactiver le plugin overlay.",PLUGIN_TIMELINE_LABEL_ELEMENTS:"Ã©lÃ©ments.",PLUGIN_TIMELINE_LABEL_ZOOM_IN:"Zoom avant",PLUGIN_TIMELINE_LABEL_ZOOM_OUT:"Zoom arriÃ¨re",PLUGIN_TIMELINE_LABEL_CHANGE_DISPLAY:"Changer la hauteur des lignes.",PLUGIN_TIMELINE_LABEL_SLIDE_LEFT:"Faire dÃ©filer vers la gauche",PLUGIN_TIMELINE_LABEL_SLIDE_RIGHT:"Faire dÃ©filer vers la droite",PLUGIN_TIMELINE_LABEL_SCROLL_UP:"Faire dÃ©filer vers le haut",PLUGIN_TIMELINE_LABEL_SCROLL_DOWN:"Faire dÃ©filer vers le bas",PLUGIN_TIMELINE_LABEL_SHOW_HIDE_TOOTIP:"Activer/dÃ©sactiver les infobulles",PLUGIN_TIMELINE_LABEL_EXPAND:"Maximiser / Minimiser",PLUGIN_TIMELINE_LABEL_SORT:"Trier",PLUGIN_TIMELINE_LABEL_NAV_POINT_PREV:"Aller au marqueur prÃ©cÃ©dent",PLUGIN_TIMELINE_LABEL_NAV_POINT_NEXT:"Aller au marqueur suivant",PLUGIN_TIMELINE_LABEL_TIMEAXIS:"Axe temporel",PLUGIN_TIMELINE_LABEL_FOCUS:"Zoom",PLUGIN_TIMELINE_LABEL_CLOSE:"Fermer",PLUGIN_METADATA_LIST_EDITOR_LABEL_HEADER:"Metadata list editor",PLUGIN_METADATA_BLOCK_EDITOR_LABEL_HEADER:"Metadata block editor",PLUGIN_METADATA_ITEMS_EDITOR_LABEL_HEADER:"Metadata items editor",PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_ID:"ID",PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_LABAL:"Etiquette",PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_TYPE:"Type",PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_DESCRIPTION:"Description",PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_REFERENCE:"RÃ©fÃ©rence",PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_AUTHOR:"Auteur",PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_SHAPE:"Forme",PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_COLOR:"Couleur",PLUGIN_METADATA_ITEMS_EDITOR_NEED_METADTA:"Vous devez sÃ©lectionner au moins un Ã©lÃ©ment dans la liste des mÃ©tadonnÃ©es avant de l'ajouter Ã©lÃ©ment.",PLUGIN_METADATA_ITEMS_EDITOR_NEED_METADTA_ITEM_TYPE:"Vous devez dÃ©finir le type Ã©lÃ©ment.",PLUGIN_TIMELINE_LABEL_BIND:"Attacher/Detacher",PLUGIN_D3JS_CHART_LABELS:["GroupÃ©s","EmpilÃ©s"]},{}),$.Class("fr.ina.amalia.player.BaseLoader",{},{settings:{},logger:null,data:null,handlerData:{},completeHandler:null,player:null,waitLoadEvent:!1,parser:null,init:function(e,t,a,i){this.settings=$.extend({debug:!1,sublocalisations:!1},e||{}),this.player=t,this.parser=null,this.handlerData=$.extend({debug:!1},i||{}),this.completeHandler=a,this.logger=null,void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),this.initialize()},initialize:function(){null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize"),this.initializeParser()},initializeParser:function(){if(this.parser=null,"json"===this.settings.format)this.parser=new fr.ina.amalia.player.parsers.BaseParserMetadata(this.settings);else try{this.parser=eval("new "+this.settings.format+"(this.settings)")}catch(error){this.parser=null,null!==this.logger&&(this.logger.warn("Unknown host configuration type."),this.logger.error(error.stack))}},setRequestType:function(e){this.requestType=e},setDataType:function(e){this.dataType=e},setTimeout:function(e){this.timeout=e},setSendData:function(e){this.sendData=$.extend(this.sendData,e||{})},getSendData:function(){return this.sendData},getWaitLoadEvent:function(){return this.waitLoadEvent},getData:function(){return this.data},onSuccess:function(e,t){null!==this.logger&&this.logger.trace(this.Class.fullName,"onSuccess status: "+t)},onError:function(e){null!==this.logger&&this.logger.trace(this.Class.fullName,"onError status :"+e)}}),fr.ina.amalia.player.BaseLoader.extend("fr.ina.amalia.player.HttpLoader",{},{requestType:"GET",dataType:"json",sendData:{},timeout:12e4,init:function(e,t,a,i){this._super(e,t,a,i),this.waitLoadEvent=!0},initialize:function(){this._super(),this.load(this.settings.url)},load:function(e){var a=this;$.ajax({type:this.requestType,url:e,timeout:this.timeout,data:this.sendData,dataType:this.dataType,success:function(e,t){a.onSuccess(e,t)},error:function(e,t){a.onError(t)}}),null!==this.logger&&this.logger.trace(this.Class.fullName,"Load url :"+e)},onSuccess:function(e,t){this._super(e,t),(this.data=null)!==this.parser&&(this.data=this.parser.processParserData(e),this.player.addAllMetadata(this.data)),"function"==typeof this.completeHandler&&this.completeHandler(this.handlerData,t)},onError:function(e){this._super(e),this.data=null,"function"==typeof this.completeHandler&&this.completeHandler(this.handlerData,e)}}),fr.ina.amalia.player.BaseLoader.extend("fr.ina.amalia.player.WsLoader",{},{socket:null,listOfMetadata:null,init:function(e,t,a,i){this._super(e,t,a,i),this.waitLoadEvent=!1},initialize:function(){this._super(),this.socket=null,this.listOfMetadata=[],this.connect(this.settings.url),this.player.getContainer().on(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{self:this},this.onPlayerDataChange)},connect:function(e){null!==this.logger&&this.logger.trace(this.Class.fullName,"Load url :"+e),"function"==typeof WebSocket?(this.socket=new WebSocket(e),null!==this.socket&&$(this.socket).on("open",{self:this},this.onOpen).on("close",{self:this},this.onClose).on("message",{self:this},this.onMessage).on("error",{self:this},this.onError)):null!==this.logger&&this.logger.error("Error: WebSocket is not supported by this browser or the server is not started.")},onOpen:function(e){null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"WebSocket connection opened")},onClose:function(e){(e.data.self.socket=null)!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"WebSocket connection closed")},onMessage:function(t){try{var e=JSON.parse(t.originalEvent.data);t.data.self.data=t.data.self.parser.processParserData(e);var a=t.data.self.data.viewControl,i=null!==t.data.self.data.viewControl&&t.data.self.data.viewControl.hasOwnProperty("action")?t.data.self.data.viewControl.action:"";if(null!==t.data.self.data)switch(i){case"add-all":t.data.self.player.updateBlockMetadata(t.data.self.data.id,{id:t.data.self.data.id,label:t.data.self.data.label,type:t.data.self.data.hasOwnProperty("type")?t.data.self.data.type:"default",author:null!==a&&a.hasOwnProperty("author")?a.author:"",color:null!==a&&a.hasOwnProperty("color")?a.color:"#3cf",shape:null!==a&&a.hasOwnProperty("shape")&&""!==a.shape?a.shape:"circle"},null),t.data.self.player.addMetadataById(t.data.self.data.id,t.data.self.data.list);break;case"replace-all":t.data.self.player.updateBlockMetadata(t.data.self.data.id,{id:t.data.self.data.id,label:t.data.self.data.label,type:t.data.self.data.hasOwnProperty("type")?t.data.self.data.type:"default",author:null!==a&&a.hasOwnProperty("author")?a.author:"",color:null!==a&&a.hasOwnProperty("color")?a.color:"#3cf",shape:null!==a&&a.hasOwnProperty("shape")&&""!==a.shape?a.shape:"circle"},i),t.data.self.player.replaceAllMetadataById(t.data.self.data.id,t.data.self.data.list);break;case"delete-all":t.data.self.player.deleteAllMetadataById(t.data.self.data.id);break;default:t.data.self.player.updateBlockMetadata(t.data.self.data.id,{id:t.data.self.data.id,label:t.data.self.data.label,type:t.data.self.data.hasOwnProperty("type")?t.data.self.data.type:"default",author:null!==a&&a.hasOwnProperty("author")?a.author:"",color:null!==a&&a.hasOwnProperty("color")?a.color:"#3cf",shape:null!==a&&a.hasOwnProperty("shape")&&""!==a.shape?a.shape:"circle"},null),t.data.self.player.addMetadataById(t.data.self.data.id,t.data.self.data.list)}}catch(e){(t.data.self.data=null)!==t.data.self.logger&&(t.data.self.logger.error("Error to add metadata"),t.data.self.logger.error(t.originalEvent.data))}},onError:function(e){e.data.self.socket=null,(e.data.self.data=null)!==e.data.self.logger&&(e.data.self.logger.error("Error to initialize, web socket connection."),e.data.self.logger.error(e))},onPlayerDataChange:function(e,t){null!==e.data.self.logger&&(e.data.self.logger.trace(e.data.self.Class.fullName,"onPlayerDataChange"),e.data.self.logger.debug(e),e.data.self.logger.debug(e.data.self.player.getMetadataById(t.id)))}}),fr.ina.amalia.player.BaseLoader.extend("fr.ina.amalia.player.JsonLoader",{},{requestType:"GET",dataType:"json",sendData:{},timeout:12e4,init:function(e,t,a,i){this._super(e,t,a,i),this.waitLoadEvent=!0},initialize:function(){this._super(),this.load(this.settings)},load:function(e){this.onSuccess([e.data],"success")},onSuccess:function(e,t){this._super(e,t),this.data=this.parser.processParserData(e),this.player.addAllMetadata(this.data),"function"==typeof this.completeHandler&&this.completeHandler(this.handlerData,t)}}),$.Class("fr.ina.amalia.player.parsers.BaseParserMetadata",{},{settings:{},logger:null,data:null,init:function(e){this.settings=$.extend({debug:!1,mainLevel:!1},e||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug}))},processParserData:function(e){if(null!=e){if(!0===e.hasOwnProperty("status")&&!0===e.hasOwnProperty("data")&&0===e.status&&null!==e)return this.parseData(e.data);if(!0===e.hasOwnProperty("id"))return this.parseData(e);if("undefined"!==e.length)return this.parseData(e)}return null!==this.logger&&(this.logger.warn(this.Class.fullName,"Error while filtering Data."),this.logger.warn(e)),null},parseData:function(e){var t=null;if(null!==this.logger&&this.logger.trace(this.Class.fullName,"parseData"),void 0!==e.length)for(var a in t=[],e)if("string"==typeof e[a])try{e[a]=JSON.parse(e[a]),t.push(this.getData(e[a]))}catch(e){null!==this.logger&&this.logger.warn("parseData : Error to find data type.")}else!0===e[a].hasOwnProperty("id")?t.push(this.getData(e[a])):null!==this.logger&&this.logger.warn("parseData : Error to find data type.");else!0===e.hasOwnProperty("id")?t=this.getData(e):null!==this.logger&&this.logger.warn("parseData : Error to find data type.");return t},getData:function(e){var t=null;if((t={}).id=e.id,t.type=e.type,t.viewControl=e.hasOwnProperty("viewControl")?e.viewControl:null,t.label=e.hasOwnProperty("label")?e.label:e.id,t.list=[],!0===e.hasOwnProperty("localisation")&&null!==e.localisation&&0<e.localisation.length){var a,i,n=null,r=null,s=null;if(null!=(n=((!this.settings.hasOwnProperty("parameters")||null===this.settings.parameters||!this.settings.parameters.hasOwnProperty("mainLevel")||!0!==this.settings.parameters.mainLevel)&&!0===e.localisation[0].hasOwnProperty("sublocalisations")&&null!==e.localisation[0].sublocalisations&&e.localisation[0].sublocalisations.hasOwnProperty("localisation")?e.localisation[0].sublocalisations:e).localisation)&&n.hasOwnProperty("length"))for(var o=0;o<n.length;o++)a=(s=n[o]).hasOwnProperty("label")?s.label:"",i=s.hasOwnProperty("thumb")?s.thumb:null,!0===s.hasOwnProperty("tcin")&&!0===s.hasOwnProperty("tcout")?(r={id:!0===s.hasOwnProperty("id")?s.id:null,shape:!0===s.hasOwnProperty("shape")?s.shape:null,data:!0===s.hasOwnProperty("data")?s.data:null,sublocalisations:!0===s.hasOwnProperty("sublocalisations")?s.sublocalisations:null,label:a,thumb:i,tclevel:!0===s.hasOwnProperty("tclevel")?s.tclevel:0,tc:"number"==typeof s.tc?s.tc:fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(s.tc),tcin:"number"==typeof s.tcin?s.tcin:fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(s.tcin),tcout:"number"==typeof s.tcout?s.tcout:fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(s.tcout),duration:fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(s.tcout)-fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(s.tcin),type:!0===s.hasOwnProperty("type")?s.type:null,score:!0===s.hasOwnProperty("score")?parseFloat(s.score):null},t.list.push(r)):!0===s.hasOwnProperty("tc")&&null!==s.tc&&(r={id:!0===s.hasOwnProperty("id")?s.id:null,shape:!0===s.hasOwnProperty("shape")?s.shape:null,data:!0===s.hasOwnProperty("data")?s.data:null,sublocalisations:!0===s.hasOwnProperty("sublocalisations")?s.sublocalisations:null,label:a,thumb:i,tclevel:!0===s.hasOwnProperty("tclevel")?s.tclevel:0,tc:"number"==typeof s.tc?s.tc:fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(s.tc),type:!0===s.hasOwnProperty("type")?s.type:null,score:!0===s.hasOwnProperty("score")?parseFloat(s.score):null},t.list.push(r))}return t}}),$.Class("fr.ina.amalia.player.MetadataManager",{},{mediaPlayer:null,logger:null,settings:{},listOfBlocks:{},listOfMetadata:[],listOfSelectedItems:[],selectedMetadataId:null,init:function(e,t){if(this.mediaPlayer=t,this.listOfBlocks={},this.listOfMetadata=[],this.listOfSelectedItems=[],this.selectedMetadataId=null,this.selectedMetadataId=null,this.settings=$.extend({debug:!1,internalPlugin:!1},e||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),null===this.mediaPlayer)throw new Error("Can't initialize plugin name"+this.Class.fullName)},getBlocksMetadata:function(){try{var e,t,a={};for(e in this.listOfBlocks)this.listOfBlocks.hasOwnProperty(e)&&(t=JSON.parse(JSON.stringify(this.listOfBlocks[e])),void 0!==this.listOfMetadata[e]?t.localisation=JSON.parse(JSON.stringify(this.listOfMetadata[e],function(e,t){if("refLoc"!==e)return t})):t.localisation=null,a[e]=t);return a}catch(e){null!==this.logger&&(this.logger.warn("Error to return blocks"),this.logger.error(e.stack))}return null},getBlockMetadata:function(e){var t=null;try{void 0!==this.listOfBlocks[e]&&(t=this.listOfBlocks[e],void 0!==this.listOfMetadata[e]?t.localisation=JSON.parse(JSON.stringify(this.listOfMetadata[e],function(e,t){return"refLoc"===e?void 0:t})):t.localisation=null)}catch(e){null!==this.logger&&(this.logger.warn("Error to return blocks"),this.logger.error(e.stack))}return t},updateBlockMetadata:function(e,t,a){try{"object"==typeof t?this.listOfBlocks[e]=$.extend(this.listOfBlocks[e],JSON.parse(JSON.stringify(t))):"string"==typeof t&&(this.listOfBlocks[e]=$.extend(this.listOfBlocks[e],JSON.parse(t))),void 0===this.listOfMetadata[e]&&(this.listOfMetadata[e]=[]),this.listOfBlocks[e].hasOwnProperty("localisation")&&this.listOfBlocks[e].localisation&&(this.listOfMetadata[e]=this.listOfBlocks[e].localisation),this.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:e,action:a})}catch(e){null!==this.logger&&(this.logger.warn("Error to add blocks"),this.logger.error(e.stack))}},removeBlockMetadata:function(e){return delete this.listOfBlocks[e]},addAllMetadata:function(e){if("object"==typeof e&&null!==e)if(void 0!==e.length)for(var t in e)if(e[t].hasOwnProperty("id")){void 0===this.listOfMetadata[e[t].id]&&(this.listOfMetadata[e[t].id]=[]);for(var a,i=0;i<e[t].list.length;i++){var n=e[t].list[i];this.listOfMetadata[e[t].id].push(n)}!0===e[t].hasOwnProperty("type")?(a=e[t],this.updateBlockMetadata(a.id,{type:a.type,id:a.id,viewControl:a.hasOwnProperty("viewControl")?a.viewControl:null,label:a.hasOwnProperty("label")?a.label:a.id})):this.updateBlockMetadata(e[t].id,{}),this.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:e[t].id}),null!==this.logger&&this.logger.info("AddAllMetadata ID:"+e[t].id)}else null!==this.logger&&this.logger.warn("parseData : Error to find data type.");else{void 0===this.listOfMetadata[e.id]&&(this.listOfMetadata[e.id]=[]);for(var r=0;r<e.list.length;r++){var s=e.list[r];this.listOfMetadata[e.id].push(s)}this.updateBlockMetadata(e.id,{id:e.id,label:e.hasOwnProperty("label")?e.label:e.id,type:e.hasOwnProperty("type")?e.type:"",viewControl:e.hasOwnProperty("viewControl")?e.viewControl:null}),this.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:e.id}),null!==this.logger&&this.logger.info("Add Metadata ID:"+e.id)}else null!==this.logger&&(this.logger.warn("Error to add metadata."),this.logger.warn(e))},addMetadataById:function(e,t){if(void 0===this.listOfMetadata[e]&&(this.listOfMetadata[e]=[],this.updateBlockMetadata(e,{})),"object"==typeof t){for(var a=0;a<t.length;a++){var i=t[a];this.listOfMetadata[e].push(i)}this.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:e})}},replaceAllMetadataById:function(e,t){if(this.listOfMetadata[e]=[],"object"==typeof t){this.listOfMetadata[e]=[];for(var a=0;a<t.length;a++){var i=t[a];this.listOfMetadata[e].push(i)}this.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:e})}},deleteAllMetadataById:function(id){var deleted;return void 0!==this.listOfMetadata[id]&&(deleted=!1,this.listOfMetadata.hasOwnProperty(id)&&(deleted=eval("delete this.listOfMetadata['"+id+"']")),deleted&&(this.removeBlockMetadata(id),this.selectedMetadataId=null,this.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.SELECTED_METADATA_CHANGE,{metadataId:this.selectedMetadataId}),this.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:id,action:"deleteBlock"}))),!1},addMetadataItem:function(e,t){if("object"!=typeof this.listOfMetadata[e]&&(this.listOfMetadata[e]=[]),"object"==typeof t){t=this.listOfMetadata[e].push(t),t=this.listOfMetadata[e][t-1];return this.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:e}),t}},getMetadataById:function(e){return void 0===this.listOfMetadata[e]?null:this.listOfMetadata[e]},setMetadataById:function(e,t){if("object"==typeof t)this.listOfMetadata[e]=t;else{if("string"!=typeof t)return!1;try{var a=JSON.parse(t);this.listOfMetadata[e]=a}catch(e){return!1}}return this.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:e}),!0},removeMetadataById:function(e){this.listOfMetadata[e]=[],this.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:e})},getMetadataWithRange:function(e,t,a){var i=this.getMetadataById(e),n=[];return null!==i&&"object"==typeof i?(n=$.grep(i,function(e){return!e.hasOwnProperty("tc")||null===e.tc||e.tc>=t&&e.tc<=a}),null!==this.logger&&this.logger.trace(this.Class.fullName,"getMetadataWithRange Id:"+e+" Tcin:"+t+" Tcout:"+a+" Number of Elements:"+i.length)):null!==this.logger&&this.logger.warn("GetMetadataWithRange:  No data id:"+e),n},getSelectedMetadataId:function(){return null!==this.selectedMetadataId?this.selectedMetadataId.toString():null},setSelectedMetadataId:function(e){this.selectedMetadataId!==e&&(this.removeAllSelectedItems(),this.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:this.selectedMetadataId}),this.selectedMetadataId=e,this.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.SELECTED_METADATA_CHANGE,{metadataId:this.selectedMetadataId}))},getSelectedItems:function(){return this.listOfSelectedItems},addSelectedItem:function(e){null!==e&&"object"==typeof e&&(e.selected=!0),this.listOfSelectedItems.push(e),this.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.SELECTED_ITEMS_CHANGE,{item:e})},removeSelectedItem:function(e){var t;"undefined"!==this.listOfSelectedItems[e]&&!1===isNaN(e)&&(null!==(t=this.listOfSelectedItems[e])&&"object"==typeof t&&!0===t.hasOwnProperty("selected")&&(t.selected=!1),-1<e&&this.listOfSelectedItems.splice(e,1))},removeAllSelectedItems:function(){if(void 0!==this.listOfSelectedItems&&this.listOfSelectedItems.hasOwnProperty("length")&&0<this.listOfSelectedItems.length)for(var e=0;e<this.listOfSelectedItems.length;e++){var t=this.listOfSelectedItems[e];null!==t&&"object"==typeof t&&!0===t.hasOwnProperty("selected")&&(t.selected=!1)}this.listOfSelectedItems=[]}}),$.Class("fr.ina.amalia.player.LocalisationManager",{},{logger:null,localisation:null,init:function(){this.localisation=[]},setLoc:function(e){this.localisation=e},getLocTc:function(){if(null!==this.localisation&&1<this.localisation.length){this.localisation.sort(function(e,t){return e.tc="number"==typeof e.tc?e.tc:parseFloat(fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(e.tc)),t.tc="number"==typeof t.tc?t.tc:parseFloat(fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(t.tc)),delete e.firstItem,delete e.lastItem,delete e.tcRange,e.tc-t.tc});for(var e=this.localisation[0],t=this.localisation[this.localisation.length-1],a=0;a<this.localisation.length;a++){var i=this.localisation[a];i.tcRange={min:e.tc,max:t.tc},i.subItem=!0}if(e.hasOwnProperty("tc")&&t.hasOwnProperty("tc"))return e.firstItem=!0,t.lastItem=!0,delete e.range,delete t.range,e.tcRange={max:t.tc},t.tcRange={min:e.tc},{tcin:e.tc,tcout:t.tc}}return null},updateSpacialLocBlock:function(e){if(null!==e&&0<e.length)for(var t=0;t<e.length;t++){var a=e[t];if(a.hasOwnProperty("sublocalisations")&&"object"==typeof a.sublocalisations&&null!==a.sublocalisations){if(0<a.sublocalisations.localisation.length){a.sublocalisations.localisation.sort(function(e,t){return e.tc-t.tc});for(var i=0;i<a.sublocalisations.localisation.length;i++){var n=a.sublocalisations.localisation[i];null===n.tc&&!0===n.deleted&&a.sublocalisations.localisation.splice(i,1)}if(a.sublocalisations.localisation.sort(function(e,t){return e.tc-t.tc}),1===a.sublocalisations.localisation.length){var r=a.sublocalisations.localisation[0];return a.tc=parseFloat(r.tc),a.shape=$.extend({},r.shape),a.sublocalisations=null,delete a.tcin,delete a.tcout,!0}if(1<a.sublocalisations.localisation.length){var s=a.sublocalisations.localisation[0],r=a.sublocalisations.localisation[a.sublocalisations.localisation.length-1];if(s.hasOwnProperty("tc")&&r.hasOwnProperty("tc"))return a.tc=parseFloat(s.tc),a.tcin=parseFloat(s.tc),a.tcout=parseFloat(r.tc),!0}}}else a.hasOwnProperty("delete")&&!0===a.delete&&e.splice(t,1)}return!1},updateLocBlock:function(e){if(null!==e&&0<e.length)for(var t=e.length-1;0<=t;t--){var a=e[t];if(null===a.tc&&null===a.tcin)e.splice(t,1);else if(a.hasOwnProperty("sublocalisations")&&null!==a.sublocalisations&&"object"==typeof a.sublocalisations&&0<a.sublocalisations.localisation.length)for(var i=a.sublocalisations.localisation.length-1;0<=i;i--){var n=a.sublocalisations.localisation[i];null===n.tc&&n.hasOwnProperty("deleted")&&!0===n.deleted&&a.sublocalisations.localisation.splice(i,1)}}return!1},shiftSpacialLocBlock:function(e,t){var a=t-e.tcin;if(e.tcout+=a,e.hasOwnProperty("sublocalisations")&&"object"==typeof e.sublocalisations){if(0<e.sublocalisations.localisation.length){e.sublocalisations.localisation.sort(function(e,t){return e.tc-t.tc});for(var i=0;i<e.sublocalisations.localisation.length;i++)e.sublocalisations.localisation[i].tc+=a}return!0}return!1},shiftLocBlock:function(e,t,a,i,n){if("object"==typeof e&&0<e.length){e.sort(function(e,t){return e.tc-t.tc});for(var r=0;r<e.length;r++){var s=e[r];(!1===n||!0===n&&s.hasOwnProperty("selected")&&!0===s.selected)&&(s.hasOwnProperty("tc")&&null!==s.tc&&(s.tc+=t),s.hasOwnProperty("tcin")&&null!==s.tcin&&(s.tcin+=t),s.hasOwnProperty("tcout")&&null!==s.tcout&&(s.tcout+=t))}return!0}return!1}}),$.Class("fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase",{},{settings:{},logger:null,element:null,component:null,mediaPlayer:null,init:function(e,t,a){this.parameter=$.extend({debug:!0},e||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.parameter.debug})),this.container=a,this.mediaPlayer=t,this.initialize()},initialize:function(){},show:function(){this.component.show()},hide:function(){this.component.hide()}}),fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase.extend("fr.ina.amalia.player.plugins.controlBar.widgets.BaseButton",{classCss:"player-base-button",style:""},{initialize:function(){this.component=$("<div>",{class:this.Class.classCss,style:this.Class.style});var e=$("<span>",{class:"button-container"}),t=$("<span>",{class:this.parameter.style});!0===this.parameter.hasOwnProperty("title")&&t.attr("title",this.parameter.title),e.append(t),this.component.on("click",{self:this,component:this.component},this.onClick),this.component.append(e),this.container.append(this.component)},onClick:function(event){if(void 0!==event.data.self.parameter.callback)try{eval(event.data.self.parameter.callback+"(event.data.self.mediaPlayer, event.data.self.parameter)")}catch(e){null!==event.data.self.logger&&event.data.self.logger.warn("Send callback failed.")}}}),fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase.extend("fr.ina.amalia.player.plugins.controlBar.widgets.TimeLabel",{classCss:"player-timelabel time-display off",style:"",eventTypes:{}},{currentTime:null,timeSeparator:null,duration:null,initialize:function(){this.component=$("<div>",{class:this.Class.classCss,style:this.Class.style}),this.currentTime=$("<span>",{class:"time-current"}),this.timeSeparator=$("<span>",{class:"time-separator"}),this.duration=$("<span>",{class:"time-duration"}),this.component.append(this.currentTime),this.component.append(this.timeSeparator),this.component.append(this.duration),this.container.append(this.component),this.definePlayerEvents()},setCurrentTime:function(e){null!==this.currentTime&&this.currentTime.text(e)},setDuration:function(e){null!==this.duration&&(this.duration.text(e),this.component.removeClass("off").addClass("on"))},definePlayerEvents:function(){this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.TIME_CHANGE,{self:this},this.onTimechange)},onTimechange:function(e,t){var a=fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(t.currentTime,e.data.self.parameter.framerate,e.data.self.parameter.timeFormat),t=fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(t.duration,e.data.self.parameter.framerate,e.data.self.parameter.timeFormat);e.data.self.setCurrentTime(a),e.data.self.setDuration(t)}}),fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase.extend("fr.ina.amalia.player.plugins.controlBar.widgets.PlayButton",{classCss:"player-play-button",style:"",playIcon:"ajs-icon ajs-icon-controlbar-play"},{initialize:function(){this.component=$("<div>",{class:this.Class.classCss,style:this.Class.style});var e=$("<span>",{class:"button-container"}),t=$("<i>",{class:this.Class.playIcon});e.append(t),this.component.append(e),this.component.on("click",{self:this,component:this.component},this.onClick),this.container.append(this.component),this.definePlayerEvents()},definePlayerEvents:function(){this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.PLAYING,{self:this},this.onPlaying),this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.PAUSED,{self:this},this.onPaused),this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.CAST_PLAYING,{self:this},this.onPlaying),this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.CAST_PAUSED,{self:this},this.onPaused)},onClick:function(e){e.data.self.mediaPlayer.getCastMode()?e.data.self.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.CAST_PLAYING):e.data.self.mediaPlayer.play()},onPlaying:function(e){e.data.self.component.addClass("off").removeClass("on")},onPaused:function(e){e.data.self.component.addClass("on").removeClass("off")}}),fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase.extend("fr.ina.amalia.player.plugins.controlBar.widgets.PauseButton",{classCss:"player-pause-button",style:"",pauseIcon:"ajs-icon ajs-icon-controlbar-pause"},{initialize:function(){this.component=$("<div>",{class:this.Class.classCss,style:this.Class.style});var e=$("<span>",{class:"button-container"}),t=$("<i>",{class:this.Class.pauseIcon});e.append(t),this.component.append(e),this.component.on("click",{self:this,component:this.component},this.onClick),this.container.append(this.component),this.definePlayerEvents(),this.component.addClass("off").removeClass("on")},definePlayerEvents:function(){this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.PLAYING,{self:this},this.onPlaying),this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.PAUSED,{self:this},this.onPaused),this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.CAST_PLAYING,{self:this},this.onPlaying),this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.CAST_PAUSED,{self:this},this.onPaused)},onClick:function(e){e.data.self.mediaPlayer.getCastMode()?e.data.self.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.CAST_PAUSED):e.data.self.mediaPlayer.isPaused()?e.data.self.mediaPlayer.play():e.data.self.mediaPlayer.pause()},onPlaying:function(e){e.data.self.component.addClass("on").removeClass("off")},onPaused:function(e){e.data.self.component.addClass("off").removeClass("on")}}),fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase.extend("fr.ina.amalia.player.plugins.controlBar.widgets.FullscreenButton",{classCss:"player-fullscreen-button",classCssFullscreenOn:"ajs-icon ajs-icon-controlbar-fullscreen",classCssFullscreenOff:"ajs-icon ajs-icon-controlbar-compress",style:"",eventTypes:{CLICK:"fr.ina.amalia.player.plugins.widgets.FullscreenButton.event.click"}},{initialize:function(){this.component=$("<div>",{class:this.Class.classCss,style:this.Class.style});var e=$("<span>",{class:this.Class.classCssFullscreenOn});this.component.append(e),this.component.on("click",{self:this,component:this.component},this.onClick),this.container.append(this.component),this.setFullscreenMode(!1),null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize"),this.definePlayerEvents()},definePlayerEvents:function(){this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.FULLSCREEN_CHANGE,{self:this},this.onFullscreenModeChange)},setFullscreenMode:function(e){!0===e?this.component.find("span").removeClass(this.Class.classCssFullscreenOn).addClass(this.Class.classCssFullscreenOff):this.component.find("span").removeClass(this.Class.classCssFullscreenOff).addClass(this.Class.classCssFullscreenOn)},onClick:function(e){e.data.self.mediaPlayer.toggleFullScreen()},onFullscreenModeChange:function(e,t){e.data.self.setFullscreenMode(t.inFullScreen)}}),fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase.extend("fr.ina.amalia.player.plugins.controlBar.widgets.VolumeControlBar",{classCss:"player-volume-control",classCssVolumeOn:"ajs-icon ajs-icon-controlbar-volume_max",classCssVolumeUp:"ajs-icon ajs-icon-controlbar-volume_max",classCssVolumeDown:"ajs-icon ajs-icon-controlbar-volume-min",classCssVolumeOff:"ajs-icon ajs-icon-controlbar-volume-off",style:"",eventTypes:{CLICK:"fr.ina.amalia.player.plugins.widgets.VolumeControlBar.event.click",CHANGE:"fr.ina.amalia.player.plugins.widgets.VolumeControlBar.event.change",HOVER:"fr.ina.amalia.player.plugins.widgets.VolumeControlBar.event.hover"}},{sliderStart:0,sliderEnd:100,defaultValue:100,volumeControlComponent:null,volumeSliderComponent:null,initialize:function(){this.volumeSliderComponent=null,this.component=$("<div>",{class:this.Class.classCss,style:this.Class.style});var e='<input class="volume-control" data-width="70" data-height="70" data-displayInput="false" data-displayPrevious="true" data-skin="tron" data-thickness=".2" data-fgColor="#13e7f0"value="'+this.defaultValue+'" >';this.component.append(e);var t=$("<div>",{class:"volume-control-btn"}),e=$("<span>");t.append(e);var a=this;this.component.find("input.volume-control").knob({change:function(e){a.onSlide(e)}}),t.on("mouseover",{self:this},this.onMouseover),t.find("span").on("click",{self:this},this.onClickVolume),this.component.find("div").append(t);e=$("<div>",{class:"volume-slider-ctn off"});this.volumeSliderComponent=$("<div>",{class:"slider-volume"}),e.append(this.volumeSliderComponent),t.append(e),this.volumeSliderComponent.slider({orientation:"vertical",min:0,max:100,range:"min",value:this.mediaPlayer.getVolume(),slide:function(e,t){a.onSlide(t.value)}}),e.on("mouseleave",{self:this},this.onMouseleave),this.container.append(this.component),this.definePlayerEvents(),this.setValue(this.mediaPlayer.getVolume()),null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize")},definePlayerEvents:function(){this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.VOLUME_CHANGE,{self:this},this.onPlayerVolumeChange)},onClick:function(e){e.data.component.trigger(e.data.self.Class.eventTypes.CLICK),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onClick/triggerevent:"+e.data.self.Class.eventTypes.CLICK)},setValue:function(e){this.component.find("input.volume-control").val(e).trigger("change");var t=this.component.find(".volume-control-btn span:first");t.attr("class",""),0===e?t.addClass(this.Class.classCssVolumeOff):e<50?t.addClass(this.Class.classCssVolumeDown):50<=e&&e<75?t.addClass(this.Class.classCssVolumeUp):75<=e&&t.addClass(this.Class.classCssVolumeOn)},onSlide:function(e){this.component.trigger(this.Class.eventTypes.CHANGE,{value:e}),this.mediaPlayer.setVolume(e),null!==this.logger&&this.logger.trace(this.Class.fullName,"onSlide/triggerevent:"+this.Class.eventTypes.CHANGE+" Value "+e)},onClickVolume:function(e){var t=50<e.data.self.mediaPlayer.getVolume()?0:100;e.data.self.mediaPlayer.setVolume(t),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onClickVolume:"+e.data.self.Class.eventTypes.CHANGE+" Value "+t)},onPlayerVolumeChange:function(e,t){null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onPlayerVolumeChange"+parseInt(t.volume)),e.data.self.setValue(parseInt(t.volume)),e.data.self.volumeSliderComponent.slider("value",parseInt(t.volume))},onMouseover:function(e){e.data.self.component.find(".volume-slider-ctn").addClass("on").removeClass("off"),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onMouseover")},onMouseleave:function(e){e.data.self.component.find(".volume-slider-ctn").addClass("off").removeClass("on"),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onMouseover")}}),fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase.extend("fr.ina.amalia.player.plugins.controlBar.widgets.ProgressBar",{classCss:"player-progress-bar",style:""},{sliderStart:0,sliderEnd:1e3,sliding:!1,defaultValue:0,lastSlideEvent:0,lastPlaybackState:!1,initialize:function(){this.lastPlaybackState=!1,this.component=$("<div>",{class:this.Class.classCss,style:this.Class.style}),this.component.slider({range:"min",min:this.sliderStart,max:this.sliderEnd,value:this.defaultValue,height:10,framepreview:!0,framepreviewTimeBound:500}),this.component.prepend($("<div>",{class:"buffer-bar"})),this.component.on("slidestart",{self:this,component:this.component},this.onSlideStart),this.component.on("slidestop",{self:this,component:this.component},this.onSlideStop),this.component.on("slide",{self:this,component:this.component},this.onSlide),this.container.append(this.component),this.definePlayerEvents()},setValue:function(e){!1===this.sliding&&this.component.slider("value",10*e)},setTitle:function(e){this.component.attr("title",e)},updateBuffer:function(e,t){this.component.find(".buffer-bar").css({left:e+"%",width:t+"%"})},definePlayerEvents:function(){this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.TIME_CHANGE,{self:this},this.onTimechange)},onTimechange:function(e,t){var a=fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(t.currentTime,e.data.self.settings.framerate,e.data.self.settings.timeFormat);e.data.self.setValue(t.percentage),e.data.self.setTitle(a),null!==e.data.self.mediaPlayer.getMediaPlayer()&&void 0!==e.data.self.mediaPlayer.getMediaPlayer().get(0).buffered&&0<e.data.self.mediaPlayer.getMediaPlayer().get(0).buffered.length&&(t=100*e.data.self.mediaPlayer.getMediaPlayer().get(0).buffered.end(Math.max(0,e.data.self.mediaPlayer.getMediaPlayer().get(0).buffered.length-1))/(t.duration-t.tcOffset),e.data.self.updateBuffer(0,t))},onSlideStart:function(e,t){e.data.self.sliding=!0,e.data.self.lastPlaybackState=!e.data.self.mediaPlayer.isPaused(),e.data.self.mediaPlayer.pause(),e.data.self.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.START_SEEKING,{percentage:t.value/10}),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onSlideStart Value : "+t.value)},onSlideStop:function(e,t){e.data.self.sliding=!1;var a=e.data.self.mediaPlayer.getDuration(),i=t.value/10;e.data.self.mediaPlayer.setCurrentTime(a*i/100+e.data.self.mediaPlayer.getTcOffset()),!0===e.data.self.lastPlaybackState&&e.data.self.mediaPlayer.play(),e.data.self.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.STOP_SEEKING,{percentage:t.value/10}),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onSlideStop value : "+t.value)},onSlide:function(e,t){var a,i;e.data.self.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.SEEKING,{percentage:t.value/10}),!0===e.data.self.parameter.framepreview&&new Date-e.data.self.lastSlideEvent>e.data.self.parameter.framepreviewTimeBound&&(e.data.self.lastSlideEvent=new Date,a=e.data.self.mediaPlayer.getDuration(),i=t.value/10,e.data.self.mediaPlayer.setCurrentTime(a*i/100+e.data.self.mediaPlayer.getTcOffset()),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onSlide value : "+t.value))}}),fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase.extend("fr.ina.amalia.player.plugins.controlBar.widgets.Label",{classCss:"iplayer-Label label label-default",style:"",eventTypes:{}},{initialize:function(){this.component=$("<div>",{class:this.Class.classCss,style:this.Class.style,text:this.parameter.defaultValue}),this.container.append(this.component),null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize")},setValue:function(e){this.component.text(e)}}),fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase.extend("fr.ina.amalia.player.plugins.controlBar.widgets.JogShuttleButton",{classCss:"player-jog-shuttle-button",style:""},{playbackSpeed:3,playbackDefaultSpeed:4,playbackSpeedList:[-2,-1,-.5,-.1,1,.5,1.5,4,8],forwardSpeedIdx:0,backwardSpeedIdx:0,backwardSpeedList:[{style:"ajs-icon ajs-icon-jogs-backward-0x",speed:1},{style:"ajs-icon ajs-icon-jogs-backward-1x",speed:-.1},{style:"ajs-icon ajs-icon-jogs-backward-1x",speed:-.25},{style:"ajs-icon ajs-icon-jogs-backward-2x",speed:-.5},{style:"ajs-icon ajs-icon-jogs-backward-2x",speed:-.75},{style:"ajs-icon ajs-icon-jogs-backward-3x",speed:-1},{style:"ajs-icon ajs-icon-jogs-backward-3x",speed:-1.5},{style:"ajs-icon ajs-icon-jogs-backward-4x",speed:-2}],forwardSpeedList:[{style:"ajs-icon ajs-icon-jogs-forward-0x",speed:1},{style:"ajs-icon ajs-icon-jogs-forward-1x",speed:.5},{style:"ajs-icon ajs-icon-jogs-forward-1x",speed:.75},{style:"ajs-icon ajs-icon-jogs-forward-2x",speed:1.5},{style:"ajs-icon ajs-icon-jogs-forward-2x",speed:2},{style:"ajs-icon ajs-icon-jogs-forward-3x",speed:4},{style:"ajs-icon ajs-icon-jogs-forward-3x",speed:6},{style:"ajs-icon ajs-icon-jogs-forward-4x",speed:8}],sliding:!1,initialize:function(){this.forwardSpeedIdx=0,this.backwardSpeedIdx=0,this.sliding=!1,this.component=$("<div>",{class:this.Class.classCss,style:this.Class.style});var e=$("<span>",{class:"button-container"}),t=$("<div>",{class:"backward-container ajs-icon ajs-icon-jogs-backward-4x"}),a=$("<span>",{class:this.backwardSpeedList[0].style});t.append(a),t.on("click",{self:this},this.onClickToBackward),t.on("dblclick",{self:this},this.onDblClickToBackward),e.append(t);a=$("<div>",{class:"forward-container ajs-icon ajs-icon-jogs-forward-4x"}),t=$("<span>",{class:this.forwardSpeedList[0].style});a.append(t),a.on("click",{self:this},this.onClickToForward),a.on("dblclick",{self:this},this.onDblClickToForward),e.append(a);a=$("<div>",{class:"jog-shuttle-separator"}).on("mouseover",{self:this},this.onHoverJogShuttle);e.append(a);var i=this,a=$("<div>",{class:"jog-shuttle"}).slider({min:0,max:8,value:i.playbackDefaultSpeed,slide:function(e,t){i.playbackSpeedList.length>=t.value&&i.setPlaybackSpeed(parseFloat(i.playbackSpeedList[t.value])),i.sliding=!0},stop:function(){$(this).slider("option","value",i.playbackDefaultSpeed),i.setPlaybackSpeed(i.playbackDefaultSpeed),i.mediaPlayer.play(),i.sliding=!1,i.component.find("div.jog-shuttle").removeClass("on")}});a.find(".ui-slider-handle").addClass("ajs-icon ajs-icon-jogs-center"),e.append(a),this.component.append(e),this.container.append(this.component),a.find(".ui-slider-handle").on("mouseleave",{self:this},this.onJogShuttleMouseout),this.definePlayerEvents()},definePlayerEvents:function(){this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.PLAYBACK_RATE_CHANGE,{self:this},this.onPlaybackRateChange)},setPlaybackSpeed:function(e){this.playbackSpeed=parseFloat(e),this.mediaPlayer.setPlaybackrate(this.playbackSpeed),null!==this.logger&&this.logger.trace(this.Class.fullName,"playbackRate:"+this.playbackSpeed)},updateControls:function(){var t=parseFloat(this.playbackSpeed),e=$.grep(this.forwardSpeedList,function(e){return e.speed===t}),a=(e.length<=0?this.forwardSpeedList:e)[0].style,e=$.grep(this.backwardSpeedList,function(e){return e.speed===t}),e=(e.length<=0?this.backwardSpeedList:e)[0].style;this.component.find(".forward-container span:first").attr("class",a),this.component.find(".backward-container span:first").attr("class",e)},onClickToForward:function(e){var t;!1===e.data.self.sliding&&(e.data.self.forwardSpeedIdx=e.data.self.forwardSpeedList.length-1>e.data.self.forwardSpeedIdx?e.data.self.forwardSpeedIdx+1:0,e.data.self.backwardSpeedIdx=0,t=e.data.self.forwardSpeedList[e.data.self.forwardSpeedIdx].speed,e.data.self.setPlaybackSpeed(t),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onClickToForward : "+e.data.self.forwardSpeedIdx))},onClickToBackward:function(e){var t;!1===e.data.self.sliding&&(e.data.self.forwardSpeedIdx=0,e.data.self.backwardSpeedIdx=e.data.self.backwardSpeedList.length-1>e.data.self.backwardSpeedIdx?e.data.self.backwardSpeedIdx+1:0,t=e.data.self.backwardSpeedList[e.data.self.backwardSpeedIdx].speed,e.data.self.setPlaybackSpeed(t),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onClickToBackward :"+e.data.self.backwardSpeedIdx))},onDblClickToForward:function(e){e.data.self.forwardSpeedIdx=0,e.data.self.mediaPlayer.setCurrentTime(e.data.self.mediaPlayer.getDuration());var t=e.data.self.forwardSpeedList[0].style;e.data.self.component.find(".forward-container span:first").attr("class","ajs-icon ajs-icon-jogs-fast-forward").delay(1500).queue(function(){e.data.self.component.find(".forward-container span:first").attr("class",t)}),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onDbClickToForward : "+e.data.self.forwardSpeedIdx)},onDblClickToBackward:function(e){e.data.self.backwardSpeedIdx=0,e.data.self.mediaPlayer.setCurrentTime(0);var t=e.data.self.backwardSpeedList[0].style;e.data.self.component.find(".backward-container span:first").attr("class","ajs-icon ajs-icon-jogs-fast-backward").delay(1500).queue(function(){e.data.self.component.find(".backward-container span:first").attr("class",t)}),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onDbClickToBackward :"+e.data.self.backwardSpeedIdx)},onHoverJogShuttle:function(e){e.data.self.component.find("div.jog-shuttle").addClass("on")},onJogShuttleMouseout:function(e){!1===e.data.self.sliding&&e.data.self.component.find("div.jog-shuttle").removeClass("on")},onPlaybackRateChange:function(e,t){e.data.self.playbackSpeed=parseFloat(t.rate),e.data.self.updateControls(),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"playbackRate:"+e.data.self.playbackSpeed)}}),fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase.extend("fr.ina.amalia.player.plugins.controlBar.widgets.ChannelVolumeControlBar",{mainClassCss:"player-channel-volume-control-position",classCss:"player-channel-volume-control",classCssVolumeOn:"ajs-icon ajs-icon-controlbar-volume_max",classCssVolumeDown:"ajs-icon ajs-icon-controlbar-volume-min",classCssVolumeOff:"ajs-icon ajs-icon-controlbar-volume-off",classUnifyVolumeStateOn:"ajs-icon-sound-link-on",classUnifyVolumeStateOff:"ajs-icon-sound-link-off",classLeftVolumeStateOn:"ajs-icon-controlbar-volume-left",classLeftVolumeStateOff:"ajs-icon-controlbar-volume-left-off",classRightVolumeStateOn:"ajs-icon-controlbar-volume-right",classRightVolumeStateOff:"ajs-icon-controlbar-volume-right-off",style:"",eventTypes:{CLICK:"fr.ina.amalia.player.plugins.widgets.VolumeControlBar.event.click",CHANGE:"fr.ina.amalia.player.plugins.widgets.VolumeControlBar.event.change",HOVER:"fr.ina.amalia.player.plugins.widgets.VolumeControlBar.event.hover"}},{sliderStart:0,sliderEnd:100,defaultValue:100,volumeControlComponent:null,audioContext:null,panLeft:null,panRight:null,channelMerger:!1,channelMergerNode:null,unifyVolumeState:!0,initialize:function(){this.defaultValue=100,this.unifyVolumeState=!0,this.channelMerger=!0!==this.parameter.hasOwnProperty("channelMerger")||this.parameter.channelMerger,this.channelMergerNode=!0===this.parameter.hasOwnProperty("channelMergerNode")&&""!==this.parameter.channelMergerNode?this.parameter.channelMergerNode:null;var e=$("<div>",{class:this.Class.mainClassCss});this.component=$("<div>",{class:this.Class.classCss,style:this.Class.style});try{this.mediaPlayer.setVolume(100);var t=window.AudioContext||window.webkitAudioContext;this.audioContext=new t,this.setupAudioNodes()}catch(e){(this.audioContext=null)!==this.logger&&this.logger.warn(e)}null!==this.audioContext&&(this.createChannelVolume(),this.definePlayerEvents(),this.updateVolume()),e.append(this.component),this.container.append(e),null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize")},setupAudioNodes:function(){var e=this.audioContext.createMediaElementSource(this.mediaPlayer.getMediaPlayer().get(0));this.panLeft=this.audioContext.createGain(),this.panRight=this.audioContext.createGain();var t,a=this.audioContext.createChannelSplitter(2);e.connect(a,0,0),a.connect(this.panLeft,0),a.connect(this.panRight,1),null!==this.channelMergerNode?((t=this.audioContext.createPanner()).coneOuterGain=1,t.coneOuterAngle=180,t.coneInnerAngle=0,"l"===this.channelMergerNode?t.setPosition(-1,0,0):"r"===this.channelMergerNode&&t.setPosition(1,0,0),this.panLeft.connect(t),this.panRight.connect(t),t.connect(this.audioContext.destination)):!0===this.channelMerger?(this.panLeft.connect(this.audioContext.destination,0),this.panRight.connect(this.audioContext.destination,0)):null===this.channelMergerNode&&(t=this.audioContext.createChannelMerger(2),this.panLeft.connect(t,0,0),this.panRight.connect(t,0,1),t.connect(this.audioContext.destination))},createChannelVolume:function(){var i=this,e=$("<div>",{class:"volume-control-btn"});e.on("click",{self:this},this.onClickToVolume),this.component.append(e);var t=$("<div>",{class:"channel-volume-sliders"});t.on("mouseleave",{self:this},this.onChannelVolumeMouseout);var a=$("<div>",{class:"channel-volume-info"});t.append(a);var n=$("<div>",{class:"channel-volume-info-left"});n.on("click",{self:this},this.onClickLeftVolume);e=$("<span>",{class:"text ajs-icon "+this.Class.classLeftVolumeStateOn,text:""});n.append(e),a.append(n);e=$("<div>",{class:"channel-volume-info-mid"}),n=$("<span>",{class:"unify on ajs-icon "+this.Class.classUnifyVolumeStateOn,text:""});n.on("click",{self:this},this.onClickUnifyVolumeState),e.append(n),a.append(e);n=$("<div>",{class:"channel-volume-info-right"});n.on("click",{self:this},this.onClickRightVolume);e=$("<span>",{class:"text ajs-icon "+this.Class.classRightVolumeStateOn,text:""});n.append(e),a.append(n);e=$("<div>",{class:"channel-volume-control"});t.append(e);a=$("<div>",{class:"channel-volume-control-left"}),n=$("<div>",{class:"left-volume-slider"});n.slider({orientation:"vertical",min:0,max:100,value:100,slide:function(e,t){i.panLeft.gain.value=t.value/100,!0===i.unifyVolumeState&&(i.panRight.gain.value=t.value/100,i.component.find(".right-volume-slider").slider("value",t.value)),i.updateVolume()},change:function(e,t){i.updateVolume(),i.panLeft.gain.value=t.value/100;var a=i.component.find(".right-volume-slider").slider("value");!0===i.unifyVolumeState&&a!==t.value&&(i.panRight.gain.value=t.value/100,i.component.find(".right-volume-slider").slider("value",t.value))}}),a.append(n),e.append(a);n=$("<div>",{class:"channel-volume-control-mid on"});e.append(n);a=$("<div>",{class:"channel-volume-control-right"}),n=$("<div>",{class:"right-volume-slider"});n.slider({orientation:"vertical",min:0,max:100,value:100,slide:function(e,t){i.panRight.gain.value=t.value/100,!0===i.unifyVolumeState&&(i.panLeft.gain.value=t.value/100,i.component.find(".left-volume-slider").slider("value",t.value),e=$(e.target).position().top+$(t.handle).outerWidth()/2,t=$(t.handle).position().top,i.component.find(".channel-volume-control-mid").css("top",t+e+"px")),i.updateVolume()},change:function(e,t){i.updateVolume();var a=$(e.target).position().top+$(t.handle).outerWidth()/2,e=$(t.handle).position().top;i.component.find(".channel-volume-control-mid").css("top",e+a+"px"),i.panRight.gain.value=t.value/100;a=i.component.find(".left-volume-slider").slider("value");!0===i.unifyVolumeState&&a!==t.value&&(i.panLeft.gain.value=t.value/100,i.component.find(".left-volume-slider").slider("value",t.value))}}),a.append(n),e.append(a),this.component.append(t)},definePlayerEvents:function(){this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.VOLUME_CHANGE,{self:this},this.onPlayerVolumeChange)},updateVolume:function(){var e=this.component.find(".left-volume-slider").slider("value"),t=this.component.find(".right-volume-slider").slider("value"),a=this.component.find(".channel-volume-info-left span.text"),i=this.component.find(".channel-volume-info-right span.text");e<10?a.addClass(this.Class.classLeftVolumeStateOff).removeClass(this.Class.classLeftVolumeStateOn):a.removeClass(this.Class.classLeftVolumeStateOff).addClass(this.Class.classLeftVolumeStateOn),t<10?i.addClass(this.Class.classRightVolumeStateOff).removeClass(this.Class.classRightVolumeStateOn):i.removeClass(this.Class.classRightVolumeStateOff).addClass(this.Class.classRightVolumeStateOn);e=Math.max(e,t),t=this.component.find(".volume-control-btn");t.attr("class","volume-control-btn"),e<10?t.addClass(this.Class.classCssVolumeOff):e<75?t.addClass(this.Class.classCssVolumeDown):t.addClass(this.Class.classCssVolumeOn),!0===this.unifyVolumeState?(this.component.find(".channel-volume-info-mid .unify").addClass("on").addClass(this.Class.classUnifyVolumeStateOn).removeClass(this.Class.classUnifyVolumeStateOff),this.component.find(".channel-volume-control-mid").addClass("on")):(this.component.find(".channel-volume-info-mid .unify").removeClass("on").addClass(this.Class.classUnifyVolumeStateOff).removeClass(this.Class.classUnifyVolumeStateOn),this.component.find(".channel-volume-control-mid").removeClass("on"))},onClick:function(e){e.data.component.trigger(e.data.self.Class.eventTypes.CLICK),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onClick/triggerevent:"+e.data.self.Class.eventTypes.CLICK)},onPlayerVolumeChange:function(e,t){null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onPlayerVolumeChange"+parseInt(t.volume)),e.data.self.component.find(".left-volume-slider").slider("value",t.volume),e.data.self.component.find(".right-volume-slider").slider("value",t.volume),e.data.self.updateVolume()},onClickUnifyVolumeState:function(e){var t,a;!1===e.data.self.unifyVolumeState?(e.data.self.unifyVolumeState=!0,t=e.data.self.component.find(".left-volume-slider").slider("value"),a=e.data.self.component.find(".right-volume-slider").slider("value"),e.data.self.component.find(".left-volume-slider").slider("value",Math.max(t,a)),e.data.self.component.find(".right-volume-slider").slider("value",Math.max(t,a))):(e.data.self.unifyVolumeState=!1,e.data.self.updateVolume()),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onClickUnifyVolumeState/unifyVolumeState:"+e.data.self.unifyVolumeState)},onClickToVolume:function(e){e.data.self.component.find(".channel-volume-sliders").addClass("on")},onChannelVolumeMouseout:function(e){e.data.self.component.find(".channel-volume-sliders").removeClass("on")},onClickLeftVolume:function(e){e.data.self.component.find(".left-volume-slider").slider("value")<10?e.data.self.component.find(".left-volume-slider").slider("value",100):e.data.self.component.find(".left-volume-slider").slider("value",0)},onClickRightVolume:function(e){e.data.self.component.find(".right-volume-slider").slider("value")<10?e.data.self.component.find(".right-volume-slider").slider("value",100):e.data.self.component.find(".right-volume-slider").slider("value",0)}}),$.Class("fr.ina.amalia.player.plugins.PluginBase",{classCss:"plugin-default",style:""},{namespace:null,uuid:null,pluginContainer:null,mediaPlayer:null,logger:null,loaderContainer:null,settings:{},eventTag:"",listOfpluginTypes:[],bindingManager:null,init:function(e,t,a,i){if(this.mediaPlayer=t,this.pluginContainer=$(a),this.namespace=this.Class.fullName,this.bindingManager=i,this.settings=$.extend({debug:!1,internalPlugin:!1,shortcuts:{enabled:!1,listOfShortcuts:[]}},e||{}),this.eventTag=this.Class.fullName+"_"+this.pluginContainer.attr("id"),!1===this.settings.internalPlugin&&(this.pluginContainer.addClass(this.Class.classCss),this.createLoader(),this.loaderContainer.show()),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),null===this.mediaPlayer)throw new Error("Can't initialize plugin name"+this.Class.fullName);try{!1===this.settings.internalPlugin&&null!==this.loaderContainer&&this.loaderContainer.hide(),this.initialize()}catch(e){null!==this.logger&&this.logger.error(e.stack)}this.initializeShortcuts()},initialize:function(){},setUuid:function(e){this.uuid=e.toString(),this.pluginContainer.attr("data-plugin-id",this.uuid)},getUuid:function(){return this.uuid.toString()},initializeError:function(e){e=fr.ina.amalia.player.PlayerErrorCode.getMessage(e),e=$("<div>",{class:"ajs-error",style:"",text:e});this.pluginContainer.append(e)},createLoader:function(){this.loaderContainer=$("<div>",{class:"ajs-loader ajs-icon ajs-icon-cog",style:""}),this.loaderContainer.hide(),this.pluginContainer.append(this.loaderContainer)},registerPluginType:function(e){"string"==typeof e&&""!==e&&this.listOfpluginTypes.push(e)},getPluginTypes:function(){return this.listOfpluginTypes},onPluginReady:function(e){null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onPluginReady"),null!==e.data.self&&(e.data.self.initialize(),null!==e.data.self.loaderContainer&&e.data.self.loaderContainer.hide())},onPluginError:function(e,t){null!==e.data.self.logger&&e.data.self.logger.warn("PluginBase/onPluginError"),null!==e.data.self&&(t=void 0===t.errorCode?"":t.errorCode,e.data.self.initializeError(t),null!==e.data.self.loaderContainer&&e.data.self.loaderContainer.hide())},initializeShortcuts:function(){if(null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize shortcuts"),"object"==typeof this.settings.shortcuts&&!0===this.settings.shortcuts.enabled)for(var i=0;i<this.settings.shortcuts.listOfShortcuts.length;i++){var conf=this.settings.shortcuts.listOfShortcuts[i],f=conf.c,callback;try{null!==conf&&conf.hasOwnProperty("s")&&conf.hasOwnProperty("c")&&(callback=eval("this."+f),"function"==typeof callback?$(document).bind("keydown",{keys:conf.s,callback:conf.c,self:this},this.callback):null!==this.logger&&(this.logger.warn(this.Class.fullName+" : error to bind shortcut "+conf.c),this.logger.warn(conf)))}catch(error){null!==this.logger&&this.logger.warn(this.Class.fullName+" : error to bind shortcut "+conf.c)}}},callback:function(event){try{event.preventDefault(),eval("event.data.self."+event.data.callback+"()")}catch(error){null!==event.data.self.logger&&event.data.self.logger.warn(event.data.self.Class.fullName+" : Error to send callback to bind shortcut :"+event.data.callback)}}}),fr.ina.amalia.player.plugins.PluginBase.extend("fr.ina.amalia.player.plugins.PluginBaseMultiBlocks",{METADATA_DISPLAY_TYPE:{STATIC:1,STATIC_DYNAMIC:2,DYNAMIC:3}},{loadDataStarted:!1,dataToDeal:null,managedMetadataIds:[],notManagedMetadataIds:null,listOfMetadataTypes:null,selectedMetadataId:"",addManagedMetadataType:function(e){"string"==typeof e&&""!==e&&this.listOfMetadataTypes.push(e)},isManagedMetadataType:function(e){return-1<$.inArray(e,this.listOfMetadataTypes)},getManagedMetadataTypes:function(){return this.listOfMetadataTypes},isManagedMetadataId:function(e){return-1<$.inArray(e,this.managedMetadataIds)||-1<$.inArray(e,this.notManagedMetadataIds)},isBoundMetadataId:function(e){return-1<$.inArray(e,this.managedMetadataIds)},getBindIds:function(){return this.managedMetadataIds},bindMetadataId:function(e){this.addManagedMetadataId(e)},unbindMetadataId:function(e){this.removeManagedMetadataId(e)},addManagedMetadataId:function(e){"string"==typeof(e="number"==typeof e?e.toString():e)&&""!==e&&-1===this.managedMetadataIds.indexOf(e)&&(this.managedMetadataIds.push(e),-1<(e=this.notManagedMetadataIds.indexOf(e))&&this.notManagedMetadataIds.splice(e,1))},removeManagedMetadataId:function(e){"string"==typeof(e="number"==typeof e?e.toString():e)&&""!==e&&-1===this.notManagedMetadataIds.indexOf(e)&&(this.notManagedMetadataIds.push(e),-1<(e=this.managedMetadataIds.indexOf(e))&&this.managedMetadataIds.splice(e,1))},getSelectedMetadata:function(){return this.selectedMetadataId.toString()},onSelectedMetadataChange:function(e,t){null!==t.metadataId&&(this.selectedMetadataId=t.metadataId.toString())}}),fr.ina.amalia.player.plugins.PluginBase.extend("fr.ina.amalia.player.plugins.PluginBaseSimpleBlock",{},{managedDataType:"",selectedMetadataId:"",addManagedDataType:function(e){"string"==typeof e&&""!==e&&(this.managedDataType=e)},isManagedType:function(e){return this.managedDataType===e},getManagedType:function(){return this.managedDataType},getSelectedMetadata:function(){return this.selectedMetadataId.toString()},onSelectedMetadataChange:function(e,t){null!==t.metadataId&&(this.selectedMetadataId=t.metadataId.toString())}}),$.Class("fr.ina.amalia.player.PluginBindingManager",{dataTypes:{DEFAULT:"default",DETECTION:"detection",VISUAL_DETECTION:"visual_detection",VISUAL_TRACKING:"visual_tracking",SEGMENTATION:"segmentation",AUDIO_SEGMENTATION:"audio_segmentation",TRANSCRIPTION:"transcription",SYNCHRONIZED_TEXT:"synchronized_text",KEYFRAMES:"keyframes",HISTOGRAM:"histogram"},pluginTypes:{TIMELINE_CUEPOINT:"timeline_cuepoint",TIMELINE_SEGMENT:"timeline_segment",TIMELINE_IMAGE:"timeline_image",TIMELINE_HISTOGRAM:"timeline_histogram",TIMELINE_VISUAL:"timeline_visual",TEXT_SYNC:"text-sync",CAPTION:"caption",OVERLAY:"overlay"}},{mediaPlayer:null,logger:null,settings:{},listOfDataTypes:null,listOfPluginTypes:null,pluginAndDataTypeMap:null,listOfPlugins:null,init:function(e,t){if(this.listOfPlugins=[],this.mediaPlayer=t,this.settings=$.extend({debug:!1,internalPlugin:!1},e||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),null===this.mediaPlayer)throw new Error("Can't initialize plugin name"+this.Class.fullName);this.setDefaultDataTypes(),this.setDefaultPluginAndDataTypeMap(),this.setDefaultPluginsTypes()},setDefaultDataTypes:function(){this.listOfDataTypes=[],this.listOfDataTypes.push(fr.ina.amalia.player.PluginBindingManager.dataTypes.DETECTION),this.listOfDataTypes.push(fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_DETECTION),this.listOfDataTypes.push(fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_TRACKING),this.listOfDataTypes.push(fr.ina.amalia.player.PluginBindingManager.dataTypes.SEGMENTATION),this.listOfDataTypes.push(fr.ina.amalia.player.PluginBindingManager.dataTypes.AUDIO_SEGMENTATION),this.listOfDataTypes.push(fr.ina.amalia.player.PluginBindingManager.dataTypes.TRANSCRIPTION),this.listOfDataTypes.push(fr.ina.amalia.player.PluginBindingManager.dataTypes.SYNCHRONIZED_TEXT),this.listOfDataTypes.push(fr.ina.amalia.player.PluginBindingManager.dataTypes.KEYFRAMES),this.listOfDataTypes.push(fr.ina.amalia.player.PluginBindingManager.dataTypes.HISTOGRAM)},setDefaultPluginsTypes:function(){this.listOfPluginTypes=[],this.listOfPluginTypes.push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_CUEPOINT),this.listOfPluginTypes.push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_SEGMENT),this.listOfPluginTypes.push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_IMAGE),this.listOfPluginTypes.push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_HISTOGRAM),this.listOfPluginTypes.push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.CAPTION),this.listOfPluginTypes.push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TEXT_SYNC),this.listOfPluginTypes.push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.OVERLAY)},setDefaultPluginAndDataTypeMap:function(){this.pluginAndDataTypeMap=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.DEFAULT]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.DETECTION]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.DETECTION].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_CUEPOINT),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_DETECTION]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_DETECTION].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_VISUAL),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_DETECTION].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.OVERLAY),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_TRACKING]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_TRACKING].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_VISUAL),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_TRACKING].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.OVERLAY),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.SEGMENTATION]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.SEGMENTATION].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_SEGMENT),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.AUDIO_SEGMENTATION]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.AUDIO_SEGMENTATION].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_SEGMENT),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.TRANSCRIPTION]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.TRANSCRIPTION].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.CAPTION),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.TRANSCRIPTION].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TEXT_SYNC),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.SYNCHRONIZED_TEXT]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.SYNCHRONIZED_TEXT].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.CAPTION),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.SYNCHRONIZED_TEXT].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TEXT_SYNC),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.SYNCHRONIZED_TEXT].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_SEGMENT),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.KEYFRAMES]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.KEYFRAMES].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_IMAGE),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.HISTOGRAM]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.HISTOGRAM].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_HISTOGRAM)},getLinetypeWithDataType:function(e){return e===fr.ina.amalia.player.PluginBindingManager.dataTypes.DETECTION?fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_CUEPOINT:e===fr.ina.amalia.player.PluginBindingManager.dataTypes.AUDIO_SEGMENTATION||e===fr.ina.amalia.player.PluginBindingManager.dataTypes.SEGMENTATION?fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_SEGMENT:e===fr.ina.amalia.player.PluginBindingManager.dataTypes.KEYFRAMES?fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_IMAGE:e===fr.ina.amalia.player.PluginBindingManager.dataTypes.HISTOGRAM?fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_HISTOGRAM:e===fr.ina.amalia.player.PluginBindingManager.dataTypes.SYNCHRONIZED_TEXT?fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_SEGMENT:e===fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_DETECTION||e===fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_TRACKING?fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_VISUAL:null},registerPlugin:function(e,t){if(void 0===this.listOfPlugins[e]&&(this.listOfPlugins[e]=[]),"object"==typeof t&&0<t.length)for(var a=0;a<t.length;a++)$.inArray(t[a],this.listOfPlugins[e])<0&&this.listOfPlugins[e].push(t[a])},isManagedDataType:function(e,t){var a=this.listOfPlugins[e];if("object"==typeof a&&a.length)for(var i=0;i<a.length;i++)if(-1<$.inArray(a[i],this.pluginAndDataTypeMap[t]))return!0;return!1}}),$.Class("fr.ina.amalia.player.plugins.PluginManager",{},{settings:{},logger:null,pluginsSettings:{},plugins:null,mediaContainer:null,mediaPlayer:null,contextMenuPlugin:null,loadedCount:0,failCount:0,dataLoaded:0,httpDataServicesCount:0,listOfPluginIds:[],listOfPluginTypes:[],bindingManager:null,init:function(e,t,a){this.mediaPlayer=t,this.mediaContainer=a,this.httpDataServicesCount=0,this.settings=$.extend({debug:!1},e||{}),this.pluginsSettings=$.extend({debug:this.settings.debug,dataServices:[],list:[]},e.plugins||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),this.plugins=[],this.initialize()},initialize:function(){null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize"),this.bindingManager=new fr.ina.amalia.player.PluginBindingManager(this.settings,this.mediaPlayer),this.mediaContainer.one(fr.ina.amalia.player.PlayerEventType.STARTED,{self:this},this.onStarted),this.mediaContainer.on(fr.ina.amalia.player.PlayerEventType.ERROR,{self:this},this.onError)},loadPlugins:function(){this.contextMenuPlugin=this.loadPlugin("fr.ina.amalia.player.plugins.ContextMenuPlugin",{internalPlugin:!0},this.mediaPlayer,this.mediaContainer);var e=$.extend({internalPlugin:!0,framerate:this.settings.framerate,debug:this.settings.debug,hide:!1},this.settings.controlBar||{});!0!==e.hide&&this.loadPlugin(this.settings.controlBarClassName,e,this.mediaPlayer,this.mediaContainer),this.loadDynamicPlugins(this.pluginsSettings.list)},getContextMenuPlugin:function(){return this.contextMenuPlugin},onStarted:function(e){e.data.self.loadPlugins(),e.data.self.loadData(e.data.self.pluginsSettings.dataServices)},onError:function(e){e.data.self.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.PLUGIN_ERROR,{errorCode:fr.ina.amalia.player.PlayerErrorCode.ERROR_LOAD_PLUGIN})},loadData:function(hosts){if(this.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.BEGIN_DATA_CHANGE),console.log("loadData hosts",hosts),$.isArray(hosts))for(var i=0,loader=null,host=null,settings={debug:this.settings.debug},i=0;i<hosts.length;++i){if(loader=null,host=hosts[i],settings={debug:this.pluginsSettings.debug,format:host.hasOwnProperty("format")?host.format:"json",url:host.hasOwnProperty("url")?host.url:host,parameters:host.hasOwnProperty("parameters")?host.parameters:null,sublocalisations:!!host.hasOwnProperty("sublocalisations")&&host.sublocalisations,data:host.data||void 0},console.log("loadData host",host),settings.data&&(loader=new fr.ina.amalia.player.JsonLoader(settings,this.mediaPlayer,this.dataLoadedHandler,{self:this})),"string"==typeof host[i])loader=new fr.ina.amalia.player.HttpLoader(settings,this.mediaPlayer,this.dataLoadedHandler,{self:this});else if(host.hasOwnProperty("protocol"))if("http"===host.protocol)loader=new fr.ina.amalia.player.HttpLoader(settings,this.mediaPlayer,this.dataLoadedHandler,{self:this});else if("ws"===host.protocol)loader=new fr.ina.amalia.player.WsLoader(settings,this.mediaPlayer,this.dataLoadedHandler,{self:this});else try{loader=eval("new "+host.protocol+"(settings, this.mediaPlayer, this.dataLoadedHandler,{self:this});")}catch(error){null!==this.logger&&(this.logger.warn("Unknown host configuration type."),this.logger.error(error.stack))}else null!==this.logger&&(this.logger.warn("Unknown host configuration."),this.logger.warn(host));null!==loader&&loader.getWaitLoadEvent()&&this.httpDataServicesCount++}else null!==this.logger&&this.logger.warn("Error dataServices is not array.")},dataLoadedHandler:function(e,t){"success"!==t&&(null!==this.logger&&(this.logger.warn("Failed to load data. status: "+t),this.logger.warn(e)),e.self.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.PLUGIN_ERROR,{errorCode:fr.ina.amalia.player.PlayerErrorCode.ERROR_LOAD_PLUGIN})),e.self.dataLoaded++,e.self.dataLoaded===e.self.httpDataServicesCount&&(e.self.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.END_DATA_CHANGE),e.self.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.PLUGIN_READY))},loadDynamicPlugins:function(e){for(var t in null!==this.logger&&(this.logger.info(this.Class.fullName,"loadPlugins List : "),this.logger.info(e)),e){var a;e.hasOwnProperty(t)&&(a=e[t],"object"==typeof(a=$.extend({debug:this.pluginsSettings.debug,className:null,container:null,data:this.data,framerate:this.settings.framerate,thumbRootDirectory:this.settings.thumbRootDirectory,parameters:{}},a||{}))&&null!==a.className?(t=null===a.container?this.mediaContainer:$(a.container),a.internalPlugin=null===a.container,this.loadPlugin(a.className,a,this.mediaPlayer,t)):null!==this.logger&&this.logger.warn(this.Class.fullName,"Error to load plugin className:"+a.className))}},loadPlugin:function(className,settings,mediaPlayer,pluginContainer){null!==this.logger&&this.logger.info(this.Class.fullName,"loadPlugin className:"+className);try{var obj=eval("new "+className+"(settings,mediaPlayer,pluginContainer,this.bindingManager)");return obj.setUuid(fr.ina.amalia.player.helpers.UtilitiesHelper.generateUUID("p_")),this.bindingManager.registerPlugin(obj.getUuid(),obj.getPluginTypes()),this.listOfPluginIds.push(obj.getUuid()),this.listOfPluginTypes[obj.getUuid()]=obj.getPluginTypes(),this.plugins.push(obj),this.loadedCount++,null!==this.logger&&this.logger.info(className+"Plugin loaded :  "+className+" ID: "+obj.getUuid()),obj}catch(error){return this.failCount++,null!==this.logger&&(this.logger.warn("Error to load plugin : "+className),this.logger.warn(error.stack)),!1}}}),fr.ina.amalia.player.plugins.PluginBase.extend("fr.ina.amalia.player.plugins.captions.CaptionsBase",{},{container:null,listOfData:[],definePlayerListeners:function(){this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.TIME_CHANGE,{self:this},this.onTimeupdate),null!==this.logger&&this.logger.trace(this.Class.fullName,"definePlayerListeners")},updateMetadata:function(e,t,a,i,n){this.listOfData=[];var r=null;n=!0===n;for(var s=this.mediaPlayer.getMetadataWithRange(e,a,i),o=0;o<s.length;o++)!0===(r=s[o]).hasOwnProperty("sublocalisations")&&null!==r.sublocalisations?this._parseSubLocalisations(r.sublocalisations,t,n):null!==r?this._parseLocalisation(r,t,n):null!==this.logger&&this.logger.trace(this.Class.fullName,"Error to set data, index: "+o)},_parseLocalisation:function(e,t,a){var i,n;e.tclevel<=t&&(!(e.tclevel===t&&!1===a||e.tclevel<=t&&!0===a)||""!==(n=this._getText(e.data))&&(i={tcin:"number"==typeof e.tcin?e.tcin:fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(e.tcin),tcout:"number"==typeof e.tcout?e.tcout:fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(e.tcout),text:n,label:e.label,thumb:e.thumb,level:e.tclevel},this.listOfData.push(i)),!0===e.hasOwnProperty("sublocalisations")&&null!==e.sublocalisations&&!0===e.sublocalisations.hasOwnProperty("localisation")&&$.isArray(e.sublocalisations.localisation)&&this._parseSubLocalisations(e.sublocalisations,t,a))},_parseSubLocalisations:function(e,t,a){var i=null;if(null!=e&&!0===e.hasOwnProperty("localisation")&&$.isArray(e.localisation))for(var n=0;n<e.localisation.length;n++)i=e.localisation[n],this._parseLocalisation(i,t,a);return i},_getText:function(e){var t="";if(null!=e&&!0===e.hasOwnProperty("text")&&null!==e.text&&$.isArray(e.text))for(var a=0;a<e.text.length;a++)null!==e.text[a]&&(t+=e.text[a].toString());return t},updatePos:function(e){null!==this.logger&&this.logger.trace(this.Class.fullName,"updatePos : "+e)},onTimeupdate:function(e,t){e.data.self.updatePos(parseFloat(t.currentTime))}}),fr.ina.amalia.player.plugins.PluginBase.extend("fr.ina.amalia.player.plugins.ContextMenuPlugin",{classCss:"plugin-context-menu dropdown-menu lg",style:"",copyrightText:"Amalia.js ========== V1.3.7, Â© INA 2021",copyrightHomepage:"http://ina-foss.github.io/amalia.js"},{container:null,menuConfiguration:{position:{my:"left top",at:"right top"}},initialize:function(){this.initContextMenu()},initContextMenu:function(){this.container=$("<ul/>",{class:this.Class.classCss,style:this.Class.style,role:"menu","aria-labelledby":"dLabel"}).menu({disabled:!1}).css({position:"fixed",left:0,top:0}).hide(),this.addItemWithLink(this.Class.copyrightText,null,null,"ajs-icon  ajs-icon-amalia-js"),this.addItemWithLink(fr.ina.amalia.player.PlayerMessage.PLAYER_OPENSOURCE_LINK,this.Class.copyrightHomepage,"homepage","ajs-icon ajs-icon-github"),this.pluginContainer.append(this.container),this.container.on("mouseleave",{self:this},this.onMouseleave),this.pluginContainer.parent().on("contextmenu",{self:this},this.onContextmenu)},addItemWithLink:function(e,t,a,i){t=t||"#",i="string"==typeof i?i:null,a=a||"disabled";a=$("<li>",{class:a}),e=$("<a>",{text:e,target:"_blank",href:t});return null!==i&&e.append($("<span>",{class:i})),"#"===t&&e.on("click",function(e){e.preventDefault()}),a.append(e),this.container.append(a),a},onContextmenu:function(e){e.data.self.container.show().css({left:e.clientX-10,top:e.clientY-10}),e.preventDefault()},onMouseleave:function(e){e.preventDefault(),e.data.self.container.hide()}}),fr.ina.amalia.player.plugins.PluginBase.extend("fr.ina.amalia.player.plugins.CustomControlBarPlugin",{classCss:"plugin-custom-controlbar"},{container:null,leftContainer:null,midContainer:null,rightContainer:null,widgets:null,height:130,progressBar:null,autoHide:!0,displayState:!0,hideDuration:500,autoHideStarted:!1,timeIndicatorContainer:null,initialize:function(){this.settings=$.extend({height:"80",autohide:!0,hideDuration:500,timeFormat:"ms",framerate:25,framepreview:!1,framepreviewTimeBound:500,sticky:!1,widgets:{left:{timelabelWidget:"fr.ina.amalia.player.plugins.controlBar.widgets.TimeLabel"},mid:{playWidget:"fr.ina.amalia.player.plugins.controlBar.widgets.PlayButton",pauseWidget:"fr.ina.amalia.player.plugins.controlBar.widgets.PauseButton"},right:{full:"fr.ina.amalia.player.plugins.controlBar.widgets.FullscreenButton",volume:"fr.ina.amalia.player.plugins.controlBar.widgets.VolumeControlBar"},settings:{}}},this.settings||{}),this.timeIndicatorContainer=null,this.leftContainer=null,this.midContainer=null,this.rightContainer=null,this.widgets=[],this.autoHide=!0!==this.settings.sticky&&this.settings.autohide,this.displayState=!0,this.hideDuration=this.settings.hideDuration,this.height=this.settings.height,this.autoHideStarted=!1,this.createControlBar(),this.initializeWidgets(),this.definePlayerListeners(),this.updatePlayerSize(!1),null!==this.logger&&(this.logger.trace(this.Class.fullName,"initialize"),this.logger.info(this.settings))},createControlBar:function(){var e=!0===this.settings.sticky?this.Class.classCss+" sticky":this.Class.classCss;this.container=$("<div>",{class:e}),this.timeIndicatorContainer=$("<div>",{class:"ajs-time-indicator"});e=$("<span>",{class:"ajs-tooltip-text"});this.timeIndicatorContainer.append(e),this.container.append(this.timeIndicatorContainer);e=$("<div>",{class:"ajs-row"});this.leftContainer=$("<div>",{class:"ajs-container left-container"}),this.midContainer=$("<div>",{class:"ajs-container middle-container"}),this.rightContainer=$("<div>",{class:"ajs-container right-container"}),e.append(this.leftContainer),e.append(this.midContainer),e.append(this.rightContainer),this.container.append(e),this.container.height(this.height),this.pluginContainer.append(this.container)},initializeWidgets:function(){var e=this.settings.widgets;if(null!==this.logger&&(this.logger.trace(this.Class.fullName,"initialize"),this.logger.info(e)),e.hasOwnProperty("left"))for(var t in e.left)e.left.hasOwnProperty(t)&&this.initWidget(t,e.left[t],this.leftContainer);if(e.hasOwnProperty("mid"))for(var a in e.mid)e.mid.hasOwnProperty(a)&&this.initWidget(a,e.mid[a],this.midContainer);if(e.hasOwnProperty("right"))for(var i in e.right)e.right.hasOwnProperty(i)&&this.initWidget(i,e.right[i],this.rightContainer);!1!==this.settings.enableProgressBar&&(this.progressBar=new fr.ina.amalia.player.plugins.controlBar.widgets.ProgressBar({debug:this.settings.debug,framepreview:this.settings.framepreview,framepreviewTimeBound:this.settings.framepreviewTimeBound},this.mediaPlayer,this.container)),this.container.find(".player-progress-bar").on("mouseover",$.proxy(this.onProgressBarMouseover,this)),this.container.find(".player-progress-bar").on("mouseout",$.proxy(this.onProgressBarMouseoout,this)),this.container.find(".player-progress-bar").on("mousemove",$.proxy(this.onProgressBarMousemove,this))},initWidget:function(widgetName,widgetClassName,container){try{var settings=this.settings.widgets.hasOwnProperty("settings")&&"object"==typeof this.settings.widgets.settings[widgetName]?this.settings.widgets.settings[widgetName]:this.settings,obj=eval("new "+widgetClassName+"(settings,this.mediaPlayer,container)");this.widgets.push(obj)}catch(error){null!==this.logger&&(this.logger.warn("Error to load widget : "+widgetClassName),this.logger.warn(error.stack))}},definePlayerListeners:function(){this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.FULLSCREEN_CHANGE,{self:this},this.onFullscreenModeChange),!0===this.autoHide&&(this.mediaPlayer.getContainer().one(fr.ina.amalia.player.PlayerEventType.PLAYING,{self:this},this.onPlaying),this.mediaPlayer.getContainer().one(fr.ina.amalia.player.PlayerEventType.SEEK,{self:this},this.onSeeking)),$(window).on("debouncedresize",{self:this},this.onWindowResize)},updatePlayerSize:function(e){!0===this.settings.sticky?(!0===e?this.mediaPlayer.getContainer().find("video").first().css("height",$(window).height()-this.height):this.mediaPlayer.getContainer().find("video").first().css("height",parseInt(this.mediaPlayer.mediaContainer.parent().height()-this.height)),null!==this.logger&&this.logger.trace(this.Class.fullName,"size : "+this.mediaPlayer.getContainer().find("video").first().css("height"))):!1===this.autoHideStarted?this.container.css("bottom",this.height+"px"):this.container.css("bottom",!0===this.displayState?this.height:"10px")},show:function(){var e=this;!1===e.displayState&&(e.container.find(".ajs-row").show(),e.container.animate({bottom:e.height+"px"},250,function(){e.displayState=!0}))},hide:function(){var e=this;!0===e.displayState&&e.container.animate({bottom:"10px"},250,function(){e.container.find(".ajs-row").hide(),e.displayState=!1})},onFullscreenModeChange:function(e,t){e.data.self.updatePlayerSize(t.inFullScreen)},onPlayerMouseEnter:function(e){!1===e.data.self.displayState&&e.data.self.show(),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onPlayerMouseEnter")},onPlayerMouseLeave:function(e){!0===e.data.self.displayState&&setTimeout(function(){e.data.self.hide()},e.data.self.hideDuration),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onPlayerMouseLeave")},onPlaying:function(e){!1===e.data.self.autoHideStarted&&(e.data.self.autoHideStarted=!0,e.data.self.mediaPlayer.getContainer().on("mouseenter touchstart",{self:e.data.self},e.data.self.onPlayerMouseEnter),e.data.self.mediaPlayer.getContainer().on("mouseleave touchleave",{self:e.data.self},e.data.self.onPlayerMouseLeave))},onSeeking:function(e){!1===e.data.self.autoHideStarted&&(e.data.self.autoHideStarted=!0,e.data.self.hide(),e.data.self.mediaPlayer.mediaContainer.on("mouseenter touchstart",{self:e.data.self},e.data.self.onPlayerMouseEnter),e.data.self.mediaPlayer.mediaContainer.on("mouseleave touchleave",{self:e.data.self},e.data.self.onPlayerMouseLeave))},onProgressBarMouseover:function(){this.timeIndicatorContainer.show()},onProgressBarMouseoout:function(){this.timeIndicatorContainer.hide()},onProgressBarMousemove:function(e){var t=$(e.currentTarget),a=this.timeIndicatorContainer.width()/2,e=e.clientX-t.offset().left,a=Math.max(a,Math.min(e,t.width()-a)),t=e*this.mediaPlayer.getDuration()/t.width()+this.mediaPlayer.getTcOffset();this.timeIndicatorContainer.css("left",a),this.timeIndicatorContainer.find(".ajs-tooltip-text").html(fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(t,this.settings.framerate,this.settings.timeFormat))},onWindowResize:function(e){e.data.self.updatePlayerSize(e.data.self.mediaPlayer.getFullscreenState()),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onWindowResize")}}),$.Class("fr.ina.amalia.player.LocalStorageManager",{storageNamespace:"ina.media.player"},{settings:{},logger:null,data:null,init:function(){this.initializeStorage()},initializeStorage:function(){if("undefined"!=typeof localStorage)try{!1===localStorage.hasOwnProperty(this.Class.storageNamespace)&&localStorage.setItem(this.Class.storageNamespace,JSON.stringify({})),this.data=JSON.parse(localStorage.getItem(this.Class.storageNamespace))}catch(e){this.data=null}else this.data=null},updateDataStorage:function(){try{"undefined"!=typeof localStorage&&localStorage.setItem(this.Class.storageNamespace,JSON.stringify(this.data))}catch(e){this.data=null}},hasItem:function(e){return null!==this.data&&!0===this.data.hasOwnProperty(e)},getItem:function(e){return null!==this.data&&!0===this.data.hasOwnProperty(e)?this.data[e]:null},setItem:function(e,t){try{null!==this.data&&void 0!==e&&void 0!==t&&(this.data[e]=t,this.updateDataStorage())}catch(e){return null}return!0},removeItem:function(e){null!==this.data&&void 0!==e&&(this.data.splice(e,1),this.updateDataStorage())},clear:function(){"undefined"!=typeof localStorage&&localStorage.removeItem(this.Class.storageNamespace)}}),$.Class("fr.ina.amalia.player.mediaTypeManager",{},{mediaPlayer:null,mainObj:null,logger:null,settings:{},init:function(e,t){if(this.mediaPlayer=t.mediaPlayer,this.mainObj=t,this.namespace=this.Class.fullName,this.settings=$.extend({debug:!1,internalPlugin:!1},e||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),null===this.mediaPlayer)throw new Error("Can't initialize plugin name"+this.Class.fullName);this.initialize()},initialize:function(){}}),fr.ina.amalia.player.mediaTypeManager.extend("fr.ina.amalia.player.media.type.DashMpeg",{},{context:null,dashPlayer:null,initialize:function(){this.context=new Dash.di.DashContext,this.dashPlayer=new MediaPlayer(this.context)},setSrc:function(e){this.dashPlayer.setAutoPlay(this.settings.autoplay),this.dashPlayer.startup(),this.dashPlayer.attachView(this.mediaPlayer.get(0)),this.dashPlayer.retrieveManifest(e,$.proxy(this.initializeDashJS,this)),this.dashPlayer.videoElementExt=this.mediaPlayer.get(0),null!==this.logger&&this.logger.trace(this.Class.fullName,"set dash src :"+this.url)},initializeDashJS:function(e,t){"object"==typeof t?this.mainObj.setErrorCode(fr.ina.amalia.player.PlayerErrorCode.ERROR_MANIFEST_DASH):this.dashPlayer.attachSource(e)}}),$.Class("fr.ina.amalia.player.ShortcutsManager",{},{mediaPlayer:null,settings:{},logger:null,listOfShortcuts:null,init:function(e,t){this.mediaPlayer=t,this.settings=$.extend({enabled:!1,debug:!1,listOfShortcuts:[{s:"f1",c:"togglePlayPause"},{s:"f11",c:"toggleFullScreen"},{s:"f2",c:"muteUnmute"},{s:"f3",c:"seekToBegin"},{s:"f4",c:"seekToEnd"}]},e||{}),this.listOfShortcuts=this.settings.listOfShortcuts,void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),this.initialize()},initialize:function(){if(null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize"),!0===this.settings.enabled)for(var i=0;i<this.listOfShortcuts.length;i++){var conf=this.listOfShortcuts[i],f,callback;try{null!==conf&&conf.hasOwnProperty("s")&&conf.hasOwnProperty("c")&&(f=conf.c,callback=eval("this.mediaPlayer."+f),"function"==typeof callback?$(document).bind("keydown",{keys:conf.s,callback:conf.c,self:this},this.callback):null!==this.logger&&(this.logger.warn(this.Class.fullName+" : error to bind shortcut "+conf.c),this.logger.warn(conf)))}catch(error){null!==this.logger&&this.logger.warn(this.Class.fullName+" : error to bind shortcut "+conf.c)}}},callback:function(event){try{event.preventDefault(),eval("event.data.self.mediaPlayer."+event.data.callback+"()")}catch(error){null!==event.data.self.logger&&event.data.self.logger.warn(event.data.self.Class.fullName+" : Error to send callback to bind shortcut :"+event.data.callback)}}}),$.Class("fr.ina.amalia.player.BasePlayer",{mediaPlayerClassCss:"player",mediaPlayerStyleCss:"position: relative; width: inherit; height: inherit; background-color: black; ",playButtonStyleCss:"ajs-icon ajs-icon-controlbar-play",pauseButtonStyleCss:"ajs-icon ajs-icon-controlbar-pause",loaderStyleCss:"ajs-icon ajs-icon-cog"},{logger:null,settings:{},title:"",poster:"",mediaContainer:null,mediaPlayer:null,pluginManager:null,localStorageManager:null,loaderContainer:null,controlLayerElement:null,errorContainer:null,isRangePlayer:!1,rangePlayerTcout:null,captureId:null,captureTc:null,captureScale:1,zTcin:null,zTcout:null,tcOffset:0,mediaTypeManager:null,metadataManager:null,intervalRewind:null,shortcutManager:null,playbackRateIdx:7,playbackRateList:[-2,-1.5,-1,-.75,-.5,-.25,-.1,1,.5,.75,1.5,2,4,6,8],isIOSDevices:!1,mediaSourceUrl:"",inCastMode:!1,init:function(e,t){this.controlLayerElement=null,this.mediaSourceUrl="",this.inCastMode=!1,this.settings=$.extend({autoplay:!1,poster:"",src:"",title:"",defaultVolume:75,crossorigin:"",shortcuts:{},defaultPlaybackRateIdx:7,duration:null},e||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),this.mediaContainer=t,this.setStyleBreakpoint(),this.tcOffset=parseInt(this.settings.tcOffset),this.createLoaderContainer(),!0===this.settings.togglePlayPause&&this.createControlLayerElement(),this.createErrorContainer(),this.localStorageManager=new fr.ina.amalia.player.LocalStorageManager({}),this.shortcutManager=new fr.ina.amalia.player.ShortcutsManager(this.settings.shortcuts,this),this.playbackRateIdx=this.settings.defaultPlaybackRateIdx;var a=-1!==navigator.userAgent.indexOf("iPhone"),e=-1!==navigator.userAgent.indexOf("iPod"),t=-1!==navigator.userAgent.indexOf("iPad");this.isIOSDevices=a||t||e,this.setTitle(this.settings.title),this.setPoster(this.settings.poster),this.initialize()},initializePlugins:function(){null!==this.logger&&this.logger.trace(this.Class.fullName,"initializePlugins"),this.pluginManager=new fr.ina.amalia.player.plugins.PluginManager(this.settings,this,this.mediaContainer)},initializeMetadataManager:function(){null!==this.logger&&this.logger.trace(this.Class.fullName,"initializeMetadataManager"),this.metadataManager=new fr.ina.amalia.player.MetadataManager(this.settings,this,this.mediaContainer)},createLoaderContainer:function(){this.loaderContainer=$("<div>",{class:"ajs-loader"});var e=$("<i>",{class:this.Class.loaderStyleCss});this.loaderContainer.append(e),this.mediaContainer.append(this.loaderContainer),this.showLoader()},createControlLayerElement:function(){this.controlLayerElement=$("<div>",{class:"ajs-control-layer"}),this.controlLayerElement.append($("<i>")),this.mediaContainer.append(this.controlLayerElement)},createErrorContainer:function(){this.errorContainer=$("<div>",{class:"ajs-error"}),this.errorContainer.hide(),this.mediaContainer.append(this.errorContainer)},getContainer:function(){return this.mediaContainer},initialize:function(){null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize"),this.initializePlugins(),this.initializeMetadataManager(),this.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.INIT,[this]),this.getContainer().on(fr.ina.amalia.player.PlayerEventType.ERROR,{self:this},this.onError)},load:function(){this.mediaPlayer.get(0).load()},showControlLayerElement:function(e){var t;null!==this.controlLayerElement&&(e="play"===e?this.Class.playButtonStyleCss:this.Class.pauseButtonStyleCss,this.controlLayerElement.find("i").attr("class",e),(t=this).controlLayerElement.fadeIn("speed").addClass("scale-up").delay(200).queue(function(){t.controlLayerElement.removeClass("scale-up").fadeOut("speed").dequeue()}))},showLoader:function(){this.loaderContainer.show()},hideLoader:function(){this.loaderContainer.hide()},getTitle:function(){return this.title},setTitle:function(e){this.title=e},getCastMode:function(){return this.inCastMode},setCastMode:function(e){this.inCastMode=e},getPoster:function(){return this.poster},setPoster:function(e){this.poster=e},setSrc:function(e,t){this.mediaSourceUrl=e,!0===t&&this.play()},getSrc:function(){return this.mediaSourceUrl},getContentType:function(){return""},initEvents:function(){$(window).on("debouncedresize",{self:this},this.onWindowResize),null!==this.logger&&this.logger.info("initEvents")},setStyleBreakpoint:function(){var e="lg",t=this.mediaContainer.width();return t<=320?e="xxs":320<t&&t<=480?e="xs":480<t&&t<=768?e="sm":768<t&&t<=992&&(e="md"),!1===this.mediaContainer.hasClass(e)&&this.mediaContainer.removeClass("xxs").removeClass("xs").removeClass("sm").removeClass("md").removeClass("lg").addClass(e),e},play:function(){if(this.mediaContainer.addClass("playing-mode").removeClass("paused-mode"),void 0!==this.settings.callbacks.onPlay)try{eval(this.settings.callbacks.onPlay+"()")}catch(e){null!==this.logger&&this.logger.warn("Send callback failed.")}},pause:function(){if(this.mediaContainer.removeClass("playing-mode").addClass("paused-mode"),this.isRangePlayer=!1,this.rangePlayerTcout=null,void 0!==this.settings.callbacks.onPause)try{eval(this.settings.callbacks.onPause+"()")}catch(e){null!==this.logger&&this.logger.warn("Send callback failed.")}},stop:function(){if(this.settings.callbacks.hasOwnProperty("onStop")&&void 0!==this.settings.callbacks.onStop)try{eval(this.settings.callbacks.onStop+"()")}catch(e){null!==this.logger&&this.logger.warn("Send callback failed.")}},togglePlayPause:function(){this.isPaused()?(this.play(),this.showControlLayerElement("play")):(this.pause(),this.showControlLayerElement("pause"))},seek:function(e){return this.setCurrentTime(e)},seekToBegin:function(){return this.setCurrentTime(0)},seekToEnd:function(){return this.setCurrentTime(this.getDuration())},mute:function(){this.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.MUTE),this.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.VOLUME_CHANGE,{volume:0})},unmute:function(){this.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.UN_MUTE),this.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.VOLUME_CHANGE,{volume:100})},isMute:function(){return 0===this.getVolume()},muteUnmute:function(){this.isMute()?this.unmute():this.mute()},getTcOffset:function(){return this.tcOffset},getMediaPlayer:function(){return this.mediaPlayer},getDuration:function(e){return"number"==typeof e&&isFinite(e)?e:0},getVolume:function(){throw new Error("Get volume is abstract method.")},rangePlay:function(e,t,a){a=void 0!==a&&a,this.isRangePlayer=!0,this.rangePlayerTcout=t+this.tcOffset,this.setCurrentTime(e),!0===a&&this.play()},setVolume:function(e){return 0<=e&&e<=100&&(this.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.VOLUME_CHANGE,{volume:e}),this.localStorageManager.setItem("volume",e),null!==this.logger&&this.logger.trace(this.Class.fullName,"setVolume"+e),!0)},getCurrentTime:function(e){return null===this.settings.duration?e+this.tcOffset:this.lastSeekTime+e+this.tcOffset},setCurrentTime:function(e){e=isNaN(e)?0:e;this.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.SEEK,{currentTime:e})},getPlaybackrate:function(){throw new Error("Get volume is abstract method.")},setPlaybackrate:function(e){throw new Error("Get volume is abstract method. Speed: "+e)},upPlaybackrate:function(){this.playbackRateIdx=Math.min(this.playbackRateList.length,this.playbackRateIdx+1),this.setPlaybackrate(parseInt(this.playbackRateList[this.playbackRateIdx]))},downPlaybackrate:function(){this.playbackRateIdx=Math.max(0,this.playbackRateIdx-1),this.setPlaybackrate(parseInt(this.playbackRateList[this.playbackRateIdx]))},setErrorCode:function(e){void 0!==this.errorContainer&&(e=$("<p>",{text:fr.ina.amalia.player.PlayerErrorCode.getMessage(e)}),this.errorContainer.html(e),this.errorContainer.show())},getFullscreenState:function(){throw new Error("Get fullscreen is abstract method.")},isPaused:function(){throw new Error("Is paused is abstract method.")},toggleFullScreen:function(inFullScreen){var container=(this.isIOSDevices?this.mediaPlayer:this.mediaContainer).get(0),iFS=fr.ina.amalia.player.helpers.HTML5Helper.toggleFullScreen(container,this.isIOSDevices);if(void 0!==this.settings.callbacks.onFullscreen)try{eval(this.settings.callbacks.onFullscreen+"(inFullScreen)")}catch(e){null!==this.logger&&this.logger.warn("Send callback failed.")}return null!==this.logger&&this.logger.trace(this.Class.fullName,"onClickFullscreenButton :"+inFullScreen),iFS},getContentTupe:function(){throw new Error("Get media content type is abstract method.")},getCurrentImage:function(e){throw new Error("Get currentTime is abstract method. Scale: "+e)},getTcImage:function(e,t,a){this.setCurrentTime(t),this.play(),this.captureId=e,this.captureTc=t+this.tcOffset,this.captureScale=void 0!==a?Math.min(1,parseFloat(a)):1},moveNextFrame:function(){this.pause(),this.setCurrentTime(Math.min(this.getDuration()+this.tcOffset,this.getCurrentTime()+1/this.settings.framerate))},movePrevFrame:function(){this.pause(),this.setCurrentTime(Math.max(0,this.getCurrentTime()-1/this.settings.framerate))},addMenuItemWithLink:function(e,t,a){if("object"==typeof this.pluginManager&&"function"==typeof this.pluginManager.getContextMenuPlugin){var i=this.pluginManager.getContextMenuPlugin();if("object"==typeof i&&"function"==typeof i.addItemWithLink)return i.addItemWithLink(e,t,a)}return!1},getMetadataManager:function(){return this.metadataManager},getBlocksMetadata:function(){return this.metadataManager.getBlocksMetadata()},getBlockMetadata:function(e){return this.metadataManager.getBlockMetadata(e)},updateBlockMetadata:function(e,t,a){this.metadataManager.updateBlockMetadata(e,t,a)},removeBlockMetadata:function(e){return this.metadataManager.removeBlockMetadata(e)},addAllMetadata:function(e){this.metadataManager.addAllMetadata(e)},addMetadataById:function(e,t){this.metadataManager.addMetadataById(e,t)},replaceAllMetadataById:function(e,t){this.metadataManager.replaceAllMetadataById(e,t)},deleteAllMetadataById:function(e){this.metadataManager.deleteAllMetadataById(e)},getMetadataById:function(e){return this.metadataManager.getMetadataById(e)},setMetadataById:function(e,t){return this.metadataManager.setMetadataById(e,t)},removeMetadataById:function(e){return this.metadataManager.removeMetadataById(e)},getMetadataWithRange:function(e,t,a){return this.metadataManager.getMetadataWithRange(e,t,a)},getSelectedMetadataId:function(){return this.metadataManager.getSelectedMetadataId()},setSelectedMetadataId:function(e){this.metadataManager.setSelectedMetadataId(e)},addMetadataItem:function(e,t){return this.metadataManager.addMetadataItem(e,t)},getSelectedItems:function(){return this.metadataManager.getSelectedItems()},addSelectedItem:function(e){this.metadataManager.addSelectedItem(e)},removeAllSelectedItems:function(){this.metadataManager.removeAllSelectedItems()},getTcin:function(){return this.getTcOffset()},getTcout:function(){return this.getTcOffset()+this.getDuration()},setZoomTc:function(e,t,a){a=void 0!==a?a:"",Math.ceil(this.zTcin)===Math.ceil(e)&&Math.ceil(this.zTcout)===Math.ceil(t)||(this.zTcin=Math.max(0,parseFloat(e)),this.zTcout=parseFloat(t),null!==this.logger&&this.logger.info("SetZoomTc: // Tcin: "+this.zTcin+" // Tcout:"+this.zTcout+" // Event Tag Name:"+a),this.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.ZOOM_RANGE_CHANGE,{zTcin:parseFloat(e),zTcout:parseFloat(t),eventTag:a}))},destroy:function(){this.setSrc("",!1),void 0!==this.mediaContainer.data("fr.ina.amalia.player")&&this.mediaContainer.data("fr.ina.amalia.player",null),this.mediaContainer.get(0).innerHTML="",this.mediaContainer.remove()},onError:function(event,data){null!==event.data.self.logger&&event.data.self.logger.trace(event.data.self.Class.fullName,"onError");var errorCode=void 0===data.errorCode?"":data.errorCode;if(event.data.self.setErrorCode(errorCode),void 0!==event.data.self.settings.callbacks.onError)try{eval(event.data.self.settings.callbacks.onError+"(errorCode)")}catch(e){null!==event.data.self.logger&&event.data.self.logger.warn("Send callback failed.")}},onWindowResize:function(e){e.data.self.setStyleBreakpoint(),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onWindowResize")}}),fr.ina.amalia.player.BasePlayer.extend("fr.ina.amalia.player.PlayerHtml5",{},{initialize:function(){this.lastSeekTime=0,this.createPlayer(),this.setSrc(this.settings.src,this.settings.autoplay),this.setVolume(!1===this.localStorageManager.hasItem("volume")?this.settings.defaultVolume:this.localStorageManager.getItem("volume")),this._super()},setSrc:function(e,t){null!==this.logger&&this.logger.trace(this.Class.fullName,"setSrc:"+e),"mpd"===this.settings.mediaType?(this.mediaTypeManager=new fr.ina.amalia.player.media.type.DashMpeg(this.settings,this),this.mediaTypeManager.setSrc(e)):(this.mediaPlayer.find("source:first").attr({src:e}),""!==this.settings.mediaType&&this.mediaPlayer.find("source:first").attr("type",this.settings.mediaType),this.load()),this._super(e,t)},createPlayer:function(){var e;null!==this.logger&&this.logger.trace(this.Class.fullName,"createPlayer"),this.mediaPlayer=$("<video/>",{class:this.Class.mediaPlayerClassCss,style:this.Class.mediaPlayerStyleCss,"x-webkit-airplay":"allow"}),""!==this.settings.crossorigin&&this.mediaPlayer.attr("crossorigin",this.settings.crossorigin),this.settings.hasOwnProperty("preload")&&""!==this.settings.preload&&this.mediaPlayer.attr("preload",this.settings.preload),""!==this.getPoster()&&this.mediaPlayer.attr("poster",this.getPoster()),"mpd"!==this.settings.mediaType&&(e=$("<source />"),this.mediaPlayer.append(e)),this.mediaContainer.append(this.mediaPlayer),this.initEvents()},initEvents:function(){this._super(),null!==this.logger&&this.logger.trace(this.Class.fullName,"adEvents"),this.mediaPlayer.on("loadstart",{self:this},this.onLoadstart),this.mediaPlayer.on("playing",{self:this},this.onPlay),this.mediaPlayer.on("pause",{self:this},this.onPause),this.mediaPlayer.on("ended",{self:this},this.onEnded),this.mediaPlayer.one("durationchange",{self:this},this.onDurationchange),this.mediaPlayer.on("timeupdate",{self:this},this.onTimeupdate),this.mediaPlayer.find("source").on("error",{self:this},this.onSourceError),this.mediaPlayer.on("seeked",{self:this},this.onSeeked),!0===this.settings.togglePlayPause&&this.mediaPlayer.on("click",$.proxy(this.togglePlayPause,this)),$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenChange MSFullscreenChange",{self:this},this.onFullscreenHandler)},load:function(){this.mediaPlayer.get(0).load()},play:function(){this.mediaPlayer.get(0).play(),this._super()},pause:function(){this._super(),this.mediaPlayer.get(0).pause()},stop:function(){this.mediaPlayer.get(0).pause(),this.mediaPlayer.get(0).currentTime=0,this._super()},mute:function(){this.mediaPlayer.get(0).volume=0,this._super()},unmute:function(){this.mediaPlayer.get(0).volume=1,this._super()},getDuration:function(){return this._super(null===this.settings.duration?this.mediaPlayer.get(0).duration:parseFloat(this.settings.duration))},getVolume:function(){return 100*this.mediaPlayer.get(0).volume},setVolume:function(e){return this.mediaPlayer.get(0).volume=e/100,this._super(e)},getCurrentTime:function(){return this._super(this.mediaPlayer.get(0).currentTime)},setCurrentTime:function(e){var t=isNaN(e)?0:e;null===this.settings.duration?this.mediaPlayer.get(0).currentTime=Math.max(0,t-this.tcOffset):(this.lastSeekTime=Math.max(0,t-this.tcOffset),e=Math.max(0,t-this.tcOffset),e=-1===this.settings.src.search(/\?/)?this.settings.src+"?start="+e:this.settings.src+"&start="+e,this.setSrc(e,!0)),this._super(t)},getPlaybackrate:function(){return this.mediaPlayer.get(0).playbackRate},setPlaybackrate:function(t){var a=this;t<=0?(clearInterval(a.intervalRewind),a.intervalRewind=setInterval(function(){a.mediaPlayer.get(0).playbackRate=1;var e=a.getCurrentTime();0===e?(a.mediaPlayer.get(0).playbackRate=1,clearInterval(a.intervalRewind),a.pause()):a.setCurrentTime(e+=t)},30)):(clearInterval(a.intervalRewind),this.isPaused()&&this.play(),a.mediaPlayer.get(0).playbackRate=parseFloat(t)),this.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.PLAYBACK_RATE_CHANGE,{rate:t}),null!==this.logger&&this.logger.trace(this.Class.fullName,"setPlaybackrate :"+t)},getContentType:function(){return null!==this.logger&&this.logger.trace(this.Class.fullName,"getContentType"),this.mediaPlayer.find("source").get(0)},getFullscreenState:function(){return fr.ina.amalia.player.helpers.HTML5Helper.inFullScreen()},isPaused:function(){return this.mediaPlayer.get(0).paused},onFullscreenHandler:function(e){var t=fr.ina.amalia.player.helpers.HTML5Helper.inFullScreen();("object"==typeof e.originalEvent.originalTarget&&"object"==typeof e.originalEvent.originalTarget.mozFullScreenElement?$(e.originalEvent.originalTarget.mozFullScreenElement):$(e.originalEvent.target)).attr("id")===e.data.self.mediaContainer.attr("id")||!1===t?e.data.self.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.FULLSCREEN_CHANGE,{inFullScreen:t}):"MSFullscreenChange"===e.type&&($(document.msFullscreenElement).attr("id")!==e.data.self.mediaContainer.attr("id")&&!1!==t||e.data.self.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.FULLSCREEN_CHANGE,{inFullScreen:t})),e.data.self.mediaContainer.toggleClass("ajs-fullscreen",t),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onFullscreenHandler :"+t)},setZoomTc:function(e,t,a){a=void 0!==a?a:"",Math.ceil(this.zTcin)===Math.ceil(e)&&Math.ceil(this.zTcout)===Math.ceil(t)||(this.zTcin=Math.max(0,parseFloat(e)),this.zTcout=parseFloat(t),null!==this.logger&&this.logger.info("SetZoomTc: // Tcin: "+this.zTcin+" // Tcout:"+this.zTcout+" // Event Tag Name:"+a),this.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.ZOOM_RANGE_CHANGE,{zTcin:parseFloat(e),zTcout:parseFloat(t),eventTag:a}))},getCurrentImage:function(e){var t="";try{var a=this.mediaPlayer.get(0),i=document.createElement("canvas");return e=void 0!==e?Math.min(1,parseFloat(e)):1,i.width=a.videoWidth*e,i.height=a.videoHeight*e,i.getContext("2d").drawImage(a,0,0,i.width,i.height),t=i.toDataURL("image/png"),this.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.IMAGE_CAPTURE,{currentTime:this.getCurrentTime(),captureTc:this.getCurrentTime(),captureId:this.getCurrentTime(),captureImage:t.toString()}),t}catch(e){null!==this.logger&&(this.logger.warn("Error lors de la capture d'imagette"),this.logger.warn(e.stack))}return t},getTcImage:function(e,t,a){this.setCurrentTime(t),this.play(),this.captureId=e,this.captureTc=t+this.tcOffset,this.captureScale=void 0!==a?Math.min(1,parseFloat(a)):1},moveNextFrame:function(){this.pause(),this.setCurrentTime(Math.min(this.getDuration()+this.tcOffset,this.getCurrentTime()+1/this.settings.framerate))},movePrevFrame:function(){this.pause(),this.setCurrentTime(Math.max(0,this.getCurrentTime()-1/this.settings.framerate))},onLoadstart:function(event){if(null!==event.data.self.logger&&event.data.self.logger.trace(event.data.self.Class.fullName,"onLoadstart"),void 0!==event.data.self.settings.callbacks.onReady)try{eval(event.data.self.settings.callbacks.onReady+"()")}catch(e){null!==event.data.self.logger&&event.data.self.logger.warn("Send callback failed.")}},onPlay:function(e){null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onPlay"),e.data.self.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.PLAYING,[e.data.self])},onPause:function(e){null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onPause"),e.data.self.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.PAUSED,[e.data.self])},onSeeked:function(t){if(t.data.self.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.SEEK,{currentTime:t.data.self.getCurrentTime()}),"number"==typeof t.data.self.captureTc)try{t.data.self.getCurrentImage(t.data.self.captureScale),t.data.self.captureTc=null}catch(e){null!==t.data.self.logger&&(t.data.self.logger.warn("Error to capture Tc"),t.data.self.logger.warn(e.stack))}},onEnded:function(event){if(null!==event.data.self.settings.duration&&(event.data.self.setCurrentTime(event.data.self.tcOffset),event.data.self.stop()),null!==event.data.self.logger&&event.data.self.logger.trace(event.data.self.Class.fullName,"onEnded"),event.data.self.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.ENDED,[event.data.self]),void 0!==event.data.self.settings.callbacks.onComplete)try{eval(event.data.self.settings.callbacks.onComplete+"()")}catch(e){null!==event.data.self.logger&&event.data.self.logger.warn("Send callback failed.")}},onDurationchange:function(e){e.data.self.hideLoader(),isNaN(e.data.self.getDuration())||0===e.data.self.getDuration()?e.data.self.mediaPlayer.one("durationchange",{self:e.data.self},e.data.self.onDurationchange):(e.data.self.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.STARTED,[e.data.self]),!0===e.data.self.settings.autoplay&&e.data.self.play())},onTimeupdate:function(event){var tcOffset=event.data.self.getTcOffset(),currentTime=event.data.self.getCurrentTime(),duration=event.data.self.getDuration()+tcOffset,percentage=100*(currentTime-tcOffset)/(duration-tcOffset);if(event.data.self.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.TIME_CHANGE,{self:event.data.self,currentTime:currentTime,duration:duration,percentage:percentage,tcOffset:event.data.self.getTcOffset()}),!0===event.data.self.isRangePlayer&&"number"==typeof event.data.self.rangePlayerTcout&&event.data.self.rangePlayerTcout<=currentTime&&event.data.self.pause(),void 0!==event.data.self.settings.callbacks.onTimeupdate)try{eval(event.data.self.settings.callbacks.onTimeupdate+"(currentTime)")}catch(e){null!==event.data.self.logger&&event.data.self.logger.warn("Send callback failed.")}},onSourceError:function(e){null!==e.data.self.logger&&(e.data.self.logger.warn(e.data.self.Class.fullName+" :: onSourceError"),e.data.self.logger.warn(e)),e.data.self.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.ERROR,{self:e.data.self,errorCode:fr.ina.amalia.player.PlayerErrorCode.MEDIA_FILE_NOT_FOUND})}}),$.Class("fr.ina.amalia.player.MediaFactory",{},{settings:{},logger:null,mediaContainer:null,player:null,errorContainer:null,lastSeekTime:null,init:function(e,t){this.mediaContainer=$(e),this.lastSeekTime=0,this.settings=$.extend({player:"default",src:null,poster:"",autoplay:!1,plugins:{},callbacks:{},duration:null,debug:!1},t||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),this.initialize()},initialize:function(){try{null!==this.settings.src?(this.loadPlayer(),null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize")):(this.createErrorContainer(),this.setErrorCode(fr.ina.amalia.player.PlayerErrorCode.MEDIA_FILE_NOT_FOUND))}catch(e){this.createErrorContainer(),this.setErrorCode(fr.ina.amalia.player.PlayerErrorCode.ERROR_HTML5_SUPPORT),null!==this.logger&&this.logger.error(e.stack)}},createErrorContainer:function(){this.errorContainer=$("<div>",{class:"ajs-error"}),this.errorContainer.hide(),this.mediaContainer.append(this.errorContainer)},setErrorCode:function(e){void 0!==this.errorContainer&&(e=$("<p>",{text:fr.ina.amalia.player.PlayerErrorCode.getMessage(e)}),this.errorContainer.html(e),this.errorContainer.show())},loadPlayer:function(){"default"===this.settings.player?this.loadHtml5MediaPlayer():this.player=eval("new "+this.settings.player+"(this.settings, this.mediaContainer);")},loadHtml5MediaPlayer:function(){if(null!==this.logger&&this.logger.info("Load html 5 media player"),!(new fr.ina.amalia.player.helpers.BrowserFeatureDetection).isSupportsVideos())throw null!==this.logger&&this.logger.error("Your browser does not support the video tag."),new Error("Your browser does not support the video tag.");this.player=new fr.ina.amalia.player.PlayerHtml5(this.settings,this.mediaContainer)},getPlayer:function(){return this.player}}),function(n){n.fn.mediaPlayer=function(i){return this.each(function(){var e=n(this),t="fr.ina.amalia.player";if(e.data(t))return null;i=n.extend({player:"default",plugins:{},src:null,framerate:25,autoplay:!0,controlBarClassName:"fr.ina.amalia.player.plugins.CustomControlBarPlugin",controlBar:{},tcOffset:0,mediaType:"",thumbRootDirectory:"",duration:null,togglePlayPause:!1,debug:!1},i||{});var a=new fr.ina.amalia.player.MediaFactory(this,i);e.data(t,a),e.addClass("ajs"),e.attr("style","width: 100%; height:100%;"),e.parent().css("position","relative")})}}(jQuery);