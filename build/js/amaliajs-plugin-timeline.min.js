/*!Amalia.js ========== V1.3.7, Â© INA 2021 */
/**
 * Copyright (c) 2015 Institut National de l'Audiovisuel, INA
 * This file is part of amalia.js

 * amalia.js is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or (at your option) any later version.

 * Redistributions of source code, javascript and css minified versions
 * must retain the above copyright notice, this list of conditions and the following disclaimer.

 * Neither the name of the copyright holder nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.

 * You should have received a copy of the GNU General Public License
 * along with amalia.js. If not, see <http://www.gnu.org/licenses/>

 *
 * amalia.js is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 */


$.Class("fr.ina.amalia.player.plugins.timeline.DefaultConfiguration",{tooltipConfiguration:{position:{my:"center bottom-20",at:"center top",delay:3e3,using:function(t,e){$(this).css(t),$("<div>").addClass("ajs-arrow").addClass(e.vertical).addClass(e.horizontal).appendTo(this)}},content:function(){var t=$(this),e=t.attr("title");return t.is("[data-src]")?"<img class='image' alt='"+e+"' src='"+t.attr("data-src")+"' />":"<p>"+(e=e.replace(/(?:\r\n|\r|\n)/g,"<br />"))+"</p>"}}},{}),$.Class("fr.ina.amalia.player.plugins.timeline.BaseComponent",{ComponentClassCss:"default-component",ComponentModuleClassCss:"module-default",STYLE_CLASSNAME_EXPAND_ON:"ajs-icon-chevron-down",STYLE_CLASSNAME_EXPAND_OFF:"ajs-icon-chevron-right",LocalStorageTimeDisplayStateNamespace:"timeline-display-state",NAV_CLICK:"fr.ina.amalia.player.plugins.timeline.event.NavClick",CLOSE_EVENT:"fr.ina.amalia.player.plugins.timeline.component.event.CloseEvent",CLICK_TC:"fr.ina.amalia.player.plugins.timeline.BaseComponent.event.click",CLICK_SELECT:"fr.ina.amalia.player.plugins.timeline.BaseComponent.event.click_select",CLICK_REMOVE_SELECT_ITEM:"fr.ina.amalia.player.plugins.timeline.BaseComponent.event.click_remove_select_item"},{logger:null,settings:{},mainContainer:null,tooltipConfiguration:{},zoomLevel:0,tcin:0,tcout:0,duration:0,displayStateList:["lg","md","sm","xs"],displayStateIdx:0,localStorageManager:null,zoomProperty:null,focusable:null,hasElements:!1,zoomable:!1,focusComponent:null,focusLine:null,listOfdata:null,zoomableZone:null,zTcin:0,zTcout:0,currentTime:0,metadataId:"",tcOffset:0,localisationManager:null,mediaPlayer:null,init:function(t,e){if(this.mediaPlayer=e,this.tooltipConfiguration=$.extend(!0,fr.ina.amalia.player.plugins.timeline.DefaultConfiguration.tooltipConfiguration,{}),this.settings=$.extend({debug:!1,icon:"circle",color:"#3cf",container:"",metadataId:"",tcOffset:0,callbacks:{},duration:0,pointNav:!1,zoomHierarchies:!1,overlap:!1,withParentLevel:!1,zoomable:!0,focusable:!1,toolsbar:!0,editable:!1,closeable:!1,viewZoom:!1,marker:!1,timecursor:!1,thumbDirectory:"",timeFormat:"mms",framerate:25,displayState:"",callback:"",callbackStyle:""},t||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),this.mainContainer=this.settings.container,this.localStorageManager=new fr.ina.amalia.player.LocalStorageManager({}),this.focusable=this.settings.focusable,this.zoomable=this.settings.zoomable,this.duration=parseFloat(this.settings.duration),this.tcOffset=parseFloat(this.settings.tcOffset),this.zTcin=parseFloat(this.tcOffset),this.zTcout=parseFloat(this.tcOffset+this.settings.duration),this.localisationManager=new fr.ina.amalia.player.LocalisationManager,0===this.mainContainer.length||"object"!=typeof this.mainContainer)throw new Error("Your container is empty.");this.initialize()},initialize:function(){if(null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize"),this.mainContainer.addClass(this.Class.ComponentClassCss),this.createAxis(),!0===this.settings.toolsbar&&this.createToolBar(),!0===this.settings.focusable&&this.createBottomToolsBar(),!0===this.settings.closeable&&this.createCloseToolBar(),!0===this.settings.timecursor&&(this.createTimeCursor(),this.mainContainer.parents(".ajs-plugin.plugin-timeline").first().on(fr.ina.amalia.player.plugins.TimelinePlugin.eventTypes.TIME_CHANGE,{self:this},this.onPluginTimeChange)),!1===this.settings.focusable&&!1===this.settings.zoomable&&!0===this.settings.viewZoom&&this.createZoomContainer(),void 0!==this.settings.callbacks.onCreated)try{eval(this.settings.callbacks.onCreated+"(this)")}catch(e){null!==this.logger&&this.logger.warn("Error to create callback.")}},createAxis:function(){var t=$("<div>",{class:"line"}),e=$("<div>",{class:"line-content"});e.append(t);t=$("<div>",{class:this.Class.ComponentModuleClassCss});t.append(e),""!==this.settings.callback&&((a=$("<div>",{class:"callback "+this.settings.callbackStyle})).on("click",{self:this},this.onClickToCallback),t.append(a));var a=$("<div>",{class:"label",text:this.settings.title});t.append(a),""!==this.settings.callback&&a.on("click",{self:this},this.onClickToCallback),this.mainContainer.append(t);t=this.settings.displayState;null===(t=""===t?this.localStorageManager.getItem(this.Class.LocalStorageTimeDisplayStateNamespace):t)?t=this.getDisplayState():(this.displayStateIdx=this.displayStateList.indexOf(t),this.displayStateIdx++),this.mainContainer.removeClass(this.displayStateList.toString().replace(/,/g," ")).addClass(t),null!==this.logger&&this.logger.trace(this.Class.fullName,"createAxis")},createToolBar:function(){var t=$("<div>",{class:"toolbar-container"}),e=this.createButton(fr.ina.amalia.player.PlayerMessage.PLUGIN_TIMELINE_LABEL_EXPAND,"expand-btn");e.on("click",{self:this},this.onClickExpandBtn),e.addClass(this.Class.STYLE_CLASSNAME_EXPAND_ON),t.append(e);var a=$("<div>",{title:fr.ina.amalia.player.PlayerMessage.PLUGIN_TIMELINE_LABEL_SORT,class:"sort-btn ajs-icon ajs-icon-sort"}).tooltip(this.tooltipConfiguration);return t.append(a),!0===this.settings.pointNav&&(e=$("<div>",{class:"nav-controls"}),(a=this.createButton(fr.ina.amalia.player.PlayerMessage.PLUGIN_TIMELINE_LABEL_NAV_POINT_PREV,"chevron-circle-left prev-control")).on("click",{self:this},this.onClickPrevNavContorl),e.append(a),(a=this.createButton(fr.ina.amalia.player.PlayerMessage.PLUGIN_TIMELINE_LABEL_NAV_POINT_NEXT,"chevron-circle-right next-control")).on("click",{self:this},this.onClickNextNavContorl),e.append(a),t.append(e)),this.mainContainer.append(t),t},createCloseToolBar:function(){var t=$("<div>",{class:"toolbar-container"}),e=this.createButton(fr.ina.amalia.player.PlayerMessage.PLUGIN_TIMELINE_LABEL_CLOSE,"remove");e.on("click",{self:this},this.onClickCloseBtn),t.append(e),this.mainContainer.append(t)},createTimeCursor:function(){var t=$("<div>",{class:"timecursor",left:"0px"});this.mainContainer.append(t)},createButton:function(t,e,a){return!1===a?$("<button>",{value:t,class:e+" ajs-icon ajs-icon-"+e}):$("<button>",{title:t,class:e+" plugin-btn ajs-icon ajs-icon-"+e}).tooltip(this.tooltipConfiguration)},createBottomToolsBar:function(){var t,e=$("<div>",{class:"bottom-toolbar-container"});!0===this.settings.focusable&&((t=this.createButton(fr.ina.amalia.player.PlayerMessage.PLUGIN_TIMELINE_LABEL_FOCUS,"zoom-in focus-btn")).on("click",{self:this},this.onClickFocusBtn),e.append(t)),this.mainContainer.append(e)},createFocusComponent:function(){var focusSettings={debug:this.settings.debug,tcOffset:void 0===this.mediaPlayer?0:this.mediaPlayer.getTcOffset()};this.focusComponent=new fr.ina.amalia.player.plugins.components.FocusComponent(this.mainContainer,this.duration,focusSettings),this.focusComponent.setTc(this.tcin,this.tcout);try{var focusLineContainer=$("<div>",{class:"sub",style:""});this.mainContainer.append(focusLineContainer);var focusLineSettings=jQuery.extend(!0,{},this.settings);focusLineSettings.container=focusLineContainer,focusLineSettings.focusable=!1,focusLineSettings.pointNav=!1,focusLineSettings.title="",focusLineSettings.toolsbar=!1,focusLineSettings.zoomHierarchies=!1,focusLineSettings.withParentLevel=!1,focusLineSettings.zoomable=!0,focusLineSettings.closeable=!0,focusLineSettings.color="#FFF",focusLineSettings.viewZoom=!1,this.focusLine=eval("new "+this.Class.fullName+"(focusLineSettings)"),this.focusLine.setTcin(this.focusComponent.getFocusTcin()),this.focusLine.setTcout(this.focusComponent.getFocusTcout()),this.mainContainer.on(fr.ina.amalia.player.plugins.components.FocusComponent.eventTypes.FOCUS_ZONE_CHANGE,{self:this},this.onFocusZoneChange),this.focusLine.mainContainer.on(this.Class.CLOSE_EVENT,{self:this},this.onCloseEventRecever),null!==this.focusLine&&(this.focusLine.removeItems(),this.focusLine.addItems(this.listOfdata))}catch(e){null!==this.logger&&this.logger.warn(e)}},createZoomContainer:function(){try{var t={debug:this.settings.debug,modeFocus:!1,tcOffset:this.settings.tcOffset};this.zoomableZone=new fr.ina.amalia.player.plugins.components.FocusComponent(this.mainContainer,this.duration,t),this.zoomableZone.setTc(this.zTcin,this.zTcout)}catch(t){null!==this.logger&&this.logger.warn(t)}},show:function(){this.mainContainer.show()},hide:function(){this.mainContainer.hide()},getContainer:function(){return this.mainContainer},getMetadataId:function(){return this.metadataId.toString()},setTitle:function(t){this.settings.title=t,this.mainContainer.find(".label").text(t)},setShape:function(t){this.settings.icon=t},setColor:function(t){this.settings.color=t},setMetadataId:function(t){this.metadataId=t.toString()},setTcin:function(t){!0!==this.isZoomable()&&!1!==this.getHasElements()||(this.tcin=parseFloat(t)),null!==this.focusComponent&&null!==this.focusLine&&(this.focusComponent.setTc(this.tcin,this.tcout),this.focusLine.setTcin(this.focusComponent.getFocusTcin()))},setTcout:function(t){!0!==this.isZoomable()&&!1!==this.getHasElements()||(this.tcout=parseFloat(t)),null!==this.focusComponent&&null!==this.focusLine&&(this.focusComponent.setTc(this.tcin,this.tcout),this.focusLine.setTcout(this.focusComponent.getFocusTcout()))},setZoomTc:function(t,e){this.zTcin=parseFloat(t),this.zTcout=parseFloat(e),null!==this.zoomableZone&&this.zoomableZone.setZoomTc(parseFloat(t),parseFloat(e))},setZoomProperty:function(t){this.zoomProperty=t},setCurrentTime:function(t){this.currentTime=parseFloat(t),!0===this.settings.timecursor&&this.updateTimeCursor()},getHasElements:function(){return this.hasElements},isFocusable:function(){return this.focusable},isZoomable:function(){return this.zoomable},addItems:function(t){console.log("addItems listOfdata",t),null!==this.logger&&(this.logger.trace(this.Class.fullName," addItems/ZoomLevel:"+this.zoomLevel),this.logger.warn(t));var a=this.zoomProperty;if(this.hasElements=!0,null!==t){t.sort(function(t,e){return t.hasOwnProperty(a)&&e.hasOwnProperty(a)&&(t=parseInt(t[a]),e=parseInt(e[a])),e<t?1:t<e?-1:0}),t.sort(function(t,e){return t=parseInt(t.tc),(e=parseInt(e.tc))<t?1:t<e?-1:0}),!0===this.settings.zoomHierarchies&&(t=this.getHierarchiesData(this.zoomLevel,t,this.settings.withParentLevel));for(var e=0;e<t.length;e++)this.addItem(t[e]);this.updateTooltip()}this.listOfdata=t,!0===this.settings.overlap&&this.updateDisplayItems(),null!==this.focusLine&&(this.focusLine.removeItems(),this.focusLine.addItems(t))},clearSelectedItems:function(){this.mediaPlayer.removeAllSelectedItems(),this.mainContainer.find(".line-content .item").removeClass("selected")},updateTooltip:function(){this.mainContainer.find(".line-content .item.cuepoint").tooltip(this.tooltipConfiguration),this.mainContainer.find(".line-content .item.segment").tooltip(this.tooltipConfiguration)},updateTimeCursor:function(){var t=parseFloat(!1===this.zoomable?this.tcOffset:this.tcin),e=parseFloat(!1===this.zoomable?this.duration:this.tcout);this.mainContainer.find(".timecursor").css("left",100*(this.currentTime-t)/(e-t)+"%")},getHierarchiesData:function(t,e,a){var i=parseInt(t.toString()),n=[];if(!0===a){do{if(0<(n=$(e).filter(function(t){return e[t].tclevel===i})).length)return n}while(0<--t)}else n=$(e).filter(function(t){return e[t].tclevel===i});return n},updateDisplayItems:function(){for(var t,e,a=this.mainContainer.find(".line-content").first().find(".item"),i=this.mainContainer.find(".line-content").first(),n=null,s=null,o=a.length-1;0<=o;o--)n=$(a[o]),o!==a.length-1?0<(s=$(i).find(".item.on").first()).length&&(t=s.offset().left,e=n.offset().left,(n.hasClass("image")&&!n.hasClass("segment")?n.find("img"):n).width()<t-e?(n.addClass("on"),n.show()):(n.addClass("off"),n.hide())):n.addClass("on")},getDisplayState:function(){var t="",t=(this.displayStateIdx<this.displayStateList.length||(this.displayStateIdx=0),this.displayStateList[this.displayStateIdx]);return this.displayStateIdx++,this.localStorageManager.setItem(this.Class.LocalStorageTimeDisplayStateNamespace,t),t},changeDisplayState:function(){this.mainContainer.removeClass(this.displayStateList.toString().replace(/,/g," ")).addClass(this.getDisplayState())},getNextItem:function(a){var t=this.mainContainer.find(".line-content").first().find(".item").filter(function(t,e){return Math.round($(e).attr("data-tc"))>Math.round(a)}).first();return t.is("[data-tc]")?parseFloat(t.attr("data-tc")):null},getPrevItem:function(a){var t=this.mainContainer.find(".line-content").first().find(".item").filter(function(t,e){return Math.round($(e).attr("data-tc"))<Math.round(a)}).last();return t.is("[data-tc]")?parseFloat(t.attr("data-tc")):null},setZoomLevel:function(t){this.zoomLevel=t},onClickExpandBtn:function(e){try{e.data.self.mainContainer.hasClass("xs")?(e.data.self.mainContainer.removeClass(e.data.self.displayStateList.toString().replace(/,/g," ")),e.data.self.mainContainer.addClass("lg"),e.data.self.mainContainer.find(".expand-btn.plugin-btn").removeClass(e.data.self.Class.STYLE_CLASSNAME_EXPAND_OFF).addClass(e.data.self.Class.STYLE_CLASSNAME_EXPAND_ON)):(e.data.self.mainContainer.removeClass(e.data.self.displayStateList.toString().replace(/,/g," ")),e.data.self.mainContainer.addClass("xs"),e.data.self.mainContainer.find(".expand-btn.plugin-btn").removeClass(e.data.self.Class.STYLE_CLASSNAME_EXPAND_ON).addClass(e.data.self.Class.STYLE_CLASSNAME_EXPAND_OFF)),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName," onClickExpandBtn hasClass :--"+e.data.self.mainContainer.hasClass("xs"))}catch(t){null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"initialize"+t.toString())}},onClickNextNavContorl:function(t){t.data.self.mainContainer.trigger(t.data.self.Class.NAV_CLICK,{type:"next"}),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onClickNextNavContorl")},onClickPrevNavContorl:function(t){t.data.self.mainContainer.trigger(t.data.self.Class.NAV_CLICK,{type:"prev"}),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onClickPrevNavContorl")},onClickFocusBtn:function(t){null===t.data.self.focusComponent&&t.data.self.createFocusComponent(),t.data.self.mainContainer.removeClass("focus-off").addClass("focus-on"),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onClickHierarchicalZoomBtn")},onFocusZoneChange:function(t,e){t.data.self.focusLine.removeItems(),t.data.self.focusLine.setTcin(e.focusTcin),t.data.self.focusLine.setTcout(e.focusTcout),t.data.self.focusLine.addItems(t.data.self.listOfdata)},onClickCloseBtn:function(t){t.data.self.mainContainer.trigger(t.data.self.Class.CLOSE_EVENT)},onCloseEventRecever:function(t){t.data.self.mainContainer.removeClass("focus-on").addClass("focus-off")},onPluginTimeChange:function(t,e){t.data.self.setCurrentTime(e.currentTime)},onClickToCallback:function(event){if(void 0!==event.data.self.settings.callback&&""!==event.data.self.settings.callback)try{eval(event.data.self.settings.callback+"(event.data.self.getMetadataId())")}catch(e){null!==event.data.self.logger&&event.data.self.logger.warn("Send callback failed.")}null!==event.data.self.logger&&event.data.self.logger.trace(event.data.self.Class.fullName,"onClickToCallback "+event.data.self.settings.callback)}}),$.Class("fr.ina.amalia.player.plugins.components.FocusComponent",{CONTAINER_NAME:"focus-container",eventTypes:{FOCUS_ZONE_CHANGE:"fr.ina.amalia.player.plugins.components.FocusComponent.FOCUS_ZONE_CHANGE",ZOOM_ZONE_CHANGE:"fr.ina.amalia.player.plugins.components.FocusComponent.ZOOM_ZONE_CHANGE"}},{logger:null,settings:{},mainContainer:null,container:null,modeFocus:null,tcin:0,tcout:0,duration:0,tcOffset:0,init:function(t,e,a){if(this.settings=$.extend({debug:!1,modeFocus:!0,tcOffset:0},a||{}),this.modeFocus=this.settings.modeFocus,this.tcOffset=parseFloat(this.settings.tcOffset),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),this.mainContainer=t,this.duration=parseFloat(e),0===this.mainContainer.length||"object"!=typeof this.mainContainer)throw new Error("Your container is empty.");this.initialize()},initialize:function(){null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize"),this.createContainer(),this.setMode(),this.mainContainer.on(fr.ina.amalia.player.plugins.timeline.TimeAxisComponent.eventTypes.RANGE_CHANGE,{self:this},this.onTimeRangeChange)},createContainer:function(){this.container=$("<div>",{class:this.Class.CONTAINER_NAME}),this.container.resizable({handles:"w,e",create:function(t){$(t.target).find("div.ui-resizable-handle").addClass("ajs-icon ajs-icon-reorder")},start:function(t){var e=$(t.target).parent().width();$(t.target).resizable("option","minWidth",40),$(t.target).resizable("option","maxWidth",e)}}),this.container.on("resizestop",{self:this},this.onResizeStop),this.container.draggable({axis:"x",drag:function(t,e){var a=$(t.target),i=a.parent(),t=Math.max(0,e.position.left);e.position.left=Math.min(i.first().width()-a.width(),t)}}).css("position","absolute"),this.container.on("dragstop",{self:this},this.onDragStop),this.mainContainer.append(this.container),null!==this.logger&&this.logger.trace(this.Class.fullName,"createContainer")},setMode:function(){!0===this.modeFocus?this.mainContainer.find("."+this.Class.CONTAINER_NAME).addClass("focus"):this.mainContainer.find("."+this.Class.CONTAINER_NAME).addClass("zoom")},getContainer:function(){return this.mainContainer},setTc:function(t,e){this.tcin=parseFloat(t),this.tcout=parseFloat(e),this.mainContainer.find("."+this.Class.CONTAINER_NAME).attr("tcin",parseFloat(t)),this.mainContainer.find("."+this.Class.CONTAINER_NAME).attr("tcout",parseFloat(e)),this.selectedZoneChange(),null!==this.logger&&this.logger.trace(this.Class.fullName,"setTc: default tc:"+this.tcin+":"+this.tcout)},setZoomTc:function(t,e){t-=this.settings.tcOffset,e-=this.settings.tcOffset;var a=this.duration-this.settings.tcOffset;this.resize(100*(e-t)/a,100*t/a)},resize:function(t,e){this.mainContainer.find("."+this.Class.CONTAINER_NAME).first().css({width:Math.min(Math.max(0,parseFloat(t)),100)+"%",left:Math.min(Math.max(0,parseFloat(e)),100)+"%"}),this.container.trigger("dragstop")},selectedZoneChange:function(){var t=this.getFocusTcin(),e=this.getFocusTcout();!0===this.modeFocus?(this.mainContainer.trigger(this.Class.eventTypes.FOCUS_ZONE_CHANGE,{focusTcin:t,focusTcout:e}),null!==this.logger&&this.logger.trace(this.Class.fullName,"selectedZoneChange trigger event : "+this.Class.eventTypes.FOCUS_ZONE_CHANGE+" focus focusTcin:"+t+" focusTcout:"+e)):(this.mainContainer.trigger(this.Class.eventTypes.ZOOM_ZONE_CHANGE,{zTcin:t,zTcout:e}),null!==this.logger&&this.logger.trace(this.Class.fullName,"selectedZoneChange trigger event : "+this.Class.eventTypes.ZOOM_ZONE_CHANGE+" focus zTcin:"+t+" zTcout:"+e))},getFocusTcin:function(){var t=parseFloat((this.tcout-this.settings.tcOffset-this.tcin)*this.mainContainer.find("."+this.Class.CONTAINER_NAME).first().position().left/this.mainContainer.first().width());return Math.max(0,this.tcin+t)},getFocusTcout:function(){var t=this.getFocusTcin(),e=parseFloat((this.tcout-this.tcOffset-this.tcin)*this.mainContainer.find("."+this.Class.CONTAINER_NAME).first().width()/this.mainContainer.first().width());return Math.min(this.duration,t+e)},onTimeRangeChange:function(t,e){t.data.self.setTc(e.tcin,e.tcout),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onTimeRangeChange default tc:"+e.tcin+":"+e.tcout)},onDragStop:function(t){null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onDragStop"),t.data.self.selectedZoneChange()},onResizeStop:function(t,e){e=$(e.element);!0===t.data.self.modeFocus?e.css("height","50%"):e.css("height","100%"),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onResizeStop"),t.data.self.selectedZoneChange()}}),$.Class("fr.ina.amalia.player.plugins.timeline.TicComponent",{eventTypes:{CLICK:"fr.ina.amalia.player.plugins.timeline.TicComponent.click",UPDATE_TC:"fr.ina.amalia.player.plugins.timeline.TicComponent.updatetc"}},{logger:null,container:null,settings:{},currentTcin:0,currentTcout:0,tooltipConfiguration:{position:{my:"center bottom-20",at:"center top",delay:3e3,using:function(t,e){$(this).css(t),$("<div>").addClass("ajs-arrow").addClass(e.vertical).addClass(e.horizontal).appendTo(this)}},content:function(){var t=$(this),e=t.attr("title");return t.is("[data-src]")?"<img class='image' alt='"+e+"' src='"+t.attr("data-src")+"' />":"<p>"+(e=e.replace(/(?:\r\n|\r|\n)/g,"<br />"))+"</p>"}},PREFERRED_TICS:[1,5,10,100,1e3,2e3,5e3,1e4,2e4,3e4,6e4,3e5,6e5,18e5],mediaDuration:0,averageLabelSize:50,init:function(t,e){this.settings=$.extend({debug:!1},e||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),this.container=t,this.mediaDuration=1e3*this.settings.duration,this.averageLabelSize=50,this.initialize()},initialize:function(){this.container.on("click",{self:this},this.onClick),this.container.draggable({axis:"x"}),this.container.on("drag",{self:this},this.onDrag),this.container.on("dragstop",{self:this},this.onDragStop),$(window).on("resize",{self:this},this.onWindowResize)},getWidth:function(){return Math.round(this.container.width())},getPreferredNbSegments:function(){return Math.round(this.getWidth()/this.averageLabelSize)},createTic:function(t,e,a){var i=$("<div>",{class:"time-grid","data-tc":t}),t=$("<span>",{class:"time",text:a,"data-tc":t,title:fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(t/1e3,this.settings.framerate,this.settings.timeFormat)});return i.append(t),i.css("left",e+"%"),i},updateSegments:function(t,e){this.currentTcin=t,this.currentTcout=e;for(var a,i=e-t,n=this.getPreferredNbSegments(),s=0,o=t,l=-1;l++,n<(s=Math.round(i/this.PREFERRED_TICS[l]))&&l<this.PREFERRED_TICS.length-1;);a=this.PREFERRED_TICS[l],o=Math.max(-1,Math.ceil(t/a)-s)*a,e=Math.min(e+i,this.mediaDuration);for(this.container.empty(),this.container.attr("data-duration",i);this.container.append(this.createTic(o+=a,100*(o-t)/i,this.getFormatTc(o,a))),o<e;);this.container.find("span.time").tooltip(this.tooltipConfiguration),null!==this.logger&&this.logger.trace(this.Class.fullName,"updateSegments getWidth() : "+this.getWidth()+" preferredNbSegments :"+n)},getFormatTc:function(t,e){t/=1e3,e/=1e3;var a="",i=Math.floor(t/60),n=Math.floor(i/60),s=Math.floor(t%60),t=t%60;return i=10<=(i=Math.floor(i%60))?i:"0"+i,n=10<=n?n:"0"+n,s=10<=s?s:"0"+s,3600<e?a=0===parseInt(n)?n+"::"+i+":"+s+" m":n+"h":e<=3600&&60<=e?a=0===parseInt(n)?i+":"+s+" m":n+":"+i+" h":e<60&&1<e?a=0!==parseInt(n)&&0===parseInt(i)?t.toFixed(2).toString()+" s":i+":"+s+" m":e<=1&&(a=e<=.001?t.toFixed(4).toString().split(".")[1]+" ms":s+"."+t.toFixed(2).toString().split(".")[1]+" s"),a},onClick:function(t){var e=$(t.target);t.preventDefault(),!e.hasClass("time")||"number"==typeof(e=parseFloat(e.attr("data-tc")))&&(t.data.self.container.trigger(t.data.self.Class.eventTypes.CLICK,{tc:e/1e3}),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onClick tc:"+e))},onDrag:function(t,e){var a=$(t.target),i=Math.abs(parseInt(a.find(".time-grid").first().position().left)),n=parseInt(a.find(".time-grid").last().position().left),t=e.position;return e.position.left>i?t.left=i:a.width()-n>e.position.left&&(t.left=a.width()-n),t},onDragStop:function(t,e){var a=$(t.target),i=parseFloat(a.attr("data-tcin")),n=(o=parseFloat(a.attr("data-tcout")))-i,s=100*Math.abs(e.position.left)/a.width(),s=Math.round(n*s/100),o=(i=0<e.position.left?i-s:i+s)+n;"number"==typeof i&&"number"==typeof o&&(a.css("left","0px"),t.data.self.container.trigger(t.data.self.Class.eventTypes.UPDATE_TC,{tcin:i,tcout:Math.min(t.data.self.mediaDuration,o)}),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onDragStop tcin:"+i+" tcout"+o))},onWindowResize:function(t){!1===$(t.target).first().is("div")&&t.data.self.updateSegments(t.data.self.currentTcin,t.data.self.currentTcout),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onWindowResize ")}}),$.Class("fr.ina.amalia.player.plugins.timeline.ZoomComponent",{styleCss:"display: block; position: absolute;height: 100px;width: 1px;background: aqua;margin-top: -50px;",eventTypes:{CHANGE:"fr.ina.amalia.player.plugins.timeline.ZoomComponent.event.change"}},{logger:null,container:null,settings:{},tcOffset:0,duration:0,currentTcin:0,currentTcout:0,slideSpeed:0,zoomSpeed:2,init:function(t,e,a){this.settings=$.extend({debug:!1,zoomSpeed:5,tcOffset:0},a||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),this.container=t,this.tcOffset=1e3*parseFloat(this.settings.tcOffset),this.duration=1e3*e,this.zoomSpeed=this.settings.zoomSpeed,this.slideSpeed=0,this.initialize(this.tcOffset,this.duration+this.tcOffset)},initialize:function(t,e){null!==this.logger&&this.logger.trace(this.Class.fullName,"Initialize  tcin"+t+" tcout:"+e+" duration : "+this.duration),this.container.append($("<span>",{class:"time",style:this.Class.styleCss}));var a=$("<div>",{class:"list"});this.container.append(a),this.setTc(t,e)},setTc:function(t,e){"number"==typeof t&&"number"==typeof e&&isFinite(t)&&isFinite(e)&&(this.currentTcin=t,this.currentTcout=e,this.updateTime()),null!==this.logger&&this.logger.trace(this.Class.fullName,"setTc / currentTcin :"+this.currentTcin+" currentTcout:"+this.currentTcout)},updateTime:function(){this.currentTcin=Math.max(this.tcOffset,this.currentTcin),this.currentTcout=Math.min(this.currentTcout,this.duration+this.currentTcout),this.updateTc(),this.sendEvent(),null!==this.logger&&this.logger.trace(this.Class.fullName,"updateTime currentTcin :"+this.currentTcin+" currentTcout:"+this.currentTcout)},sendEvent:function(){this.container.trigger(this.Class.eventTypes.CHANGE,{tcin:this.currentTcin,tcout:this.currentTcout}),null!==this.logger&&this.logger.trace(this.Class.fullName,"sendEvent sendEvent :"+this.Class.eventTypes.CHANGE+" currentTcin:"+this.currentTcin+" currentTcout "+this.currentTcout)},updateTc:function(){this.container.attr({"data-tcin":this.currentTcin,"data-tcout":this.currentTcout})},zoomIn:function(t){var e=this.currentTcout-this.currentTcin,e=Math.round(e/this.zoomSpeed);0!==e&&(this.slideSpeed=e,this.currentTcin=t-e,this.currentTcout=t+e,this.updateTime())},zoomOut:function(){var t=this.currentTcout-this.currentTcin,t=Math.round(t/this.zoomSpeed);this.slideSpeed=t=t<=0?1:t,this.currentTcin-=t,this.currentTcout+=t,this.updateTime()},slideLeft:function(){0<=this.currentTcin-this.slideSpeed&&(this.currentTcin=this.currentTcin-this.slideSpeed,this.currentTcout=this.currentTcout-this.slideSpeed,null!==this.logger&&this.logger.trace(this.Class.fullName,"slideLeft currentZoom : "+this.currentZoom+" currentTcin :"+this.currentTcin+" currentTcout:"+this.currentTcout),this.updateTc(),this.sendEvent())},slideRight:function(){this.currentTcout+this.slideSpeed<=this.duration&&(this.currentTcin=this.currentTcin+this.slideSpeed,this.currentTcout=this.currentTcout+this.slideSpeed,null!==this.logger&&this.logger.trace(this.Class.fullName,"slideRight currentZoom : "+this.currentZoom+" currentTcin :"+this.currentTcin+" currentTcout:"+this.currentTcout),this.updateTc(),this.sendEvent())}}),fr.ina.amalia.player.plugins.timeline.BaseComponent.extend("fr.ina.amalia.player.plugins.timeline.TimeAxisComponent",{STYLE_CLASSNAME_EXPAND_ON:"ajs-icon-chevron-down",STYLE_CLASSNAME_EXPAND_OFF:"ajs-icon-chevron-right",eventTypes:{CLICK_AT_TIC:"fr.ina.amalia.player.plugins.timeline.TimeAxisComponent.event.clickattic",RANGE_CHANGE:"fr.ina.amalia.player.plugins.timeline.TimeAxisComponent.event.rangechange",CHANGE_DISPLAY:"fr.ina.amalia.player.plugins.timeline.TimeAxisComponent.event.changedisplay",CHANGE_TIMEAXIS_DISPLAY_STATE:"fr.ina.amalia.player.plugins.timeline.TimeAxisComponent.event.changetimeaxisdisplaystate"}},{tcin:0,tcout:0,duration:0,segmentsGenerator:null,timeZoomComponent:null,currentTcin:0,currentTcout:0,init:function(t){if(this.settings=$.extend({debug:!1,container:null,duration:0,expand:!1,tcOffset:0},t||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),this.mainContainer=this.settings.container,this.tcin=parseFloat(this.settings.tcOffset),this.currentTcin=parseFloat(this.settings.tcOffset),this.tcout=parseFloat(this.settings.duration)+parseFloat(this.settings.tcOffset),this.currentTcout=parseFloat(this.settings.duration)+parseFloat(this.settings.tcOffset),this.duration=parseFloat(this.settings.duration),this.segmentsGenerator=null,this.timeZoomComponent=null,"object"!=typeof this.mainContainer)throw new Error("Your container is empty.");this.initialize()},initialize:function(){this.createTimeAxis(),!0===this.settings.expand&&(this.createControleBar(),this.createLabelContainer())},getTcin:function(){return this.tcin},getTcout:function(){return this.tcout},createControleBar:function(){var t=$("<div>",{class:"toolbar-container"}),e=this.createButton(fr.ina.amalia.player.PlayerMessage.PLUGIN_TIMELINE_LABEL_EXPAND,"expand-btn");e.on("click",{self:this},this.onClickExpandBtn),e.addClass(this.Class.STYLE_CLASSNAME_EXPAND_ON),t.append(e),this.mainContainer.append(t)},createLabelContainer:function(){var t=$("<div>",{class:"timeaxis-label"});t.append($("<p>",{class:"label",text:fr.ina.amalia.player.PlayerMessage.PLUGIN_TIMELINE_LABEL_TIMEAXIS})),this.mainContainer.append(t)},createTimeAxis:function(){var t=$("<div>",{class:"line-content"}),e=$("<div>",{class:"line"}),a=$("<div>",{class:"toolsbar"});this.createToolsBar(a);var i=$("<div>",{class:"module-timeaxis"});i.append(e),i.append(t),this.mainContainer.append(i),this.mainContainer.append(a),this.timeZoomComponent=new fr.ina.amalia.player.plugins.timeline.ZoomComponent(t,this.duration,this.settings),this.segmentsGenerator=new fr.ina.amalia.player.plugins.timeline.TicComponent(t,this.settings),i.on(fr.ina.amalia.player.plugins.timeline.ZoomComponent.eventTypes.CHANGE,{self:this},this.onTimeRangeChange),this.mainContainer.on("mousewheel",{self:this},this.onMousewheel),this.mainContainer.on("DOMMouseScroll",{self:this},this.onDOMMouseScroll),t.on(fr.ina.amalia.player.plugins.timeline.TicComponent.eventTypes.CLICK,{self:this},this.onClickAtTic),t.on(fr.ina.amalia.player.plugins.timeline.TicComponent.eventTypes.UPDATE_TC,{self:this},this.onUpdateTicRange),null!==this.logger&&this.logger.trace(this.Class.fullName,"createTimeAxis")},createToolsBar:function(t){var e=this,a=$("<div>",{class:"ajs-row"}),i=$("<div>",{class:"ajs-col leftContainer"}),n=$("<div>",{class:"ajs-col middleContainer"}),s=$("<div>",{class:"ajs-col rightContainer"}),o=this.createButton(fr.ina.amalia.player.PlayerMessage.PLUGIN_TIMELINE_LABEL_ZOOM_IN,"plus");o.on("click",{self:this},this.onZoomIn),n.append(o);o=this.createButton(fr.ina.amalia.player.PlayerMessage.PLUGIN_TIMELINE_LABEL_ZOOM_OUT,"minus");o.on("click",{self:this},this.onZoomOut),n.append(o);o=this.createButton(fr.ina.amalia.player.PlayerMessage.PLUGIN_TIMELINE_LABEL_CHANGE_DISPLAY,"arrows-v");o.on("click",{self:this},this.onChangeDisplay),n.append(o);var l=null,o=this.createButton(fr.ina.amalia.player.PlayerMessage.PLUGIN_TIMELINE_LABEL_SLIDE_LEFT,"chevron-left");o.on("click",$.proxy(this.onSlideLeft,this)),o.on("mousedown",function(){l=setInterval(function(){e.onSlideLeft()},75)}),o.on("mouseup",function(){clearTimeout(l)}),o.addClass("pull-left"),i.append(o);var r=null,o=this.createButton(fr.ina.amalia.player.PlayerMessage.PLUGIN_TIMELINE_LABEL_SLIDE_RIGHT,"chevron-right");o.on("click",$.proxy(this.onSlideRight,this)),o.on("mousedown",function(){r=setInterval(function(){e.onSlideRight()},75)}),o.on("mouseup",function(){clearTimeout(r)}),o.addClass("pull-right"),s.append(o),a.append(i),a.append(n),a.append(s),t.append(a)},setZoomTc:function(t,e){this.timeZoomComponent.setTc(parseFloat(1e3*t),parseFloat(1e3*e))},zoom:function(t,e){"in"===(void 0===t?"in":t)?this.timeZoomComponent.zoomIn(e):this.timeZoomComponent.zoomOut(e)},slide:function(t){"left"===(void 0===t?"left":t)?this.timeZoomComponent.slideLeft():this.timeZoomComponent.slideRight()},onTimeRangeChange:function(t,e){t.data.self.currentTcin=parseFloat(e.tcin),t.data.self.currentTcout=parseFloat(e.tcout),t.data.self.segmentsGenerator.updateSegments(e.tcin,e.tcout),t.data.self.mainContainer.trigger(t.data.self.Class.eventTypes.RANGE_CHANGE,{tcin:e.tcin/1e3,tcout:e.tcout/1e3})},onZoomIn:function(t){var e=(t.data.self.currentTcout-t.data.self.currentTcin)/2+t.data.self.currentTcin;t.data.self.zoom("in",e),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onZoomIn")},onZoomOut:function(t){var e=(t.data.self.currentTcout-t.data.self.currentTcin)/2+t.data.self.currentTcin;t.data.self.zoom("out",e),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onZoomOut")},onSlideLeft:function(){this.slide("left"),null!==this.logger&&this.logger.trace(this.Class.fullName,"slideLeft")},onSlideRight:function(){this.slide("right"),null!==this.logger&&this.logger.trace(this.Class.fullName,"slideRight")},onChangeDisplay:function(t){t.data.self.mainContainer.trigger(t.data.self.Class.eventTypes.CHANGE_DISPLAY),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onChangeDisplay")},getTcOfEvent:function(t){var e=$(t.currentTarget);return(t.data.self.currentTcout-t.data.self.currentTcin)*(t.clientX-e.offset().left)/e.width()+t.data.self.currentTcin},onDOMMouseScroll:function(t){t.preventDefault();var e=t.originalEvent.wheelDelta||t.originalEvent.detail,a=t.data.self.getTcOfEvent(t);"number"==typeof e&&(e<0?t.data.self.zoom("in",a):t.data.self.zoom("out",a)),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onDOMMouseScroll")},onMousewheel:function(t){t.preventDefault();var e=t.originalEvent.wheelDelta||t.originalEvent.detail,a=t.data.self.getTcOfEvent(t);"number"==typeof e&&(0<e?t.data.self.zoom("in",a):t.data.self.zoom("out",a)),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onMousewheel")},onClickAtTic:function(t,e){!0===e.hasOwnProperty("tc")&&"number"==typeof e.tc&&t.data.self.mainContainer.trigger(t.data.self.Class.eventTypes.CLICK_AT_TIC,{tc:parseFloat(e.tc)})},onUpdateTicRange:function(t,e){!0===e.hasOwnProperty("tcin")&&!0===e.hasOwnProperty("tcout")&&(null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onUpdateTicRange"),t.data.self.timeZoomComponent.setTc(e.tcin,e.tcout))},onClickExpandBtn:function(e){try{e.data.self.mainContainer.hasClass("off")?(e.data.self.mainContainer.removeClass("off").addClass("on"),e.data.self.mainContainer.find(".expand-btn.plugin-btn").removeClass(e.data.self.Class.STYLE_CLASSNAME_EXPAND_OFF).addClass(e.data.self.Class.STYLE_CLASSNAME_EXPAND_ON),e.data.self.mainContainer.trigger(e.data.self.Class.eventTypes.CHANGE_TIMEAXIS_DISPLAY_STATE,{state:!0})):(e.data.self.mainContainer.removeClass("on").addClass("off"),e.data.self.mainContainer.find(".expand-btn.plugin-btn").removeClass(e.data.self.Class.STYLE_CLASSNAME_EXPAND_ON).addClass(e.data.self.Class.STYLE_CLASSNAME_EXPAND_OFF),e.data.self.mainContainer.trigger(e.data.self.Class.eventTypes.CHANGE_TIMEAXIS_DISPLAY_STATE,{state:!1}))}catch(t){null!==e.data.self.logger&&e.data.self.logger.error(e.data.self.Class.fullName+"onClickExpandBtn : "+t.toString())}}}),fr.ina.amalia.player.plugins.timeline.BaseComponent.extend("fr.ina.amalia.player.plugins.timeline.CuepointsComponent",{eventTypes:{DATA_CHANGE:"fr.ina.amalia.player.plugins.timeline.CuepointsComponent.eventTypes.DATA_CHANGE"},ComponentClassCss:"cuepoints-component",ComponentModuleClassCss:"module-cuepoints",COMPONENT_NAME:"cuepoint"},{initialize:function(){this._super(),this.mainContainer.on("click",".cuepoint",{self:this},this.onClickAtCuepoint),!0===this.settings.editable&&!0===this.settings.selectable&&this.mainContainer.find(".module-cuepoints").selectable({filter:".item",stop:$.proxy(this.onSelectStop,this)})},createCuePointElement:function(t,e,a,i){var s=this,n=void 0!==this.settings.icon&&""!==this.settings.icon?this.settings.icon:"circle",o=$("<i>",{class:"item cuepoint ajs-icon ajs-icon-"+n,style:"left: "+e+"%; color:"+this.settings.color+";",title:a,"data-tc":t,"data-tclevel":i});return!0===this.settings.editable&&(o.draggable({axis:"x",drag:function(t,e){var a=$(t.target),i=a.parent(),n=Math.max(0,e.position.left);e.position.left=Math.min(i.first().width(),n);n=s.zTcin+parseFloat((s.zTcout-s.zTcin)*n/s.mainContainer.first().width());!0===t.shiftKey?(a=n-a.data("metadata").tc,o.attr("title","Offset seconds : "+fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(a,s.settings.framerate,"seconds"))):o.attr("title",fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(n,s.settings.framerate,s.settings.timeFormat)),s.updateTooltip()}}),o.on("dragstop",{self:this},this.onDragStop),o.css("position","absolute")),o},addItem:function(t){var e,a,i,n,s,o;t.hasOwnProperty("tc")&&(e=parseFloat(t.tc),o=this.tcout-this.tcin,a=100*(e-this.tcin)/o,i=this.mainContainer.find(".line-content").first(),n=!0===t.hasOwnProperty("label")&&""!==t.label&&null!==t.label?t.label:"Tc: "+fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(e,this.settings.framerate,this.settings.timeFormat),s=null,o=t.hasOwnProperty("selected")&&!0===t.selected,e>=this.tcin&&e<=this.tcout&&((s=this.createCuePointElement(e,a,n,t.tclevel)).data("metadata",t),o&&(s.addClass("selected"),t.hasOwnProperty("formCreated")&&!1===t.formCreated&&this.mainContainer.trigger(this.Class.CLICK_SELECT,{tc:e,metadata:t})),t.hasOwnProperty("type")&&null!==t.type&&s.attr("data-item-type",t.type),i.append(s),null!==this.logger&&this.logger.trace(this.Class.fullName,"addItem tcin: "+this.tcin+" tcout: "+this.tcout+" tc:"+e+" percentPos:"+a)))},removeItems:function(){this.mainContainer.find(".line-content .cuepoint").remove()},onClickAtCuepoint:function(t){t.stopPropagation();var e=$(t.currentTarget),a=parseFloat(e.data("tc")),i=$(t.currentTarget).data("metadata");t.ctrlKey&&t.altKey&&!0!==i.selected&&!0===t.data.self.settings.editable?(e.addClass("selected"),t.data.self.mainContainer.trigger(t.data.self.Class.CLICK_SELECT,{tc:a,metadata:i})):t.altKey&&!0===t.data.self.settings.editable?(t.data.self.clearSelectedItems(),e.addClass("selected"),t.data.self.mainContainer.trigger(t.data.self.Class.CLICK_SELECT,{tc:a,metadata:i})):(t.data.self.clearSelectedItems(),t.data.self.mainContainer.trigger(t.data.self.Class.CLICK_TC,{tc:a})),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onClickAtCuepoint tc:"+a)},onDragStop:function(t){var e,a=$(t.currentTarget),i=t.data.self.zTcin+parseFloat((t.data.self.zTcout-t.data.self.zTcin)*a.position().left/t.data.self.mainContainer.first().width());!0===t.shiftKey?(e=i-a.data("metadata").tc,t.data.self.localisationManager.shiftLocBlock(t.data.self.mediaPlayer.getMetadataById(t.data.self.getMetadataId()),e,t.data.self.mediaPlayer.getTcin(),t.data.self.mediaPlayer.getTcout(),t.altKey)):(a.data("metadata").tc=i,a.data("metadata").hasOwnProperty("tcin")&&(a.data("metadata").tcin=i)),t.data.self.mainContainer.trigger(t.data.self.Class.eventTypes.DATA_CHANGE,{id:t.data.self.getMetadataId()})},onSelectStop:function(){this.clearSelectedItems();var a=this;this.mainContainer.find(".module-cuepoints").find(".item.ui-selected").each(function(t,e){e=$(e);e.addClass("selected");e=e.data("metadata");null!==e&&(e.selected=!0,a.mainContainer.trigger(a.Class.CLICK_SELECT,{tc:e.tc,metadata:e}))}),this.mainContainer.find(".module-cuepoints").selectable("option","cancel",".item")}}),fr.ina.amalia.player.plugins.timeline.BaseComponent("fr.ina.amalia.player.plugins.timeline.SegmentsComponent",{ComponentClassCss:"segments-component",ComponentModuleClassCss:"module-segments",COMPONENT_NAME:"segment",eventTypes:{DATA_CHANGE:"fr.ina.amalia.player.plugins.timeline.SegmentsComponent.eventTypes.DATA_CHANGE"}},{initialize:function(){this._super(),this.mainContainer.on("dblclick ",".segment",{self:this},this.onDBLClickAtSegment),this.mainContainer.on("click",".segment",{self:this},this.onClickAtSegment),!0===this.settings.editable&&!0===this.settings.selectable&&this.mainContainer.find(".module-segments").selectable({filter:".item",stop:$.proxy(this.onSelectStop,this)})},createSegmentElement:function(i,t,e,a,n){var s=this,o=""!==this.settings.color?"color:"+this.settings.color+"; background-color:"+this.settings.color+";":"",l=!0===this.settings.marker?"item segment marker":"item segment",r=$("<div>",{class:l,style:"left: "+e+"%; width:"+a+"%;"+o,title:n,"data-tc":i,"data-tcin":i,"data-tcout":t});return!0===this.settings.editable&&(r.resizable({handles:"e,w",ghost:!0,helper:"ui-resizable-helper",start:function(t,e){var a=$(t.target).parent().width()-e.element.position().left;$(t.target).resizable("option","maxWidth",a);t=$(t.originalEvent.target);$(e.element).data("resizeTcin",t.hasClass("ui-resizable-w")),$(e.element).data("resizeTcout",t.hasClass("ui-resizable-e"))},resize:function(t,e){var a=parseFloat((s.zTcout-s.zTcin)*Math.max(0,e.position.left)/s.mainContainer.first().width())+s.zTcin,e=i+parseFloat((s.zTcout-s.zTcin)*e.size.width/s.mainContainer.first().width());r.attr("title","Tc in : "+fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(a,s.settings.framerate,s.settings.timeFormat)+"\n Tc out : "+fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(e,s.settings.framerate,s.settings.timeFormat)),s.updateTooltip()}}),r.on("resizestop",{self:this},this.onResizeStop),r.draggable({axis:"x",drag:function(t,e){var a=$(t.target),i=a.parent(),n=Math.max(0,e.position.left);e.position.left=Math.min(i.first().width()-a.width(),n);n=parseFloat((s.zTcout-s.zTcin)*e.position.left/s.mainContainer.first().width())+s.zTcin,e=parseFloat((s.zTcout-s.zTcin)*a.width()/s.mainContainer.first().width())+n;!0===t.shiftKey?(a=n-a.data("metadata").tcin,r.attr("title","Offset seconds : "+fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(a,s.settings.framerate,"seconds"))):r.attr("title","Tc in : "+fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(n,s.settings.framerate,s.settings.timeFormat)+"\n Tc out : "+fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(e,s.settings.framerate,s.settings.timeFormat)),s.updateTooltip()}}),r.on("dragstop",{self:this},this.onDragStop),r.css("position","absolute")),r},addItem:function(t){var e,a,i,n,s,o,l,r,c,d;t.hasOwnProperty("tcin")&&t.hasOwnProperty("tcout")&&(e=parseFloat(!1===this.zoomable?this.tcOffset:this.tcin),a=parseFloat(!1===this.zoomable?this.duration:this.tcout),i=parseFloat(t.tcin),s=100*((n=parseFloat(t.tcout))-i)/(d=a-e),o=100*(i-e)/d,r=null,l=t.hasOwnProperty("selected")&&!0===t.selected,r=!0===t.hasOwnProperty("label")&&""!==t.label&&null!==t.label?t.label:"Tc in : "+fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(i,this.settings.framerate,this.settings.timeFormat)+"\n Tc out : "+fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(n,this.settings.framerate,this.settings.timeFormat),c=this.mainContainer.find(".line-content").first(),d=null,i<a&&e<n&&((d=this.createSegmentElement(i,n,o,s,r)).data("metadata",t),l&&d.addClass("selected"),l&&t.hasOwnProperty("formCreated")&&!1===t.formCreated&&this.mainContainer.trigger(this.Class.CLICK_SELECT,{tc:i,metadata:t}),t.hasOwnProperty("type")&&null!==t.type&&d.attr("data-item-type",t.type),c.append(d),null!==this.logger&&this.logger.trace(this.Class.fullName,"addItem tcin: "+e+" tcout: "+a+" itemTcin:"+i+" itemTcout:"+n+" percentWidth:"+o)))},removeItems:function(){this.mainContainer.find(".line-content").first().find(".segment").remove()},onClickAtSegment:function(t){t.stopPropagation();var e=$(t.currentTarget),a=parseFloat(e.data("tcin")),i=$(t.currentTarget).data("metadata");t.altKey&&!0===t.data.self.settings.editable&&"object"==typeof i&&!0!==i.selected?(e.addClass("selected"),t.data.self.mainContainer.trigger(t.data.self.Class.CLICK_SELECT,{tc:a,metadata:i})):(t.data.self.clearSelectedItems(),t.data.self.mainContainer.trigger(t.data.self.Class.CLICK_TC,{tc:a,metadata:i})),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onClickAtSegment tcin:"+a)},onDBLClickAtSegment:function(t){var e=$(t.currentTarget),a=parseFloat(e.data("tcin")),i=$(t.currentTarget).data("metadata");t.preventDefault(),!0===t.data.self.settings.editable&&"object"==typeof i&&(t.data.self.clearSelectedItems(),i.hasOwnProperty("selected")&&!0===i.selected?(e.removeClass("selected"),t.data.self.mainContainer.trigger(t.data.self.Class.CLICK_REMOVE_SELECT_ITEM,{tc:a,metadata:i})):(e.addClass("selected"),t.data.self.mainContainer.trigger(t.data.self.Class.CLICK_SELECT,{tc:a,metadata:i}))),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onDBLClickAtSegment tcin:"+a)},onDragStop:function(t){var e=$(t.currentTarget),a=parseFloat(!1===t.data.self.zoomable?t.data.self.tcOffset:t.data.self.zTcin),i=parseFloat(!1===t.data.self.zoomable?t.data.self.duration:t.data.self.zTcout),n=parseFloat((i-a)*e.position().left/t.data.self.mainContainer.first().width())+a,i=parseFloat((i-a)*e.width()/t.data.self.mainContainer.first().width())+n;!0===t.shiftKey?(a=n-e.data("metadata").tcin,t.data.self.localisationManager.shiftLocBlock(t.data.self.mediaPlayer.getMetadataById(t.data.self.getMetadataId()),a,t.data.self.mediaPlayer.getTcin(),t.data.self.mediaPlayer.getTcout(),t.altKey)):(e.data("metadata").tcin=n,e.data("metadata").tcout=i),t.data.self.mainContainer.trigger(t.data.self.Class.eventTypes.DATA_CHANGE,{id:t.data.self.getMetadataId()})},onResizeStop:function(t,e){var a=$(t.currentTarget),i=parseFloat(!1===t.data.self.zoomable?t.data.self.tcOffset:t.data.self.zTcin),n=parseFloat(!1===t.data.self.zoomable?t.data.self.duration:t.data.self.zTcout),s=parseFloat((n-i)*Math.max(0,a.position().left)/t.data.self.mainContainer.first().width())+i,a=s+parseFloat((n-i)*a.width()/t.data.self.mainContainer.first().width()),e=$(e.element);!0===e.data("resizeTcin")&&($(t.currentTarget).data("metadata").tcin=s),!0===e.data("resizeTcout")&&($(t.currentTarget).data("metadata").tcout=a),t.data.self.updateTooltip(),t.data.self.mainContainer.trigger(t.data.self.Class.eventTypes.DATA_CHANGE,{id:t.data.self.getMetadataId()})},onSelectStop:function(){this.clearSelectedItems();var a=this;this.mainContainer.find(".module-segments").find(".item.ui-selected").each(function(t,e){e=$(e);e.addClass("selected");e=e.data("metadata");null!==e&&(e.selected=!0,a.mainContainer.trigger(a.Class.CLICK_SELECT,{tc:e.tc,metadata:e}))}),this.mainContainer.find(".module-segments").selectable("option","cancel",".item")}}),fr.ina.amalia.player.plugins.timeline.BaseComponent.extend("fr.ina.amalia.player.plugins.timeline.ImagesComponent",{ComponentClassCss:"images-component",ComponentModuleClassCss:"module-images",COMPONENT_NAME:"image"},{tooltipConfiguration:{position:{my:"center bottom-20",at:"center top",delay:3e3,using:function(t,e){$(this).css(t),$("<div>").addClass("ajs-arrow").addClass("timeline-images-component").addClass(e.vertical).addClass(e.horizontal).appendTo(this)}},content:function(){var t=$(this),e=t.attr("title");return console.log("content",t),t.is("[data-src]")?"<img class='timeline-images-component tooltip-image' alt='"+e+"' src='"+t.attr("data-src")+"' />":"<p>"+(e=e.replace(/(?:\r\n|\r|\n)/g,"<br />"))+"</p>"}},initialize:function(){this._super(),this.mainContainer.on("click",".image",{self:this},this.onClickAtImage)},createImageElement:function(t,e,a,i,n,s,o){var l=$("<img>",{src:s,class:"content",title:n,"data-src":s}).tooltip(this.tooltipConfiguration),r=null;return null!==e?(s=$("<hr>",{class:"flow",style:"border-color:"+this.settings.color+"; color:"+this.settings.color+";"}),r=$("<div>",{class:"item image segment",style:"left: "+a+"%; width:"+i+"%;",title:n,"data-tc":t,"data-tclevel":o,"data-tcin":t,"data-tcout":e}).append(s),i>parseInt(this.settings.pointTogglePercentHeight)?r.append(l):r.tooltip(this.tooltipConfiguration)):r=$("<div>",{class:"item image",style:"left: "+a+"%; margin-left:-"+this.settings.offset+"px;",title:n,"data-tc":t,"data-tclevel":o}).append(l),r.on("mouseenter mouseleave",function(t){"mouseenter"===t.type?($(t.currentTarget).parent().find(".image").css("opacity",".3"),$(t.currentTarget).addClass("on").css("opacity","1")):($(t.currentTarget).parent().find(".image").css("opacity","1"),$(t.currentTarget).removeClass("on").css("opacity","1"))}),r},getThumbPath:function(t){var e="";return e=!0===t.hasOwnProperty("thumb")&&null!==t.thumb&&""!==t.thumb&&-1===(e=t.thumb).search("/^data:/")?this.settings.thumbDirectory+e:e},addItem:function(t){var e,a,i,n=null,s=null,o=null,l=this.tcout-this.tcin,r=this.getThumbPath(t);t.hasOwnProperty("tcin")&&t.hasOwnProperty("tcout")?(e=parseFloat(t.tcin),a=100*((i=parseFloat(t.tcout))-e)/l,n=100*(e-this.tcin)/l,s=!0===t.hasOwnProperty("label")&&""!==t.label&&null!==t.label?t.label:"Tc in: "+fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(e,this.settings.framerate,this.settings.timeFormat)+"\n Tc out: "+fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(i,this.settings.framerate,this.settings.timeFormat),o=this.mainContainer.find(".line-content").first(),e>=this.tcin&&e<=this.tcout&&(o.append(this.createImageElement(e,i,n,a,s,r,t.tclevel)),null!==this.logger&&this.logger.trace(this.Class.fullName,"addItem tcin: "+this.tcin+" tcout: "+this.tcout+" itemTcin:"+e+" itemTcout:"+i+" percentWidth:"+n))):t.hasOwnProperty("tc")&&(n=100*((i=parseFloat(t.tc))-this.tcin)/l,s=!0===t.hasOwnProperty("label")&&""!==t.label&&null!==t.label?t.label:fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(i,this.settings.framerate,this.settings.timeFormat),o=this.mainContainer.find(".line-content").first(),i>=this.tcin&&i<=this.tcout&&(o.append(this.createImageElement(i,null,n,null,s,r,t.tclevel)),null!==this.logger&&this.logger.trace(this.Class.fullName,"addItem tc: "+i)))},removeItems:function(){this.mainContainer.find(".line-content").first().find(".image").remove()},onClickAtImage:function(t){var e=$(t.currentTarget),e=parseFloat(e.data("tc"));t.data.self.mainContainer.trigger(t.data.self.Class.CLICK_TC,{tc:e}),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onClickAtImage tcin:"+e)}}),fr.ina.amalia.player.plugins.timeline.BaseComponent.extend("fr.ina.amalia.player.plugins.timeline.HistogramComponent",{ComponentClassCss:"histogram-component",ComponentModuleClassCss:"module-histogram",eventTypes:{}},{canvas:null,histogramIsCreated:!1,initialize:function(){this._super(),this.settings=$.extend({mirror:!1,color:"#ffffff"},this.settings||{}),this.histogramIsCreated=!1,this.canvas=new Raphael(this.mainContainer.find(".line-content").get(0)),this.mainContainer.on("click",{self:this},this.onClickAtHistogram)},createHistogram:function(t,e,a,i,n){var s=fr.ina.amalia.player.helpers.UtilitiesHelper.base64DecToArr(t,n),o=null,t=parseInt(e);null!==a&&null!==i&&(o=fr.ina.amalia.player.helpers.UtilitiesHelper.base64DecToArr(a,n),t=parseInt(e+i)),this.canvas.setViewBox(0,0,n,t,!1),this.canvas.setSize("100%","100%"),this.canvas.canvas.setAttribute("preserveAspectRatio","none");for(var l,r,c=void 0===this.settings.color?"#FFFFFF":this.settings.color,d=0;d<n;d++)l=parseInt(s[d]),this.canvas.path("M"+d+" "+e+"l 0 -"+l).attr({type:"path",stroke:c,"stroke-width":"1",fill:c}),null!==o&&(r=parseInt(o[d]),this.canvas.path("M"+d+" "+i+"l 0 "+r).attr({type:"path",stroke:c,"stroke-width":"1",fill:c}));null!==this.logger&&this.logger.trace(this.Class.fullName,"CreateHistogramWithMirror posmax:"+e+"  negmax:"+i+"/ nbbins:"+n)},createHistogramWithMirror:function(t,e,a){var i=fr.ina.amalia.player.helpers.UtilitiesHelper.base64DecToArr(t,a);this.canvas.setViewBox(0,0,a,2*e,!1),this.canvas.setSize("100%","100%"),this.canvas.canvas.setAttribute("preserveAspectRatio","none");for(var n,s=0;s<a;s++)n=parseInt(i[s]),this.canvas.path("M"+s+" "+e+"l 0 -"+n).attr({type:"path",stroke:this.settings.color,"stroke-width":"1",fill:this.settings.color}),this.canvas.path("M"+s+" "+e+"l 0 "+n).attr({type:"path",stroke:this.settings.color,"stroke-width":"1",fill:this.settings.color});null!==this.logger&&this.logger.trace(this.Class.fullName,"CreateHistogramWithMirror posmax:"+e+"/ nbbins:"+a)},setZoomTc:function(t,e){this._super(t,e),!0===this.settings.zoomable&&(t=parseInt(this.settings.tcOffset),e=(t=100*(e=parseInt(this.settings.duration)-t)/(this.zTcout-this.zTcin))*(this.zTcin-parseInt(this.settings.tcOffset))/e,this.mainContainer.find(".line-content").css({left:-e+"%",width:t+"%"}))},addItem:function(t){if(!1===this.histogramIsCreated&&null!==t.data&&!0===t.data.hasOwnProperty("histogram")&&null!==t.data.histogram&&0<t.data.histogram.length){this.canvas.clear();for(var e=0;e<t.data.histogram.length;e++){var a=t.data.histogram[e];if(a.hasOwnProperty("posbins")&&a.hasOwnProperty("posmax")&&a.hasOwnProperty("nbbins"))try{!0===this.settings.mirror?this.createHistogramWithMirror(a.posbins,a.posmax,a.nbbins):this.createHistogram(a.posbins,a.posmax,a.hasOwnProperty("negbins")?a.negbins:null,a.hasOwnProperty("negmax")?a.negmax:null,a.nbbins)}catch(t){null!==this.logger&&(this.logger.warn("Error to create histogram"),this.logger.warn(t.stack))}else null!==this.logger&&(this.logger.warn(this.Class.fullName+"Error to create histogram"),this.logger.warn(a))}this.histogramIsCreated=!0}},removeItems:function(){},setHistogramIsCreated:function(t){this.histogramIsCreated=t},onClickAtHistogram:function(t){var e=$(t.currentTarget),a=100*(t.clientX-e.offset().left+e.position().left)/t.data.self.mainContainer.width(),e=null,e=!1===t.data.self.zoomable?(t.data.self.tcout-t.data.self.tcin)*a/100+parseInt(t.data.self.settings.tcOffset):(t.data.self.zTcout-t.data.self.zTcin)*a/100+t.data.self.zTcin;t.data.self.mainContainer.trigger(t.data.self.Class.CLICK_TC,{tc:e}),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onClickAtHistogram")}}),fr.ina.amalia.player.plugins.timeline.BaseComponent("fr.ina.amalia.player.plugins.timeline.VisualComponent",{ComponentClassCss:"visual-component",ComponentModuleClassCss:"module-visual",COMPONENT_NAME:"visual",STYLE_CLASSNAME_BIND_ON:"ajs-icon-eye-on",STYLE_CLASSNAME_BIND_OFF:"ajs-icon-eye-off",eventTypes:{DATA_CHANGE:"fr.ina.amalia.player.plugins.timeline.VisualComponent.eventTypes.DATA_CHANGE",BIND:"fr.ina.amalia.player.plugins.timeline.VisualComponent.eventTypes.BIND",UNBIND:"fr.ina.amalia.player.plugins.timeline.VisualComponent.eventTypes.UNBIND"}},{initialize:function(){this._super(),this.mainContainer.on("click",".cuepoint",{self:this},this.onClickAtCuepoint)},createToolBar:function(){var t=this._super(),e=this.createButton(fr.ina.amalia.player.PlayerMessage.PLUGIN_TIMELINE_LABEL_BIND,"bind-btn");e.on("click",{self:this},this.onClickBindBtn),e.addClass(this.Class.STYLE_CLASSNAME_BIND_ON),t.append(e)},addItem:function(t){var e,a=null,i=t.hasOwnProperty("selected")&&!0===t.selected,n=!0===t.hasOwnProperty("label")&&""!==t.label&&null!==t.label?t.label:"",s=this.mainContainer.find(".line-content").first(),o=this.tcout-this.tcin;t.hasOwnProperty("tcin")&&t.hasOwnProperty("tcout")&&!0===t.hasOwnProperty("sublocalisations")&&null!==t.sublocalisations&&t.sublocalisations.hasOwnProperty("localisation")?(this.createSublocalisationSegments(s,t,n,i),null!==this.logger&&this.logger.trace(this.Class.fullName,"addItem segment tcin: "+t.tcin+" tcout: "+t.tcout)):t.hasOwnProperty("tc")&&(o=100*((e=parseFloat(t.tc))-this.tcin)/o,n=""!==n?n:"Tc : "+fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(e,this.settings.framerate,this.settings.timeFormat),e>=this.tcin&&e<=this.tcout&&((a=this.createCuePointElement(e,o,n,t.tclevel)).data("metadata",t),!0===this.settings.editable&&(a.draggable({axis:"x",drag:function(t,e){var a=$(t.target).parent(),t=Math.max(0,e.position.left);e.position.left=Math.min(a.first().width(),t)}}),a.on("dragstop",{self:this},this.onCuepointDragStop),a.css("position","absolute")),i&&(a.addClass("selected"),t.hasOwnProperty("formCreated")&&!1===t.formCreated&&this.mainContainer.trigger(this.Class.CLICK_SELECT,{tc:e,metadata:t})),s.append(a)),null!==this.logger&&this.logger.trace(this.Class.fullName,"addItem cuepoint tcin:  tc:"+t.tc))},createSublocalisationSegments:function(t,e,a){this.localisationManager.setLoc(e.sublocalisations.localisation);var i=this.localisationManager.getLocTc();if(null!==i){e.tcin=i.tcin,e.tcout=i.tcout;var n=parseFloat(i.tcin),s=parseFloat(i.tcout),o=e.sublocalisations.localisation,l=this.tcout-this.tcin,r=100*(s-n)/l,i=100*(n-this.tcin)/l,l=""!==this.settings.color?"color:"+this.settings.color+"; background-color:"+this.settings.color+";":"",c=$("<div>",{class:"item segment marker",style:"left: "+i+"%; width:"+r+"%;"+l,title:"Tc in: "+fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(n,this.settings.framerate,this.settings.timeFormat)+"\n Tc out: "+fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(s,this.settings.framerate,this.settings.timeFormat),"data-tc":n,"data-tcin":n,"data-tcout":s});t.append(c),c.data("metadata",e);for(var d=null,h=0;h<o.length;h++){var m=o[h].tc,g=100*(m-n)/(s-n);a=""!==a?a:"Tc: "+fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(m,this.settings.framerate,this.settings.timeFormat),(d=this.createCuePointElement(m,g,a)).data("metadata",o[h]),d.draggable({axis:"x",drag:this.onItemDrag}),d.on("dragstop",{self:this},this.onSegmentDragStop),c.append(d)}r<100&&(c.draggable({axis:"x",drag:function(t,e){var a=$(t.target),i=a.parent(),t=Math.max(0,e.position.left);e.position.left=Math.min(i.first().width()-a.width(),t)}}),c.on("dragstop",{self:this},this.onShiftDragStop))}},createCuePointElement:function(t,e,a,i){var n=void 0!==this.settings.color&&""!==this.settings.color?this.settings.color:"#3cf",s=void 0!==this.settings.icon&&""!==this.settings.icon?this.settings.icon:"circle";return $("<i>",{class:"item cuepoint ajs-icon ajs-icon-"+s,style:"left: "+e+"%; color:"+n+";",title:a,"data-tc":t,"data-tclevel":i})},removeItems:function(){this.mainContainer.find(".line-content").first().find(".item").remove()},onClickAtCuepoint:function(t){var e=$(t.currentTarget),a=parseFloat(e.data("tc")),i=$(t.currentTarget).data("metadata");t.altKey&&!0!==i.selected&&!0===t.data.self.settings.editable?(e.addClass("selected"),t.data.self.mainContainer.trigger(t.data.self.Class.CLICK_SELECT,{tc:a,metadata:i})):t.data.self.mainContainer.trigger(t.data.self.Class.CLICK_TC,{tc:a}),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onClickAtCuepoint tc:"+a)},onCuepointDragStop:function(t){var e=$(t.currentTarget),e=parseFloat((t.data.self.tcout-t.data.self.tcin)*e.position().left/t.data.self.mainContainer.first().width());$(t.currentTarget).data("metadata").tc=Math.max(0,e),$(t.currentTarget).data("metadata").tcin=Math.max(0,e),t.data.self.mainContainer.trigger(t.data.self.Class.eventTypes.DATA_CHANGE,{id:t.data.self.getMetadataId()})},onSegmentDragStop:function(t){var e=$(t.currentTarget),e=parseFloat((t.data.self.tcout-t.data.self.tcin)*(e.parent().position().left+e.position().left)/t.data.self.mainContainer.first().width())+t.data.self.tcin;$(t.currentTarget).data("metadata").tc=Math.max(0,e),t.data.self.mainContainer.trigger(t.data.self.Class.eventTypes.DATA_CHANGE,{id:t.data.self.getMetadataId()})},onShiftDragStop:function(t){var e=$(t.currentTarget),a=parseFloat((t.data.self.tcout-t.data.self.tcin)*(e.parent().position().left+e.position().left)/t.data.self.mainContainer.first().width())+t.data.self.tcin;t.data.self.localisationManager.shiftSpacialLocBlock(e.data("metadata"),a),t.data.self.mainContainer.trigger(t.data.self.Class.eventTypes.DATA_CHANGE,{id:t.data.self.getMetadataId()})},onClickBindBtn:function(t){var e=$(t.currentTarget);e.hasClass(t.data.self.Class.STYLE_CLASSNAME_BIND_ON)?(e.removeClass(t.data.self.Class.STYLE_CLASSNAME_BIND_ON).addClass(t.data.self.Class.STYLE_CLASSNAME_BIND_OFF),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onClickBindBtn UNBIND:"+t.data.self.getMetadataId()),t.data.self.mainContainer.trigger(t.data.self.Class.eventTypes.UNBIND,{id:t.data.self.getMetadataId()})):e.hasClass(t.data.self.Class.STYLE_CLASSNAME_BIND_OFF)&&(e.removeClass(t.data.self.Class.STYLE_CLASSNAME_BIND_OFF).addClass(t.data.self.Class.STYLE_CLASSNAME_BIND_ON),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onClickBindBtn BIND:"+t.data.self.getMetadataId()),t.data.self.mainContainer.trigger(t.data.self.Class.eventTypes.BIND,{id:t.data.self.getMetadataId()}))},onItemDrag:function(t,e){var a=$(t.target),i=a.parent(),n=e.position.left,t=a.data("metadata");t.hasOwnProperty("firstItem")&&!0===t.firstItem?(n=Math.max(-i.first().offset().left+a.width(),e.position.left),e.position.left=Math.min(i.first().width(),n)):t.hasOwnProperty("lastItem")&&!0===t.lastItem?(a=i.first().parent().width()-i.first().offset().left+a.width(),n=Math.max(0,n),e.position.left=Math.min(n,a)):(n=Math.max(0,n),e.position.left=Math.min(i.first().width(),n))}}),fr.ina.amalia.player.plugins.PluginBaseMultiBlocks.extend("fr.ina.amalia.player.plugins.TimelinePlugin",{eventTypes:{TIME_CHANGE:"fr.ina.amalia.player.plugins.timeline.TIME_CHANGE"},classCss:"ajs-plugin plugin-timeline",style:"",componentDefaultHeight:110},{timeCursor:null,timeProgressContainer:null,timeAxisComponentContainer:null,timeAxisComponent:null,componentsContainer:null,navBarContainer:null,zoomRangeLevels:null,zoomLevel:0,displayLinesNb:0,listOfComponents:[],tcin:0,tcout:0,zTcin:0,zTcout:0,timeAxisHeight:150,tooltipConfiguration:{},localStorageManager:null,loadDataStarted:!1,dataToDeal:null,settingsListOfComponents:[],editingMode:!1,metadataManager:null,initialize:function(){this.listOfMetadataTypes=[],this.notManagedMetadataIds=[],this.managedMetadataIds=[],this.listOfComponents=[],this.tooltipConfiguration=$.extend(!0,fr.ina.amalia.player.plugins.timeline.DefaultConfiguration.tooltipConfiguration,{}),this.settings=$.extend({debug:this.settings.debug,timeFormat:"mms",internalPlugin:!1,listOfLines:{},displayLines:3,nbZoomLevel:3,zoomCoef:[.25,1/16,1/64,1/256],zoomProperty:"tclevel",timeaxis:!0,displayState:"",resizable:!1,viewZoomSync:!1,viewZoomSyncOffset:1,mouseWheelCoef:5,timecursor:!0,timeaxisExpandable:!1,editingMode:!1,thumbRootDirectory:this.settings.thumbRootDirectory,thumbDirectory:"",callback:"",callbackStyle:"",lineDisplayMode:fr.ina.amalia.player.plugins.PluginBaseMultiBlocks.METADATA_DISPLAY_TYPE.STATIC},this.settings.parameters||{}),this.tcin=this.mediaPlayer.getTcOffset(),this.tcout=this.mediaPlayer.getDuration()+this.mediaPlayer.getTcOffset(),this.zTcin=this.mediaPlayer.getTcOffset(),this.zTcout=this.mediaPlayer.getDuration()+this.mediaPlayer.getTcOffset(),this.metadataManager=this.mediaPlayer.getMetadataManager(),this.loadDataStarted=!1,this.editingMode=this.settings.editingMode,this.registerMetadataTypes(),this.registerPluginTypes(),this.settingsListOfComponents=$.extend(!0,[],this.settings.listOfLines),!0===this.settings.timecursor&&this.createTimeCursor(),!0===this.settings.timeaxis?(this.timeAxisComponentContainer=$("<div>",{class:"timeaxis"}),this.createTimeProgressContainer()):this.timeProgressContainer=null,this.componentsContainer=$("<div>",{class:"components",style:"height:"+(this.pluginContainer.height()-this.timeAxisHeight)+"px;"}),this.componentsContainer.sortable({handle:".sort-btn"}),this.zoomRangeLevels=this.getZoomRangeLevels(this.tcout,this.settings.nbZoomLevel,this.settings.zoomCoef),this.pluginContainer.append(this.timeAxisComponentContainer),this.pluginContainer.append(this.componentsContainer),this.createTimlineNavBar(this.settings.listOfLines.length),this.localStorageManager=new fr.ina.amalia.player.LocalStorageManager({}),this.pluginContainer.find(".plugin-btn").tooltip("option","disabled",!1!==this.localStorageManager.hasItem("help-tooltip")&&this.localStorageManager.getItem("help-tooltip")),!0===this.settings.resizable&&this.pluginContainer.resizable({handles:"s",create:function(t){$(t.target).find("div.ui-resizable-handle").addClass("ajs-icon ajs-icon-ellipsis-h")},start:this.onResizeStart,resize:this.onResize}),this.resizeComponentsHeight(),null!==this.timeAxisComponent&&this.timeAxisComponent.setZoomTc(this.zTcin,this.zTcout),this.defineListeners()},registerMetadataTypes:function(){this.addManagedMetadataType(fr.ina.amalia.player.PluginBindingManager.dataTypes.DETECTION),this.addManagedMetadataType(fr.ina.amalia.player.PluginBindingManager.dataTypes.SEGMENTATION),this.addManagedMetadataType(fr.ina.amalia.player.PluginBindingManager.dataTypes.TRANSCRIPTION),this.addManagedMetadataType(fr.ina.amalia.player.PluginBindingManager.dataTypes.SYNCHRONIZED_TEXT),this.addManagedMetadataType(fr.ina.amalia.player.PluginBindingManager.dataTypes.KEYFRAMES),this.addManagedMetadataType(fr.ina.amalia.player.PluginBindingManager.dataTypes.HISTOGRAM),this.addManagedMetadataType(fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_DETECTION),this.addManagedMetadataType(fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_TRACKING)},registerPluginTypes:function(){this.registerPluginType(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_CUEPOINT),this.registerPluginType(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_SEGMENT),this.registerPluginType(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_IMAGE),this.registerPluginType(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_HISTOGRAM),this.registerPluginType(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_VISUAL)},createTimeCursor:function(){this.timeCursor=$("<div>",{class:"timeline-cursor"}),this.pluginContainer.append(this.timeCursor),null!==this.logger&&this.logger.trace(this.Class.fullName,"createTimeCursor")},createTimeProgressContainer:function(){this.timeProgressContainer=$("<div>",{class:"timeline-progress-container"}),this.initializeTimeAxisComponent(),this.pluginContainer.append(this.timeProgressContainer),null!==this.logger&&this.logger.trace(this.Class.fullName,"createTimeProgressContainer")},createTimlineNavBar:function(t){this.navBarContainer=$("<div>",{class:"module-nav-bar-container "});var e=$("<div>",{class:"ajs-row toolsbar"}),a=$("<div>",{class:"ajs-col-3 leftContainer"}),i=$("<div>",{class:"ajs-col-6 middleContainer"}),n=$("<div>",{class:"ajs-col-3 rightContainer"}),s=this.createButton(fr.ina.amalia.player.PlayerMessage.PLUGIN_TIMELINE_LABEL_SCROLL_DOWN,"chevron-down scroll-btn");s.on("click",{self:this},this.onScrollDown);var o=this.createButton(fr.ina.amalia.player.PlayerMessage.PLUGIN_TIMELINE_LABEL_SCROLL_UP,"chevron-up scroll-btn");o.on("click",{self:this},this.onScrollUp),i.append(o),i.append(s),a.append($("<div>",{class:"info",html:'<span class="count">'+t+"</span> "+fr.ina.amalia.player.PlayerMessage.PLUGIN_TIMELINE_LABEL_ELEMENTS})),n.append(this.createDropdownMenu()),e.append(a),e.append(i),e.append(n),this.navBarContainer.append(e),this.pluginContainer.append(this.navBarContainer),this.settings.lineDisplayMode<3&&this.createComponentsWithList(this.settingsListOfComponents)},createButton:function(t,e){return $("<button>",{title:t,class:"plugin-btn ajs-icon ajs-icon-"+e}).tooltip(this.tooltipConfiguration)},createDropdownMenu:function(){var t=$("<div>",{class:"config-menu btn-group"}),e=$("<span>",{class:"config-btn","data-toggle":"dropdown"}).on("click",function(t){$(t.currentTarget).parent().find(".config-menu-list").show()});e.append($("<span>",{class:"ajs-icon ajs-icon-cog"})),t.append(e);var a=$("<ul>",{class:"config-menu-list",role:"menu"}).hide().on("mouseleave",function(t){$(t.currentTarget).hide()}),e=$("<li>",{text:fr.ina.amalia.player.PlayerMessage.PLUGIN_TIMELINE_LABEL_SHOW_HIDE_TOOTIP}).on("click",{self:this},this.onChangeToogleStatus);return a.append(e),t.append(a),t},initializeTimeAxisComponent:function(){var t=$.extend({debug:this.settings.debug,container:this.timeAxisComponentContainer,duration:this.mediaPlayer.getDuration()+this.mediaPlayer.getTcOffset(),expand:this.settings.timeaxisExpandable,tcOffset:this.mediaPlayer.getTcOffset(),timeFormat:this.settings.timeFormat,framerate:this.settings.framerate,displayState:this.settings.displayState},this.settings.timeAxisSettings||{});try{this.timeAxisComponent=new fr.ina.amalia.player.plugins.timeline.TimeAxisComponent(t),this.timeAxisComponent.getContainer().on(fr.ina.amalia.player.plugins.timeline.TimeAxisComponent.eventTypes.RANGE_CHANGE,{self:this},this.onRangeChange),this.timeAxisComponent.getContainer().on(fr.ina.amalia.player.plugins.timeline.TimeAxisComponent.eventTypes.CHANGE_DISPLAY,{self:this},this.onDisplayStateChange),this.timeAxisComponent.getContainer().on(fr.ina.amalia.player.plugins.timeline.TimeAxisComponent.eventTypes.CHANGE_TIMEAXIS_DISPLAY_STATE,{self:this},this.onTimeaxisDisplayStateChange),this.timeAxisComponent.getContainer().on(fr.ina.amalia.player.plugins.timeline.TimeAxisComponent.eventTypes.CLICK_AT_TIC,{self:this},this.onClickTc)}catch(t){null!==this.logger&&this.logger.warn(t.stack),this.timeAxisComponent=null}},defineListeners:function(){var t=this.mediaPlayer.getContainer();t.on(fr.ina.amalia.player.PlayerEventType.TIME_CHANGE,{self:this},this.onTimeupdate),t.on(fr.ina.amalia.player.PlayerEventType.BEGIN_DATA_CHANGE,{self:this},this.onBeginDataChange),t.on(fr.ina.amalia.player.PlayerEventType.END_DATA_CHANGE,{self:this},this.onEndDataChange),t.on(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{self:this},this.onDataChange),t.on(fr.ina.amalia.player.PlayerEventType.ZOOM_RANGE_CHANGE,{self:this},this.onZoomRangeChange),t.on(fr.ina.amalia.player.PlayerEventType.SELECTED_METADATA_CHANGE,{self:this},this.onSelectedMetadataChange),this.pluginContainer.on(fr.ina.amalia.player.plugins.timeline.CuepointsComponent.eventTypes.DATA_CHANGE,{self:this},this.onCuepointDataChange),this.pluginContainer.on(fr.ina.amalia.player.plugins.timeline.SegmentsComponent.eventTypes.DATA_CHANGE,{self:this},this.onSegmentDataChange),this.pluginContainer.on(fr.ina.amalia.player.plugins.components.FocusComponent.eventTypes.ZOOM_ZONE_CHANGE,{self:this},this.onZoomZoneChangeWithFocusComponent),this.pluginContainer.on(fr.ina.amalia.player.plugins.timeline.BaseComponent.CLICK_SELECT,{self:this},this.onSelectItem),this.pluginContainer.on(fr.ina.amalia.player.plugins.timeline.BaseComponent.CLICK_REMOVE_SELECT_ITEM,{self:this},this.onRemoveSelectItem),this.pluginContainer.on(fr.ina.amalia.player.plugins.timeline.VisualComponent.eventTypes.DATA_CHANGE,{self:this},this.onVisualComponentDataChange),this.pluginContainer.on(fr.ina.amalia.player.plugins.timeline.VisualComponent.eventTypes.BIND,{self:this},this.onVisualComponentBindMetadata),this.pluginContainer.on(fr.ina.amalia.player.plugins.timeline.VisualComponent.eventTypes.UNBIND,{self:this},this.onVisualComponentUnBindMetadata),null!==this.logger&&this.logger.trace(this.Class.fullName,"definePlayerListeners")},updateZoomChange:function(t,e){this.zTcin===t&&this.zTcout===e||(this.zTcin=Math.max(0,parseFloat(t)),this.zTcout=Math.min(this.mediaPlayer.getDuration()+this.mediaPlayer.getTcOffset(),parseFloat(e)),this.mediaPlayer.setZoomTc(this.zTcin,this.zTcout,this.eventTag),null!==this.timeAxisComponent&&this.timeAxisComponent.setZoomTc(this.zTcin,this.zTcout),this.updateRange(this.zTcin,this.zTcout),!0===this.settings.timecursor&&this.updateTimelinePos(parseFloat(this.mediaPlayer.getCurrentTime())))},updateRange:function(t,e){this.tcin=t,this.tcout=e,this.zoomLevel=this.getZoomRangeLevel(this.tcin,this.tcout),this.updateAllBlocks()},updateTimelinePos:function(t){var e=parseFloat(t),a=this.tcout-this.tcin,a=100*(e-this.tcin)/a;t>this.tcin&&t<this.tcout?(this.timeCursor.show(),this.timeCursor.data("tc",t),this.timeCursor.css("left",a+"%"),null!==this.timeProgressContainer&&(this.timeProgressContainer.show(),this.timeProgressContainer.data("tc",t),this.timeProgressContainer.css("right",100-a+"%"))):t>this.tcin?(this.timeCursor.hide(),null!==this.timeProgressContainer&&this.timeProgressContainer.css("right","0%")):(this.timeCursor.hide(),null!==this.timeProgressContainer&&this.timeProgressContainer.hide())},getZoomRangeLevel:function(t,e){for(var a=e-t,i=0;i<this.zoomRangeLevels.length;i++)if(a>this.zoomRangeLevels[i].start&&a<this.zoomRangeLevels[i].end)return this.zoomRangeLevels[i].level;return 0},getZoomRangeLevels:function(t,e,a){for(var i=[],n=null,s=0;s<e;s++)(n={level:s,start:s<e-1?a[s]*t:0,end:0===s?t:a[s-1]*t}).tc=n.end-n.start,i.push(n);return i},createComponent:function(container,settings){var componentSettings=$.extend({debug:this.settings.debug,container:container,duration:this.mediaPlayer.getDuration()+this.mediaPlayer.getTcOffset(),tcOffset:this.mediaPlayer.getTcOffset(),timeFormat:this.settings.timeFormat,framerate:this.settings.framerate,displayState:this.settings.displayState,callback:this.settings.callback,callbackStyle:this.settings.callbackStyle,thumbDirectory:this.settings.thumbRootDirectory+this.settings.thumbDirectory},settings||{}),component=null;try{component=!0===componentSettings.hasOwnProperty("className")?eval("new "+componentSettings.className+"(componentSettings,this.mediaPlayer)"):eval("new "+this.getComponentType(settings.type)+"(componentSettings,this.mediaPlayer)")}catch(error){null!==this.logger&&this.logger.warn(error.stack)}return component},getComponentType:function(t){var e="";switch(t){case"image":e="fr.ina.amalia.player.plugins.timeline.ImagesComponent";break;case"segment":e="fr.ina.amalia.player.plugins.timeline.SegmentsComponent";break;case"histogram":e="fr.ina.amalia.player.plugins.timeline.HistogramComponent";break;case"visual":e="fr.ina.amalia.player.plugins.timeline.VisualComponent";break;default:e="fr.ina.amalia.player.plugins.timeline.CuepointsComponent"}return e},getNewLineConf:function(t,e,a){return{title:t,metadataId:t,type:e=e.split("_")[1],pointNav:!0,icon:a,editable:this.editingMode,timeFormat:this.settings.timeFormat,framerate:this.settings.framerate}},createComponentsWithList:function(t){for(var e=null,a=null,i=0;i<t.length;i++){var n=t[i];!0===n.hasOwnProperty("title")&&!0===n.hasOwnProperty("type")&&!0===n.hasOwnProperty("metadataId")?(e=$("<div>",{class:"component"}),this.componentsContainer.append(e),null!==(a=this.createComponent(e,n))&&(a.setZoomProperty(this.settings.zoomProperty),a.setMetadataId(n.metadataId),a.setZoomLevel(this.zoomLevel),a.setTcin(this.tcin),a.setTcout(this.tcout),a.setZoomTc(this.zTcin,this.zTcout),e.attr("data-metadata-id",n.metadataId),this.bindMetadataId(n.metadataId),this.listOfComponents.push(a),a.getContainer().on(fr.ina.amalia.player.plugins.timeline.BaseComponent.CLICK_TC,{self:this},this.onClickTc),a.getContainer().on(fr.ina.amalia.player.plugins.timeline.BaseComponent.NAV_CLICK,{self:this,component:a},this.onClickNavControls))):null!==this.logger&&this.logger.warn("Error initializing the component.")}this.resizeComponentsHeight(),this.updateComponentsLineHeight(),this.componentsContainer.find(".component").on("click",{self:this},this.onSelectComponents)},deleteComponentsWithMetadataId:function(t){this.componentsContainer.find('.component[data-metadata-id="'+t+'"]').remove(),this.unbindMetadataId(t)},updateAllBlocks:function(){console.log("updateAllBlocks");for(var t=null,e=0;e<this.listOfComponents.length;e++){var a=this.listOfComponents[e];a.setZoomLevel(this.zoomLevel),a.setTcin(this.tcin),a.setTcout(this.tcout),a.setZoomTc(this.zTcin,this.zTcout),"function"==typeof a.removeItems&&"function"==typeof a.addItems&&"function"==typeof a.getMetadataId&&(a.removeItems(),null!=(t=this.mediaPlayer.getMetadataById(a.getMetadataId()))&&t.hasOwnProperty("length")&&0<t.length&&a.addItems(t))}},updateBlock:function(t,e){console.log("updateBlock id action",t,e);for(var a=0;a<this.listOfComponents.length;a++){var i,n,s=this.listOfComponents[a];s.getMetadataId()===t&&"function"==typeof s.removeItems&&"function"==typeof s.addItems&&"function"==typeof s.getMetadataId&&(s.removeItems(),i=this.mediaPlayer.getMetadataById(s.getMetadataId()),1<this.settings.lineDisplayMode&&(n=this.mediaPlayer.getBlockMetadata(t.toString()),s.setTitle(n.label),n.hasOwnProperty("viewControl")&&null!==n.viewControl&&(s.setShape(n.viewControl.hasOwnProperty("shape")?n.viewControl.shape:""),s.setColor(n.viewControl.hasOwnProperty("color")?n.viewControl.color:"")),"replace-all"===e&&"function"==typeof s.setHistogramIsCreated&&s.setHistogramIsCreated(!1)),null!=i&&i.hasOwnProperty("length")&&0<i.length&&s.addItems(i))}},updateBlocks:function(t){for(var e,a,i,n=0;n<t.length;n++)1<this.settings.lineDisplayMode&&!1===this.isManagedMetadataId(t[n])&&(e=null!==(i=this.mediaPlayer.getBlockMetadata(t[n]))&&i.hasOwnProperty("type")?i.type:"",a=this.bindingManager.getLinetypeWithDataType(e),!0===this.bindingManager.isManagedDataType(this.uuid,e)&&null!==a&&(i=null!==i&&i.hasOwnProperty("shape")&&""!==i.shape?i.shape:"circle",this.createComponentsWithList([this.getNewLineConf(t[n],a,i)]))),this.updateBlock(t[n]);this.updateRange(this.tcin,this.tcout)},updateComponentsLineHeight:function(){var t=this.pluginContainer,e=parseFloat(t.find(".timeaxis").height()+t.find(".module-nav-bar-container").height()),a=2*t.find(".component").length,i=$(t).find(".component").first().height(),n=this.settings.displayLines;t.find(".components").first().css("height",i*n+a),t.css("height",i*n+a+e),t.find(".module-nav-bar-container .info span.count").text(t.find(".component").length)},resizeComponentsHeight:function(){var t=parseFloat(this.pluginContainer.find(".timeaxis").height()+this.pluginContainer.find(".module-nav-bar-container").height()),e=parseFloat(fr.ina.amalia.player.plugins.TimelinePlugin.componentDefaultHeight);this.displayLinesNb="number"==typeof this.settings.displayLines?this.settings.displayLines:this.settings.listOfLines.length,this.displayLinesNb>this.settings.listOfLines.length&&(this.displayLinesNb=this.settings.listOfLines.length);var a=2*this.displayLinesNb,e=this.displayLinesNb*e+this.navBarContainer.height();this.settings.timeaxis?this.pluginContainer.css("height",e+this.timeAxisHeight+"px"):this.pluginContainer.css("height",e+"px"),this.componentsContainer.css("height",this.pluginContainer.height()-t+"px");a=this.componentsContainer.height()+a>=this.componentsContainer.get(0).scrollHeight;this.navBarContainer.find(".scroll-btn").toggle(!a),a||this.componentsContainer.on("mousewheel DOMMouseScroll",{self:this},this.onComponentsMousewheel)},nextItem:function(){for(var t,e=null,a=0;a<this.listOfComponents.length;a++)this.listOfComponents[a].mainContainer.hasClass("activated")&&(e=this.listOfComponents[a]);null!==e&&(t=e.getNextItem(this.mediaPlayer.getCurrentTime()),this.mediaPlayer.pause(),null!==t&&this.mediaPlayer.setCurrentTime(t))},prevItem:function(){for(var t,e=null,a=0;a<this.listOfComponents.length;a++)this.listOfComponents[a].mainContainer.hasClass("activated")&&(e=this.listOfComponents[a]);null!==e&&(t=e.getPrevItem(this.mediaPlayer.getCurrentTime()),this.mediaPlayer.pause(),null!==t&&this.mediaPlayer.setCurrentTime(t))},onRangeChange:function(t,e){t.data.self.updateZoomChange(parseFloat(e.tcin),parseFloat(e.tcout)),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onRangeChange Tcin:"+e.tcin+" Tcout"+e.tcout)},onDisplayStateChange:function(t){for(var e=0;e<t.data.self.listOfComponents.length;e++){var a=t.data.self.listOfComponents[e];"function"==typeof a.changeDisplayState&&a.changeDisplayState()}!1===t.data.self.settings.displayLines&&t.data.self.updateComponentsLineHeight()},onTimeaxisDisplayStateChange:function(t,e){var a,i;null!==t.data.self.timeProgressContainer&&(!0===e.state?(t.data.self.timeProgressContainer.css("height","102px"),t.data.self.timeProgressContainer.addClass("max").removeClass("min")):(t.data.self.timeProgressContainer.css("height","2px"),t.data.self.timeProgressContainer.addClass("min").removeClass("max"))),!1===t.data.self.settings.displayLines?t.data.self.updateComponentsLineHeight():(a=t.data.self.pluginContainer,i=t.data.self.settings.displayLines,e=parseFloat(a.find(".timeaxis").height()+a.find(".module-nav-bar-container").height()),t=2*i,t=$(a).find(".component").first().height()*i+t,a.find(".components").first().css("height",t),a.css("height",t+e))},onClickTc:function(t,e){!0===e.hasOwnProperty("tc")&&t.data.self.mediaPlayer.setCurrentTime(parseFloat(e.tc))},onTimeupdate:function(t,e){var a;!0===t.data.self.settings.timecursor&&t.data.self.updateTimelinePos(parseFloat(e.currentTime)),t.data.self.pluginContainer.trigger(fr.ina.amalia.player.plugins.TimelinePlugin.eventTypes.TIME_CHANGE,{currentTime:parseFloat(e.currentTime)}),!0===t.data.self.settings.viewZoomSync&&parseFloat(e.currentTime)>t.data.self.zTcout-t.data.self.settings.viewZoomSyncOffset&&(a=t.data.self.zTcout-t.data.self.zTcin,e=Math.min(t.data.self.mediaPlayer.getDuration()+this.mediaPlayer.getTcOffset(),t.data.self.zTcout+a),a=Math.max(0,e-a),t.data.self.updateZoomChange(a,e))},onBeginDataChange:function(t){t.data.self.loadDataStarted=!0,t.data.self.dataToDeal=[],null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onBeginDataChange")},onDataChange:function(t,e){var a,i,n;!1===t.data.self.loadDataStarted?t.data.self.editingMode?e.hasOwnProperty("action")&&"deleteBlock"===e.action?t.data.self.deleteComponentsWithMetadataId(e.id):t.data.self.isManagedMetadataId(e.id)?t.data.self.updateBlock(e.id,e.action):1<t.data.self.settings.lineDisplayMode&&(a=null!==(n=t.data.self.mediaPlayer.getBlockMetadata(e.id))&&n.hasOwnProperty("type")?n.type:"",i=t.data.self.bindingManager.getLinetypeWithDataType(a),n=null!==n&&n.hasOwnProperty("shape")&&""!==n.shape?n.shape:"circle",!0===t.data.self.bindingManager.isManagedDataType(t.data.self.uuid,a)&&null!==i&&(t.data.self.createComponentsWithList([t.data.self.getNewLineConf(e.id,i,n)]),t.data.self.updateBlock(e.id))):t.data.self.isManagedMetadataId(e.id)&&t.data.self.updateBlock(e.id,e.action):null!==t.data.self.dataToDeal&&1<t.data.self.settings.lineDisplayMode&&$.inArray(e.id,t.data.self.dataToDeal)<0&&t.data.self.dataToDeal.push(e.id)},onEndDataChange:function(t){t.data.self.loadDataStarted=!1,t.data.self.updateBlocks(t.data.self.dataToDeal),!(t.data.self.dataToDeal=[])===t.data.self.settings.displayLines&&t.data.self.updateComponentsLineHeight(),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"EndDataChange")},onZoomRangeChange:function(t,e){e.eventTag!==t.data.self.eventTag&&(Math.ceil(t.data.self.zTcin)===Math.ceil(e.zTcin)&&Math.ceil(t.data.self.zTcout)===Math.ceil(e.zTcout)||(t.data.self.updateZoomChange(e.zTcin,e.zTcout),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onZoomRangeChange zTcin:"+e.zTcin+" zTcout"+e.zTcout)))},onSelectedMetadataChange:function(t,e){var a;t.data.self.componentsContainer.find(".component").removeClass("activated"),null!==e.metadataId&&(t.data.self.componentsContainer.find('.component[data-metadata-id="'+e.metadataId+'"]').addClass("activated"),a=t.data.self.componentsContainer.find('.component[data-metadata-id="'+e.metadataId+'"]:first').position(),e=t.data.self.componentsContainer.get(0).scrollTop,"object"==typeof a&&a.hasOwnProperty("top")&&(e=Math.min(e,t.data.self.componentsContainer.get(0).scrollHeight),t.data.self.componentsContainer.stop().animate({scrollTop:e+a.top},500,"easeInOutExpo")))},onCuepointDataChange:function(t,e){t.data.self.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:e.id})},onSegmentDataChange:function(t,e){t.data.self.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:e.id})},onVisualComponentDataChange:function(t,e){t.data.self.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:e.id})},onSelectComponents:function(t){var e=$(t.currentTarget).attr("data-metadata-id");t.data.self.mediaPlayer.setSelectedMetadataId(e),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onSelectComponents  : "+e)},onScrollUp:function(t){var e=t.data.self.componentsContainer.find(".component").height(),e=t.data.self.componentsContainer.get(0).scrollTop-e,e=Math.min(e,t.data.self.componentsContainer.get(0).scrollHeight);t.data.self.componentsContainer.stop().animate({scrollTop:e},500,"easeInOutExpo")},onScrollDown:function(t){var e=t.data.self.componentsContainer.find(".component").height(),e=t.data.self.componentsContainer.get(0).scrollTop+e,e=Math.min(e,t.data.self.componentsContainer.get(0).scrollHeight);t.data.self.componentsContainer.stop().animate({scrollTop:e},500,"easeInOutExpo")},onComponentsMousewheel:function(t){t.preventDefault();var e=Math.max(-1,Math.min(1,t.originalEvent.wheelDelta||-t.originalEvent.detail));"number"==typeof e&&(e=t.data.self.componentsContainer.get(0).scrollTop-e*t.data.self.settings.mouseWheelCoef,e=Math.min(e,t.data.self.componentsContainer.get(0).scrollHeight),t.data.self.componentsContainer.get(0).scrollTop=e)},onSelectItem:function(t,e){var a=$(t.target).attr("data-metadata-id");t.data.self.mediaPlayer.getSelectedMetadataId()!==a&&t.data.self.mediaPlayer.setSelectedMetadataId(a),t.data.self.mediaPlayer.addSelectedItem(e.metadata)},onRemoveSelectItem:function(t,e){null!==e.metadata&&"object"==typeof e.metadata&&(e.metadata.selected=!1),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onRemoveSelectItem ",e)},onZoomZoneChangeWithFocusComponent:function(t,e){Math.ceil(t.data.self.zTcin)===Math.ceil(e.zTcin)&&Math.ceil(t.data.self.zTcout)===Math.ceil(e.zTcout)||(t.data.self.updateZoomChange(e.zTcin,e.zTcout),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onZoomZoneChangeWithFocusComponent zTcin:"+e.zTcin+" zTcout"+e.zTcout))},onResizeStart:function(t,e){var a=e.element,i=$(a).find(".component").first().height(),n=2*$(a).find(".component").length,e=parseFloat($(a).find(".timeaxis").height()+$(a).find(".module-nav-bar-container").height());a.resizable("option","minHeight",i+e),a.resizable("option","maxHeight",i*$(a).find(".component").length-n+e)},onResize:function(t,e){var a=e.element,i=parseFloat($(a).find(".timeaxis").height()+$(a).find(".module-nav-bar-container").height());$(a).find(".components").first().css("height",e.size.height-i)},onVisualComponentBindMetadata:function(t,e){t.data.self.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.BIND_METADATA,{id:e.id}),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onVisualComponentBindMetadata  : "+e.id)},onVisualComponentUnBindMetadata:function(t,e){t.data.self.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.UNBIND_METADATA,{id:e.id}),null!==t.data.self.logger&&t.data.self.logger.trace(t.data.self.Class.fullName,"onVisualComponentUnBindMetadata  : "+e.id)},onClickNavControls:function(t,e){!0===e.hasOwnProperty("type")&&(e="next"===e.type?t.data.component.getNextItem(t.data.self.mediaPlayer.getCurrentTime()):t.data.component.getPrevItem(t.data.self.mediaPlayer.getCurrentTime()),t.data.self.mediaPlayer.pause(),null!==e&&t.data.self.mediaPlayer.setCurrentTime(e))}});