/*!Amalia.js ========== V1.3.4, © INA 2021 */
/**
 * Copyright (c) 2015 Institut National de l'Audiovisuel, INA
 * This file is part of amalia.js

 * amalia.js is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or (at your option) any later version.

 * Redistributions of source code, javascript and css minified versions
 * must retain the above copyright notice, this list of conditions and the following disclaimer.

 * Neither the name of the copyright holder nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.

 * You should have received a copy of the GNU General Public License
 * along with amalia.js. If not, see <http://www.gnu.org/licenses/>

 *
 * amalia.js is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 */


fr.ina.amalia.player.plugins.PluginBase.extend("fr.ina.amalia.player.plugins.MetadataListEditorPlugin",{classCss:"ajs-plugin editor plugin-list-editor",eventTypes:{}},{container:null,loadDataStarted:!1,metadataManager:null,initialize:function(){this._super(),this.settings=$.extend({defaultDataType:"default",defaultAuthor:"amalia.js",defaultColor:"#2196f3",defaultShape:"circle"},this.settings.parameters||{}),this.container=$("<div>",{class:this.Class.classCss}),this.pluginContainer.append(this.container),this.createHeaderElement(),this.createMetadataListBlock(),this.createFooterElement(),this.defineListeners(),this.metadataManager=this.mediaPlayer.getMetadataManager(),this.loaderContainer.show()},defineListeners:function(){var e=this.mediaPlayer.getContainer();e.on(fr.ina.amalia.player.PlayerEventType.SELECTED_METADATA_CHANGE,{self:this},this.onSelectedMetadataChange),e.on(fr.ina.amalia.player.PlayerEventType.BEGIN_DATA_CHANGE,{self:this},this.onBeginDataChange),e.on(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{self:this},this.onDataChange),e.on(fr.ina.amalia.player.PlayerEventType.END_DATA_CHANGE,{self:this},this.onEndDataChange),null!==this.logger&&this.logger.trace(this.Class.fullName,"definePlayerListeners")},createHeaderElement:function(){var e=$("<div>",{class:"heading"}),a=$("<h3>",{class:"title",text:fr.ina.amalia.player.PlayerMessage.PLUGIN_METADATA_LIST_EDITOR_LABEL_HEADER});e.append(a),this.container.append(e)},createMetadataListBlock:function(){var e=$("<div>",{class:"body"}),a=$("<ul>",{class:"listOfmetadata"});e.append(a),this.container.append(e)},createFooterElement:function(){var e=$("<div>",{class:"footer"}),a=$("<button>",{class:"add-metadata ajs-icon ajs-icon-plus"}).on("click",{self:this},this.onAddMetadata);e.append(a),this.container.append(e)},updateMetadataListBlock:function(){var e=this.container.find("ul.listOfmetadata");e.empty();var a=this.mediaPlayer.getBlocksMetadata();if(null!==a)for(var t in a){var i=$("<li>",{class:"item item-"+t,"data-metadata-id":t}),l=$("<span>",{class:"text",text:t}),n=$("<span>",{class:"delete ajs-icon ajs-icon-remove"}),t=$("<span>",{class:"duplicate ajs-icon ajs-icon-reorder"});i.append(l),i.append(n),i.append(t),e.append(i)}e.find("li").on("click",{self:this},this.onSelectMetadata);a=this.mediaPlayer.getSelectedMetadataId();e.find("li.item").removeClass("selected"),null!==a&&e.find("li.item.item-"+a).addClass("selected"),this.loaderContainer.hide()},setSelectedMetadataId:function(e){this.mediaPlayer.getSelectedMetadataId()!==e&&this.mediaPlayer.setSelectedMetadataId(e)},removeMetadataById:function(e){this.mediaPlayer.deleteAllMetadataById(e),this.updateMetadataListBlock()},duplicateBlock:function(e){var a="_"+fr.ina.amalia.player.helpers.UtilitiesHelper.generateUUID(),t=JSON.parse(JSON.stringify(this.mediaPlayer.getMetadataById(e))),e=this.metadataManager.getBlockMetadata(e);this.metadataManager.updateBlockMetadata(a,{id:a,label:a,type:e.hasOwnProperty("type")?e.type:this.settings.defaultDataType,author:e.hasOwnProperty("author")?e.type:this.settings.defaultAuthor,color:e.hasOwnProperty("color")?e.type:this.settings.defaultColor,shape:e.hasOwnProperty("shape")?e.type:this.settings.defaultShape}),this.mediaPlayer.setMetadataById(a,t),this.mediaPlayer.setSelectedMetadataId(a),this.updateMetadataListBlock()},onAddMetadata:function(e){var a="_"+fr.ina.amalia.player.helpers.UtilitiesHelper.generateUUID();e.data.self.metadataManager.updateBlockMetadata(a,{id:a,label:a,type:e.data.self.settings.defaultDataType,author:e.data.self.settings.defaultAuthor,color:e.data.self.settings.defaultColor,shape:e.data.self.settings.defaultShape}),e.data.self.mediaPlayer.addMetadataById(a,[]),e.data.self.mediaPlayer.setSelectedMetadataId(a),e.data.self.updateMetadataListBlock()},onSelectMetadata:function(e){var a=$(e.currentTarget).attr("data-metadata-id"),t=$(e.target);t.hasClass("delete")?e.data.self.removeMetadataById(a):t.hasClass("duplicate")?e.data.self.duplicateBlock(a):e.data.self.setSelectedMetadataId(a),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onSelectMetadata  : "+a)},onSelectedMetadataChange:function(e,a){e.data.self.container.find("ul.listOfmetadata .item").removeClass("selected"),null!==a.metadataId&&(e.data.self.container.find('ul.listOfmetadata [data-metadata-id="'+a.metadataId+'"]').addClass("selected"),"object"==typeof(a=e.data.self.container.find('ul.listOfmetadata [data-metadata-id="'+a.metadataId+'"]').offset())&&a.hasOwnProperty("top")&&e.data.self.container.find("ul.listOfmetadata").stop().animate({scrollTop:a.top},500,"easeInOutExpo"))},onBeginDataChange:function(e){e.data.self.loadDataStarted=!0,null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onBeginDataChange")},onDataChange:function(e){!1===e.data.self.loadDataStarted&&e.data.self.updateMetadataListBlock()},onEndDataChange:function(e){e.data.self.loadDataStarted=!1,e.data.self.updateMetadataListBlock(),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"EndDataChange")}}),fr.ina.amalia.player.plugins.PluginBase.extend("fr.ina.amalia.player.plugins.MetadataBlockEditorPlugin",{classCss:"ajs-plugin editor plugin-block-editor",eventTypes:{}},{container:null,loadDataStarted:!1,metadataManager:null,initialize:function(){this._super(),this.settings=$.extend({shapesListOfElements:["legal","facetime","circle"]},this.settings.parameters||{}),this.container=$("<div>",{class:this.Class.classCss}),this.pluginContainer.append(this.container),this.createHeaderElement(),this.createMetadataBlock(),this.createFooterElement(),this.defineListeners(),this.metadataManager=this.mediaPlayer.getMetadataManager()},createHeaderElement:function(){var e=$("<div>",{class:"heading"}),a=$("<h3>",{class:"title",text:fr.ina.amalia.player.PlayerMessage.PLUGIN_METADATA_BLOCK_EDITOR_LABEL_HEADER});e.append(a),this.container.append(e)},createMetadataBlock:function(){var e=$("<div>",{class:"body"}),a=$("<div>",{class:"messages-container"});a.hide();var t=$("<form>",{class:"formMetadataBlock"}),i=$("<div>",{class:"form-item",text:fr.ina.amalia.player.PlayerMessage.PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_ID}),l=$("<input>",{class:"metadata-id input",name:"id",type:"text",disabled:"disabled",placeholder:fr.ina.amalia.player.PlayerMessage.PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_ID});i.append(l);var n=$("<div>",{class:"form-item",text:fr.ina.amalia.player.PlayerMessage.PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_LABAL}),s=$("<input>",{class:"metadata-label input",name:"label",type:"text",placeholder:fr.ina.amalia.player.PlayerMessage.PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_LABAL});n.append(s);var r=$("<div>",{class:"form-item",text:fr.ina.amalia.player.PlayerMessage.PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_TYPE}),d=$("<select>",{class:"metadata-type select",name:"type"});r.append(d);var o,m=fr.ina.amalia.player.PluginBindingManager.dataTypes;for(o in m){var c=$("<option>",{value:m[o].toString(),text:o.toString()});d.append(c)}var f=$("<div>",{class:"form-item",text:fr.ina.amalia.player.PlayerMessage.PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_DESCRIPTION}),p=$("<textarea>",{class:"metadata-description text-area",name:"description",placeholder:"Description"});f.append(p);var h=$("<div>",{class:"form-item",text:fr.ina.amalia.player.PlayerMessage.PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_REFERENCE}),u=$("<input>",{class:"metadata-ref input",name:"ref",type:"text",placeholder:fr.ina.amalia.player.PlayerMessage.PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_REFERENCE});h.append(u);l=$("<div>",{class:"form-item",text:fr.ina.amalia.player.PlayerMessage.PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_AUTHOR}),s=$("<input>",{class:"metadata-author input",name:"author",type:"text",placeholder:fr.ina.amalia.player.PlayerMessage.PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_AUTHOR});l.append(s);var p=$("<div>",{class:"form-item",text:fr.ina.amalia.player.PlayerMessage.PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_SHAPE}),g=$("<p>",{class:"metadata-shape",placeholder:fr.ina.amalia.player.PlayerMessage.PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_SHAPE});p.append(g);var y,v=this.settings.shapesListOfElements;for(y in v){var C=$("<input>",{id:"shape-item-"+v[y].toString(),name:"shape",value:v[y].toString(),type:"radio"}),I=$("<label>",{for:"shape-item-"+v[y].toString(),class:"shape ajs-icon ajs-icon-"+v[y].toString()});g.append(C),g.append(I)}u=$("<div>",{class:"form-item",text:fr.ina.amalia.player.PlayerMessage.PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_COLOR}),s=$("<input>",{class:"metadata-color input",type:"color",name:"color",placeholder:fr.ina.amalia.player.PlayerMessage.PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_COLOR});u.append(s),t.append(i),t.append(r),t.append(n),t.append(f),t.append(h),t.append(l),t.append(u),t.append(p),e.append(a),e.append(t),this.container.append(e)},createFooterElement:function(){var e=$("<div>",{class:"footer"}),a=$("<button>",{class:"save-metadata ajs-icon ajs-icon-check"}).on("click",{self:this},this.onSaveMetadata);e.append(a),this.container.append(e)},setMessage:function(e,a){if(a=a||"info",void 0!==e&&void 0!==e.length){var t=this.container.find(".messages-container");t.empty().removeClass(function(e,a){return(a.match(/(^|\s)type-\S+/g)||[]).join(" ")}).addClass("type-"+a);for(var i=0;i<e.length;i++){var l=$("<p>",{class:"error",text:e[i].toString()});t.append(l)}0!==e.length?t.show():t.hide()}},clearMessage:function(){this.container.find(".messages-container").empty().hide()},defineListeners:function(){this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.SELECTED_METADATA_CHANGE,{self:this},this.onSelectedMetadataChange),null!==this.logger&&this.logger.trace(this.Class.fullName,"definePlayerListeners")},isValidForm:function(e){if(void 0===e||void 0===e.length)return!1;var a=this.container.find(".formMetadataBlock");return""===a.find('[name="id"]').val()?e.push("Id is required field"):""===a.find('[name="label"]').val()?e.push("Label is required field"):""===a.find('[name="type"]').val()&&e.push("Type is required field"),0===e.length},updateMetadata:function(e){var a=this.metadataManager.getBlockMetadata(e),t=a.hasOwnProperty("viewControl")&&null!==a.viewControl?a.viewControl:null,i=null!==t&&t.hasOwnProperty("shape")&&""!==t.shape?t.shape:"circle",l=null!==t&&t.hasOwnProperty("color")&&""!==t.color?t.color:"#3cf",t=this.container.find(".formMetadataBlock");null!==a?(t.find('[name="label"]').val(a.hasOwnProperty("label")?a.label:""),t.find('[name="type"] option[value="'+a.type+'"]').prop("selected",!0),""===a.type||a.type===fr.ina.amalia.player.PluginBindingManager.dataTypes.DEFAULT?t.find('[name="type"]').prop("disabled",!1):t.find('[name="type"]').prop("disabled",!0),t.find('[name="description"]').val(a.hasOwnProperty("description")?a.description:""),t.find('[name="ref"]').val(a.hasOwnProperty("ref")?a.ref:""),t.find('[name="author"]').val(a.hasOwnProperty("author")?a.author:""),t.find('[name="color"]').val(l),t.find('[name="shape"]').first().prop("checked",!0),t.find('[name="shape"][value="'+i+'"]').prop("checked",!0)):(t.find('[name="label"]').val(""),t.find('[name="type"] option').prop("selected",!1),t.find('[name="type"]').prop("disabled",!1),t.find('[name="description"]').val(""),t.find('[name="ref"]').val(""),t.find('[name="author"]').val(""),t.find('[name="color"]').val(""),t.find('[name="shape"]').first().prop("checked",!0)),this.container.find("form.formMetadataBlock .form-item .metadata-id").val(e),this.clearMessage()},saveMetadata:function(){var e,a=this.container.find(".formMetadataBlock"),t=[];this.isValidForm(t)?(e=a.find('[name="id"]').val(),this.metadataManager.updateBlockMetadata(e,{id:e,label:fr.ina.amalia.player.helpers.UtilitiesHelper.htmlEscape(a.find('[name="label"]').val()),type:a.find('[name="type"]').val(),description:fr.ina.amalia.player.helpers.UtilitiesHelper.htmlEscape(a.find('[name="description"]').val()),ref:fr.ina.amalia.player.helpers.UtilitiesHelper.htmlEscape(a.find('[name="ref"]').val()),author:fr.ina.amalia.player.helpers.UtilitiesHelper.htmlEscape(a.find('[name="author"]').val()),viewControl:{color:fr.ina.amalia.player.helpers.UtilitiesHelper.htmlEscape(a.find('[name="color"]').val()),shape:fr.ina.amalia.player.helpers.UtilitiesHelper.htmlEscape(a.find('[name="shape"]:checked').val())}}),this.updateMetadata(e),this.setMessage(["Saved!"],"info")):this.setMessage(t,"error")},onSelectedMetadataChange:function(e,a){null!==a.metadataId&&e.data.self.updateMetadata(a.metadataId)},onSaveMetadata:function(e){e.data.self.saveMetadata()}}),fr.ina.amalia.player.plugins.PluginBase.extend("fr.ina.amalia.player.plugins.MetadataItemsEditorPlugin",{classCss:"ajs-plugin editor plugin-items-editor"},{tcin:0,tcout:0,container:null,loadDataStarted:!1,metadataManager:null,metadataId:null,localisationManager:null,initialize:function(){this._super(),this.settings=$.extend({defaultPercentWidth:.1},this.settings.parameters||{}),this.container=$("<div>",{class:this.Class.classCss}),this.tcin=this.mediaPlayer.getTcOffset(),this.tcout=this.mediaPlayer.getDuration()+this.mediaPlayer.getTcOffset(),this.pluginContainer.append(this.container),this.createHeaderElement(),this.createMetadataItemsBlock(),this.createFooterElement(),this.defineListeners(),this.metadataManager=this.mediaPlayer.getMetadataManager(),this.localisationManager=new fr.ina.amalia.player.LocalisationManager},createHeaderElement:function(){var e=$("<div>",{class:"heading"}),a=$("<h3>",{class:"title",text:fr.ina.amalia.player.PlayerMessage.PLUGIN_METADATA_ITEMS_EDITOR_LABEL_HEADER});e.append(a),this.container.append(e)},createMetadataItemsBlock:function(){var e=$("<div>",{class:"body"}),a=$("<div>",{class:"messages-container"}).hide(),t=$("<ul>",{class:"listOfSelectedItems"});e.append(a),e.append(t),this.container.append(e)},createFooterElement:function(){var e=$("<div>",{class:"footer"}),a=$("<span>",{class:"button add ajs-icon ajs-icon-plus"}).on("click",{self:this},this.onAddItem),t=$("<span>",{class:"button validateAll ajs-icon ajs-icon-check"}).on("click",{self:this},this.onValidateItems),i=$("<span>",{class:"button clear ajs-icon ajs-icon-eject"}).on("click",{self:this},this.onClearItems);e.append(a),e.append(t),e.append(i),this.container.append(e)},setMessage:function(e,a){if(a=a||"info",void 0!==e&&void 0!==e.length){var t=this.container.find(".messages-container");t.empty().removeClass(function(e,a){return(a.match(/(^|\s)type-\S+/g)||[]).join(" ")}).addClass("type-"+a);for(var i=0;i<e.length;i++){var l=$("<p>",{class:"error",text:e[i].toString()});t.append(l)}0!==e.length?t.show():t.hide()}},clearMessage:function(){this.container.find(".messages-container").empty().hide()},defineListeners:function(){var e=this.mediaPlayer.getContainer();e.on(fr.ina.amalia.player.PlayerEventType.SELECTED_METADATA_CHANGE,{self:this},this.onSelectedMetadataChange),e.on(fr.ina.amalia.player.PlayerEventType.SELECTED_ITEMS_CHANGE,{self:this},this.onSelectedItemsChange),e.on(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{self:this},this.onDataChange),null!==this.logger&&this.logger.trace(this.Class.fullName,"definePlayerListeners")},createFormData:function(e){var a=$("<form>",{class:"form-data"}).data("metadata",e),t=$("<div>",{class:"form-input"}),i=$("<span>",{class:"text data-model-label","data-label":"",text:e.hasOwnProperty("label")?e.label:""}),l=$("<input>",{name:"label",class:"input data-model-label",value:e.hasOwnProperty("label")?e.label:"",placeholder:"Label"}).hide();t.append(i),t.append(l),a.append(t),e.hasOwnProperty("tcout")?(i=$("<div>",{class:"form-input"}),l=$("<span>",{class:"text  data-model-tcin","data-label":"Tc-in: ",text:e.hasOwnProperty("tcin")?"Tc-in: "+fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(e.tcin,"ms"):""}),t=$("<input>",{name:"tcin",class:"input  data-model-tcin",value:e.hasOwnProperty("tcin")?fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(e.tcin,"ms"):"",placeholder:"TC-IN"}).hide(),i.append(l),i.append(t),a.append(i),l=$("<div>",{class:"form-input"}),t=$("<span>",{class:"text data-model-tcout","data-label":"Tc-out: ",text:e.hasOwnProperty("tcout")?"Tc-out: "+fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(e.tcout,"ms"):""}),i=$("<input>",{name:"tcout",class:"input data-model-tcout",value:e.hasOwnProperty("tcout")?fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(e.tcout,"ms"):"",placeholder:"TC-OUT"}).hide(),l.append(t),l.append(i),a.append(l)):(n="number"==typeof e.tc?e.tc:fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(e.tc),d=$("<div>",{class:"form-input"}),s=$("<span>",{class:"text data-model-tc","data-label":"Tc: ",text:e.hasOwnProperty("tc")?"Tc: "+fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(n,"ms"):""}),r=$("<input>",{name:"tc",class:"input data-model-tc",value:e.hasOwnProperty("tc")?fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(n,"ms"):"",placeholder:"TC"}).hide(),d.append(s),d.append(r),a.append(d));var n=$("<div>",{class:"form-controls"}),s=$("<span>",{class:"button valid ajs-icon ajs-icon-check"}),r=$("<span>",{class:"button remove ajs-icon ajs-icon-eraser"}),d=$("<span>",{class:"button close ajs-icon ajs-icon-eject"});return n.append(s),n.append(r),n.append(d),a.append(n),a},updateSelectedItems:function(){var e=this.container.find("ul.listOfSelectedItems"),a=this.mediaPlayer.getSelectedItems(),t=e.find("li.item").last(),t=0<t.length?parseInt(t.attr("class").match(/item-([0-9]+)/)[1])+1:0,t=isNaN(t)?0:t;if(void 0!==a&&a.hasOwnProperty("length")&&0<a.length)for(var i=0;i<a.length;i++){var l,n=a[i],s=null===n||!n.hasOwnProperty("formCreated")||!1===n.formCreated;null!==n&&s&&(l=this.createFormData(n),s=$("<li>",{class:"item item-"+i}),n.formCreated=!0,s.append(l),e.append(s))}e.find(".form-input").on("click",{self:this},this.onFormEdit),e.find(".form-input input.input").on("focusout",{self:this},this.onFormFocusout),e.find(".form-data .form-controls .button.valid").on("click",{self:this},this.onSaveForm),e.find(".form-data .form-controls .button.remove").on("click",{self:this},this.onDeleteItem),e.find(".form-data .form-controls .button.close").on("click",{self:this},this.onCloseForm)},_closeItem:function(e){var a=e.find("form").first().data("metadata");a.selected=!1,a.formCreated=!1,e.remove()},_validateItem:function(e){var a=parseInt(e.attr("class").match(/item-([0-9]+)/)[1]),t=e.find("form").first(),i=t.data("metadata"),l=/^[0-9]{2}:[0-9]{2}:[0-9]{2}.[0-9]{2}$/,n=!1;return l.test(t.find('[name="tc"]').val())?n=!0:void 0!==t.find('[name="tcin"]').val()&&void 0!==t.find('[name="tcout"]').val()&&(n=!(!l.test(t.find('[name="tcin"]').val())||!l.test(t.find('[name="tcout"]').val()))),i.tc=fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(t.find('[name="tc"]').val()),this.validItemTcRange(i,i.tc)?n=!0:i.hasOwnProperty("tcRange")&&(n=!1),n&&(void 0!==t.find('[name="tcout"]').val()&&(i.tcin=fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(t.find('[name="tcin"]').val()),i.tcout=fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(t.find('[name="tcout"]').val())),i.label=fr.ina.amalia.player.helpers.UtilitiesHelper.htmlEscape(t.find('[name="label"]').val()),i.selected=!1,i.formCreated=!1,e.remove(),this.metadataManager.removeSelectedItem(a)),n},validItemTcRange:function(e,a){var t=!1;return null!==e&&"object"==typeof e&&e.hasOwnProperty("tcRange")&&(e.tcRange.hasOwnProperty("min")&&e.tcRange.hasOwnProperty("max")?t=a>e.tcRange.min&&a<e.tcRange.max:e.tcRange.hasOwnProperty("min")?t=a>e.tcRange.min&&a<=this.tcout:e.tcRange.hasOwnProperty("max")&&(t=a>=this.tcin&&a<e.tcRange.max)),t},updateFormItems:function(){for(var e=this.container.find("ul.listOfSelectedItems li.item"),a=0;a<e.length;a++){var t=$(e[a]).find("form.form-data").data("metadata");"object"==typeof t&&t.hasOwnProperty("selected")&&!0===t.selected?$.each($(e[a]).find(".form-data"),this.updateFormItem):"object"==typeof t&&t.hasOwnProperty("selected")&&!1===t.selected&&this._closeItem($(e[a]))}},updateFormItem:function(e,a){var t=$(a),a=t.data("metadata");a.hasOwnProperty("label")&&(t.find("span.data-model-label").html(a.label),t.find("input.data-model-label").val(a.label)),a.hasOwnProperty("tc")&&(t.find("span.data-model-tc").html(t.find("span.data-model-tc").attr("data-label")+fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(a.tc,"ms")),t.find("input.data-model-tc").val(fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(a.tc,"ms"))),a.hasOwnProperty("tcin")&&(t.find("span.data-model-tcin").html(t.find("span.data-model-tcin").attr("data-label")+fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(a.tcin,"ms")),t.find("input.data-model-tcin").val(fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(a.tcin,"ms"))),a.hasOwnProperty("tcout")&&(t.find("span.data-model-tcout").html(t.find("span.data-model-tcout").attr("data-label")+fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(a.tcout,"ms")),t.find("input.data-model-tcout").val(fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(a.tcout,"ms")))},onFormEdit:function(e){e=$(e.currentTarget);e.find(".text").html("").hide(),e.find("input").show().focus()},onFormFocusout:function(e){var a=$(e.target),e=a.parent().find(".text");e.text(e.attr("data-label")+a.val()).show(),a.parents("li.item").find(".button.valid").addClass("on"),a.hide()},onSaveForm:function(e){e.data.self._validateItem($(e.currentTarget).parents("li.item").first(),e.data.self.metadataId)?e.data.self.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:e.data.self.metadataId}):$(e.currentTarget).parents("li.item").first().addClass("error")},onCloseForm:function(e){e.data.self._closeItem($(e.currentTarget).parents("li.item").first()),e.data.self.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:e.data.self.metadataId})},onDeleteItem:function(e){var a=$(e.currentTarget).parents("li.item").first(),t=parseInt(a.attr("class").match(/item-([0-9]+)/)[1]),i=a.find("form").first().data("metadata");i.tc=null,i.tcin=null,i.tcout=null,i.label=null,i.selected=!1,i.formCreated=!1,e.data.self.metadataManager.removeSelectedItem(t),a.remove(),i.deleted=!0,i.hasOwnProperty("subItem")&&!0===i.subItem&&(i=e.data.self.mediaPlayer.getMetadataById(e.data.self.metadataId),e.data.self.localisationManager.updateSpacialLocBlock(i)),a.remove(),e.data.self.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:e.data.self.metadataId})},onSelectedMetadataChange:function(e,a){for(var t=e.data.self.container.find("ul.listOfSelectedItems li.item"),i=0;i<t.length;i++)e.data.self._closeItem($(t[i]));e.data.self.metadataId=null!==a.metadataId?a.metadataId.toString():null,e.data.self.clearMessage()},onAddItem:function(e){if(null!==e.data.self.metadataId&&""!==e.data.self.metadataId){var a,t=null,i="";switch(null!==e.data.self.metadataId&&(a=null!==(a=e.data.self.mediaPlayer.getBlockMetadata(e.data.self.metadataId))&&a.hasOwnProperty("type")?a.type:"",i=e.data.self.bindingManager.getLinetypeWithDataType(a)),i){case fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_SEGMENT:t=[{tcin:e.data.self.mediaPlayer.getCurrentTime(),tcout:Math.min(e.data.self.mediaPlayer.getCurrentTime()+e.data.self.mediaPlayer.getDuration()*Math.min(e.data.self.settings.defaultPercentWidth,1),e.data.self.mediaPlayer.getDuration()),label:"New segment",tclevel:1,selected:!0,formCreated:!1}],e.data.self.mediaPlayer.addMetadataById(e.data.self.metadataId,t),e.data.self.clearMessage();break;case fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_IMAGE:case fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_CUEPOINT:t=[{tc:e.data.self.mediaPlayer.getCurrentTime(),label:"New Point",tclevel:1,selected:!0,formCreated:!1}],e.data.self.mediaPlayer.addMetadataById(e.data.self.metadataId,t),e.data.self.clearMessage();break;default:e.data.self.setMessage([fr.ina.amalia.player.PlayerMessage.PLUGIN_METADATA_ITEMS_EDITOR_NEED_METADTA_ITEM_TYPE],"error")}}else e.data.self.setMessage([fr.ina.amalia.player.PlayerMessage.PLUGIN_METADATA_ITEMS_EDITOR_NEED_METADTA],"error")},onClearItems:function(e){for(var a=e.data.self.container.find("ul.listOfSelectedItems li.item"),t=0;t<a.length;t++)e.data.self._closeItem($(a[t]));e.data.self.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:e.data.self.metadataId})},onValidateItems:function(e){for(var a=e.data.self.container.find("ul.listOfSelectedItems li.item"),t=0;t<a.length;t++)e.data.self._validateItem($(a[t]))||$(a[t]).addClass("error");e.data.self.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:e.data.self.metadataId})},onDataChange:function(e,a){a.id===e.data.self.metadataId&&e.data.self.updateFormItems()},onSelectedItemsChange:function(e){null!==e.data.self.metadataId&&""!==e.data.self.metadataId&&(e.data.self.updateFormItems(),e.data.self.updateSelectedItems()),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"EndDataChange")}}),fr.ina.amalia.player.plugins.PluginBase.extend("fr.ina.amalia.player.plugins.MetadataItemEditorPlugin",{classCss:"ajs-plugin plugin-selected-item-editor",addSegmentIcon:"ajs-icon ajs-icon-add-whole-segment",msgAddSegment:"AJOUTER UN SEGMENT INTEGRALE",msgValid:"Créer un élément",msgEdit:"Modifier l'élément"},{container:null,metadataId:null,selectedItem:null,initialize:function(){this.metadataId=null,this.selectedItem=null,this._super(),this.settings=$.extend({timeFormat:"f",framerate:this.settings.framerate,defaultPercentWidth:.1},this.settings.parameters||{}),this.container=$("<div>",{class:this.Class.classCss}),this.pluginContainer.append(this.container),this.createAutoFillUpForm(),this.createFormContainer(),this.defineListeners()},createFormItem:function(e,a,t){var i=$("<div>",{class:"form-item "+e}),a=$("<input>",{class:"form-item-"+e,type:t,placeholder:a});return i.append(a),i},createControl:function(e,a){var t=$("<div>",{class:"form-item ctrl "+e}),a=$("<button>",{class:"form-ctrl-item-"+e,text:a});return t.append(a),t},createAutoFillUpForm:function(){var e=$("<div>",{class:"auto-fill-up-form"}),a=$("<div>",{class:"message",text:this.Class.msgAddSegment});e.append(a),e.append(this.createControl("yes","Oui")),e.append(this.createControl("no","NON")),this.container.append(e)},createFormContainer:function(){var e=$("<div>",{class:"form"});e.append(this.createFormItem("label","Titre","text")),e.append(this.createControl("tcin","TC-IN")),e.append(this.createFormItem("tcin","00:00:00:00","text")),e.append(this.createControl("tcout","TC-OUT")),e.append(this.createFormItem("tcout","00:00:00:00","text")),e.append(this.createControl("valid",this.Class.msgValid)),e.append(this.createControl("delete","Supprimer")),e.append(this.createControl("close-item","Annuler"));var a=this.createControl("auto-fill-up","");a.find("button").addClass(this.Class.addSegmentIcon),e.append(a),this.container.append(e)},defineListeners:function(){this.container.find(".form .form-item .form-ctrl-item-auto-fill-up").on("click",{self:this},this.onClickOpenAutoCompletForm),this.container.find(".auto-fill-up-form .form-ctrl-item-no").on("click",{self:this},this.onClickCloseAutoCompletForm),this.container.find(".auto-fill-up-form .form-ctrl-item-yes").on("click",{self:this},this.onClickAutoCompletForm),this.container.find(".form .form-ctrl-item-tcin").on("click",{self:this},this.onClickToTcin),this.container.find(".form .form-ctrl-item-tcout").on("click",{self:this},this.onClickToTcout),this.container.find(".form .form-item-tcin").on("keyup",{self:this},this.onFormValuesChange),this.container.find(".form .form-item-tcin").on("change",{self:this},this.onFormValuesChange),this.container.find(".form .form-item-tcout").on("keyup",{self:this},this.onFormValuesChange),this.container.find(".form .form-item-tcout").on("change",{self:this},this.onFormValuesChange),this.container.find(".form .form-item .form-ctrl-item-valid").on("click",{self:this},this.onFormValid),this.container.find(".form .form-item .form-ctrl-item-delete").on("click",{self:this},this.onDeleteItem),this.container.find(".form .form-item .form-ctrl-item-close-item").on("click",{self:this},this.onCloseItem);var e=this.mediaPlayer.getContainer();e.on(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{self:this},this.onDataChange),e.on(fr.ina.amalia.player.PlayerEventType.SELECTED_ITEMS_CHANGE,{self:this},this.onSelectedItemsChange),e.on(fr.ina.amalia.player.PlayerEventType.SELECTED_METADATA_CHANGE,{self:this},this.onSelectedMetadataChange),null!==this.logger&&this.logger.trace(this.Class.fullName,"definePlayerListeners")},addItem:function(){var e,a,t,i;null!==this.metadataId&&(e=this.container.find(".form input.form-item-label").val(),a=this.container.find(".form input.form-item-tcin").val(),t=this.container.find(".form input.form-item-tcout").val(),null===this.selectedItem?(i=[{tcin:fr.ina.amalia.player.helpers.UtilitiesHelper.convertTimeFPSToSeconde(a),tcout:fr.ina.amalia.player.helpers.UtilitiesHelper.convertTimeFPSToSeconde(t),label:""===e?this.getLabel():e}],this.mediaPlayer.addMetadataById(this.metadataId,i),this.clearSelectedData()):null!==this.selectedItem&&this.selectedItem.hasOwnProperty("label")&&this.selectedItem.hasOwnProperty("tcin")&&this.selectedItem.hasOwnProperty("tcout")&&(this.selectedItem.label=""===e?this.getLabel():e,this.selectedItem.tcin=fr.ina.amalia.player.helpers.UtilitiesHelper.convertTimeFPSToSeconde(a),this.selectedItem.tcout=fr.ina.amalia.player.helpers.UtilitiesHelper.convertTimeFPSToSeconde(t),this.clearSelectedData(),this.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:this.metadataId})),this.container.find(".form").removeClass("edit-mode"))},getLabel:function(){var e="",a=this.mediaPlayer.getBlockMetadata(this.metadataId),t=$(this.mediaPlayer.getMetadataById(this.metadataId)).size();return e=null!==a&&a.hasOwnProperty("label")?a.label+" - "+t:e},addItemAuto:function(){if(null===this.metadataId)return!1;var e=[{tcin:this.mediaPlayer.getTcin(),tcout:this.mediaPlayer.getTcout(),label:this.getLabel()}];return this.mediaPlayer.addMetadataById(this.metadataId,e),this.clearSelectedData(),!0},clearSelectedData:function(){null!==this.selectedItem&&this.selectedItem.hasOwnProperty("selected")&&(this.selectedItem.selected=!1),this.selectedItem=null,this.container.find(".form").removeClass("edit-mode"),this.container.find(".form input.form-item-label").val(""),this.container.find(".form input.form-item-tcin").val(""),this.container.find(".form input.form-item-tcout").val(""),this.container.find(".form .form-item .form-ctrl-item-delete").removeClass("on"),this.container.find(".form .form-item .form-ctrl-item-close-item").removeClass("on"),this.container.find(".form .form-item .form-ctrl-item-valid").text(this.Class.msgValid),this.container.find(".form .form-item .form-ctrl-item-valid").removeClass("valid"),this.container.find(".form").removeClass("valid"),this.container.find(".form input.form-item-tcout").removeClass("error").removeClass("valid"),this.container.find(".form input.form-item-tcin").removeClass("error").removeClass("valid")},validFormItems:function(){var e=!0,a=/^[0-9]{2}:[0-9]{2}:[0-9]{2}:[0-9]{2}$/,t=this.container.find(".form input.form-item-tcin").val(),i=this.container.find(".form input.form-item-tcout").val();return!0!==a.test(t)?(this.container.find(".form input.form-item-tcin").addClass("error").removeClass("valid"),e=!1):this.container.find(".form input.form-item-tcin").removeClass("error").addClass("valid"),!0!==a.test(i)?(this.container.find(".form input.form-item-tcout").addClass("error").removeClass("valid"),e=!1):this.container.find(".form input.form-item-tcout").removeClass("error").addClass("valid"),fr.ina.amalia.player.helpers.UtilitiesHelper.convertTimeFPSToSeconde(t)>=fr.ina.amalia.player.helpers.UtilitiesHelper.convertTimeFPSToSeconde(i)&&(this.container.find(".form input.form-item-tcin").addClass("error"),this.container.find(".form input.form-item-tcout").addClass("error"),e=!1),null===this.selectedItem?(this.container.find(".form .form-item .form-ctrl-item-delete").removeClass("on"),this.container.find(".form .form-item .form-ctrl-item-close-item").removeClass("on"),this.container.find(".form .form-item .form-ctrl-item-valid").text(this.Class.msgValid)):(this.container.find(".form .form-item .form-ctrl-item-delete").addClass("on"),this.container.find(".form .form-item .form-ctrl-item-close-item").addClass("on"),this.container.find(".form .form-item .form-ctrl-item-valid").text(this.Class.msgEdit)),e?(this.container.find(".form .form-item .form-ctrl-item-valid").addClass("valid"),this.container.find(".form").addClass("valid")):(this.container.find(".form .form-item .form-ctrl-item-valid").removeClass("valid"),this.container.find(".form").removeClass("valid")),e},setTcin:function(){var e;this.container.find(".form input.form-item-tcin").val(fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(this.mediaPlayer.getCurrentTime(),this.settings.framerate,this.settings.timeFormat)),""===this.container.find(".form input.form-item-tcout").val()?(e=Math.min(this.mediaPlayer.getCurrentTime()+this.mediaPlayer.getDuration()*Math.min(this.settings.defaultPercentWidth,1),this.mediaPlayer.getDuration()),this.container.find(".form input.form-item-tcout").val(fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(e,this.settings.framerate,this.settings.timeFormat)),this.validFormItems(),this.container.find(".form input.form-item-tcout").removeClass("error").removeClass("valid")):this.validFormItems()},setTcout:function(){this.container.find(".form input.form-item-tcout").val(fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(this.mediaPlayer.getCurrentTime(),this.settings.framerate,this.settings.timeFormat)),this.validFormItems()},validForm:function(){this.validFormItems()&&this.addItem()},onFormValuesChange:function(e){e.data.self.validFormItems()},onClickToTcin:function(e){e.data.self.setTcin()},onClickToTcout:function(e){e.data.self.setTcout()},onSelectedItemsChange:function(e,a){e.data.self.selectedItem=void 0!==a&&a.hasOwnProperty("item")?a.item:null,null!==e.data.self.selectedItem&&!1===e.data.self.selectedItem.selected?(e.data.self.selectedItem=null,e.data.self.clearSelectedData()):null!==e.data.self.selectedItem&&e.data.self.selectedItem.hasOwnProperty("label")&&e.data.self.selectedItem.hasOwnProperty("tcin")&&e.data.self.selectedItem.hasOwnProperty("tcout")&&(e.data.self.container.find(".form").addClass("edit-mode"),e.data.self.container.find(".form input.form-item-label").val(e.data.self.selectedItem.label),e.data.self.container.find(".form input.form-item-tcin").val(fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(e.data.self.selectedItem.tcin,e.data.self.settings.framerate,e.data.self.settings.timeFormat)),e.data.self.container.find(".form input.form-item-tcout").val(fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(e.data.self.selectedItem.tcout,e.data.self.settings.framerate,e.data.self.settings.timeFormat)),e.data.self.validFormItems()),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onSelectedItemsChange")},onDataChange:function(e){null!==e.data.self.selectedItem&&e.data.self.selectedItem.hasOwnProperty("label")&&e.data.self.selectedItem.hasOwnProperty("tcin")&&e.data.self.selectedItem.hasOwnProperty("tcout")&&(e.data.self.container.find(".form input.form-item-label").val(e.data.self.selectedItem.label),e.data.self.container.find(".form input.form-item-tcin").val(fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(e.data.self.selectedItem.tcin,e.data.self.settings.framerate,"f")),e.data.self.container.find(".form input.form-item-tcout").val(fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(e.data.self.selectedItem.tcout,e.data.self.settings.framerate,"f")),e.data.self.validFormItems()),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onSelectedItemsChange")},onSelectedMetadataChange:function(e,a){e.data.self.mediaPlayer.removeAllSelectedItems(),e.data.self.metadataId=null!==a.metadataId?a.metadataId.toString():null},onClickOpenAutoCompletForm:function(e){e.data.self.container.find(".auto-fill-up-form").addClass("on")},onClickCloseAutoCompletForm:function(e){e.data.self.container.find(".auto-fill-up-form").removeClass("on")},onClickAutoCompletForm:function(e){e.data.self.addItemAuto(),e.data.self.container.find(".auto-fill-up-form").removeClass("on")},onFormValid:function(e){e.data.self.validForm()},onDeleteItem:function(e){e.data.self.selectedItem.tc=null,e.data.self.selectedItem.tcin=null,e.data.self.selectedItem.tcout=null,e.data.self.selectedItem.label=null,e.data.self.selectedItem.selected=!1,e.data.self.selectedItem.formCreated=!1,e.data.self.selectedItem.deleted=!0,e.data.self.selectedItem=null,e.data.self.clearSelectedData(),e.data.self.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:e.data.self.metadataId})},onCloseItem:function(e){e.data.self.selectedItem=null,e.data.self.mediaPlayer.removeAllSelectedItems(),e.data.self.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:e.data.self.metadataId}),e.data.self.clearSelectedData()}}),fr.ina.amalia.player.plugins.PluginBase.extend("fr.ina.amalia.player.plugins.MetadataItemsRefEditorPlugin",{classCss:"ajs-plugin plugin-items-ref-editor",classCssForThumbCapture:"ajs-icon ajs-icon-screenshot",classCssEditForm:"ajs-icon ajs-icon-check",LABEL_DESCRIPTION:"Description"},{container:null,metadataId:null,selectedItem:null,localisationManager:null,initialize:function(){this.metadataId=null,this.selectedItem=null,this._super(),this.settings=$.extend({defaultPercentWidth:.1,timeFormat:"f",framerate:this.settings.framerate},this.settings.parameters||{}),this.container=$("<div>",{class:this.Class.classCss}),this.localisationManager=new fr.ina.amalia.player.LocalisationManager,this.pluginContainer.append(this.container),this.createMetadataItemsBlock(),this.defineListeners()},createMetadataItemsBlock:function(){var e=$("<div>",{class:"heading off"});e.append("<p class='title'></p>");var a=$("<div>",{class:"body"}),t=$("<div>",{class:"messages-container"}).hide(),i=$("<ul>",{class:"listOfSelectedItems"});a.append(e),a.append(t),a.append(i),this.container.append(a)},createItem:function(e){var a=$("<li>",{class:"item"}).data("metadata",e),t=$("<div>",{class:"thumb"}),i=$("<span>",{class:"capture "+this.Class.classCssForThumbCapture});e.hasOwnProperty("thumb")&&null!==e.thumb&&""!==e.thumb&&t.css("background-image","url("+e.thumb+")"),t.append(i),a.append(t);var l=$("<span>",{class:"text",text:e.hasOwnProperty("label")?e.label:""});a.append(l);i=$("<span>",{class:"tcin",text:e.hasOwnProperty("tcin")?fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(e.tcin,this.settings.framerate,this.settings.timeFormat):""});a.append(i);t=$("<span>",{class:"tcout",text:e.hasOwnProperty("tcout")?fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(e.tcout,this.settings.framerate,this.settings.timeFormat):""});a.append(t),a.append("<div style='clear: both;'></div>");l=$("<div>",{class:"edit-form"}),i=$("<p>",{class:"text-element"}),t=$("<label>",{class:"text-label",text:this.Class.LABEL_DESCRIPTION}),e=null!==e&&e.hasOwnProperty("data")&&null!==e.data&&e.data.hasOwnProperty("text")&&null!==e.data.text?e.data.text.join("\n"):"",e=$("<textarea>",{class:"text-element",text:e});i.append(t),i.append(e),l.append(i),e.one("keydown",function(){a.addClass("change")});i=$("<div>",{class:"actions-list"}),e=$("<button>",{class:"save "+this.Class.classCssEditForm});return i.append(e),l.append(i),a.append(l),a},updataFormHeader:function(){var e=this.mediaPlayer.getBlockMetadata(this.metadataId);null!==e&&"object"==typeof e&&e.hasOwnProperty("label")?(this.container.find("div.heading").removeClass("off").addClass("on"),this.container.find("div.heading p.title").html(e.label)):this.container.find("div.heading").removeClass("on").addClass("off")},updateFormItems:function(){var e=this.container.find("ul.listOfSelectedItems");e.empty(),this.localisationManager.updateLocBlock(this.mediaPlayer.getMetadataById(this.metadataId));var a=this.mediaPlayer.getMetadataById(this.metadataId);if(null!==a){for(var t=0;t<a.length;t++){var i=a[t];null!==i&&i.hasOwnProperty("tcin")&&i.tcin>=this.mediaPlayer.getTcOffset()&&e.append(this.createItem(i))}e.find("li.item .thumb .capture").on("click",{self:this},this.onClickToCapture),e.find("li.item").on("click",{self:this},this.onSelectItem),e.find("li.item .edit-form .save").on("click",{self:this},this.onSaveItem)}},updateCaptureImage:function(e){var a=this.mediaPlayer.getCurrentImage(),t=e.data("metadata");void 0!==t&&(t.thumb=a,e.find(".thumb").css("background-image","url("+a+")"))},saveItem:function(e){var a=e.find(".edit-form textarea.text-element").val().split("\n"),t=e.data("metadata");void 0!==t&&(null!==t.data&&void 0!==t.data||(t.data={}),t.data.text=a),e.removeClass("change")},defineListeners:function(){var e=this.mediaPlayer.getContainer();e.on(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{self:this},this.onDataChange),e.on(fr.ina.amalia.player.PlayerEventType.SELECTED_METADATA_CHANGE,{self:this},this.onSelectedMetadataChange),null!==this.logger&&this.logger.trace(this.Class.fullName,"definePlayerListeners")},onDataChange:function(e,a){null!==e.data.self.metadataId&&e.data.self.metadataId===a.id&&(e.data.self.updataFormHeader(),e.data.self.updateFormItems(),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onSelectedItemsChange"))},onSelectedMetadataChange:function(e,a){e.data.self.metadataId=null!==a.metadataId?a.metadataId.toString():null,e.data.self.updataFormHeader(),e.data.self.updateFormItems(),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onSelectedMetadataChange:"+a.metadataId)},onSelectItem:function(e){e.data.self.container.find("ul.listOfSelectedItems").find("li.item").removeClass("on"),$(e.currentTarget).addClass("on");var a=$(e.currentTarget).data("metadata");!0===a.hasOwnProperty("tcin")&&null!==a.tcin?e.data.self.mediaPlayer.setCurrentTime(parseFloat(a.tcin)):!0===a.hasOwnProperty("tc")&&null!==a.tc&&e.data.self.mediaPlayer.setCurrentTime(parseFloat(a.tc)),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onSelectItem")},onClickToCapture:function(e){e.data.self.updateCaptureImage($(e.currentTarget).parents("li").first()),e.preventDefault(),e.stopPropagation(),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onClickToCapture")},onSaveItem:function(e){e.preventDefault(),e.data.self.saveItem($(e.currentTarget).parents("li").first()),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onClickToCapture")}});