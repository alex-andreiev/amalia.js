/*!Amalia.js ========== V1.3.5, Â© INA 2021 */
/**
 * Copyright (c) 2015 Institut National de l'Audiovisuel, INA
 * This file is part of amalia.js

 * amalia.js is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or (at your option) any later version.

 * Redistributions of source code, javascript and css minified versions
 * must retain the above copyright notice, this list of conditions and the following disclaimer.

 * Neither the name of the copyright holder nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.

 * You should have received a copy of the GNU General Public License
 * along with amalia.js. If not, see <http://www.gnu.org/licenses/>

 *
 * amalia.js is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 */


fr.ina.amalia.player.plugins.PluginBase.extend("fr.ina.amalia.player.plugins.WatermarkPlugin",{classCss:"ajs-plugin plugin-watermark",eventTypes:{}},{container:null,ratio:0,placement:"",placementList:["c","tl","tr","bl","br"],initialize:function(){this._super(),this.settings=$.extend({backgroundImageUrl:"",ratio:50,placement:"c",imageWidth:0,imageHeight:0,topOffet:45},this.settings.parameters||{}),""!==this.settings.backgroundImageUrl&&(this.setPlacement(this.settings.placement),this.container=$("<div>",{class:this.Class.classCss}),this.pluginContainer.append(this.container),this.defineListeners())},defineListeners:function(){this.mediaPlayer.getContainer().one(fr.ina.amalia.player.PlayerEventType.TIME_CHANGE,{self:this},this.onPluginReady),$(window).on("debouncedresize",{self:this},this.onWindowResize),null!==this.logger&&this.logger.trace(this.Class.fullName,"definePlayerListeners")},initializeOnLoadStart:function(){this.createWatermarkElement()},createWatermarkElement:function(){var t=$("<div>",{style:"background-image: url("+this.settings.backgroundImageUrl+");",class:"watermark"});this.container.append(t),this.updatePos()},updatePos:function(){var t=this.getVideoSize(),e=t.w,i=t.h,n=(this.container.width()-e)/2,t=(this.container.height()-i-this.settings.topOffet)/2;this.container.find(".watermark").css({width:e+"px",height:i+"px",top:t+"px",left:n+"px"}),this.updateImagePositionWithPlacement(),this.updateImageSize()},updateImageSize:function(){var t=this.getVideoSize(),e=t.w/this.settings.imageWidth,t=t.h/this.settings.imageHeight,e=Math.min(e,t),t=(e*=this.settings.ratio/100)*this.settings.imageWidth,e=e*this.settings.imageHeight;this.container.find(".watermark").css("background-size",t+"px "+e+"px")},updateImagePositionWithPlacement:function(){var t=this.container.find(".watermark"),e="50%",i="50%";"tl"===this.placement?i=e="0%":"tr"===this.placement?(e="100%",i="0%"):"bl"===this.placement?(e="0%",i="100%"):"br"===this.placement&&(i=e="100%"),t.css("background-position",e+" "+i)},getVideoSize:function(){var t=this.mediaPlayer.getMediaPlayer(),e=t.get(0).videoHeight,i=t.get(0).videoWidth;0===e&&(e=t.height()),0===i&&(i=t.width());var n=t.width()/i,t=t.height()/e,t=Math.min(n,t);return{w:t*i,h:t*e}},getPosition:function(){return this.placement},setPlacement:function(t){-1===$.inArray(t,this.placementList)?this.placement=this.placementList[0].toString():this.placement=t.toString()},onPluginReady:function(t){t.data.self.initializeOnLoadStart()},onWindowResize:function(t){t.data.self.updatePos()}});