/*!Amalia.js ========== V1.3.5, Â© INA 2021 */
/**
 * Copyright (c) 2015 Institut National de l'Audiovisuel, INA
 * This file is part of amalia.js

 * amalia.js is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or (at your option) any later version.

 * Redistributions of source code, javascript and css minified versions
 * must retain the above copyright notice, this list of conditions and the following disclaimer.

 * Neither the name of the copyright holder nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.

 * You should have received a copy of the GNU General Public License
 * along with amalia.js. If not, see <http://www.gnu.org/licenses/>

 *
 * amalia.js is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 */


fr.ina.amalia.player.plugins.PluginBase.extend("fr.ina.amalia.player.plugins.ProgressBarPlugin",{classCss:"ajs-plugin plugin-progress-bar",eventTypes:{}},{container:null,progressBar:null,sliding:!1,sliderStart:0,sliderEnd:1e3,defaultValue:0,initialize:function(){this._super(),this.sliding=!1,this.settings=$.extend({framerate:"25",timeFormat:"f"},this.settings.parameters||{}),this.container=$("<div>",{class:this.Class.classCss}),this.pluginContainer.append(this.container),this.createProgressBarElement(),this.defineListeners()},defineListeners:function(){this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.TIME_CHANGE,{self:this},this.onTimechange),null!==this.logger&&this.logger.trace(this.Class.fullName,"definePlayerListeners")},createProgressBarElement:function(){this.timeIndicatorContainer=$("<div>",{class:"ajs-time-indicator"});var e=$("<span>",{class:"ajs-tooltip-text"});this.timeIndicatorContainer.append(e),this.container.append(this.timeIndicatorContainer),this.progressBar=$("<div>",{class:"ajs-progress-bar"}),this.progressBar.slider({range:"min",min:this.sliderStart,max:this.sliderEnd,value:this.defaultValue,height:20}),this.progressBar.prepend($("<div>",{class:"buffer-bar"})),this.progressBar.on("slidestart",{self:this,component:this.component},this.onSlideStart),this.progressBar.on("slide",{self:this,component:this.component},this.onSlide),this.progressBar.on("slidestop",{self:this,component:this.component},this.onSlideStop),this.container.append(this.progressBar),this.container.find(".ajs-progress-bar").on("mouseover",$.proxy(this.onProgressBarMouseover,this)),this.container.find(".ajs-progress-bar").on("mouseout",$.proxy(this.onProgressBarMouseoout,this)),this.container.find(".ajs-progress-bar").on("mousemove",$.proxy(this.onProgressBarMousemove,this))},setValue:function(e){!1===this.sliding&&this.progressBar.slider("value",10*e)},setTitle:function(e){this.progressBar.attr("title",e)},onTimechange:function(e,t){var a=fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(t.currentTime,e.data.self.settings.framerate,e.data.self.settings.timeFormat);e.data.self.setValue(t.percentage),e.data.self.setTitle(a)},onSlideStart:function(e,t){e.data.self.sliding=!0,e.data.self.mediaPlayer.pause(),e.data.self.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.START_SEEKING,{percentage:t.value/10}),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onSlideStart Value : "+t.value)},onSlide:function(e,t){e.data.self.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.SEEKING,{percentage:t.value/10})},onSlideStop:function(e,t){e.data.self.sliding=!1;var a=e.data.self.mediaPlayer.getDuration(),s=t.value/10;e.data.self.mediaPlayer.setCurrentTime(a*s/100+e.data.self.mediaPlayer.getTcOffset()),e.data.self.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.STOP_SEEKING,{percentage:t.value/10}),e.data.self.mediaPlayer.play(),null!==e.data.self.logger&&e.data.self.logger.trace(e.data.self.Class.fullName,"onSlideStop value : "+t.value)},onProgressBarMouseover:function(){this.timeIndicatorContainer.show()},onProgressBarMouseoout:function(){this.timeIndicatorContainer.hide()},onProgressBarMousemove:function(e){var t=$(e.currentTarget),a=this.timeIndicatorContainer.width()/2,e=e.clientX-t.offset().left,a=Math.max(a,Math.min(e,t.width()-a)),t=e*this.mediaPlayer.getDuration()/t.width()+this.mediaPlayer.getTcOffset();this.timeIndicatorContainer.css("left",a),this.timeIndicatorContainer.find(".ajs-tooltip-text").html(fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(t,this.settings.framerate,this.settings.timeFormat))}});